[0m04:53:28.601157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f60651f9ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f60651fb770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6065927830>]}


============================== 04:53:28.623277 | 4403793a-49b3-4247-bbbb-4bcf0226ba3f ==============================
[0m04:53:28.623277 [info ] [MainThread]: Running with dbt=1.9.0
[0m04:53:28.625495 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt init hospital', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:53:28.663504 [info ] [MainThread]: Setting up your profile.
[0m04:53:42.530803 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": true, "command_wall_clock_time": 14.206742, "process_in_blocks": "40", "process_kernel_time": 0.973049, "process_mem_max_rss": "86528", "process_out_blocks": "64", "process_user_time": 6.663482}
[0m04:53:42.533004 [debug] [MainThread]: Command `dbt init` succeeded at 04:53:42.532615 after 14.21 seconds
[0m04:53:42.534738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f606550fce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6065927830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6064b89dc0>]}
[0m04:53:42.536320 [debug] [MainThread]: Flushing usage events
[0m04:53:44.206632 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:00:57.889778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0cb902bd70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0cba33c290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0cb902bfe0>]}


============================== 05:00:57.900777 | 5c4631c2-90e4-48db-8144-a9b04fdaa1c7 ==============================
[0m05:00:57.900777 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:00:57.902838 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt init hospital', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m05:00:57.938674 [info ] [MainThread]: Setting up your profile.
[0m05:02:57.998084 [info ] [MainThread]: Profile hospital written to /root/.dbt/profiles.yml using target's profile_template.yml and your supplied values. Run 'dbt debug' to validate the connection.
[0m05:02:58.002322 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": true, "command_wall_clock_time": 120.38239, "process_in_blocks": "96", "process_kernel_time": 1.157523, "process_mem_max_rss": "91904", "process_out_blocks": "24", "process_user_time": 6.983865}
[0m05:02:58.004351 [debug] [MainThread]: Command `dbt init` succeeded at 05:02:58.003907 after 120.38 seconds
[0m05:02:58.005713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0cb865c6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0cb82bd1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0cb8a4f9e0>]}
[0m05:02:58.007063 [debug] [MainThread]: Flushing usage events
[0m05:02:59.483389 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:03:13.224631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f0cf1d6b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f0cf264950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f0cec1d400>]}


============================== 05:03:13.234123 | 21174ed8-5e9f-4628-a28d-94bd71820a51 ==============================
[0m05:03:13.234123 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:03:13.236724 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m05:03:13.271247 [info ] [MainThread]: dbt version: 1.9.0
[0m05:03:13.273067 [info ] [MainThread]: python version: 3.12.4
[0m05:03:13.273959 [info ] [MainThread]: python path: /usr/local/bin/python
[0m05:03:13.274806 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m05:03:13.484069 [info ] [MainThread]: Using profiles dir at /root/.dbt
[0m05:03:13.486467 [info ] [MainThread]: Using profiles.yml file at /root/.dbt/profiles.yml
[0m05:03:13.488524 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m05:03:13.490549 [info ] [MainThread]: adapter type: postgres
[0m05:03:13.491906 [info ] [MainThread]: adapter version: 1.9.0
[0m05:03:13.838654 [info ] [MainThread]: Configuration:
[0m05:03:13.840498 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m05:03:13.841713 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m05:03:13.843433 [info ] [MainThread]: Required dependencies:
[0m05:03:13.844766 [debug] [MainThread]: Executing "git --help"
[0m05:03:13.853863 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m05:03:13.855999 [debug] [MainThread]: STDERR: "b''"
[0m05:03:13.857309 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m05:03:13.858950 [info ] [MainThread]: Connection:
[0m05:03:13.860403 [info ] [MainThread]:   host: project_postgres
[0m05:03:13.862221 [info ] [MainThread]:   port: 5432
[0m05:03:13.864106 [info ] [MainThread]:   user: postgres
[0m05:03:13.865458 [info ] [MainThread]:   database: hospital
[0m05:03:13.867008 [info ] [MainThread]:   schema: public
[0m05:03:13.868875 [info ] [MainThread]:   connect_timeout: 10
[0m05:03:13.870781 [info ] [MainThread]:   role: None
[0m05:03:13.872800 [info ] [MainThread]:   search_path: None
[0m05:03:13.875147 [info ] [MainThread]:   keepalives_idle: 0
[0m05:03:13.876687 [info ] [MainThread]:   sslmode: None
[0m05:03:13.877686 [info ] [MainThread]:   sslcert: None
[0m05:03:13.879421 [info ] [MainThread]:   sslkey: None
[0m05:03:13.880910 [info ] [MainThread]:   sslrootcert: None
[0m05:03:13.882881 [info ] [MainThread]:   application_name: dbt
[0m05:03:13.884698 [info ] [MainThread]:   retries: 1
[0m05:03:13.886758 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:03:14.345537 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m05:03:14.611141 [debug] [MainThread]: Using postgres connection "debug"
[0m05:03:14.612412 [debug] [MainThread]: On debug: select 1 as id
[0m05:03:14.613486 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:03:14.669550 [debug] [MainThread]: SQL status: SELECT 1 in 0.056 seconds
[0m05:03:14.673490 [debug] [MainThread]: On debug: Close
[0m05:03:14.674842 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m05:03:14.676153 [info ] [MainThread]: [32mAll checks passed![0m
[0m05:03:14.686550 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.739204, "process_in_blocks": "6104", "process_kernel_time": 0.981097, "process_mem_max_rss": "101708", "process_out_blocks": "40", "process_user_time": 5.183801}
[0m05:03:14.689560 [debug] [MainThread]: Command `dbt debug` succeeded at 05:03:14.688864 after 1.74 seconds
[0m05:03:14.690898 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m05:03:14.692386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f0d0658bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f0cee00a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f0cce8fc80>]}
[0m05:03:14.693884 [debug] [MainThread]: Flushing usage events
[0m05:03:16.180647 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:08:38.536463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde5766ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde4e1d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde57675c0>]}


============================== 05:08:38.547539 | fbd39793-b42d-4508-965a-08dcb36de12e ==============================
[0m05:08:38.547539 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:08:38.549769 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/root/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m05:08:39.132283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbd39793-b42d-4508-965a-08dcb36de12e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde3fa7890>]}
[0m05:08:39.352946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fbd39793-b42d-4508-965a-08dcb36de12e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde3e3a450>]}
[0m05:08:39.355502 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:08:39.834422 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:08:39.837524 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m05:08:39.839209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fbd39793-b42d-4508-965a-08dcb36de12e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde43e5250>]}
[0m05:08:46.665545 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.hospital.daily_visits' (models/daily_visits.sql) depends on a source named 'hospital.visits' which was not found
[0m05:08:46.669788 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.411075, "process_in_blocks": "1968", "process_kernel_time": 1.254703, "process_mem_max_rss": "98872", "process_out_blocks": "16", "process_user_time": 11.526768}
[0m05:08:46.671715 [debug] [MainThread]: Command `dbt run` failed at 05:08:46.671300 after 8.41 seconds
[0m05:08:46.673273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde3fd4e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde23fab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75fde23fa510>]}
[0m05:08:46.674361 [debug] [MainThread]: Flushing usage events
[0m05:08:48.183869 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:21:35.629349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750877278410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750877905df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750876c49df0>]}


============================== 05:21:35.639953 | af29a485-5db7-4f8a-b645-d1dc9400d6c8 ==============================
[0m05:21:35.639953 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:21:35.642588 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/.dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m05:21:36.223990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af29a485-5db7-4f8a-b645-d1dc9400d6c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750876c49df0>]}
[0m05:21:36.447315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af29a485-5db7-4f8a-b645-d1dc9400d6c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508771fbf20>]}
[0m05:21:36.450178 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:21:36.917143 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:21:36.919650 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m05:21:36.921902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'af29a485-5db7-4f8a-b645-d1dc9400d6c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508764e8ef0>]}
[0m05:21:40.223493 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.hospital.daily_visits' (models/daily_visits.sql) depends on a source named 'public.visits' which was not found
[0m05:21:40.227716 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.9063683, "process_in_blocks": "0", "process_kernel_time": 0.920763, "process_mem_max_rss": "98776", "process_out_blocks": "16", "process_user_time": 8.560796}
[0m05:21:40.229670 [debug] [MainThread]: Command `dbt run` failed at 05:21:40.228987 after 4.91 seconds
[0m05:21:40.230917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750876d1f6e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508748b70b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75087674b260>]}
[0m05:21:40.232393 [debug] [MainThread]: Flushing usage events
[0m05:21:42.237378 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:22:48.479864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a39907bc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a398f67650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a398ad8bc0>]}


============================== 05:22:48.490188 | 8dc013d2-45f3-4059-9966-b95bf3c13e35 ==============================
[0m05:22:48.490188 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:22:48.491688 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:22:49.095955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8dc013d2-45f3-4059-9966-b95bf3c13e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a3982f3e90>]}
[0m05:22:49.314563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8dc013d2-45f3-4059-9966-b95bf3c13e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a39830f350>]}
[0m05:22:49.317183 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:22:49.764984 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:22:49.767222 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m05:22:49.768532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8dc013d2-45f3-4059-9966-b95bf3c13e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a396a8d3d0>]}
[0m05:22:53.024523 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.hospital.daily_visits' (models/daily_visits.sql) depends on a source named 'hospital.visits' which was not found
[0m05:22:53.028988 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.8450294, "process_in_blocks": "0", "process_kernel_time": 0.919515, "process_mem_max_rss": "98592", "process_out_blocks": "16", "process_user_time": 8.602604}
[0m05:22:53.030733 [debug] [MainThread]: Command `dbt run` failed at 05:22:53.030398 after 4.85 seconds
[0m05:22:53.032222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a3985165a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a3966274a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a396a70170>]}
[0m05:22:53.033435 [debug] [MainThread]: Flushing usage events
[0m05:22:54.473576 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:39:04.949886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dedb9ff5a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dedba5537a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dedb9a7d340>]}


============================== 05:39:04.962139 | f95d1a1a-40ca-4659-b09b-871fc123b075 ==============================
[0m05:39:04.962139 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:39:04.963838 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:39:05.000213 [info ] [MainThread]: dbt version: 1.9.0
[0m05:39:05.002376 [info ] [MainThread]: python version: 3.12.4
[0m05:39:05.003534 [info ] [MainThread]: python path: /usr/local/bin/python
[0m05:39:05.004835 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m05:39:05.200213 [info ] [MainThread]: Using profiles dir at /root/.dbt
[0m05:39:05.201936 [info ] [MainThread]: Using profiles.yml file at /root/.dbt/profiles.yml
[0m05:39:05.203189 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m05:39:05.204942 [info ] [MainThread]: adapter type: postgres
[0m05:39:05.206706 [info ] [MainThread]: adapter version: 1.9.0
[0m05:39:05.543507 [info ] [MainThread]: Configuration:
[0m05:39:05.545467 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m05:39:05.546885 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m05:39:05.548526 [info ] [MainThread]: Required dependencies:
[0m05:39:05.549936 [debug] [MainThread]: Executing "git --help"
[0m05:39:05.560320 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m05:39:05.561816 [debug] [MainThread]: STDERR: "b''"
[0m05:39:05.562818 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m05:39:05.564320 [info ] [MainThread]: Connection:
[0m05:39:05.565455 [info ] [MainThread]:   host: project_postgres
[0m05:39:05.566722 [info ] [MainThread]:   port: 5432
[0m05:39:05.568180 [info ] [MainThread]:   user: postgres
[0m05:39:05.569640 [info ] [MainThread]:   database: hospital
[0m05:39:05.571084 [info ] [MainThread]:   schema: public
[0m05:39:05.572412 [info ] [MainThread]:   connect_timeout: 10
[0m05:39:05.574053 [info ] [MainThread]:   role: None
[0m05:39:05.575174 [info ] [MainThread]:   search_path: None
[0m05:39:05.576754 [info ] [MainThread]:   keepalives_idle: 0
[0m05:39:05.578389 [info ] [MainThread]:   sslmode: None
[0m05:39:05.579375 [info ] [MainThread]:   sslcert: None
[0m05:39:05.580553 [info ] [MainThread]:   sslkey: None
[0m05:39:05.582311 [info ] [MainThread]:   sslrootcert: None
[0m05:39:05.583902 [info ] [MainThread]:   application_name: dbt
[0m05:39:05.585516 [info ] [MainThread]:   retries: 1
[0m05:39:05.587230 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:39:06.037716 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m05:39:06.177605 [debug] [MainThread]: Using postgres connection "debug"
[0m05:39:06.178931 [debug] [MainThread]: On debug: select 1 as id
[0m05:39:06.180288 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:39:06.202971 [debug] [MainThread]: SQL status: SELECT 1 in 0.023 seconds
[0m05:39:06.207191 [debug] [MainThread]: On debug: Close
[0m05:39:06.207985 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m05:39:06.209487 [info ] [MainThread]: [32mAll checks passed![0m
[0m05:39:06.220182 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.6319947, "process_in_blocks": "0", "process_kernel_time": 0.927224, "process_mem_max_rss": "101356", "process_out_blocks": "24", "process_user_time": 5.286197}
[0m05:39:06.222385 [debug] [MainThread]: Command `dbt debug` succeeded at 05:39:06.221884 after 1.63 seconds
[0m05:39:06.223711 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m05:39:06.225083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dedb9ff5a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dedb99ecb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dedba579c70>]}
[0m05:39:06.225947 [debug] [MainThread]: Flushing usage events
[0m05:39:07.624988 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:39:26.505008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a910f9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a910db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a910fa10>]}


============================== 05:39:26.514717 | 4dd1c52e-90cb-4f4b-84c0-cae4abc4f619 ==============================
[0m05:39:26.514717 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:39:26.516902 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/root/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt parse', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:39:27.075106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4dd1c52e-90cb-4f4b-84c0-cae4abc4f619', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a90724e0>]}
[0m05:39:27.287102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4dd1c52e-90cb-4f4b-84c0-cae4abc4f619', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a8fa28a0>]}
[0m05:39:27.290778 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:39:27.749562 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:39:27.752151 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m05:39:27.753485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4dd1c52e-90cb-4f4b-84c0-cae4abc4f619', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a775df40>]}
[0m05:39:31.597223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4dd1c52e-90cb-4f4b-84c0-cae4abc4f619', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a7409100>]}
[0m05:39:31.611665 [info ] [MainThread]: Performance info: /usr/app/dbt/target/perf_info.json
[0m05:39:31.838097 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:39:31.848132 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:39:31.851537 [debug] [MainThread]: Resource report: {"command_name": "parse", "command_success": true, "command_wall_clock_time": 5.628984, "process_in_blocks": "8", "process_kernel_time": 0.895911, "process_mem_max_rss": "101616", "process_out_blocks": "1664", "process_user_time": 9.227792}
[0m05:39:31.853312 [debug] [MainThread]: Command `dbt parse` succeeded at 05:39:31.852891 after 5.63 seconds
[0m05:39:31.854582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a913cdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a738aff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7289a7633740>]}
[0m05:39:31.855803 [debug] [MainThread]: Flushing usage events
[0m05:39:33.432995 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:39:48.561655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e674a7c410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e674778a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e674ea90a0>]}


============================== 05:39:48.570979 | 42efc4e0-9e33-41b3-a208-8fd5c138b45c ==============================
[0m05:39:48.570979 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:39:48.573382 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m05:39:49.116359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e6747b2510>]}
[0m05:39:49.324985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e67515f500>]}
[0m05:39:49.327226 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:39:49.779869 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:39:50.140666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:39:50.142155 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:39:50.254567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e672dba570>]}
[0m05:39:50.502746 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:39:50.511761 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:39:50.602996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e672aeeff0>]}
[0m05:39:50.604790 [info ] [MainThread]: Found 2 models, 1 source, 429 macros
[0m05:39:50.606353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e67452bda0>]}
[0m05:39:50.613061 [info ] [MainThread]: 
[0m05:39:50.614599 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:39:50.615916 [info ] [MainThread]: 
[0m05:39:50.618386 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m05:39:50.634110 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m05:39:50.804728 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m05:39:50.806253 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m05:39:50.807697 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:39:50.832932 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m05:39:50.837980 [debug] [ThreadPool]: On list_hospital: Close
[0m05:39:50.843146 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m05:39:50.860930 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m05:39:50.862054 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m05:39:50.862849 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:39:50.881348 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m05:39:50.882344 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m05:39:50.883497 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m05:39:50.902691 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.018 seconds
[0m05:39:50.907787 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m05:39:50.910213 [debug] [ThreadPool]: On list_hospital_public: Close
[0m05:39:50.928139 [debug] [MainThread]: Using postgres connection "master"
[0m05:39:50.929569 [debug] [MainThread]: On master: BEGIN
[0m05:39:50.931173 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:39:50.951539 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m05:39:50.952819 [debug] [MainThread]: Using postgres connection "master"
[0m05:39:50.954482 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m05:39:50.997435 [debug] [MainThread]: SQL status: SELECT 0 in 0.041 seconds
[0m05:39:51.002620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e672aef6b0>]}
[0m05:39:51.004414 [debug] [MainThread]: On master: ROLLBACK
[0m05:39:51.006338 [debug] [MainThread]: Using postgres connection "master"
[0m05:39:51.007534 [debug] [MainThread]: On master: BEGIN
[0m05:39:51.010449 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m05:39:51.011713 [debug] [MainThread]: On master: COMMIT
[0m05:39:51.012866 [debug] [MainThread]: Using postgres connection "master"
[0m05:39:51.014086 [debug] [MainThread]: On master: COMMIT
[0m05:39:51.016320 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m05:39:51.017188 [debug] [MainThread]: On master: Close
[0m05:39:51.024850 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m05:39:51.026673 [info ] [Thread-1 (]: 1 of 2 START sql view model public.daily_visits ................................ [RUN]
[0m05:39:51.028733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m05:39:51.030155 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m05:39:51.051500 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m05:39:51.053765 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m05:39:51.162559 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m05:39:51.164673 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:39:51.165674 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m05:39:51.166746 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:39:51.186382 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m05:39:51.187683 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:39:51.189214 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_date, doctor_id
)
SELECT * FROM visits;
  );
[0m05:39:51.191934 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 15: SELECT * FROM visits;
                             ^

[0m05:39:51.193311 [debug] [Thread-1 (]: On model.hospital.daily_visits: ROLLBACK
[0m05:39:51.195446 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m05:39:51.237148 [debug] [Thread-1 (]: Database Error in model daily_visits (models/daily_visits.sql)
  syntax error at or near ";"
  LINE 15: SELECT * FROM visits;
                               ^
  compiled code at target/run/hospital/models/daily_visits.sql
[0m05:39:51.243227 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e6751a5df0>]}
[0m05:39:51.245740 [error] [Thread-1 (]: 1 of 2 ERROR creating sql view model public.daily_visits ....................... [[31mERROR[0m in 0.21s]
[0m05:39:51.248487 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m05:39:51.250157 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m05:39:51.252165 [debug] [Thread-4 (]: Marking all children of 'model.hospital.daily_visits' to be skipped because of status 'error'.  Reason: Database Error in model daily_visits (models/daily_visits.sql)
  syntax error at or near ";"
  LINE 15: SELECT * FROM visits;
                               ^
  compiled code at target/run/hospital/models/daily_visits.sql.
[0m05:39:51.254502 [info ] [Thread-1 (]: 2 of 2 START sql view model public.top_diagnoses ............................... [RUN]
[0m05:39:51.260272 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.top_diagnoses)
[0m05:39:51.262324 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m05:39:51.270442 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m05:39:51.272419 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m05:39:51.282473 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m05:39:51.285239 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:39:51.286609 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m05:39:51.287874 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:39:51.309806 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m05:39:51.311312 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:39:51.312533 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC;
  );
[0m05:39:51.316525 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 15: ORDER BY count DESC;
                            ^

[0m05:39:51.318722 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: ROLLBACK
[0m05:39:51.320997 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m05:39:51.329344 [debug] [Thread-1 (]: Database Error in model top_diagnoses (models/top_diagnoses.sql)
  syntax error at or near ";"
  LINE 15: ORDER BY count DESC;
                              ^
  compiled code at target/run/hospital/models/top_diagnoses.sql
[0m05:39:51.330925 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42efc4e0-9e33-41b3-a208-8fd5c138b45c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e671114410>]}
[0m05:39:51.333247 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model public.top_diagnoses ...................... [[31mERROR[0m in 0.07s]
[0m05:39:51.335696 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m05:39:51.337904 [debug] [Thread-4 (]: Marking all children of 'model.hospital.top_diagnoses' to be skipped because of status 'error'.  Reason: Database Error in model top_diagnoses (models/top_diagnoses.sql)
  syntax error at or near ";"
  LINE 15: ORDER BY count DESC;
                              ^
  compiled code at target/run/hospital/models/top_diagnoses.sql.
[0m05:39:51.342968 [debug] [MainThread]: Using postgres connection "master"
[0m05:39:51.343736 [debug] [MainThread]: On master: BEGIN
[0m05:39:51.344975 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:39:51.364506 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m05:39:51.365188 [debug] [MainThread]: On master: COMMIT
[0m05:39:51.365836 [debug] [MainThread]: Using postgres connection "master"
[0m05:39:51.366470 [debug] [MainThread]: On master: COMMIT
[0m05:39:51.367417 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m05:39:51.368443 [debug] [MainThread]: On master: Close
[0m05:39:51.370567 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:39:51.371590 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m05:39:51.372970 [info ] [MainThread]: 
[0m05:39:51.375217 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m05:39:51.378881 [debug] [MainThread]: Command end result
[0m05:39:51.439478 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:39:51.446615 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:39:51.468870 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m05:39:51.470319 [info ] [MainThread]: 
[0m05:39:51.472076 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m05:39:51.473478 [info ] [MainThread]: 
[0m05:39:51.475484 [error] [MainThread]:   Database Error in model daily_visits (models/daily_visits.sql)
  syntax error at or near ";"
  LINE 15: SELECT * FROM visits;
                               ^
  compiled code at target/run/hospital/models/daily_visits.sql
[0m05:39:51.476710 [info ] [MainThread]: 
[0m05:39:51.478502 [error] [MainThread]:   Database Error in model top_diagnoses (models/top_diagnoses.sql)
  syntax error at or near ";"
  LINE 15: ORDER BY count DESC;
                              ^
  compiled code at target/run/hospital/models/top_diagnoses.sql
[0m05:39:51.480248 [info ] [MainThread]: 
[0m05:39:51.482166 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m05:39:51.485837 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.178785, "process_in_blocks": "664", "process_kernel_time": 0.959177, "process_mem_max_rss": "107164", "process_out_blocks": "1840", "process_user_time": 6.43777}
[0m05:39:51.487842 [debug] [MainThread]: Command `dbt run` failed at 05:39:51.487301 after 3.18 seconds
[0m05:39:51.489147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e674778a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e674a25bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e674a26420>]}
[0m05:39:51.489757 [debug] [MainThread]: Flushing usage events
[0m05:39:52.941129 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:41:20.765398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2de9d3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2f7ca330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2dc88bf0>]}


============================== 05:41:20.776639 | 79e767e1-7bd0-425b-ab8e-49b021be5a01 ==============================
[0m05:41:20.776639 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:41:20.778707 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/root/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m05:41:21.357698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2d9dc740>]}
[0m05:41:21.575046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2ebc53d0>]}
[0m05:41:21.577734 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:41:22.039351 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:41:22.405780 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m05:41:22.408218 [debug] [MainThread]: Partial parsing: updated file: hospital://models/daily_visits.sql
[0m05:41:22.410183 [debug] [MainThread]: Partial parsing: updated file: hospital://models/top_diagnoses.sql
[0m05:41:23.355366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2be29670>]}
[0m05:41:23.583140 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:41:23.591471 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:41:23.645391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2bcf5bb0>]}
[0m05:41:23.647272 [info ] [MainThread]: Found 2 models, 1 source, 429 macros
[0m05:41:23.649152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2c18aff0>]}
[0m05:41:23.654819 [info ] [MainThread]: 
[0m05:41:23.656306 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:41:23.657899 [info ] [MainThread]: 
[0m05:41:23.660256 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m05:41:23.675995 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m05:41:24.086128 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m05:41:24.105649 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m05:41:24.120991 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:41:24.394832 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.288 seconds
[0m05:41:24.443588 [debug] [ThreadPool]: On list_hospital: Close
[0m05:41:24.498869 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m05:41:24.779255 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m05:41:24.780754 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m05:41:24.781983 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:41:24.801750 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m05:41:24.802803 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m05:41:24.803543 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m05:41:24.813780 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m05:41:24.818466 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m05:41:24.820608 [debug] [ThreadPool]: On list_hospital_public: Close
[0m05:41:24.945312 [debug] [MainThread]: Using postgres connection "master"
[0m05:41:24.952970 [debug] [MainThread]: On master: BEGIN
[0m05:41:24.960211 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:41:25.469004 [debug] [MainThread]: SQL status: BEGIN in 0.515 seconds
[0m05:41:25.483007 [debug] [MainThread]: Using postgres connection "master"
[0m05:41:25.546845 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m05:41:25.878731 [debug] [MainThread]: SQL status: SELECT 0 in 0.316 seconds
[0m05:41:25.922652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2be00290>]}
[0m05:41:25.924508 [debug] [MainThread]: On master: ROLLBACK
[0m05:41:25.926987 [debug] [MainThread]: Using postgres connection "master"
[0m05:41:25.928446 [debug] [MainThread]: On master: BEGIN
[0m05:41:25.930961 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m05:41:25.932063 [debug] [MainThread]: On master: COMMIT
[0m05:41:25.933056 [debug] [MainThread]: Using postgres connection "master"
[0m05:41:25.934044 [debug] [MainThread]: On master: COMMIT
[0m05:41:25.935905 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m05:41:25.936958 [debug] [MainThread]: On master: Close
[0m05:41:25.944766 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m05:41:25.949500 [info ] [Thread-1 (]: 1 of 2 START sql view model public.daily_visits ................................ [RUN]
[0m05:41:25.981985 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m05:41:26.012589 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m05:41:26.273115 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m05:41:26.303245 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m05:41:27.195665 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m05:41:27.203816 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:41:27.227811 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m05:41:27.245973 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:41:27.509444 [debug] [Thread-1 (]: SQL status: BEGIN in 0.259 seconds
[0m05:41:27.510417 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:41:27.527733 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_date, doctor_id
)
SELECT * FROM visits
  );
[0m05:41:27.560398 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "visit_date" does not exist
LINE 13:     GROUP BY visit_date, doctor_id
                      ^

[0m05:41:27.574073 [debug] [Thread-1 (]: On model.hospital.daily_visits: ROLLBACK
[0m05:41:27.581310 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m05:41:27.616215 [debug] [Thread-1 (]: Database Error in model daily_visits (models/daily_visits.sql)
  column "visit_date" does not exist
  LINE 13:     GROUP BY visit_date, doctor_id
                        ^
  compiled code at target/run/hospital/models/daily_visits.sql
[0m05:41:27.621704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2c08da00>]}
[0m05:41:27.622904 [error] [Thread-1 (]: 1 of 2 ERROR creating sql view model public.daily_visits ....................... [[31mERROR[0m in 1.64s]
[0m05:41:27.624055 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m05:41:27.624836 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m05:41:27.626724 [debug] [Thread-4 (]: Marking all children of 'model.hospital.daily_visits' to be skipped because of status 'error'.  Reason: Database Error in model daily_visits (models/daily_visits.sql)
  column "visit_date" does not exist
  LINE 13:     GROUP BY visit_date, doctor_id
                        ^
  compiled code at target/run/hospital/models/daily_visits.sql.
[0m05:41:27.628567 [info ] [Thread-1 (]: 2 of 2 START sql view model public.top_diagnoses ............................... [RUN]
[0m05:41:27.633738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.top_diagnoses)
[0m05:41:27.635498 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m05:41:27.644861 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m05:41:27.647046 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m05:41:27.654978 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m05:41:27.657778 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:41:27.659097 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m05:41:27.660399 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:41:27.684479 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m05:41:27.686235 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:41:27.687734 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m05:41:27.708853 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.020 seconds
[0m05:41:27.727059 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:41:27.728359 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m05:41:27.730561 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m05:41:27.780112 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m05:41:27.781561 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:41:27.783336 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m05:41:27.787568 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m05:41:27.807097 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m05:41:27.825557 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:41:27.827165 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m05:41:27.829347 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m05:41:27.836996 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m05:41:27.839548 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e767e1-7bd0-425b-ab8e-49b021be5a01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2f67e3f0>]}
[0m05:41:27.841567 [info ] [Thread-1 (]: 2 of 2 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.21s]
[0m05:41:27.844215 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m05:41:27.851010 [debug] [MainThread]: Using postgres connection "master"
[0m05:41:27.852546 [debug] [MainThread]: On master: BEGIN
[0m05:41:27.854721 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:41:27.876204 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m05:41:27.877727 [debug] [MainThread]: On master: COMMIT
[0m05:41:27.878859 [debug] [MainThread]: Using postgres connection "master"
[0m05:41:27.880148 [debug] [MainThread]: On master: COMMIT
[0m05:41:27.882528 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m05:41:27.883864 [debug] [MainThread]: On master: Close
[0m05:41:27.885797 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:41:27.887299 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m05:41:27.888724 [info ] [MainThread]: 
[0m05:41:27.891052 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 4.23 seconds (4.23s).
[0m05:41:27.898353 [debug] [MainThread]: Command end result
[0m05:41:27.967003 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:41:27.973181 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:41:27.996246 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m05:41:27.997397 [info ] [MainThread]: 
[0m05:41:27.999615 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m05:41:28.001714 [info ] [MainThread]: 
[0m05:41:28.004202 [error] [MainThread]:   Database Error in model daily_visits (models/daily_visits.sql)
  column "visit_date" does not exist
  LINE 13:     GROUP BY visit_date, doctor_id
                        ^
  compiled code at target/run/hospital/models/daily_visits.sql
[0m05:41:28.006775 [info ] [MainThread]: 
[0m05:41:28.009898 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m05:41:28.014489 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.541634, "process_in_blocks": "0", "process_kernel_time": 1.306162, "process_mem_max_rss": "110164", "process_out_blocks": "2544", "process_user_time": 9.384071}
[0m05:41:28.016681 [debug] [MainThread]: Command `dbt run` failed at 05:41:28.016257 after 7.54 seconds
[0m05:41:28.018459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2e4767b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2e0e1520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be2e552ff0>]}
[0m05:41:28.020199 [debug] [MainThread]: Flushing usage events
[0m05:41:29.691134 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:42:54.349763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021ddfbb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021bdb4980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021db68350>]}


============================== 05:42:54.359729 | 2ab7261f-dbb3-4025-9244-637cfcc7850c ==============================
[0m05:42:54.359729 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:42:54.361859 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m05:42:54.895343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021c69d700>]}
[0m05:42:55.099268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021c7b7a10>]}
[0m05:42:55.101927 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m05:42:55.545936 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:42:55.887941 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:42:55.889653 [debug] [MainThread]: Partial parsing: updated file: hospital://models/daily_visits.sql
[0m05:42:56.776080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770219f601d0>]}
[0m05:42:56.997949 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:42:57.005139 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:42:57.061260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770219f558b0>]}
[0m05:42:57.062965 [info ] [MainThread]: Found 2 models, 1 source, 429 macros
[0m05:42:57.064735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770219f4ad80>]}
[0m05:42:57.070593 [info ] [MainThread]: 
[0m05:42:57.071789 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:42:57.073183 [info ] [MainThread]: 
[0m05:42:57.075276 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m05:42:57.089299 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m05:42:57.249942 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m05:42:57.251441 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m05:42:57.253748 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:42:57.277626 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.024 seconds
[0m05:42:57.282132 [debug] [ThreadPool]: On list_hospital: Close
[0m05:42:57.287488 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m05:42:57.304149 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m05:42:57.305910 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m05:42:57.307310 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:42:57.327859 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m05:42:57.329902 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m05:42:57.331407 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m05:42:57.342247 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.009 seconds
[0m05:42:57.346557 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m05:42:57.348524 [debug] [ThreadPool]: On list_hospital_public: Close
[0m05:42:57.370210 [debug] [MainThread]: Using postgres connection "master"
[0m05:42:57.371560 [debug] [MainThread]: On master: BEGIN
[0m05:42:57.372618 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:42:57.393623 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m05:42:57.395200 [debug] [MainThread]: Using postgres connection "master"
[0m05:42:57.396630 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m05:42:57.423335 [debug] [MainThread]: SQL status: SELECT 1 in 0.026 seconds
[0m05:42:57.428870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021d9885c0>]}
[0m05:42:57.430496 [debug] [MainThread]: On master: ROLLBACK
[0m05:42:57.432066 [debug] [MainThread]: Using postgres connection "master"
[0m05:42:57.433417 [debug] [MainThread]: On master: BEGIN
[0m05:42:57.435071 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m05:42:57.435714 [debug] [MainThread]: On master: COMMIT
[0m05:42:57.436691 [debug] [MainThread]: Using postgres connection "master"
[0m05:42:57.437865 [debug] [MainThread]: On master: COMMIT
[0m05:42:57.440114 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m05:42:57.441231 [debug] [MainThread]: On master: Close
[0m05:42:57.448534 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m05:42:57.450259 [info ] [Thread-1 (]: 1 of 2 START sql view model public.daily_visits ................................ [RUN]
[0m05:42:57.451688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m05:42:57.454113 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m05:42:57.475051 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m05:42:57.478266 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m05:42:57.632303 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m05:42:57.635768 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:42:57.637219 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m05:42:57.638526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:42:57.660897 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m05:42:57.662574 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:42:57.663710 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m05:42:57.675311 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m05:42:57.695254 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:42:57.696678 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m05:42:57.699880 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m05:42:57.745106 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m05:42:57.746542 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:42:57.747837 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m05:42:57.751777 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m05:42:57.772587 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m05:42:57.791738 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m05:42:57.792968 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m05:42:57.794908 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m05:42:57.804348 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m05:42:57.809723 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770219f4a300>]}
[0m05:42:57.812333 [info ] [Thread-1 (]: 1 of 2 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.35s]
[0m05:42:57.814756 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m05:42:57.816443 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m05:42:57.818873 [info ] [Thread-1 (]: 2 of 2 START sql view model public.top_diagnoses ............................... [RUN]
[0m05:42:57.820465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.top_diagnoses)
[0m05:42:57.821563 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m05:42:57.831159 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m05:42:57.833576 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m05:42:57.844430 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m05:42:57.847098 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:42:57.848657 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m05:42:57.849821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:42:57.872456 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m05:42:57.873937 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:42:57.875406 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m05:42:57.883468 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m05:42:57.893677 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:42:57.895507 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m05:42:57.898800 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m05:42:57.908375 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:42:57.909625 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m05:42:57.911972 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m05:42:57.923740 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m05:42:57.925173 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:42:57.926264 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m05:42:57.930641 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m05:42:57.944342 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m05:42:57.946681 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m05:42:57.948593 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m05:42:57.953955 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m05:42:57.958653 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m05:42:57.961408 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ab7261f-dbb3-4025-9244-637cfcc7850c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770218754b00>]}
[0m05:42:57.963445 [info ] [Thread-1 (]: 2 of 2 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.14s]
[0m05:42:57.966260 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m05:42:57.971920 [debug] [MainThread]: Using postgres connection "master"
[0m05:42:57.973341 [debug] [MainThread]: On master: BEGIN
[0m05:42:57.974824 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:42:57.998433 [debug] [MainThread]: SQL status: BEGIN in 0.024 seconds
[0m05:42:58.000393 [debug] [MainThread]: On master: COMMIT
[0m05:42:58.001825 [debug] [MainThread]: Using postgres connection "master"
[0m05:42:58.003211 [debug] [MainThread]: On master: COMMIT
[0m05:42:58.005205 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m05:42:58.006787 [debug] [MainThread]: On master: Close
[0m05:42:58.008895 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:42:58.010426 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m05:42:58.012083 [info ] [MainThread]: 
[0m05:42:58.014384 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m05:42:58.017983 [debug] [MainThread]: Command end result
[0m05:42:58.088564 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:42:58.094402 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:42:58.124558 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m05:42:58.126441 [info ] [MainThread]: 
[0m05:42:58.128367 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:42:58.129811 [info ] [MainThread]: 
[0m05:42:58.131445 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m05:42:58.135061 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.046273, "process_in_blocks": "0", "process_kernel_time": 1.384667, "process_mem_max_rss": "109440", "process_out_blocks": "2552", "process_user_time": 10.14932}
[0m05:42:58.136864 [debug] [MainThread]: Command `dbt run` succeeded at 05:42:58.136530 after 4.05 seconds
[0m05:42:58.138117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021be489e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021c69fe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77021c6d4a40>]}
[0m05:42:58.139524 [debug] [MainThread]: Flushing usage events
[0m05:42:59.629106 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:02:03.859143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd32350bd70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd32350af30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd322b3ca70>]}


============================== 08:02:03.871282 | c49a175a-ea47-4bbf-9f4a-bbbf40417c88 ==============================
[0m08:02:03.871282 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:02:03.873415 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:02:03.906981 [info ] [MainThread]: dbt version: 1.9.0
[0m08:02:03.908686 [info ] [MainThread]: python version: 3.12.4
[0m08:02:03.910375 [info ] [MainThread]: python path: /usr/local/bin/python
[0m08:02:03.911731 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m08:02:04.131578 [info ] [MainThread]: Using profiles dir at /root/.dbt
[0m08:02:04.133675 [info ] [MainThread]: Using profiles.yml file at /root/.dbt/profiles.yml
[0m08:02:04.135547 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m08:02:04.138543 [info ] [MainThread]: adapter type: postgres
[0m08:02:04.140592 [info ] [MainThread]: adapter version: 1.9.0
[0m08:02:04.505652 [info ] [MainThread]: Configuration:
[0m08:02:04.507365 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:02:04.507953 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:02:04.509876 [info ] [MainThread]: Required dependencies:
[0m08:02:04.511442 [debug] [MainThread]: Executing "git --help"
[0m08:02:04.521018 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m08:02:04.522973 [debug] [MainThread]: STDERR: "b''"
[0m08:02:04.524287 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m08:02:04.526473 [info ] [MainThread]: Connection:
[0m08:02:04.528266 [info ] [MainThread]:   host: project_postgres
[0m08:02:04.530539 [info ] [MainThread]:   port: 5432
[0m08:02:04.532510 [info ] [MainThread]:   user: postgres
[0m08:02:04.534478 [info ] [MainThread]:   database: hospital
[0m08:02:04.536162 [info ] [MainThread]:   schema: public
[0m08:02:04.538273 [info ] [MainThread]:   connect_timeout: 10
[0m08:02:04.540186 [info ] [MainThread]:   role: None
[0m08:02:04.542282 [info ] [MainThread]:   search_path: None
[0m08:02:04.544193 [info ] [MainThread]:   keepalives_idle: 0
[0m08:02:04.545666 [info ] [MainThread]:   sslmode: None
[0m08:02:04.547567 [info ] [MainThread]:   sslcert: None
[0m08:02:04.549198 [info ] [MainThread]:   sslkey: None
[0m08:02:04.550697 [info ] [MainThread]:   sslrootcert: None
[0m08:02:04.553281 [info ] [MainThread]:   application_name: dbt
[0m08:02:04.554921 [info ] [MainThread]:   retries: 1
[0m08:02:04.558442 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:02:04.990739 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m08:02:05.134676 [debug] [MainThread]: Using postgres connection "debug"
[0m08:02:05.136147 [debug] [MainThread]: On debug: select 1 as id
[0m08:02:05.137422 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:02:05.160465 [debug] [MainThread]: SQL status: SELECT 1 in 0.023 seconds
[0m08:02:05.164339 [debug] [MainThread]: On debug: Close
[0m08:02:05.165717 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:02:05.167597 [info ] [MainThread]: [32mAll checks passed![0m
[0m08:02:05.178818 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.6100843, "process_in_blocks": "0", "process_kernel_time": 0.901657, "process_mem_max_rss": "101332", "process_out_blocks": "24", "process_user_time": 5.34497}
[0m08:02:05.181458 [debug] [MainThread]: Command `dbt debug` succeeded at 08:02:05.181199 after 1.61 seconds
[0m08:02:05.182779 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:02:05.184577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd322c33cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd323002540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd3228e94c0>]}
[0m08:02:05.186758 [debug] [MainThread]: Flushing usage events
[0m08:02:06.608784 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:10:52.356045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcf5edbd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcf5f34ac60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcf5edbfb00>]}


============================== 08:10:52.366983 | 4cfd4989-7f46-4124-9354-bb5da00a4b6a ==============================
[0m08:10:52.366983 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:10:52.369749 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:10:52.404937 [info ] [MainThread]: dbt version: 1.9.0
[0m08:10:52.406462 [info ] [MainThread]: python version: 3.12.4
[0m08:10:52.407892 [info ] [MainThread]: python path: /usr/local/bin/python
[0m08:10:52.409224 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m08:10:52.611091 [info ] [MainThread]: Using profiles dir at /root/.dbt
[0m08:10:52.612586 [info ] [MainThread]: Using profiles.yml file at /root/.dbt/profiles.yml
[0m08:10:52.613693 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m08:10:52.615191 [info ] [MainThread]: adapter type: postgres
[0m08:10:52.616390 [info ] [MainThread]: adapter version: 1.9.0
[0m08:10:52.957647 [info ] [MainThread]: Configuration:
[0m08:10:52.958901 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:10:52.960123 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:10:52.961770 [info ] [MainThread]: Required dependencies:
[0m08:10:52.962917 [debug] [MainThread]: Executing "git --help"
[0m08:10:52.971108 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m08:10:52.972989 [debug] [MainThread]: STDERR: "b''"
[0m08:10:52.974401 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m08:10:52.976064 [info ] [MainThread]: Connection:
[0m08:10:52.977261 [info ] [MainThread]:   host: project_postgres
[0m08:10:52.978381 [info ] [MainThread]:   port: 5432
[0m08:10:52.980776 [info ] [MainThread]:   user: postgres
[0m08:10:52.982413 [info ] [MainThread]:   database: hospital
[0m08:10:52.984710 [info ] [MainThread]:   schema: public
[0m08:10:52.986236 [info ] [MainThread]:   connect_timeout: 10
[0m08:10:52.987457 [info ] [MainThread]:   role: None
[0m08:10:52.989034 [info ] [MainThread]:   search_path: None
[0m08:10:52.990747 [info ] [MainThread]:   keepalives_idle: 0
[0m08:10:52.992466 [info ] [MainThread]:   sslmode: None
[0m08:10:52.994264 [info ] [MainThread]:   sslcert: None
[0m08:10:52.995364 [info ] [MainThread]:   sslkey: None
[0m08:10:52.996935 [info ] [MainThread]:   sslrootcert: None
[0m08:10:52.998816 [info ] [MainThread]:   application_name: dbt
[0m08:10:53.000439 [info ] [MainThread]:   retries: 1
[0m08:10:53.001717 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:10:53.434964 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m08:10:53.570094 [debug] [MainThread]: Using postgres connection "debug"
[0m08:10:53.571315 [debug] [MainThread]: On debug: select 1 as id
[0m08:10:53.571816 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:10:53.597227 [debug] [MainThread]: SQL status: SELECT 1 in 0.025 seconds
[0m08:10:53.601582 [debug] [MainThread]: On debug: Close
[0m08:10:53.602960 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:10:53.605507 [info ] [MainThread]: [32mAll checks passed![0m
[0m08:10:53.616180 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.562937, "process_in_blocks": "0", "process_kernel_time": 0.845984, "process_mem_max_rss": "101264", "process_out_blocks": "24", "process_user_time": 5.313343}
[0m08:10:53.618867 [debug] [MainThread]: Command `dbt debug` succeeded at 08:10:53.618097 after 1.57 seconds
[0m08:10:53.619986 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:10:53.621052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcf5fbd9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcf5f37de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcf5f7f6330>]}
[0m08:10:53.622571 [debug] [MainThread]: Flushing usage events
[0m08:10:55.313626 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:14:55.499370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c85ec1945f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c85ec47d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c85edc8cbf0>]}


============================== 08:14:55.509189 | d2912e08-e9c4-4c2b-a66d-23c404bf76af ==============================
[0m08:14:55.509189 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:14:55.511466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt debug --profile hospital_project', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:14:55.548748 [info ] [MainThread]: dbt version: 1.9.0
[0m08:14:55.550465 [info ] [MainThread]: python version: 3.12.4
[0m08:14:55.551725 [info ] [MainThread]: python path: /usr/local/bin/python
[0m08:14:55.553057 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m08:14:57.943610 [info ] [MainThread]: Using profiles dir at /root/.dbt
[0m08:14:57.945195 [info ] [MainThread]: Using profiles.yml file at /root/.dbt/profiles.yml
[0m08:14:57.947200 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m08:14:57.948288 [info ] [MainThread]: adapter type: bigquery
[0m08:14:57.949143 [info ] [MainThread]: adapter version: 1.9.1
[0m08:14:58.249299 [info ] [MainThread]: Configuration:
[0m08:14:58.251231 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:14:58.252668 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:14:58.254227 [info ] [MainThread]: Required dependencies:
[0m08:14:58.256437 [debug] [MainThread]: Executing "git --help"
[0m08:14:58.273530 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m08:14:58.275228 [debug] [MainThread]: STDERR: "b''"
[0m08:14:58.276478 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m08:14:58.277680 [info ] [MainThread]: Connection:
[0m08:14:58.279716 [info ] [MainThread]:   method: service-account
[0m08:14:58.282913 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m08:14:58.286402 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m08:14:58.289635 [info ] [MainThread]:   schema: hospital
[0m08:14:58.291253 [info ] [MainThread]:   location: asia-southeast2
[0m08:14:58.294844 [info ] [MainThread]:   priority: None
[0m08:14:58.297733 [info ] [MainThread]:   maximum_bytes_billed: None
[0m08:14:58.301333 [info ] [MainThread]:   impersonate_service_account: None
[0m08:14:58.304133 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m08:14:58.307130 [info ] [MainThread]:   job_retries: 1
[0m08:14:58.309299 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m08:14:58.311928 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m08:14:58.315108 [info ] [MainThread]:   timeout_seconds: 300
[0m08:14:58.318081 [info ] [MainThread]:   client_id: None
[0m08:14:58.320219 [info ] [MainThread]:   token_uri: None
[0m08:14:58.322337 [info ] [MainThread]:   dataproc_region: None
[0m08:14:58.325486 [info ] [MainThread]:   dataproc_cluster_name: None
[0m08:14:58.327600 [info ] [MainThread]:   gcs_bucket: None
[0m08:14:58.328837 [info ] [MainThread]:   dataproc_batch: None
[0m08:14:58.332978 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:14:58.977479 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m08:14:58.978718 [debug] [MainThread]: On debug: select 1 as id
[0m08:14:58.979776 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:14:59.750469 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a641f454-1fa7-47b4-b01d-f95aaec9726d&page=queryresults
[0m08:15:00.203823 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:15:00.205482 [info ] [MainThread]: [32mAll checks passed![0m
[0m08:15:00.209611 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.0001025, "process_in_blocks": "0", "process_kernel_time": 1.316301, "process_mem_max_rss": "202512", "process_out_blocks": "24", "process_user_time": 7.71904}
[0m08:15:00.211165 [debug] [MainThread]: Command `dbt debug` succeeded at 08:15:00.210824 after 5.00 seconds
[0m08:15:00.212242 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:15:00.213217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c85ec292c60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c85ec541a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c85cdaf2630>]}
[0m08:15:00.214505 [debug] [MainThread]: Flushing usage events
[0m08:15:01.739108 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:28:06.728410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c38c6ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c30b1010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c2bada60>]}


============================== 08:28:06.738270 | fb4032a0-fef0-44ca-8f59-7efd31283305 ==============================
[0m08:28:06.738270 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:28:06.739979 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profile hospital', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:28:07.313546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c2939ac0>]}
[0m08:28:07.513309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c32c7da0>]}
[0m08:28:07.516381 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:28:07.968995 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:28:08.250705 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m08:28:08.252635 [debug] [MainThread]: previous checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, current checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff
[0m08:28:08.254062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c28ffad0>]}
[0m08:28:12.053598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c0af2360>]}
[0m08:28:12.273630 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:28:12.283060 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:28:12.335610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c0914e60>]}
[0m08:28:12.336456 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:28:12.337628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c091b110>]}
[0m08:28:12.344730 [info ] [MainThread]: 
[0m08:28:12.347261 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:28:12.348738 [info ] [MainThread]: 
[0m08:28:12.351310 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:28:12.365002 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:28:12.654604 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:28:12.655771 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:28:12.656597 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:28:12.684421 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.028 seconds
[0m08:28:12.688844 [debug] [ThreadPool]: On list_hospital: Close
[0m08:28:12.697639 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:28:12.715693 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:28:12.717434 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:28:12.718499 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:28:12.736868 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m08:28:12.738226 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:28:12.739304 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:28:12.749152 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m08:28:12.754131 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:28:12.755835 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:28:12.776334 [debug] [MainThread]: Using postgres connection "master"
[0m08:28:12.777631 [debug] [MainThread]: On master: BEGIN
[0m08:28:12.778791 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:28:12.798993 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m08:28:12.799951 [debug] [MainThread]: Using postgres connection "master"
[0m08:28:12.801371 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:28:12.834175 [debug] [MainThread]: SQL status: SELECT 2 in 0.031 seconds
[0m08:28:12.841160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c0a88560>]}
[0m08:28:12.842663 [debug] [MainThread]: On master: ROLLBACK
[0m08:28:12.844676 [debug] [MainThread]: Using postgres connection "master"
[0m08:28:12.845809 [debug] [MainThread]: On master: BEGIN
[0m08:28:12.848673 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m08:28:12.849970 [debug] [MainThread]: On master: COMMIT
[0m08:28:12.851003 [debug] [MainThread]: Using postgres connection "master"
[0m08:28:12.852108 [debug] [MainThread]: On master: COMMIT
[0m08:28:12.855279 [debug] [MainThread]: SQL status: COMMIT in 0.002 seconds
[0m08:28:12.856424 [debug] [MainThread]: On master: Close
[0m08:28:12.863982 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_model
[0m08:28:12.865712 [info ] [Thread-1 (]: 1 of 5 START sql view model public.bigquery_model .............................. [RUN]
[0m08:28:12.867371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.bigquery_model)
[0m08:28:12.868627 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_model
[0m08:28:12.893282 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:28:12.895574 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_model
[0m08:28:13.007417 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:28:13.009574 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:28:13.010756 [debug] [Thread-1 (]: On model.hospital.bigquery_model: BEGIN
[0m08:28:13.011858 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:28:13.032501 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:28:13.033923 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:28:13.035426 [debug] [Thread-1 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */

  create view "hospital"."public"."bigquery_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "de-zoomcamp-2025--id"."hospital"."visits"
  );
[0m08:28:13.038430 [debug] [Thread-1 (]: Postgres adapter: Postgres error: cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
              ^

[0m08:28:13.039761 [debug] [Thread-1 (]: On model.hospital.bigquery_model: ROLLBACK
[0m08:28:13.041897 [debug] [Thread-1 (]: On model.hospital.bigquery_model: Close
[0m08:28:13.054891 [debug] [Thread-1 (]: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:28:13.060155 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c43cc2c0>]}
[0m08:28:13.062104 [error] [Thread-1 (]: 1 of 5 ERROR creating sql view model public.bigquery_model ..................... [[31mERROR[0m in 0.19s]
[0m08:28:13.064952 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_model
[0m08:28:13.066533 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:28:13.067932 [info ] [Thread-1 (]: 2 of 5 START sql view model public.daily_visits ................................ [RUN]
[0m08:28:13.070328 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.bigquery_model, now model.hospital.daily_visits)
[0m08:28:13.072497 [debug] [Thread-4 (]: Marking all children of 'model.hospital.bigquery_model' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql.
[0m08:28:13.074463 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:28:13.086852 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:28:13.089365 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:28:13.103172 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:28:13.105348 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:28:13.107401 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:28:13.108841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:28:13.130781 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:28:13.132351 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:28:13.133557 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:28:13.143547 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m08:28:13.165440 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:28:13.167183 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:28:13.170701 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:28:13.179454 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:28:13.181234 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:28:13.184702 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:28:13.236301 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:28:13.237800 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:28:13.239158 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:28:13.243284 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:28:13.264193 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:28:13.283323 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:28:13.284843 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:28:13.290609 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:28:13.298865 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:28:13.301301 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c0e58f20>]}
[0m08:28:13.303544 [info ] [Thread-1 (]: 2 of 5 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.23s]
[0m08:28:13.306324 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:28:13.307939 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:28:13.309819 [info ] [Thread-1 (]: 3 of 5 START sql table model public.hospital_visits ............................ [RUN]
[0m08:28:13.312246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:28:13.313860 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:28:13.321568 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:28:13.323411 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:28:13.395746 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:28:13.398197 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:28:13.399408 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:28:13.400615 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:28:13.419520 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m08:28:13.421087 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:28:13.422358 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        TIMESTAMP(visit_timestamp) AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.external_visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:28:13.424527 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "visit_timestamp"
LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                           ^

[0m08:28:13.425933 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:28:13.428430 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:28:13.436197 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:28:13.437745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211bb726510>]}
[0m08:28:13.439943 [error] [Thread-1 (]: 3 of 5 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.13s]
[0m08:28:13.441334 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:28:13.442890 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:28:13.444690 [info ] [Thread-1 (]: 4 of 5 START sql view model public.postgres_model .............................. [RUN]
[0m08:28:13.446727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:28:13.448320 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql.
[0m08:28:13.449631 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:28:13.458163 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:28:13.459860 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:28:13.470773 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:28:13.472939 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:28:13.474536 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:28:13.475737 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:28:13.497208 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m08:28:13.498478 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:28:13.500155 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:28:13.506550 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m08:28:13.516063 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:28:13.518134 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:28:13.520985 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:28:13.525954 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:28:13.527401 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:28:13.528630 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:28:13.532760 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:28:13.540634 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:28:13.543102 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:28:13.544498 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:28:13.546898 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m08:28:13.551388 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:28:13.553181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c0e590a0>]}
[0m08:28:13.555234 [info ] [Thread-1 (]: 4 of 5 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.11s]
[0m08:28:13.557590 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:28:13.559336 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:28:13.560889 [info ] [Thread-1 (]: 5 of 5 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:28:13.563121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:28:13.565147 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:28:13.577816 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:28:13.580342 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:28:13.589613 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:28:13.592308 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:28:13.593864 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:28:13.595296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:28:13.617055 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:28:13.618679 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:28:13.620257 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:28:13.626706 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m08:28:13.635810 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:28:13.637250 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:28:13.641336 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m08:28:13.648180 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:28:13.649703 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:28:13.652350 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:28:13.656286 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:28:13.657603 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:28:13.659231 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:28:13.662633 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:28:13.669143 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:28:13.671482 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:28:13.672725 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:28:13.676857 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m08:28:13.680446 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:28:13.682615 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb4032a0-fef0-44ca-8f59-7efd31283305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211bb75cfb0>]}
[0m08:28:13.684401 [info ] [Thread-1 (]: 5 of 5 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.12s]
[0m08:28:13.686754 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:28:13.692700 [debug] [MainThread]: Using postgres connection "master"
[0m08:28:13.694246 [debug] [MainThread]: On master: BEGIN
[0m08:28:13.695997 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:28:13.716494 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m08:28:13.717790 [debug] [MainThread]: On master: COMMIT
[0m08:28:13.718656 [debug] [MainThread]: Using postgres connection "master"
[0m08:28:13.719692 [debug] [MainThread]: On master: COMMIT
[0m08:28:13.721282 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:28:13.722349 [debug] [MainThread]: On master: Close
[0m08:28:13.723959 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:28:13.725590 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:28:13.727172 [info ] [MainThread]: 
[0m08:28:13.729265 [info ] [MainThread]: Finished running 1 table model, 4 view models in 0 hours 0 minutes and 1.38 seconds (1.38s).
[0m08:28:13.738711 [debug] [MainThread]: Command end result
[0m08:28:13.811002 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:28:13.817319 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:28:13.839224 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:28:13.840224 [info ] [MainThread]: 
[0m08:28:13.842153 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m08:28:13.844684 [info ] [MainThread]: 
[0m08:28:13.846871 [error] [MainThread]:   Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:28:13.849833 [info ] [MainThread]: 
[0m08:28:13.851734 [error] [MainThread]:   Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:28:13.853975 [info ] [MainThread]: 
[0m08:28:13.855465 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m08:28:13.859603 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.4165373, "process_in_blocks": "0", "process_kernel_time": 1.174353, "process_mem_max_rss": "110764", "process_out_blocks": "2704", "process_user_time": 12.080326}
[0m08:28:13.861634 [debug] [MainThread]: Command `dbt run` failed at 08:28:13.861162 after 7.42 seconds
[0m08:28:13.862813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c29abd70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c0917b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211c2730770>]}
[0m08:28:13.864484 [debug] [MainThread]: Flushing usage events
[0m08:28:15.460141 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:32:18.816725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7a1c0290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7a07b4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7a7ac0b0>]}


============================== 08:32:18.826524 | e969919e-3302-4ab5-a7cf-88f11d11d291 ==============================
[0m08:32:18.826524 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:32:18.828631 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profile hospital', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:32:19.376617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7b92faa0>]}
[0m08:32:19.579790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7bf60350>]}
[0m08:32:19.582505 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:32:20.038758 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:32:20.400288 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:32:20.402349 [debug] [MainThread]: Partial parsing: updated file: hospital://models/hospital_visits.sql
[0m08:32:21.337677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea77ef1610>]}
[0m08:32:21.560471 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:32:21.570376 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:32:21.626720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea77b2e450>]}
[0m08:32:21.629338 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:32:21.631313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7ae997c0>]}
[0m08:32:21.639273 [info ] [MainThread]: 
[0m08:32:21.640847 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:32:21.642247 [info ] [MainThread]: 
[0m08:32:21.644244 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:32:21.659289 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:32:21.848261 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:32:21.856716 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:32:21.857814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:32:21.884893 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.027 seconds
[0m08:32:21.889832 [debug] [ThreadPool]: On list_hospital: Close
[0m08:32:21.897935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:32:21.915096 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:32:21.916421 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:32:21.917652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:32:21.937403 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m08:32:21.938758 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:32:21.940422 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:32:21.954830 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.010 seconds
[0m08:32:21.959837 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:32:21.961469 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:32:21.982112 [debug] [MainThread]: Using postgres connection "master"
[0m08:32:21.983303 [debug] [MainThread]: On master: BEGIN
[0m08:32:21.984109 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:32:22.003444 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m08:32:22.004934 [debug] [MainThread]: Using postgres connection "master"
[0m08:32:22.007590 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:32:22.042139 [debug] [MainThread]: SQL status: SELECT 3 in 0.032 seconds
[0m08:32:22.049877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea79ba3740>]}
[0m08:32:22.051058 [debug] [MainThread]: On master: ROLLBACK
[0m08:32:22.053384 [debug] [MainThread]: Using postgres connection "master"
[0m08:32:22.055001 [debug] [MainThread]: On master: BEGIN
[0m08:32:22.056592 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m08:32:22.058307 [debug] [MainThread]: On master: COMMIT
[0m08:32:22.059418 [debug] [MainThread]: Using postgres connection "master"
[0m08:32:22.061158 [debug] [MainThread]: On master: COMMIT
[0m08:32:22.063174 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:32:22.064323 [debug] [MainThread]: On master: Close
[0m08:32:22.071890 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_model
[0m08:32:22.074171 [info ] [Thread-1 (]: 1 of 5 START sql view model public.bigquery_model .............................. [RUN]
[0m08:32:22.076650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.bigquery_model)
[0m08:32:22.078136 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_model
[0m08:32:22.106307 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:32:22.108611 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_model
[0m08:32:22.225340 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:32:22.228069 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:32:22.229193 [debug] [Thread-1 (]: On model.hospital.bigquery_model: BEGIN
[0m08:32:22.230151 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:32:22.249782 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m08:32:22.251457 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:32:22.252939 [debug] [Thread-1 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */

  create view "hospital"."public"."bigquery_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "de-zoomcamp-2025--id"."hospital"."visits"
  );
[0m08:32:22.256389 [debug] [Thread-1 (]: Postgres adapter: Postgres error: cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
              ^

[0m08:32:22.257897 [debug] [Thread-1 (]: On model.hospital.bigquery_model: ROLLBACK
[0m08:32:22.259898 [debug] [Thread-1 (]: On model.hospital.bigquery_model: Close
[0m08:32:22.271815 [debug] [Thread-1 (]: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:32:22.277874 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7a71a7b0>]}
[0m08:32:22.280605 [error] [Thread-1 (]: 1 of 5 ERROR creating sql view model public.bigquery_model ..................... [[31mERROR[0m in 0.20s]
[0m08:32:22.283605 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_model
[0m08:32:22.285428 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:32:22.287074 [info ] [Thread-1 (]: 2 of 5 START sql view model public.daily_visits ................................ [RUN]
[0m08:32:22.289335 [debug] [Thread-4 (]: Marking all children of 'model.hospital.bigquery_model' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql.
[0m08:32:22.291204 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.bigquery_model, now model.hospital.daily_visits)
[0m08:32:22.295746 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:32:22.304680 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:32:22.307385 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:32:22.317448 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:32:22.320335 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:32:22.321732 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:32:22.322651 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:32:22.344690 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m08:32:22.346258 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:32:22.347747 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:32:22.354737 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m08:32:22.376781 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:32:22.378536 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:32:22.381605 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:32:22.389873 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:32:22.390952 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:32:22.394252 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:32:22.444187 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:32:22.445920 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:32:22.447237 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:32:22.450904 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:32:22.473129 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:32:22.492689 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:32:22.493855 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:32:22.503334 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.008 seconds
[0m08:32:22.511747 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:32:22.513939 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea767cd280>]}
[0m08:32:22.515863 [info ] [Thread-1 (]: 2 of 5 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.22s]
[0m08:32:22.518332 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:32:22.520538 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:32:22.522667 [info ] [Thread-1 (]: 3 of 5 START sql table model public.hospital_visits ............................ [RUN]
[0m08:32:22.524765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:32:22.526259 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:32:22.532838 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:32:22.535978 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:32:22.603796 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:32:22.606609 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:32:22.608096 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:32:22.609618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:32:22.629508 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:32:22.631117 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:32:22.632541 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        TIMESTAMP(visit_timestamp) AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:32:22.635196 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "visit_timestamp"
LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                           ^

[0m08:32:22.636668 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:32:22.639103 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:32:22.646573 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:32:22.648172 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea76752930>]}
[0m08:32:22.649977 [error] [Thread-1 (]: 3 of 5 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.12s]
[0m08:32:22.652476 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:32:22.653899 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:32:22.655971 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql.
[0m08:32:22.657869 [info ] [Thread-1 (]: 4 of 5 START sql view model public.postgres_model .............................. [RUN]
[0m08:32:22.660818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:32:22.662065 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:32:22.668948 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:32:22.671302 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:32:22.681821 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:32:22.685120 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:32:22.686532 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:32:22.687716 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:32:22.711007 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m08:32:22.712544 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:32:22.714330 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:32:22.721262 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m08:32:22.731310 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:32:22.732859 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:32:22.735733 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:32:22.744712 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:32:22.746503 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:32:22.749527 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:32:22.754774 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:32:22.756420 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:32:22.757643 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:32:22.761362 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:32:22.768602 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:32:22.770789 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:32:22.771986 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:32:22.777128 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:32:22.781870 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:32:22.784138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea76bbfda0>]}
[0m08:32:22.786555 [info ] [Thread-1 (]: 4 of 5 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.12s]
[0m08:32:22.789747 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:32:22.791442 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:32:22.793124 [info ] [Thread-1 (]: 5 of 5 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:32:22.794814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:32:22.796692 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:32:22.805438 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:32:22.807608 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:32:22.817595 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:32:22.820572 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:32:22.822309 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:32:22.823510 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:32:22.848446 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m08:32:22.850331 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:32:22.851813 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:32:22.860436 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m08:32:22.873113 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:32:22.874575 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:32:22.877617 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:32:22.888308 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:32:22.889802 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:32:22.892753 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:32:22.898173 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:32:22.899620 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:32:22.900974 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:32:22.904864 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:32:22.912388 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:32:22.915111 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:32:22.916493 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:32:22.921662 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:32:22.928168 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:32:22.930878 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e969919e-3302-4ab5-a7cf-88f11d11d291', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7632f4a0>]}
[0m08:32:22.932800 [info ] [Thread-1 (]: 5 of 5 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.14s]
[0m08:32:22.935200 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:32:22.939874 [debug] [MainThread]: Using postgres connection "master"
[0m08:32:22.941172 [debug] [MainThread]: On master: BEGIN
[0m08:32:22.942326 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:32:22.963910 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m08:32:22.965070 [debug] [MainThread]: On master: COMMIT
[0m08:32:22.966734 [debug] [MainThread]: Using postgres connection "master"
[0m08:32:22.967888 [debug] [MainThread]: On master: COMMIT
[0m08:32:22.969536 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:32:22.970705 [debug] [MainThread]: On master: Close
[0m08:32:22.972941 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:32:22.975915 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:32:22.977997 [info ] [MainThread]: 
[0m08:32:22.980314 [info ] [MainThread]: Finished running 1 table model, 4 view models in 0 hours 0 minutes and 1.33 seconds (1.33s).
[0m08:32:22.985441 [debug] [MainThread]: Command end result
[0m08:32:23.052239 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:32:23.058597 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:32:23.079583 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:32:23.080779 [info ] [MainThread]: 
[0m08:32:23.082381 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m08:32:23.084021 [info ] [MainThread]: 
[0m08:32:23.085785 [error] [MainThread]:   Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:32:23.087837 [info ] [MainThread]: 
[0m08:32:23.089668 [error] [MainThread]:   Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:32:23.091552 [info ] [MainThread]: 
[0m08:32:23.092902 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m08:32:23.097220 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.5359178, "process_in_blocks": "0", "process_kernel_time": 1.407814, "process_mem_max_rss": "111236", "process_out_blocks": "2696", "process_user_time": 10.503667}
[0m08:32:23.099405 [debug] [MainThread]: Command `dbt run` failed at 08:32:23.098739 after 4.54 seconds
[0m08:32:23.100981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea79c79d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea78089670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea7a139670>]}
[0m08:32:23.102699 [debug] [MainThread]: Flushing usage events
[0m08:32:24.581742 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:32:46.970902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737977d6dac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737977d41460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737978095520>]}


============================== 08:32:46.981235 | c175ecd7-c12a-484e-afb6-4a9f39653410 ==============================
[0m08:32:46.981235 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:32:46.983503 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/root/.dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profile hospital_project', 'send_anonymous_usage_stats': 'True'}
[0m08:32:49.868747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737953e1ddf0>]}
[0m08:32:50.051144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7379788448c0>]}
[0m08:32:50.053129 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:32:50.752907 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m08:32:51.007619 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m08:32:51.009461 [debug] [MainThread]: previous checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, current checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835
[0m08:32:51.010675 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m08:32:51.012362 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m08:32:51.013836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737953a0f740>]}
[0m08:32:55.012944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737953616300>]}
[0m08:32:55.217049 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:32:55.226268 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:32:55.270285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7379536f8d40>]}
[0m08:32:55.271979 [info ] [MainThread]: Found 5 models, 4 sources, 487 macros
[0m08:32:55.273614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73795375c500>]}
[0m08:32:55.280360 [info ] [MainThread]: 
[0m08:32:55.282271 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:32:55.283582 [info ] [MainThread]: 
[0m08:32:55.285440 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:32:55.300130 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:32:55.302648 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:32:56.053372 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m08:32:56.054730 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:32:56.573283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737978d173e0>]}
[0m08:32:56.575184 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:32:56.586009 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_model
[0m08:32:56.588325 [debug] [Thread-2 (]: Began running node model.hospital.daily_visits
[0m08:32:56.590835 [info ] [Thread-1 (]: 1 of 5 START sql view model hospital.bigquery_model ............................ [RUN]
[0m08:32:56.599117 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_model)
[0m08:32:56.595333 [info ] [Thread-2 (]: 2 of 5 START sql view model hospital.daily_visits .............................. [RUN]
[0m08:32:56.597263 [debug] [Thread-4 (]: Began running node model.hospital.postgres_model
[0m08:32:56.600700 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_model
[0m08:32:56.593111 [debug] [Thread-3 (]: Began running node model.hospital.hospital_visits
[0m08:32:56.603005 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.daily_visits'
[0m08:32:56.605407 [info ] [Thread-4 (]: 4 of 5 START sql view model hospital.postgres_model ............................ [RUN]
[0m08:32:56.618727 [info ] [Thread-3 (]: 3 of 5 START sql table model hospital.hospital_visits .......................... [RUN]
[0m08:32:56.621435 [debug] [Thread-2 (]: Began compiling node model.hospital.daily_visits
[0m08:32:56.640761 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:32:56.642701 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital.postgres_model'
[0m08:32:56.660735 [debug] [Thread-4 (]: Began compiling node model.hospital.postgres_model
[0m08:32:56.659002 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:32:56.662182 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_model
[0m08:32:56.646976 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.hospital.hospital_visits'
[0m08:32:56.671780 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:32:56.680554 [debug] [Thread-3 (]: Began compiling node model.hospital.hospital_visits
[0m08:32:56.700715 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:32:56.731569 [debug] [Thread-2 (]: Began executing node model.hospital.daily_visits
[0m08:32:56.733342 [debug] [Thread-3 (]: Began executing node model.hospital.hospital_visits
[0m08:32:56.848524 [debug] [Thread-4 (]: Began executing node model.hospital.postgres_model
[0m08:32:56.949731 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:32:56.954995 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:32:56.960096 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:32:56.967971 [debug] [Thread-2 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`daily_visits`
  OPTIONS()
  as WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM `hospital`.`public`.`visits`
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits;


[0m08:32:56.970577 [debug] [Thread-1 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m08:32:56.972261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:32:56.982160 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m08:32:57.076826 [debug] [Thread-4 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`postgres_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `hospital`.`public`.`visits`;


[0m08:32:57.091122 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m08:32:57.203293 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:32:57.291464 [debug] [Thread-3 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        TIMESTAMP(visit_timestamp) AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
    );
  
[0m08:32:57.293895 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m08:32:58.008439 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6868f9ae-1c34-49c6-91cd-83e3d63e5123&page=queryresults
[0m08:32:58.059091 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:22f4858d-b56d-4d21-8909-a6637e9ad6d2&page=queryresults
[0m08:32:58.485217 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cec338b3-0489-45b3-9bf7-b5f5b22b5153&page=queryresults
[0m08:32:58.490062 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cec338b3-0489-45b3-9bf7-b5f5b22b5153&page=queryresults
[0m08:32:58.505097 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a0ccb7e0-b1a8-4edd-94d3-2dd35e12a75f&page=queryresults
[0m08:32:58.573994 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a0ccb7e0-b1a8-4edd-94d3-2dd35e12a75f&page=queryresults
[0m08:32:58.677344 [debug] [Thread-2 (]: Database Error in model daily_visits (models/daily_visits.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/daily_visits.sql
[0m08:32:58.719126 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7379536bfbc0>]}
[0m08:32:58.742503 [error] [Thread-2 (]: 2 of 5 ERROR creating sql view model hospital.daily_visits ..................... [[31mERROR[0m in 2.08s]
[0m08:32:58.758456 [debug] [Thread-2 (]: Finished running node model.hospital.daily_visits
[0m08:32:58.761174 [debug] [Thread-2 (]: Began running node model.hospital.top_diagnoses
[0m08:32:58.763103 [info ] [Thread-2 (]: 5 of 5 START sql view model hospital.top_diagnoses ............................. [RUN]
[0m08:32:58.775827 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.top_diagnoses)
[0m08:32:58.798430 [debug] [Thread-2 (]: Began compiling node model.hospital.top_diagnoses
[0m08:32:58.892178 [debug] [Thread-7 (]: Marking all children of 'model.hospital.daily_visits' to be skipped because of status 'error'.  Reason: Database Error in model daily_visits (models/daily_visits.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/daily_visits.sql.
[0m08:32:58.886347 [debug] [Thread-4 (]: Database Error in model postgres_model (models/postgres_model.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/postgres_model.sql
[0m08:32:58.940763 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737952d30920>]}
[0m08:32:58.948373 [error] [Thread-4 (]: 4 of 5 ERROR creating sql view model hospital.postgres_model ................... [[31mERROR[0m in 2.30s]
[0m08:32:58.965470 [debug] [Thread-4 (]: Finished running node model.hospital.postgres_model
[0m08:32:58.987755 [debug] [Thread-7 (]: Marking all children of 'model.hospital.postgres_model' to be skipped because of status 'error'.  Reason: Database Error in model postgres_model (models/postgres_model.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/postgres_model.sql.
[0m08:32:58.995697 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:32:59.020642 [debug] [Thread-2 (]: Began executing node model.hospital.top_diagnoses
[0m08:32:59.038238 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:32:59.042925 [debug] [Thread-2 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`top_diagnoses`
  OPTIONS()
  as WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM `hospital`.`public`.`visits`
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC;


[0m08:32:59.044715 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:32:59.738527 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73795290d640>]}
[0m08:32:59.750760 [info ] [Thread-1 (]: 1 of 5 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 3.14s]
[0m08:32:59.754652 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_model
[0m08:32:59.826000 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737952dca5d0>]}
[0m08:32:59.831848 [info ] [Thread-3 (]: 3 of 5 OK created sql table model hospital.hospital_visits ..................... [[32mCREATE TABLE (3.2k rows, 133.5 KiB processed)[0m in 3.18s]
[0m08:32:59.839717 [debug] [Thread-3 (]: Finished running node model.hospital.hospital_visits
[0m08:33:00.497196 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:286874f9-2c71-42ca-95e4-65951cd19357&page=queryresults
[0m08:33:00.505984 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:286874f9-2c71-42ca-95e4-65951cd19357&page=queryresults
[0m08:33:00.582238 [debug] [Thread-2 (]: Database Error in model top_diagnoses (models/top_diagnoses.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/top_diagnoses.sql
[0m08:33:00.591269 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c175ecd7-c12a-484e-afb6-4a9f39653410', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7379521a6c60>]}
[0m08:33:00.610690 [error] [Thread-2 (]: 5 of 5 ERROR creating sql view model hospital.top_diagnoses .................... [[31mERROR[0m in 1.82s]
[0m08:33:00.637448 [debug] [Thread-2 (]: Finished running node model.hospital.top_diagnoses
[0m08:33:00.654370 [debug] [Thread-7 (]: Marking all children of 'model.hospital.top_diagnoses' to be skipped because of status 'error'.  Reason: Database Error in model top_diagnoses (models/top_diagnoses.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/top_diagnoses.sql.
[0m08:33:00.753689 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:33:00.787159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:33:00.788688 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m08:33:00.789754 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:33:00.802737 [debug] [MainThread]: Connection 'model.hospital.postgres_model' was properly closed.
[0m08:33:00.803841 [debug] [MainThread]: Connection 'model.hospital.hospital_visits' was properly closed.
[0m08:33:00.809739 [info ] [MainThread]: 
[0m08:33:00.823457 [info ] [MainThread]: Finished running 1 table model, 4 view models in 0 hours 0 minutes and 5.52 seconds (5.52s).
[0m08:33:00.855830 [debug] [MainThread]: Command end result
[0m08:33:01.245423 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:33:01.291961 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:33:01.391815 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:33:01.400333 [info ] [MainThread]: 
[0m08:33:01.421999 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m08:33:01.429966 [info ] [MainThread]: 
[0m08:33:01.437628 [error] [MainThread]:   Database Error in model daily_visits (models/daily_visits.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/daily_visits.sql
[0m08:33:01.446187 [info ] [MainThread]: 
[0m08:33:01.447992 [error] [MainThread]:   Database Error in model postgres_model (models/postgres_model.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/postgres_model.sql
[0m08:33:01.456779 [info ] [MainThread]: 
[0m08:33:01.467751 [error] [MainThread]:   Database Error in model top_diagnoses (models/top_diagnoses.sql)
  Access Denied: Table hospital:public.visits: User does not have permission to query table hospital:public.visits, or perhaps it does not exist.
  compiled code at target/run/hospital/models/top_diagnoses.sql
[0m08:33:01.478334 [info ] [MainThread]: 
[0m08:33:01.479950 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=3 SKIP=0 TOTAL=5
[0m08:33:01.495710 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 14.805987, "process_in_blocks": "0", "process_kernel_time": 1.88565, "process_mem_max_rss": "215060", "process_out_blocks": "3136", "process_user_time": 15.196825}
[0m08:33:01.502770 [debug] [MainThread]: Command `dbt run` failed at 08:33:01.497329 after 14.81 seconds
[0m08:33:01.504475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737979910a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73797858a7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73797858a720>]}
[0m08:33:01.505833 [debug] [MainThread]: Flushing usage events
[0m08:33:03.041247 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:36:02.032457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418cfd3a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418dc4a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418c8db590>]}


============================== 08:36:02.042932 | e608cb46-62c1-4308-b70a-b8a52cd88cc0 ==============================
[0m08:36:02.042932 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:36:02.045282 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profile hospital', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:36:02.627941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418c753860>]}
[0m08:36:02.846265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418d38d400>]}
[0m08:36:02.848780 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:36:03.295142 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:36:03.583155 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m08:36:03.585313 [debug] [MainThread]: previous checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, current checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68
[0m08:36:03.586662 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m08:36:03.587964 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m08:36:03.589584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418ad9f020>]}
[0m08:36:07.451604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418aac7b90>]}
[0m08:36:07.683499 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:36:07.692350 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:36:07.746523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418a71bd10>]}
[0m08:36:07.748251 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:36:07.749754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418ab20d70>]}
[0m08:36:07.757212 [info ] [MainThread]: 
[0m08:36:07.758502 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:36:07.759941 [info ] [MainThread]: 
[0m08:36:07.762113 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:36:07.778502 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:36:08.120841 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:36:08.121630 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:36:08.122707 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:36:08.147981 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m08:36:08.151995 [debug] [ThreadPool]: On list_hospital: Close
[0m08:36:08.157931 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:36:08.177689 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:36:08.179333 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:36:08.180423 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:36:08.200915 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m08:36:08.202368 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:36:08.203532 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:36:08.214343 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.009 seconds
[0m08:36:08.218835 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:36:08.220796 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:36:08.240750 [debug] [MainThread]: Using postgres connection "master"
[0m08:36:08.241949 [debug] [MainThread]: On master: BEGIN
[0m08:36:08.243247 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:36:08.262172 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m08:36:08.263712 [debug] [MainThread]: Using postgres connection "master"
[0m08:36:08.264700 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:36:08.299182 [debug] [MainThread]: SQL status: SELECT 3 in 0.033 seconds
[0m08:36:08.305739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418d415100>]}
[0m08:36:08.307142 [debug] [MainThread]: On master: ROLLBACK
[0m08:36:08.309595 [debug] [MainThread]: Using postgres connection "master"
[0m08:36:08.310731 [debug] [MainThread]: On master: BEGIN
[0m08:36:08.313256 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m08:36:08.314437 [debug] [MainThread]: On master: COMMIT
[0m08:36:08.315990 [debug] [MainThread]: Using postgres connection "master"
[0m08:36:08.317363 [debug] [MainThread]: On master: COMMIT
[0m08:36:08.319272 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:36:08.320517 [debug] [MainThread]: On master: Close
[0m08:36:08.328653 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_model
[0m08:36:08.330405 [info ] [Thread-1 (]: 1 of 5 START sql view model public.bigquery_model .............................. [RUN]
[0m08:36:08.331895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.bigquery_model)
[0m08:36:08.333787 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_model
[0m08:36:08.358376 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:36:08.361397 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_model
[0m08:36:08.477422 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:36:08.480225 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:36:08.481541 [debug] [Thread-1 (]: On model.hospital.bigquery_model: BEGIN
[0m08:36:08.482617 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:08.502480 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:36:08.503861 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:36:08.505337 [debug] [Thread-1 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */

  create view "hospital"."public"."bigquery_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "de-zoomcamp-2025--id"."hospital"."visits"
  );
[0m08:36:08.507931 [debug] [Thread-1 (]: Postgres adapter: Postgres error: cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
              ^

[0m08:36:08.509637 [debug] [Thread-1 (]: On model.hospital.bigquery_model: ROLLBACK
[0m08:36:08.512842 [debug] [Thread-1 (]: On model.hospital.bigquery_model: Close
[0m08:36:08.526581 [debug] [Thread-1 (]: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:36:08.531883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418d4c61e0>]}
[0m08:36:08.534481 [error] [Thread-1 (]: 1 of 5 ERROR creating sql view model public.bigquery_model ..................... [[31mERROR[0m in 0.20s]
[0m08:36:08.537222 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_model
[0m08:36:08.538893 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:36:08.540870 [debug] [Thread-4 (]: Marking all children of 'model.hospital.bigquery_model' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql.
[0m08:36:08.543338 [info ] [Thread-1 (]: 2 of 5 START sql view model public.daily_visits ................................ [RUN]
[0m08:36:08.547953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.bigquery_model, now model.hospital.daily_visits)
[0m08:36:08.549614 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:36:08.558332 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:36:08.560661 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:36:08.573595 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:36:08.576400 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:36:08.577982 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:36:08.579388 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:08.606606 [debug] [Thread-1 (]: SQL status: BEGIN in 0.027 seconds
[0m08:36:08.608252 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:36:08.609772 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:36:08.623605 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m08:36:08.645585 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:36:08.646820 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:36:08.650100 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:36:08.659984 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:36:08.661456 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:36:08.664603 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:36:08.720710 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:36:08.722597 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:36:08.723744 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:36:08.729267 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m08:36:08.749640 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:36:08.768442 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:36:08.769832 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:36:08.774795 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:36:08.782922 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:36:08.785484 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418e4fa7e0>]}
[0m08:36:08.787354 [info ] [Thread-1 (]: 2 of 5 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.24s]
[0m08:36:08.789345 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:36:08.791205 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:36:08.792993 [info ] [Thread-1 (]: 3 of 5 START sql table model public.hospital_visits ............................ [RUN]
[0m08:36:08.794971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:36:08.796637 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:36:08.805919 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:36:08.808298 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:36:08.882926 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:36:08.885951 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:36:08.887454 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:36:08.888529 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:08.908684 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:36:08.910481 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:36:08.912003 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        TIMESTAMP(visit_timestamp) AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:36:08.914754 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "visit_timestamp"
LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                           ^

[0m08:36:08.916673 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:36:08.918749 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:36:08.925500 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:36:08.926935 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418933b680>]}
[0m08:36:08.929191 [error] [Thread-1 (]: 3 of 5 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.13s]
[0m08:36:08.931761 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:36:08.932916 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:36:08.934778 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql.
[0m08:36:08.937773 [info ] [Thread-1 (]: 4 of 5 START sql view model public.postgres_model .............................. [RUN]
[0m08:36:08.940897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:36:08.943110 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:36:08.950457 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:36:08.952991 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:36:08.969230 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:36:08.972190 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:36:08.973812 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:36:08.975097 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:08.995569 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:36:08.996966 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:36:08.997821 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:36:09.005691 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m08:36:09.017493 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:36:09.018757 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:36:09.021433 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:36:09.029323 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:36:09.030737 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:36:09.033905 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:36:09.040311 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:36:09.041340 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:36:09.042887 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:36:09.046367 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:36:09.053139 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:36:09.055739 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:36:09.057140 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:36:09.061523 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m08:36:09.066003 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:36:09.068373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4189367b00>]}
[0m08:36:09.070505 [info ] [Thread-1 (]: 4 of 5 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.13s]
[0m08:36:09.072961 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:36:09.074590 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:36:09.076912 [info ] [Thread-1 (]: 5 of 5 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:36:09.078983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:36:09.080442 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:36:09.089306 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:36:09.091557 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:36:09.101778 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:36:09.104854 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:36:09.106864 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:36:09.108654 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:09.132154 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m08:36:09.133609 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:36:09.134587 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:36:09.150548 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.014 seconds
[0m08:36:09.161127 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:36:09.162315 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:36:09.165244 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:36:09.177003 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:36:09.178398 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:36:09.181140 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:36:09.185614 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:36:09.186713 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:36:09.187870 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:36:09.190969 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:36:09.197428 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:36:09.199320 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:36:09.200607 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:36:09.206338 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:36:09.211128 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:36:09.213136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e608cb46-62c1-4308-b70a-b8a52cd88cc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41897ea150>]}
[0m08:36:09.215329 [info ] [Thread-1 (]: 5 of 5 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.13s]
[0m08:36:09.217792 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:36:09.223607 [debug] [MainThread]: Using postgres connection "master"
[0m08:36:09.224668 [debug] [MainThread]: On master: BEGIN
[0m08:36:09.225474 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:36:09.247843 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m08:36:09.249466 [debug] [MainThread]: On master: COMMIT
[0m08:36:09.251398 [debug] [MainThread]: Using postgres connection "master"
[0m08:36:09.252654 [debug] [MainThread]: On master: COMMIT
[0m08:36:09.254695 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:36:09.256518 [debug] [MainThread]: On master: Close
[0m08:36:09.258603 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:36:09.259696 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:36:09.260779 [info ] [MainThread]: 
[0m08:36:09.262559 [info ] [MainThread]: Finished running 1 table model, 4 view models in 0 hours 0 minutes and 1.50 seconds (1.50s).
[0m08:36:09.269303 [debug] [MainThread]: Command end result
[0m08:36:09.344854 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:36:09.350372 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:36:09.371775 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:36:09.373192 [info ] [MainThread]: 
[0m08:36:09.374569 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m08:36:09.376731 [info ] [MainThread]: 
[0m08:36:09.378437 [error] [MainThread]:   Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:36:09.379761 [info ] [MainThread]: 
[0m08:36:09.382315 [error] [MainThread]:   Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:36:09.384520 [info ] [MainThread]: 
[0m08:36:09.386647 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m08:36:09.390943 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.650144, "process_in_blocks": "0", "process_kernel_time": 1.011167, "process_mem_max_rss": "110952", "process_out_blocks": "2704", "process_user_time": 10.995942}
[0m08:36:09.392485 [debug] [MainThread]: Command `dbt run` failed at 08:36:09.392125 after 7.65 seconds
[0m08:36:09.393846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418cfd1580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418ad9d520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a418c8db1a0>]}
[0m08:36:09.395066 [debug] [MainThread]: Flushing usage events
[0m08:36:11.330673 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:37:50.567378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0fbe9550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0fb46b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0fc451c0>]}


============================== 08:37:50.578628 | 02f340dc-9a2a-45c1-aa6b-8c701998163e ==============================
[0m08:37:50.578628 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:37:50.581002 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profile hospital', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:37:51.161772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0f7fe360>]}
[0m08:37:51.372860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb10424620>]}
[0m08:37:51.376137 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:37:51.826003 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:37:52.181966 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:37:52.183412 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:37:52.295484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0de64c50>]}
[0m08:37:52.532146 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:37:52.541151 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:37:52.595299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0db54320>]}
[0m08:37:52.597064 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:37:52.598377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0de67d70>]}
[0m08:37:52.606552 [info ] [MainThread]: 
[0m08:37:52.607928 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:37:52.608987 [info ] [MainThread]: 
[0m08:37:52.610801 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:37:52.625795 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:37:52.800842 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:37:52.802184 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:37:52.803484 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:37:52.830820 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.027 seconds
[0m08:37:52.835540 [debug] [ThreadPool]: On list_hospital: Close
[0m08:37:52.842438 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:37:52.860900 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:37:52.861983 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:37:52.863231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:37:52.882691 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m08:37:52.883961 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:37:52.885242 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:37:52.895063 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.008 seconds
[0m08:37:52.899889 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:37:52.902891 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:37:52.924909 [debug] [MainThread]: Using postgres connection "master"
[0m08:37:52.926431 [debug] [MainThread]: On master: BEGIN
[0m08:37:52.927448 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:37:52.948376 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m08:37:52.949885 [debug] [MainThread]: Using postgres connection "master"
[0m08:37:52.951347 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:37:52.986358 [debug] [MainThread]: SQL status: SELECT 3 in 0.033 seconds
[0m08:37:52.994972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0db55760>]}
[0m08:37:52.996662 [debug] [MainThread]: On master: ROLLBACK
[0m08:37:52.998623 [debug] [MainThread]: Using postgres connection "master"
[0m08:37:52.999889 [debug] [MainThread]: On master: BEGIN
[0m08:37:53.002510 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m08:37:53.003653 [debug] [MainThread]: On master: COMMIT
[0m08:37:53.005010 [debug] [MainThread]: Using postgres connection "master"
[0m08:37:53.006092 [debug] [MainThread]: On master: COMMIT
[0m08:37:53.007959 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:37:53.008871 [debug] [MainThread]: On master: Close
[0m08:37:53.016934 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_model
[0m08:37:53.018670 [info ] [Thread-1 (]: 1 of 5 START sql view model public.bigquery_model .............................. [RUN]
[0m08:37:53.020403 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.bigquery_model)
[0m08:37:53.021650 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_model
[0m08:37:53.045722 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:37:53.048881 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_model
[0m08:37:53.166900 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:37:53.169809 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:37:53.171189 [debug] [Thread-1 (]: On model.hospital.bigquery_model: BEGIN
[0m08:37:53.173091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:53.193812 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m08:37:53.195519 [debug] [Thread-1 (]: Using postgres connection "model.hospital.bigquery_model"
[0m08:37:53.196899 [debug] [Thread-1 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */

  create view "hospital"."public"."bigquery_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "de-zoomcamp-2025--id"."hospital"."visits"
  );
[0m08:37:53.199295 [debug] [Thread-1 (]: Postgres adapter: Postgres error: cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
              ^

[0m08:37:53.200599 [debug] [Thread-1 (]: On model.hospital.bigquery_model: ROLLBACK
[0m08:37:53.202583 [debug] [Thread-1 (]: On model.hospital.bigquery_model: Close
[0m08:37:53.215545 [debug] [Thread-1 (]: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:37:53.220736 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0f9fcb30>]}
[0m08:37:53.223371 [error] [Thread-1 (]: 1 of 5 ERROR creating sql view model public.bigquery_model ..................... [[31mERROR[0m in 0.20s]
[0m08:37:53.226340 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_model
[0m08:37:53.227943 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:37:53.230100 [debug] [Thread-4 (]: Marking all children of 'model.hospital.bigquery_model' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql.
[0m08:37:53.232259 [info ] [Thread-1 (]: 2 of 5 START sql view model public.daily_visits ................................ [RUN]
[0m08:37:53.237059 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.bigquery_model, now model.hospital.daily_visits)
[0m08:37:53.238777 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:37:53.251829 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:37:53.254590 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:37:53.265865 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:37:53.269441 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:37:53.270949 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:37:53.272112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:53.294570 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:37:53.296483 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:37:53.297816 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:37:53.306546 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m08:37:53.327140 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:37:53.328647 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:37:53.331717 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:37:53.342343 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:37:53.344205 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:37:53.347505 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:37:53.399653 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:37:53.400943 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:37:53.402613 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:37:53.406960 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:37:53.427781 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:37:53.448642 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:37:53.450379 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:37:53.455390 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:37:53.462706 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:37:53.464882 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0cdb1850>]}
[0m08:37:53.466912 [info ] [Thread-1 (]: 2 of 5 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.23s]
[0m08:37:53.469505 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:37:53.471003 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:37:53.473087 [info ] [Thread-1 (]: 3 of 5 START sql table model public.hospital_visits ............................ [RUN]
[0m08:37:53.474991 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:37:53.476491 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:37:53.483976 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:37:53.486301 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:37:53.556062 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:37:53.558617 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:37:53.560965 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:37:53.562407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:53.583823 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m08:37:53.585461 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:37:53.586799 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        TIMESTAMP(visit_timestamp) AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:37:53.589404 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "visit_timestamp"
LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                           ^

[0m08:37:53.590642 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:37:53.592425 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:37:53.599837 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:37:53.601523 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0c330f50>]}
[0m08:37:53.603532 [error] [Thread-1 (]: 3 of 5 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.13s]
[0m08:37:53.605719 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:37:53.607415 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:37:53.610989 [info ] [Thread-1 (]: 4 of 5 START sql view model public.postgres_model .............................. [RUN]
[0m08:37:53.609352 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql.
[0m08:37:53.612982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:37:53.615336 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:37:53.622380 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:37:53.624758 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:37:53.635086 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:37:53.637676 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:37:53.639436 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:37:53.640511 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:53.661441 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:37:53.663507 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:37:53.665707 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:37:53.678959 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m08:37:53.693346 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:37:53.694517 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:37:53.697333 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:37:53.708820 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:37:53.710450 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:37:53.713656 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:37:53.719351 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:37:53.720519 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:37:53.721529 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:37:53.725454 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:37:53.732328 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:37:53.734210 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:37:53.735442 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:37:53.739822 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m08:37:53.744063 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:37:53.746380 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0c3303b0>]}
[0m08:37:53.748727 [info ] [Thread-1 (]: 4 of 5 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.13s]
[0m08:37:53.751477 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:37:53.753245 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:37:53.755147 [info ] [Thread-1 (]: 5 of 5 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:37:53.757182 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:37:53.759162 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:37:53.767064 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:37:53.769491 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:37:53.780097 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:37:53.782494 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:37:53.783990 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:37:53.785351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:53.806821 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m08:37:53.808591 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:37:53.810081 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:37:53.818259 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m08:37:53.827946 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:37:53.829501 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:37:53.832535 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:37:53.842597 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:37:53.844075 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:37:53.847473 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:37:53.852489 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:37:53.854302 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:37:53.855644 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:37:53.860362 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:37:53.867978 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:37:53.870007 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:37:53.871287 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:37:53.876289 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:37:53.880743 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:37:53.883243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '02f340dc-9a2a-45c1-aa6b-8c701998163e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0c337920>]}
[0m08:37:53.885463 [info ] [Thread-1 (]: 5 of 5 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.13s]
[0m08:37:53.888310 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:37:53.894755 [debug] [MainThread]: Using postgres connection "master"
[0m08:37:53.896412 [debug] [MainThread]: On master: BEGIN
[0m08:37:53.897491 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:37:53.916621 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m08:37:53.918310 [debug] [MainThread]: On master: COMMIT
[0m08:37:53.919543 [debug] [MainThread]: Using postgres connection "master"
[0m08:37:53.920976 [debug] [MainThread]: On master: COMMIT
[0m08:37:53.923684 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:37:53.925251 [debug] [MainThread]: On master: Close
[0m08:37:53.928197 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:37:53.930212 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:37:53.931667 [info ] [MainThread]: 
[0m08:37:53.933467 [info ] [MainThread]: Finished running 1 table model, 4 view models in 0 hours 0 minutes and 1.32 seconds (1.32s).
[0m08:37:53.942223 [debug] [MainThread]: Command end result
[0m08:37:54.018916 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:37:54.025085 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:37:54.045990 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:37:54.047366 [info ] [MainThread]: 
[0m08:37:54.048807 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m08:37:54.051483 [info ] [MainThread]: 
[0m08:37:54.053328 [error] [MainThread]:   Database Error in model bigquery_model (models/bigquery_model.sql)
  cross-database references are not implemented: "de-zoomcamp-2025--id.hospital.visits"
  LINE 13: FROM "de-zoomcamp-2025--id"."hospital"."visits"
                ^
  compiled code at target/run/hospital/models/bigquery_model.sql
[0m08:37:54.054562 [info ] [MainThread]: 
[0m08:37:54.056480 [error] [MainThread]:   Database Error in model hospital_visits (models/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/hospital_visits.sql
[0m08:37:54.057990 [info ] [MainThread]: 
[0m08:37:54.059597 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m08:37:54.063869 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.7988515, "process_in_blocks": "0", "process_kernel_time": 1.057675, "process_mem_max_rss": "107700", "process_out_blocks": "1864", "process_user_time": 7.127814}
[0m08:37:54.066362 [debug] [MainThread]: Command `dbt run` failed at 08:37:54.065840 after 3.80 seconds
[0m08:37:54.067916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0c34adb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0fba52e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebb0f716990>]}
[0m08:37:54.069047 [debug] [MainThread]: Flushing usage events
[0m08:37:56.352167 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:42:32.232810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b55507b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b555068a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b555064b0>]}


============================== 08:42:32.243822 | 893f5551-14ab-4673-b59d-c5213f236b62 ==============================
[0m08:42:32.243822 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:42:32.246175 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profile hospital --models postgres.*', 'send_anonymous_usage_stats': 'True'}
[0m08:42:32.831093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b56cbb650>]}
[0m08:42:33.038432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b54ff3e90>]}
[0m08:42:33.041525 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:42:33.489187 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:42:33.840695 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 5 files added, 0 files changed.
[0m08:42:33.842323 [debug] [MainThread]: Partial parsing: added file: hospital://models/bigquery/bigquery_model.sql
[0m08:42:33.843365 [debug] [MainThread]: Partial parsing: added file: hospital://models/postgres/hospital_visits.sql
[0m08:42:33.844493 [debug] [MainThread]: Partial parsing: added file: hospital://models/postgres/daily_visits.sql
[0m08:42:33.845425 [debug] [MainThread]: Partial parsing: added file: hospital://models/postgres/top_diagnoses.sql
[0m08:42:33.846785 [debug] [MainThread]: Partial parsing: added file: hospital://models/postgres/postgres_model.sql
[0m08:42:33.847860 [debug] [MainThread]: Partial parsing: deleted file: hospital://models/top_diagnoses.sql
[0m08:42:33.848920 [debug] [MainThread]: Partial parsing: deleted file: hospital://models/postgres_model.sql
[0m08:42:33.849838 [debug] [MainThread]: Partial parsing: deleted file: hospital://models/daily_visits.sql
[0m08:42:33.851385 [debug] [MainThread]: Partial parsing: deleted file: hospital://models/bigquery_model.sql
[0m08:42:33.852268 [debug] [MainThread]: Partial parsing: deleted file: hospital://models/hospital_visits.sql
[0m08:42:34.847303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b533b3e30>]}
[0m08:42:35.077239 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:42:35.084914 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:42:35.143869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b53336d80>]}
[0m08:42:35.145236 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:42:35.147260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b532b59a0>]}
[0m08:42:35.158291 [info ] [MainThread]: 
[0m08:42:35.161715 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:42:35.164453 [info ] [MainThread]: 
[0m08:42:35.167698 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:42:35.181474 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:42:35.343817 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:42:35.345414 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:42:35.346568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:35.371453 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m08:42:35.376686 [debug] [ThreadPool]: On list_hospital: Close
[0m08:42:35.382635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:42:35.402649 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:42:35.404369 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:42:35.405596 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:42:35.426510 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m08:42:35.428503 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:42:35.430931 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:42:35.442873 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.010 seconds
[0m08:42:35.447265 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:42:35.448988 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:42:35.468749 [debug] [MainThread]: Using postgres connection "master"
[0m08:42:35.470172 [debug] [MainThread]: On master: BEGIN
[0m08:42:35.471280 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:42:35.496252 [debug] [MainThread]: SQL status: BEGIN in 0.025 seconds
[0m08:42:35.497550 [debug] [MainThread]: Using postgres connection "master"
[0m08:42:35.499118 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:42:35.530493 [debug] [MainThread]: SQL status: SELECT 3 in 0.029 seconds
[0m08:42:35.537994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b533f5ee0>]}
[0m08:42:35.539643 [debug] [MainThread]: On master: ROLLBACK
[0m08:42:35.541664 [debug] [MainThread]: Using postgres connection "master"
[0m08:42:35.542865 [debug] [MainThread]: On master: BEGIN
[0m08:42:35.545646 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m08:42:35.546654 [debug] [MainThread]: On master: COMMIT
[0m08:42:35.547666 [debug] [MainThread]: Using postgres connection "master"
[0m08:42:35.548531 [debug] [MainThread]: On master: COMMIT
[0m08:42:35.550752 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:42:35.551373 [debug] [MainThread]: On master: Close
[0m08:42:35.572313 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:42:35.574790 [info ] [Thread-1 (]: 1 of 4 START sql view model public.daily_visits ................................ [RUN]
[0m08:42:35.577496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m08:42:35.578770 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:42:35.601372 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:42:35.603646 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:42:35.718626 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:42:35.720972 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:42:35.722392 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:42:35.723553 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:35.744216 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:42:35.746008 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:42:35.747567 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:42:35.760827 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m08:42:35.782490 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:42:35.783839 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:42:35.786664 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:42:35.795863 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:42:35.797574 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:42:35.800407 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:42:35.848458 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:42:35.850011 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:42:35.851287 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:42:35.856171 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:42:35.875823 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:42:35.896327 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:42:35.897768 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:42:35.902524 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m08:42:35.909227 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:42:35.915185 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b53435430>]}
[0m08:42:35.917308 [info ] [Thread-1 (]: 1 of 4 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.33s]
[0m08:42:35.919722 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:42:35.921472 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:42:35.923365 [info ] [Thread-1 (]: 2 of 4 START sql table model public.hospital_visits ............................ [RUN]
[0m08:42:35.925307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:42:35.926479 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:42:35.936192 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:42:35.938383 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:42:36.020287 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:42:36.022348 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:42:36.023850 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:42:36.025400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:36.045127 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:42:36.046747 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:42:36.047856 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        TIMESTAMP(visit_timestamp) AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:42:36.051066 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "visit_timestamp"
LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                           ^

[0m08:42:36.052426 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:42:36.054478 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:42:36.067274 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql
[0m08:42:36.069600 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b51b4a540>]}
[0m08:42:36.071744 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.14s]
[0m08:42:36.073573 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:42:36.075145 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:42:36.076807 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql.
[0m08:42:36.078956 [info ] [Thread-1 (]: 3 of 4 START sql view model public.postgres_model .............................. [RUN]
[0m08:42:36.084224 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:42:36.085702 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:42:36.093896 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:42:36.095100 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:42:36.105488 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:42:36.107534 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:42:36.108547 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:42:36.110230 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:36.131408 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m08:42:36.133134 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:42:36.134603 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:42:36.141770 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m08:42:36.152221 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:42:36.153805 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:42:36.157275 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:42:36.166426 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:42:36.167770 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:42:36.170891 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:42:36.176214 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:42:36.177382 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:42:36.178283 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:42:36.181553 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:42:36.188879 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:42:36.191256 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:42:36.192765 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:42:36.197186 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m08:42:36.201283 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:42:36.203807 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b51b36d80>]}
[0m08:42:36.205750 [info ] [Thread-1 (]: 3 of 4 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.12s]
[0m08:42:36.207921 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:42:36.209959 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:42:36.211499 [info ] [Thread-1 (]: 4 of 4 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:42:36.213122 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:42:36.214189 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:42:36.223241 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:42:36.225240 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:42:36.235131 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:42:36.236895 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:42:36.238565 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:42:36.240357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:36.263583 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m08:42:36.265445 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:42:36.267240 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:42:36.277754 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m08:42:36.288321 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:42:36.290273 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:42:36.293485 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:42:36.303189 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:42:36.304994 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:42:36.308572 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:42:36.314454 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:42:36.315711 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:42:36.316948 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:42:36.321235 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:42:36.328733 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:42:36.331417 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:42:36.332453 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:42:36.337494 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:42:36.341406 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:42:36.343554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '893f5551-14ab-4673-b59d-c5213f236b62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b523ee120>]}
[0m08:42:36.344713 [info ] [Thread-1 (]: 4 of 4 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.13s]
[0m08:42:36.347275 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:42:36.352309 [debug] [MainThread]: Using postgres connection "master"
[0m08:42:36.353467 [debug] [MainThread]: On master: BEGIN
[0m08:42:36.354301 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:42:36.376422 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m08:42:36.377928 [debug] [MainThread]: On master: COMMIT
[0m08:42:36.379602 [debug] [MainThread]: Using postgres connection "master"
[0m08:42:36.380595 [debug] [MainThread]: On master: COMMIT
[0m08:42:36.383128 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:42:36.384303 [debug] [MainThread]: On master: Close
[0m08:42:36.385924 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:42:36.387501 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:42:36.388740 [info ] [MainThread]: 
[0m08:42:36.390363 [info ] [MainThread]: Finished running 1 table model, 3 view models in 0 hours 0 minutes and 1.22 seconds (1.22s).
[0m08:42:36.395361 [debug] [MainThread]: Command end result
[0m08:42:36.458803 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:42:36.463557 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:42:36.480479 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:42:36.481625 [info ] [MainThread]: 
[0m08:42:36.482897 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m08:42:36.484004 [info ] [MainThread]: 
[0m08:42:36.485268 [error] [MainThread]:   Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  syntax error at or near "visit_timestamp"
  LINE 17:         TIMESTAMP(visit_timestamp) AS visit_time,
                             ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql
[0m08:42:36.486285 [info ] [MainThread]: 
[0m08:42:36.487359 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m08:42:36.490673 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.559482, "process_in_blocks": "0", "process_kernel_time": 1.101886, "process_mem_max_rss": "110640", "process_out_blocks": "2672", "process_user_time": 7.721188}
[0m08:42:36.492895 [debug] [MainThread]: Command `dbt run` failed at 08:42:36.492486 after 4.56 seconds
[0m08:42:36.494636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b5690b620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b53411460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8b51bf6f60>]}
[0m08:42:36.496530 [debug] [MainThread]: Flushing usage events
[0m08:42:38.562962 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:44:18.797159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775937e4a9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775937d067e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775938cc2180>]}


============================== 08:44:18.807606 | 51bcc510-8076-482d-94f4-957f67e338fc ==============================
[0m08:44:18.807606 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:44:18.809739 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profile hospital --models postgres.*', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:44:19.403177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775937aa0110>]}
[0m08:44:19.610933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759379534d0>]}
[0m08:44:19.613171 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:44:20.075904 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:44:20.457122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:44:20.459175 [debug] [MainThread]: Partial parsing: updated file: hospital://models/postgres/hospital_visits.sql
[0m08:44:21.418128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775935e2d460>]}
[0m08:44:21.648305 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:44:21.657428 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:44:21.710816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775935e1e420>]}
[0m08:44:21.712334 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:44:21.713673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775935e2f740>]}
[0m08:44:21.720941 [info ] [MainThread]: 
[0m08:44:21.722820 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:44:21.724675 [info ] [MainThread]: 
[0m08:44:21.727546 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:44:21.743136 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:44:21.912396 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:44:21.913603 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:44:21.914740 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:44:21.939503 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.025 seconds
[0m08:44:21.944072 [debug] [ThreadPool]: On list_hospital: Close
[0m08:44:21.948941 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:44:21.967636 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:44:21.969059 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:44:21.970383 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:44:21.990747 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m08:44:21.992291 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:44:21.993656 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:44:22.003851 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.009 seconds
[0m08:44:22.007880 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:44:22.009608 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:44:22.025846 [debug] [MainThread]: Using postgres connection "master"
[0m08:44:22.026927 [debug] [MainThread]: On master: BEGIN
[0m08:44:22.028136 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:44:22.047676 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m08:44:22.049457 [debug] [MainThread]: Using postgres connection "master"
[0m08:44:22.051092 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:44:22.085583 [debug] [MainThread]: SQL status: SELECT 3 in 0.032 seconds
[0m08:44:22.093068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77593516f140>]}
[0m08:44:22.094747 [debug] [MainThread]: On master: ROLLBACK
[0m08:44:22.097309 [debug] [MainThread]: Using postgres connection "master"
[0m08:44:22.098342 [debug] [MainThread]: On master: BEGIN
[0m08:44:22.101626 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m08:44:22.103144 [debug] [MainThread]: On master: COMMIT
[0m08:44:22.104436 [debug] [MainThread]: Using postgres connection "master"
[0m08:44:22.105551 [debug] [MainThread]: On master: COMMIT
[0m08:44:22.108315 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:44:22.109550 [debug] [MainThread]: On master: Close
[0m08:44:22.117724 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:44:22.119526 [info ] [Thread-1 (]: 1 of 4 START sql view model public.daily_visits ................................ [RUN]
[0m08:44:22.121368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m08:44:22.122884 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:44:22.147123 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:44:22.149824 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:44:22.272788 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:44:22.275075 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:44:22.276790 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:44:22.278416 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:44:22.298443 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m08:44:22.300361 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:44:22.301606 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:44:22.312310 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.008 seconds
[0m08:44:22.331836 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:44:22.333376 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:44:22.335456 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:44:22.343863 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:44:22.345398 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:44:22.347659 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:44:22.401637 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:44:22.403624 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:44:22.405610 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:44:22.409564 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:44:22.428748 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:44:22.451667 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:44:22.454643 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:44:22.463847 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m08:44:22.479542 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:44:22.486306 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759397929c0>]}
[0m08:44:22.488513 [info ] [Thread-1 (]: 1 of 4 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.36s]
[0m08:44:22.492469 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:44:22.494524 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:44:22.496383 [info ] [Thread-1 (]: 2 of 4 START sql table model public.hospital_visits ............................ [RUN]
[0m08:44:22.500176 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:44:22.503412 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:44:22.518640 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:44:22.520920 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:44:22.590910 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:44:22.594415 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:44:22.596359 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:44:22.597723 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:44:22.621480 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m08:44:22.622908 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:44:22.624384 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM `hospital.visits`
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:44:22.627585 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near "`"
LINE 21:     FROM `hospital.visits`
                  ^

[0m08:44:22.628943 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:44:22.631424 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:44:22.644419 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  syntax error at or near "`"
  LINE 21:     FROM `hospital.visits`
                    ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql
[0m08:44:22.646264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775934970e30>]}
[0m08:44:22.648771 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.15s]
[0m08:44:22.651349 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:44:22.652709 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:44:22.654525 [info ] [Thread-1 (]: 3 of 4 START sql view model public.postgres_model .............................. [RUN]
[0m08:44:22.656545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:44:22.658327 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:44:22.667538 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  syntax error at or near "`"
  LINE 21:     FROM `hospital.visits`
                    ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql.
[0m08:44:22.673815 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:44:22.676503 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:44:22.689280 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:44:22.692408 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:44:22.694398 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:44:22.695642 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:44:22.717580 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:44:22.719538 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:44:22.721651 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:44:22.728581 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m08:44:22.740489 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:44:22.742162 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:44:22.745589 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:44:22.756553 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:44:22.758389 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:44:22.761531 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:44:22.767582 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:44:22.769166 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:44:22.770621 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:44:22.773701 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:44:22.781077 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:44:22.783209 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:44:22.784801 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:44:22.789838 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:44:22.794106 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:44:22.796609 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775935d56870>]}
[0m08:44:22.798631 [info ] [Thread-1 (]: 3 of 4 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.14s]
[0m08:44:22.800787 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:44:22.802470 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:44:22.804128 [info ] [Thread-1 (]: 4 of 4 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:44:22.805832 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:44:22.807303 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:44:22.816442 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:44:22.819082 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:44:22.830706 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:44:22.834470 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:44:22.835911 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:44:22.836859 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:44:22.860409 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m08:44:22.862604 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:44:22.863933 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:44:22.874905 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m08:44:22.885567 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:44:22.887124 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:44:22.890437 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:44:22.899714 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:44:22.901060 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:44:22.903839 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:44:22.908052 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:44:22.909677 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:44:22.911407 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:44:22.916643 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m08:44:22.929788 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:44:22.932156 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:44:22.933485 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:44:22.938592 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:44:22.942583 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:44:22.945141 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51bcc510-8076-482d-94f4-957f67e338fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77593450e0c0>]}
[0m08:44:22.947298 [info ] [Thread-1 (]: 4 of 4 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.14s]
[0m08:44:22.949840 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:44:22.955493 [debug] [MainThread]: Using postgres connection "master"
[0m08:44:22.956701 [debug] [MainThread]: On master: BEGIN
[0m08:44:22.957918 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:44:22.979929 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m08:44:22.981833 [debug] [MainThread]: On master: COMMIT
[0m08:44:22.983319 [debug] [MainThread]: Using postgres connection "master"
[0m08:44:22.985474 [debug] [MainThread]: On master: COMMIT
[0m08:44:22.987260 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:44:22.988253 [debug] [MainThread]: On master: Close
[0m08:44:22.990443 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:44:22.991983 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:44:22.993481 [info ] [MainThread]: 
[0m08:44:22.995107 [info ] [MainThread]: Finished running 1 table model, 3 view models in 0 hours 0 minutes and 1.27 seconds (1.27s).
[0m08:44:23.004743 [debug] [MainThread]: Command end result
[0m08:44:23.079514 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:44:23.086489 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:44:23.108831 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:44:23.109867 [info ] [MainThread]: 
[0m08:44:23.111905 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m08:44:23.113886 [info ] [MainThread]: 
[0m08:44:23.115712 [error] [MainThread]:   Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  syntax error at or near "`"
  LINE 21:     FROM `hospital.visits`
                    ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql
[0m08:44:23.117161 [info ] [MainThread]: 
[0m08:44:23.119300 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m08:44:23.123461 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.610472, "process_in_blocks": "0", "process_kernel_time": 1.058951, "process_mem_max_rss": "110728", "process_out_blocks": "2672", "process_user_time": 7.898634}
[0m08:44:23.125856 [debug] [MainThread]: Command `dbt run` failed at 08:44:23.125091 after 4.61 seconds
[0m08:44:23.127960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77593863d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759361600b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x775934d72900>]}
[0m08:44:23.130093 [debug] [MainThread]: Flushing usage events
[0m08:44:24.752072 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:45:04.627443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b847c865a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b846a0f740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b846a0f080>]}


============================== 08:45:04.637682 | 26909287-9c9d-47b5-807d-eeb7cff1b12c ==============================
[0m08:45:04.637682 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:45:04.639845 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profile hospital --models postgres.*', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:45:05.243330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b847b377a0>]}
[0m08:45:05.464547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b8461bcbc0>]}
[0m08:45:05.467887 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:45:05.923197 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:45:06.297586 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:45:06.300072 [debug] [MainThread]: Partial parsing: updated file: hospital://models/postgres/hospital_visits.sql
[0m08:45:07.237702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b8441d51c0>]}
[0m08:45:07.473935 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:45:07.485207 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:45:07.539897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b843d02870>]}
[0m08:45:07.541683 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:45:07.543404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b844381bb0>]}
[0m08:45:07.549938 [info ] [MainThread]: 
[0m08:45:07.551570 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:45:07.553300 [info ] [MainThread]: 
[0m08:45:07.555960 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:45:07.572187 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:45:07.749368 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:45:07.750840 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:45:07.751910 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:45:07.778549 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.027 seconds
[0m08:45:07.783128 [debug] [ThreadPool]: On list_hospital: Close
[0m08:45:07.788188 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:45:07.811211 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:45:07.812424 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:45:07.813743 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:45:07.834979 [debug] [ThreadPool]: SQL status: BEGIN in 0.021 seconds
[0m08:45:07.836267 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:45:07.837633 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:45:07.848540 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.010 seconds
[0m08:45:07.854691 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:45:07.857762 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:45:07.885500 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:07.886929 [debug] [MainThread]: On master: BEGIN
[0m08:45:07.887976 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:45:07.906470 [debug] [MainThread]: SQL status: BEGIN in 0.018 seconds
[0m08:45:07.907661 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:07.909219 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:45:07.942463 [debug] [MainThread]: SQL status: SELECT 3 in 0.032 seconds
[0m08:45:07.951171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b844232450>]}
[0m08:45:07.953276 [debug] [MainThread]: On master: ROLLBACK
[0m08:45:07.955381 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:07.956591 [debug] [MainThread]: On master: BEGIN
[0m08:45:07.959604 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m08:45:07.960935 [debug] [MainThread]: On master: COMMIT
[0m08:45:07.962203 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:07.963606 [debug] [MainThread]: On master: COMMIT
[0m08:45:07.965568 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:45:07.966762 [debug] [MainThread]: On master: Close
[0m08:45:07.976346 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:45:07.979277 [info ] [Thread-1 (]: 1 of 4 START sql view model public.daily_visits ................................ [RUN]
[0m08:45:07.981547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m08:45:07.982974 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:45:08.005943 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:45:08.008731 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:45:08.108402 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:45:08.111519 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:08.112921 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:45:08.114250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:08.137505 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m08:45:08.139069 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:08.140737 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:45:08.148510 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m08:45:08.171072 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:08.172804 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:45:08.175716 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:45:08.184319 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:08.186165 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:45:08.189269 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:08.239619 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:45:08.242091 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:08.243771 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:45:08.249518 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m08:45:08.269647 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:45:08.289045 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:08.290560 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:45:08.295550 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:45:08.303437 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:45:08.308787 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b847b36930>]}
[0m08:45:08.310555 [info ] [Thread-1 (]: 1 of 4 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.32s]
[0m08:45:08.313390 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:45:08.314776 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:45:08.316623 [info ] [Thread-1 (]: 2 of 4 START sql table model public.hospital_visits ............................ [RUN]
[0m08:45:08.318295 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:45:08.319519 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:45:08.331489 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:45:08.333840 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:45:08.407686 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:45:08.410889 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:08.412421 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:45:08.413730 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:08.436224 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:45:08.437706 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:08.439090 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM hospital.visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:45:08.441638 [debug] [Thread-1 (]: Postgres adapter: Postgres error: relation "hospital.visits" does not exist
LINE 21:     FROM hospital.visits
                  ^

[0m08:45:08.443412 [debug] [Thread-1 (]: On model.hospital.hospital_visits: ROLLBACK
[0m08:45:08.446538 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:45:08.458451 [debug] [Thread-1 (]: Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  relation "hospital.visits" does not exist
  LINE 21:     FROM hospital.visits
                    ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql
[0m08:45:08.459970 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b842918aa0>]}
[0m08:45:08.462065 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model public.hospital_visits ................... [[31mERROR[0m in 0.14s]
[0m08:45:08.464510 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:45:08.465713 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:45:08.467946 [info ] [Thread-1 (]: 3 of 4 START sql view model public.postgres_model .............................. [RUN]
[0m08:45:08.470429 [debug] [Thread-4 (]: Marking all children of 'model.hospital.hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  relation "hospital.visits" does not exist
  LINE 21:     FROM hospital.visits
                    ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql.
[0m08:45:08.475144 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:45:08.487335 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:45:08.511406 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:45:08.516380 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:45:08.562617 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:45:08.576466 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:08.586181 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:45:08.587712 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:08.706255 [debug] [Thread-1 (]: SQL status: BEGIN in 0.117 seconds
[0m08:45:08.713804 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:08.721659 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:45:08.752094 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.029 seconds
[0m08:45:08.789593 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:08.794344 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:45:08.802227 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m08:45:08.827321 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:08.828814 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:45:08.840724 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.008 seconds
[0m08:45:08.866180 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:45:08.874715 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:08.876264 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:45:08.910007 [debug] [Thread-1 (]: SQL status: COMMIT in 0.032 seconds
[0m08:45:08.943654 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:45:08.957369 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:08.963238 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:45:08.991106 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.026 seconds
[0m08:45:09.007235 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:45:09.022653 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b842d82ba0>]}
[0m08:45:09.029553 [info ] [Thread-1 (]: 3 of 4 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.54s]
[0m08:45:09.032184 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:45:09.046495 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:45:09.048363 [info ] [Thread-1 (]: 4 of 4 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:45:09.054802 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:45:09.062818 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:45:09.095584 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:45:09.103841 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:45:09.128338 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:45:09.136712 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:09.143963 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:45:09.152185 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:09.181554 [debug] [Thread-1 (]: SQL status: BEGIN in 0.035 seconds
[0m08:45:09.183854 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:09.185415 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:45:09.193524 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m08:45:09.215791 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:09.225778 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:45:09.237183 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:09.289125 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:09.297164 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:45:09.311878 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m08:45:09.334200 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:45:09.342777 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:09.349484 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:45:09.372206 [debug] [Thread-1 (]: SQL status: COMMIT in 0.017 seconds
[0m08:45:09.406861 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:45:09.409477 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:09.414654 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:45:09.444759 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.024 seconds
[0m08:45:09.462740 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:45:09.472181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26909287-9c9d-47b5-807d-eeb7cff1b12c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b8429e2150>]}
[0m08:45:09.478381 [info ] [Thread-1 (]: 4 of 4 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.42s]
[0m08:45:09.485188 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:45:09.516592 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:09.524425 [debug] [MainThread]: On master: BEGIN
[0m08:45:09.528665 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:45:09.644143 [debug] [MainThread]: SQL status: BEGIN in 0.115 seconds
[0m08:45:09.651964 [debug] [MainThread]: On master: COMMIT
[0m08:45:09.659286 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:09.661077 [debug] [MainThread]: On master: COMMIT
[0m08:45:09.691966 [debug] [MainThread]: SQL status: COMMIT in 0.022 seconds
[0m08:45:09.700136 [debug] [MainThread]: On master: Close
[0m08:45:09.708797 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:45:09.717177 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:45:09.723372 [info ] [MainThread]: 
[0m08:45:09.729893 [info ] [MainThread]: Finished running 1 table model, 3 view models in 0 hours 0 minutes and 2.16 seconds (2.16s).
[0m08:45:09.739540 [debug] [MainThread]: Command end result
[0m08:45:10.006561 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:45:10.027183 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:45:10.124670 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:45:10.136384 [info ] [MainThread]: 
[0m08:45:10.144576 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m08:45:10.146141 [info ] [MainThread]: 
[0m08:45:10.153844 [error] [MainThread]:   Database Error in model hospital_visits (models/postgres/hospital_visits.sql)
  relation "hospital.visits" does not exist
  LINE 21:     FROM hospital.visits
                    ^
  compiled code at target/run/hospital/models/postgres/hospital_visits.sql
[0m08:45:10.155429 [info ] [MainThread]: 
[0m08:45:10.162651 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m08:45:10.167504 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.822506, "process_in_blocks": "0", "process_kernel_time": 1.211756, "process_mem_max_rss": "111020", "process_out_blocks": "2672", "process_user_time": 8.73524}
[0m08:45:10.177453 [debug] [MainThread]: Command `dbt run` failed at 08:45:10.176934 after 5.83 seconds
[0m08:45:10.185345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b847c865a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b84667ec60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b842d40860>]}
[0m08:45:10.194314 [debug] [MainThread]: Flushing usage events
[0m08:45:11.785734 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:45:39.028444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa3866480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa1aa27b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa1f673b0>]}


============================== 08:45:39.038692 | 4a42f78e-e2cb-46ca-8f78-8412e9a8f97a ==============================
[0m08:45:39.038692 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:45:39.041252 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profile hospital --models postgres.*', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:45:39.649160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa18822d0>]}
[0m08:45:39.879937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa17a14c0>]}
[0m08:45:39.883979 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m08:45:40.348915 [debug] [MainThread]: checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835, vars: {}, profile: hospital, target: , version: 1.9.0
[0m08:45:40.716376 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:45:40.718616 [debug] [MainThread]: Partial parsing: updated file: hospital://models/postgres/hospital_visits.sql
[0m08:45:41.655828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9fbf9310>]}
[0m08:45:41.884682 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:45:41.894834 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:45:41.947470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9fbde5a0>]}
[0m08:45:41.949623 [info ] [MainThread]: Found 5 models, 4 sources, 429 macros
[0m08:45:41.951316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9fbe1a90>]}
[0m08:45:41.957554 [info ] [MainThread]: 
[0m08:45:41.959643 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:45:41.961415 [info ] [MainThread]: 
[0m08:45:41.963595 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:45:41.979439 [debug] [ThreadPool]: Acquiring new postgres connection 'list_hospital'
[0m08:45:42.149568 [debug] [ThreadPool]: Using postgres connection "list_hospital"
[0m08:45:42.150679 [debug] [ThreadPool]: On list_hospital: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital"} */

    select distinct nspname from pg_namespace
  
[0m08:45:42.151673 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:45:42.177579 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.026 seconds
[0m08:45:42.182117 [debug] [ThreadPool]: On list_hospital: Close
[0m08:45:42.188532 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_hospital, now list_hospital_public)
[0m08:45:42.207472 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:45:42.208455 [debug] [ThreadPool]: On list_hospital_public: BEGIN
[0m08:45:42.209692 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:45:42.227923 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m08:45:42.229237 [debug] [ThreadPool]: Using postgres connection "list_hospital_public"
[0m08:45:42.230583 [debug] [ThreadPool]: On list_hospital_public: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "list_hospital_public"} */
select
      'hospital' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'hospital' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:45:42.240646 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.009 seconds
[0m08:45:42.244750 [debug] [ThreadPool]: On list_hospital_public: ROLLBACK
[0m08:45:42.246397 [debug] [ThreadPool]: On list_hospital_public: Close
[0m08:45:42.268058 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:42.269235 [debug] [MainThread]: On master: BEGIN
[0m08:45:42.270688 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:45:42.290635 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m08:45:42.292320 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:42.293849 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:45:42.325983 [debug] [MainThread]: SQL status: SELECT 3 in 0.030 seconds
[0m08:45:42.332113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa17876b0>]}
[0m08:45:42.333688 [debug] [MainThread]: On master: ROLLBACK
[0m08:45:42.336321 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:42.337284 [debug] [MainThread]: On master: BEGIN
[0m08:45:42.339891 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m08:45:42.341246 [debug] [MainThread]: On master: COMMIT
[0m08:45:42.342260 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:42.343316 [debug] [MainThread]: On master: COMMIT
[0m08:45:42.345592 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:45:42.346697 [debug] [MainThread]: On master: Close
[0m08:45:42.356950 [debug] [Thread-1 (]: Began running node model.hospital.daily_visits
[0m08:45:42.359198 [info ] [Thread-1 (]: 1 of 4 START sql view model public.daily_visits ................................ [RUN]
[0m08:45:42.361101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_hospital_public, now model.hospital.daily_visits)
[0m08:45:42.362945 [debug] [Thread-1 (]: Began compiling node model.hospital.daily_visits
[0m08:45:42.386481 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.daily_visits"
[0m08:45:42.389253 [debug] [Thread-1 (]: Began executing node model.hospital.daily_visits
[0m08:45:42.502561 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.daily_visits"
[0m08:45:42.506250 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:42.507412 [debug] [Thread-1 (]: On model.hospital.daily_visits: BEGIN
[0m08:45:42.508477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:42.526551 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m08:45:42.527888 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:42.529737 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */

  create view "hospital"."public"."daily_visits__dbt_tmp"
    
    
  as (
    WITH visits AS (
    SELECT
        visit_timestamp,
        doctor_id,
        COUNT(*) AS total_visits
    FROM "hospital"."public"."visits"
    GROUP BY visit_timestamp, doctor_id
)
SELECT * FROM visits
  );
[0m08:45:42.538099 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m08:45:42.559223 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:42.561280 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits" rename to "daily_visits__dbt_backup"
[0m08:45:42.563970 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:42.572853 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:42.573968 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
alter table "hospital"."public"."daily_visits__dbt_tmp" rename to "daily_visits"
[0m08:45:42.576799 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:45:42.626366 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:45:42.627890 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:42.629086 [debug] [Thread-1 (]: On model.hospital.daily_visits: COMMIT
[0m08:45:42.632830 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:45:42.653396 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."daily_visits__dbt_backup"
[0m08:45:42.673792 [debug] [Thread-1 (]: Using postgres connection "model.hospital.daily_visits"
[0m08:45:42.675674 [debug] [Thread-1 (]: On model.hospital.daily_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.daily_visits"} */
drop view if exists "hospital"."public"."daily_visits__dbt_backup" cascade
[0m08:45:42.680454 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m08:45:42.688307 [debug] [Thread-1 (]: On model.hospital.daily_visits: Close
[0m08:45:42.693845 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa35567b0>]}
[0m08:45:42.695672 [info ] [Thread-1 (]: 1 of 4 OK created sql view model public.daily_visits ........................... [[32mCREATE VIEW[0m in 0.33s]
[0m08:45:42.698434 [debug] [Thread-1 (]: Finished running node model.hospital.daily_visits
[0m08:45:42.700154 [debug] [Thread-1 (]: Began running node model.hospital.hospital_visits
[0m08:45:42.701582 [info ] [Thread-1 (]: 2 of 4 START sql table model public.hospital_visits ............................ [RUN]
[0m08:45:42.703896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.daily_visits, now model.hospital.hospital_visits)
[0m08:45:42.705347 [debug] [Thread-1 (]: Began compiling node model.hospital.hospital_visits
[0m08:45:42.719034 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.hospital_visits"
[0m08:45:42.721623 [debug] [Thread-1 (]: Began executing node model.hospital.hospital_visits
[0m08:45:42.804915 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.hospital_visits"
[0m08:45:42.807436 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:42.808995 [debug] [Thread-1 (]: On model.hospital.hospital_visits: BEGIN
[0m08:45:42.810257 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:42.828919 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m08:45:42.830643 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:42.831875 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */

  
    

  create  table "hospital"."public"."hospital_visits__dbt_tmp"
  
  
    as
  
  (
    

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM visits
  );
  
[0m08:45:42.873280 [debug] [Thread-1 (]: SQL status: SELECT 3891 in 0.040 seconds
[0m08:45:42.882861 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:42.884000 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */
alter table "hospital"."public"."hospital_visits__dbt_tmp" rename to "hospital_visits"
[0m08:45:42.886512 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:45:42.902442 [debug] [Thread-1 (]: On model.hospital.hospital_visits: COMMIT
[0m08:45:42.904359 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:42.905669 [debug] [Thread-1 (]: On model.hospital.hospital_visits: COMMIT
[0m08:45:42.911374 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m08:45:42.918365 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."hospital_visits__dbt_backup"
[0m08:45:42.929578 [debug] [Thread-1 (]: Using postgres connection "model.hospital.hospital_visits"
[0m08:45:42.931570 [debug] [Thread-1 (]: On model.hospital.hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.hospital_visits"} */
drop table if exists "hospital"."public"."hospital_visits__dbt_backup" cascade
[0m08:45:42.934253 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m08:45:42.938812 [debug] [Thread-1 (]: On model.hospital.hospital_visits: Close
[0m08:45:42.941159 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9e730fe0>]}
[0m08:45:42.943188 [info ] [Thread-1 (]: 2 of 4 OK created sql table model public.hospital_visits ....................... [[32mSELECT 3891[0m in 0.24s]
[0m08:45:42.945998 [debug] [Thread-1 (]: Finished running node model.hospital.hospital_visits
[0m08:45:42.947747 [debug] [Thread-1 (]: Began running node model.hospital.postgres_model
[0m08:45:42.949693 [info ] [Thread-1 (]: 3 of 4 START sql view model public.postgres_model .............................. [RUN]
[0m08:45:42.951845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.hospital_visits, now model.hospital.postgres_model)
[0m08:45:42.953838 [debug] [Thread-1 (]: Began compiling node model.hospital.postgres_model
[0m08:45:42.962740 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.postgres_model"
[0m08:45:42.964996 [debug] [Thread-1 (]: Began executing node model.hospital.postgres_model
[0m08:45:42.978472 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.postgres_model"
[0m08:45:42.983148 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:42.986219 [debug] [Thread-1 (]: On model.hospital.postgres_model: BEGIN
[0m08:45:42.988450 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:43.010356 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:45:43.011983 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:43.013598 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */

  create view "hospital"."public"."postgres_model__dbt_tmp"
    
    
  as (
    SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM "hospital"."public"."visits"
  );
[0m08:45:43.021385 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m08:45:43.032234 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:43.033723 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model" rename to "postgres_model__dbt_backup"
[0m08:45:43.037308 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:43.046919 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:43.048477 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
alter table "hospital"."public"."postgres_model__dbt_tmp" rename to "postgres_model"
[0m08:45:43.051966 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:43.056865 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:45:43.058187 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:43.059338 [debug] [Thread-1 (]: On model.hospital.postgres_model: COMMIT
[0m08:45:43.062468 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m08:45:43.068994 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."postgres_model__dbt_backup"
[0m08:45:43.071053 [debug] [Thread-1 (]: Using postgres connection "model.hospital.postgres_model"
[0m08:45:43.072457 [debug] [Thread-1 (]: On model.hospital.postgres_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.postgres_model"} */
drop view if exists "hospital"."public"."postgres_model__dbt_backup" cascade
[0m08:45:43.077590 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:45:43.082940 [debug] [Thread-1 (]: On model.hospital.postgres_model: Close
[0m08:45:43.085396 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9eb97da0>]}
[0m08:45:43.087661 [info ] [Thread-1 (]: 3 of 4 OK created sql view model public.postgres_model ......................... [[32mCREATE VIEW[0m in 0.13s]
[0m08:45:43.090794 [debug] [Thread-1 (]: Finished running node model.hospital.postgres_model
[0m08:45:43.092168 [debug] [Thread-1 (]: Began running node model.hospital.top_diagnoses
[0m08:45:43.093929 [info ] [Thread-1 (]: 4 of 4 START sql view model public.top_diagnoses ............................... [RUN]
[0m08:45:43.096472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital.postgres_model, now model.hospital.top_diagnoses)
[0m08:45:43.099323 [debug] [Thread-1 (]: Began compiling node model.hospital.top_diagnoses
[0m08:45:43.109085 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.top_diagnoses"
[0m08:45:43.111430 [debug] [Thread-1 (]: Began executing node model.hospital.top_diagnoses
[0m08:45:43.131270 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.top_diagnoses"
[0m08:45:43.134274 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:43.135795 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: BEGIN
[0m08:45:43.137345 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:45:43.159430 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m08:45:43.161220 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:43.162549 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */

  create view "hospital"."public"."top_diagnoses__dbt_tmp"
    
    
  as (
    WITH diagnosis_counts AS (
    SELECT
        diagnosis,
        COUNT(*) AS count
    FROM "hospital"."public"."visits"
    GROUP BY diagnosis
)
SELECT * FROM diagnosis_counts
ORDER BY count DESC
  );
[0m08:45:43.174532 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m08:45:43.184349 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:43.185860 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses" rename to "top_diagnoses__dbt_backup"
[0m08:45:43.188784 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:43.198591 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:43.199905 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
alter table "hospital"."public"."top_diagnoses__dbt_tmp" rename to "top_diagnoses"
[0m08:45:43.203129 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m08:45:43.208308 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:45:43.210013 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:43.211098 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: COMMIT
[0m08:45:43.215550 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m08:45:43.223276 [debug] [Thread-1 (]: Applying DROP to: "hospital"."public"."top_diagnoses__dbt_backup"
[0m08:45:43.225783 [debug] [Thread-1 (]: Using postgres connection "model.hospital.top_diagnoses"
[0m08:45:43.227300 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital", "target_name": "dev", "node_id": "model.hospital.top_diagnoses"} */
drop view if exists "hospital"."public"."top_diagnoses__dbt_backup" cascade
[0m08:45:43.231865 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.004 seconds
[0m08:45:43.236159 [debug] [Thread-1 (]: On model.hospital.top_diagnoses: Close
[0m08:45:43.239157 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a42f78e-e2cb-46ca-8f78-8412e9a8f97a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9e795ca0>]}
[0m08:45:43.241262 [info ] [Thread-1 (]: 4 of 4 OK created sql view model public.top_diagnoses .......................... [[32mCREATE VIEW[0m in 0.14s]
[0m08:45:43.243594 [debug] [Thread-1 (]: Finished running node model.hospital.top_diagnoses
[0m08:45:43.250350 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:43.252937 [debug] [MainThread]: On master: BEGIN
[0m08:45:43.254255 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:45:43.275173 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m08:45:43.276653 [debug] [MainThread]: On master: COMMIT
[0m08:45:43.277519 [debug] [MainThread]: Using postgres connection "master"
[0m08:45:43.279521 [debug] [MainThread]: On master: COMMIT
[0m08:45:43.281679 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m08:45:43.282876 [debug] [MainThread]: On master: Close
[0m08:45:43.284531 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:45:43.286117 [debug] [MainThread]: Connection 'model.hospital.top_diagnoses' was properly closed.
[0m08:45:43.287514 [info ] [MainThread]: 
[0m08:45:43.289617 [info ] [MainThread]: Finished running 1 table model, 3 view models in 0 hours 0 minutes and 1.32 seconds (1.32s).
[0m08:45:43.296194 [debug] [MainThread]: Command end result
[0m08:45:43.364716 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:45:43.370284 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:45:43.392462 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:45:43.393734 [info ] [MainThread]: 
[0m08:45:43.395410 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:45:43.397574 [info ] [MainThread]: 
[0m08:45:43.399088 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m08:45:43.402878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6647983, "process_in_blocks": "0", "process_kernel_time": 1.234396, "process_mem_max_rss": "110420", "process_out_blocks": "2672", "process_user_time": 9.288344}
[0m08:45:43.405315 [debug] [MainThread]: Command `dbt run` succeeded at 08:45:43.404688 after 4.67 seconds
[0m08:45:43.406859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa37d4650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5aa1f45f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5a9fbdf410>]}
[0m08:45:43.408462 [debug] [MainThread]: Flushing usage events
[0m08:45:44.936942 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:47:47.995567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6ac4ea6d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6ac4ea7da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6ac48eb050>]}


============================== 08:47:48.006910 | aee42b6a-a973-4e38-bed9-220b0f9c43ae ==============================
[0m08:47:48.006910 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:47:48.008919 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:47:50.873893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aee42b6a-a973-4e38-bed9-220b0f9c43ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6aa4824830>]}
[0m08:47:51.063092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aee42b6a-a973-4e38-bed9-220b0f9c43ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6ac4c7a120>]}
[0m08:47:51.065837 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:47:51.754259 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m08:47:52.010391 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m08:47:52.012119 [debug] [MainThread]: previous checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, current checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835
[0m08:47:52.013527 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m08:47:52.015123 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m08:47:52.016564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aee42b6a-a973-4e38-bed9-220b0f9c43ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6aa4c4b5c0>]}
[0m08:47:55.455894 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two models with the name "hospital_visits".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for ref("hospital_visits").
  
  To fix this, change the name of one of these resources:
  - model.hospital.hospital_visits (models/bigquery/hospital_visits.sql)
  - model.hospital.hospital_visits (models/postgres/hospital_visits.sql)
[0m08:47:55.459854 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.761516, "process_in_blocks": "0", "process_kernel_time": 1.854202, "process_mem_max_rss": "201644", "process_out_blocks": "24", "process_user_time": 14.154869}
[0m08:47:55.461488 [debug] [MainThread]: Command `dbt run` failed at 08:47:55.461151 after 7.76 seconds
[0m08:47:55.462779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6ac43fd8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6aa449a060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6aa479f0e0>]}
[0m08:47:55.464377 [debug] [MainThread]: Flushing usage events
[0m08:47:57.021176 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:49:04.768773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef1255a57f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef125185b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef125710b60>]}


============================== 08:49:04.779833 | 3192d960-6c8a-4070-ac54-d22c567ef82d ==============================
[0m08:49:04.779833 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:49:04.782146 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'send_anonymous_usage_stats': 'True'}
[0m08:49:07.601466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef104edf7a0>]}
[0m08:49:07.794671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef104d9c560>]}
[0m08:49:07.796491 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:49:08.473098 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m08:49:08.725071 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m08:49:08.726879 [debug] [MainThread]: previous checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, current checksum: cdea3b6da3f6ca304d0ce6619b8c4c5d6053ca4ee60b7bc9f17eb16a79bcb835
[0m08:49:08.727802 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m08:49:08.729360 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m08:49:08.730924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef10499dd30>]}
[0m08:49:15.706275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef104a352e0>]}
[0m08:49:15.917803 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:49:15.926724 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:49:15.971434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef104953020>]}
[0m08:49:15.973401 [info ] [MainThread]: Found 6 models, 4 sources, 487 macros
[0m08:49:15.974519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef1049962a0>]}
[0m08:49:15.979076 [info ] [MainThread]: 
[0m08:49:15.980729 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:49:15.982325 [info ] [MainThread]: 
[0m08:49:15.984225 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:49:15.996209 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:49:15.997295 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:49:16.715884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m08:49:16.717448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:49:17.176501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef104e5a960>]}
[0m08:49:17.178177 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:49:17.194368 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_hospital_visits
[0m08:49:17.196673 [info ] [Thread-1 (]: 1 of 2 START sql table model hospital.bigquery_hospital_visits ................. [RUN]
[0m08:49:17.198772 [debug] [Thread-2 (]: Began running node model.hospital.bigquery_model
[0m08:49:17.200938 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_hospital_visits)
[0m08:49:17.203558 [info ] [Thread-2 (]: 2 of 2 START sql view model hospital.bigquery_model ............................ [RUN]
[0m08:49:17.207733 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_hospital_visits
[0m08:49:17.213626 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.bigquery_model'
[0m08:49:17.244408 [debug] [Thread-2 (]: Began compiling node model.hospital.bigquery_model
[0m08:49:17.255723 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_hospital_visits"
[0m08:49:17.266545 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:49:17.269908 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_hospital_visits
[0m08:49:17.284640 [debug] [Thread-2 (]: Began executing node model.hospital.bigquery_model
[0m08:49:17.472724 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:49:17.493352 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_hospital_visits"
[0m08:49:17.495596 [debug] [Thread-1 (]: On model.hospital.bigquery_hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`bigquery_hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp AS visit_time,
        doctor_id,
        diagnosis,
        treatment
    FROM hospital.visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_time) AS visit_number
FROM hospital.visits
    );
  
[0m08:49:17.497516 [debug] [Thread-2 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m08:49:17.499993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:49:17.501806 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m08:49:18.250842 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:20ed2b6a-19a0-4dd3-98d8-e2820b64f19a&page=queryresults
[0m08:49:18.275626 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e1cf971f-8095-41f6-9ce1-cb747ff0d073&page=queryresults
[0m08:49:18.398008 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e1cf971f-8095-41f6-9ce1-cb747ff0d073&page=queryresults
[0m08:49:18.414342 [debug] [Thread-1 (]: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m08:49:18.420575 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef1048d0a70>]}
[0m08:49:18.422867 [error] [Thread-1 (]: 1 of 2 ERROR creating sql table model hospital.bigquery_hospital_visits ........ [[31mERROR[0m in 1.22s]
[0m08:49:18.425513 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_hospital_visits
[0m08:49:18.427762 [debug] [Thread-7 (]: Marking all children of 'model.hospital.bigquery_hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql.
[0m08:49:18.697593 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3192d960-6c8a-4070-ac54-d22c567ef82d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef1041d1010>]}
[0m08:49:18.700006 [info ] [Thread-2 (]: 2 of 2 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 1.48s]
[0m08:49:18.702570 [debug] [Thread-2 (]: Finished running node model.hospital.bigquery_model
[0m08:49:18.709088 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:49:18.713910 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:49:18.715308 [debug] [MainThread]: Connection 'model.hospital.bigquery_hospital_visits' was properly closed.
[0m08:49:18.716330 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m08:49:18.717560 [info ] [MainThread]: 
[0m08:49:18.718960 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 2.73 seconds (2.73s).
[0m08:49:18.722132 [debug] [MainThread]: Command end result
[0m08:49:18.784995 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:49:18.790318 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:49:18.808393 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:49:18.809667 [info ] [MainThread]: 
[0m08:49:18.811654 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m08:49:18.813327 [info ] [MainThread]: 
[0m08:49:18.814798 [error] [MainThread]:   Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m08:49:18.816716 [info ] [MainThread]: 
[0m08:49:18.817911 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m08:49:18.822207 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 14.354594, "process_in_blocks": "0", "process_kernel_time": 1.808788, "process_mem_max_rss": "213844", "process_out_blocks": "3064", "process_user_time": 16.075531}
[0m08:49:18.824029 [debug] [MainThread]: Command `dbt run` failed at 08:49:18.823538 after 14.36 seconds
[0m08:49:18.826123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef124f49be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef1048ecf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef1048ec170>]}
[0m08:49:18.827559 [debug] [MainThread]: Flushing usage events
[0m08:49:20.324878 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:51:04.162557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975bcf4920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975b915520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975bc9cb30>]}


============================== 08:51:04.173578 | deeaa4e9-7de1-47ad-b23d-1fe847fb3760 ==============================
[0m08:51:04.173578 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:51:04.175835 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:51:07.093862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975b045940>]}
[0m08:51:07.276140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975b0dc8c0>]}
[0m08:51:07.278371 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:51:07.965907 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m08:51:08.307932 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:51:08.309701 [debug] [MainThread]: Partial parsing: updated file: hospital://models/bigquery/bigquery_hospital_visits.sql
[0m08:51:09.150345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739736ceed50>]}
[0m08:51:09.361447 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:51:09.371720 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:51:09.417328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739736940230>]}
[0m08:51:09.419490 [info ] [MainThread]: Found 6 models, 4 sources, 487 macros
[0m08:51:09.421190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975b103b60>]}
[0m08:51:09.427490 [info ] [MainThread]: 
[0m08:51:09.429338 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:51:09.431191 [info ] [MainThread]: 
[0m08:51:09.432764 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:51:09.444908 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:51:09.447094 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:51:10.354529 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m08:51:10.356743 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:51:10.798729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975ce64530>]}
[0m08:51:10.799998 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:51:10.812732 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_hospital_visits
[0m08:51:10.814359 [debug] [Thread-2 (]: Began running node model.hospital.bigquery_model
[0m08:51:10.816800 [info ] [Thread-1 (]: 1 of 2 START sql table model hospital.bigquery_hospital_visits ................. [RUN]
[0m08:51:10.819337 [info ] [Thread-2 (]: 2 of 2 START sql view model hospital.bigquery_model ............................ [RUN]
[0m08:51:10.825331 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_hospital_visits)
[0m08:51:10.827665 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.bigquery_model'
[0m08:51:10.830756 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_hospital_visits
[0m08:51:10.833590 [debug] [Thread-2 (]: Began compiling node model.hospital.bigquery_model
[0m08:51:10.875662 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_hospital_visits"
[0m08:51:10.879706 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:51:10.883496 [debug] [Thread-2 (]: Began executing node model.hospital.bigquery_model
[0m08:51:11.102705 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_hospital_visits
[0m08:51:11.325438 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:51:11.337764 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_hospital_visits"
[0m08:51:11.341543 [debug] [Thread-2 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m08:51:11.343575 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m08:51:11.350665 [debug] [Thread-1 (]: On model.hospital.bigquery_hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`bigquery_hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp,
        doctor_id,
        diagnosis,
        treatment
    FROM hospital.visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_timeistamp) AS visit_number
FROM hospital.visits
    );
  
[0m08:51:11.426127 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:51:12.176180 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:631ae35b-6916-4116-9c38-f91ef06cfb7b&page=queryresults
[0m08:51:12.186870 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b079e79c-52a1-496c-9448-5b2e09171330&page=queryresults
[0m08:51:12.307807 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b079e79c-52a1-496c-9448-5b2e09171330&page=queryresults
[0m08:51:12.325891 [debug] [Thread-1 (]: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m08:51:12.332573 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975bcba810>]}
[0m08:51:12.335308 [error] [Thread-1 (]: 1 of 2 ERROR creating sql table model hospital.bigquery_hospital_visits ........ [[31mERROR[0m in 1.50s]
[0m08:51:12.337952 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_hospital_visits
[0m08:51:12.341351 [debug] [Thread-7 (]: Marking all children of 'model.hospital.bigquery_hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql.
[0m08:51:12.699897 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'deeaa4e9-7de1-47ad-b23d-1fe847fb3760', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739736da2f60>]}
[0m08:51:12.702226 [info ] [Thread-2 (]: 2 of 2 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 1.87s]
[0m08:51:12.704924 [debug] [Thread-2 (]: Finished running node model.hospital.bigquery_model
[0m08:51:12.712688 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:51:12.717107 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:51:12.718214 [debug] [MainThread]: Connection 'model.hospital.bigquery_hospital_visits' was properly closed.
[0m08:51:12.719123 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m08:51:12.720111 [info ] [MainThread]: 
[0m08:51:12.722144 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m08:51:12.725920 [debug] [MainThread]: Command end result
[0m08:51:12.802229 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:51:12.808129 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:51:12.825732 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:51:12.826925 [info ] [MainThread]: 
[0m08:51:12.828772 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m08:51:12.830643 [info ] [MainThread]: 
[0m08:51:12.832361 [error] [MainThread]:   Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m08:51:12.833602 [info ] [MainThread]: 
[0m08:51:12.834690 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m08:51:12.837936 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.950229, "process_in_blocks": "0", "process_kernel_time": 2.024998, "process_mem_max_rss": "212008", "process_out_blocks": "3048", "process_user_time": 13.186096}
[0m08:51:12.839956 [debug] [MainThread]: Command `dbt run` failed at 08:51:12.839569 after 8.95 seconds
[0m08:51:12.841558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975e31cc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73975b7273e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739736522570>]}
[0m08:51:12.842838 [debug] [MainThread]: Flushing usage events
[0m08:51:14.345002 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:52:12.055660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c660e7cda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c660b3d100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c660e7e7e0>]}


============================== 08:52:12.066589 | 7f3649bb-698b-470d-9106-678105b7587f ==============================
[0m08:52:12.066589 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:52:12.068592 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/root/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'send_anonymous_usage_stats': 'True'}
[0m08:52:14.944226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c6626937a0>]}
[0m08:52:15.134829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c6611f3c20>]}
[0m08:52:15.137430 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:52:15.809636 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m08:52:16.151431 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:52:16.154069 [debug] [MainThread]: Partial parsing: updated file: hospital://models/bigquery/bigquery_hospital_visits.sql
[0m08:52:16.990317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c6405240e0>]}
[0m08:52:17.200624 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:52:17.208604 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:52:17.251497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c64081ab10>]}
[0m08:52:17.253823 [info ] [MainThread]: Found 6 models, 4 sources, 487 macros
[0m08:52:17.254965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c640aa2cc0>]}
[0m08:52:17.261594 [info ] [MainThread]: 
[0m08:52:17.262816 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:52:17.264225 [info ] [MainThread]: 
[0m08:52:17.266116 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:52:17.279565 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:52:17.281456 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:52:17.990727 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m08:52:17.992157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:52:18.441643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c640b30440>]}
[0m08:52:18.443578 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:52:18.456942 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_hospital_visits
[0m08:52:18.459100 [info ] [Thread-1 (]: 1 of 2 START sql table model hospital.bigquery_hospital_visits ................. [RUN]
[0m08:52:18.461636 [debug] [Thread-2 (]: Began running node model.hospital.bigquery_model
[0m08:52:18.467064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_hospital_visits)
[0m08:52:18.476909 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_hospital_visits
[0m08:52:18.474380 [info ] [Thread-2 (]: 2 of 2 START sql view model hospital.bigquery_model ............................ [RUN]
[0m08:52:18.503617 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_hospital_visits"
[0m08:52:18.506232 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.bigquery_model'
[0m08:52:18.508915 [debug] [Thread-2 (]: Began compiling node model.hospital.bigquery_model
[0m08:52:18.727370 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m08:52:18.729874 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_hospital_visits
[0m08:52:18.736901 [debug] [Thread-2 (]: Began executing node model.hospital.bigquery_model
[0m08:52:18.926000 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m08:52:18.938340 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_hospital_visits"
[0m08:52:18.940651 [debug] [Thread-2 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m08:52:18.942513 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m08:52:19.024547 [debug] [Thread-1 (]: On model.hospital.bigquery_hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`bigquery_hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp,
        doctor_id,
        diagnosis,
        treatment
    FROM visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_timeistamp) AS visit_number
FROM visits
    );
  
[0m08:52:19.026650 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:19.555296 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b7376b30-e222-4b2f-811e-58db13856440&page=queryresults
[0m08:52:19.557304 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b7376b30-e222-4b2f-811e-58db13856440&page=queryresults
[0m08:52:19.581725 [debug] [Thread-1 (]: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Table "visits" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m08:52:19.597696 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cca3c7c3-2c82-44a1-a6b9-5dcdf41c6c7f&page=queryresults
[0m08:52:19.606307 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c6405deea0>]}
[0m08:52:19.611226 [error] [Thread-1 (]: 1 of 2 ERROR creating sql table model hospital.bigquery_hospital_visits ........ [[31mERROR[0m in 1.12s]
[0m08:52:19.615872 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_hospital_visits
[0m08:52:19.619574 [debug] [Thread-7 (]: Marking all children of 'model.hospital.bigquery_hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Table "visits" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql.
[0m08:52:20.019353 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f3649bb-698b-470d-9106-678105b7587f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c640c9fe60>]}
[0m08:52:20.021334 [info ] [Thread-2 (]: 2 of 2 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 1.51s]
[0m08:52:20.023816 [debug] [Thread-2 (]: Finished running node model.hospital.bigquery_model
[0m08:52:20.031532 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:52:20.037318 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:52:20.038404 [debug] [MainThread]: Connection 'model.hospital.bigquery_hospital_visits' was properly closed.
[0m08:52:20.039493 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m08:52:20.040710 [info ] [MainThread]: 
[0m08:52:20.041950 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 2.78 seconds (2.78s).
[0m08:52:20.046446 [debug] [MainThread]: Command end result
[0m08:52:20.123354 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:52:20.129196 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:52:20.150042 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:52:20.151570 [info ] [MainThread]: 
[0m08:52:20.153007 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m08:52:20.156050 [info ] [MainThread]: 
[0m08:52:20.158111 [error] [MainThread]:   Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Table "visits" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m08:52:20.159549 [info ] [MainThread]: 
[0m08:52:20.161819 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m08:52:20.166102 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.411025, "process_in_blocks": "0", "process_kernel_time": 1.52702, "process_mem_max_rss": "212068", "process_out_blocks": "3048", "process_user_time": 10.495017}
[0m08:52:20.167991 [debug] [MainThread]: Command `dbt run` failed at 08:52:20.167579 after 8.41 seconds
[0m08:52:20.169607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c660e15f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c641967080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72c6407ac140>]}
[0m08:52:20.171166 [debug] [MainThread]: Flushing usage events
[0m08:52:21.718130 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:02:48.946917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b71dd3710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b71dd20f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b719b0bf0>]}


============================== 10:02:48.956876 | ddad5b34-e968-4802-85a0-d2091e194bf7 ==============================
[0m10:02:48.956876 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:02:48.959446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:02:51.840099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b516d76e0>]}
[0m10:02:53.021648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b51478ef0>]}
[0m10:02:53.042993 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m10:02:55.953701 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m10:02:56.291875 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:02:56.294166 [debug] [MainThread]: Partial parsing: updated file: hospital://models/bigquery/bigquery_hospital_visits.sql
[0m10:02:57.079521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b50ca88c0>]}
[0m10:02:57.277686 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:02:57.286098 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:02:57.330821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b50f9a9c0>]}
[0m10:02:57.332267 [info ] [MainThread]: Found 6 models, 4 sources, 487 macros
[0m10:02:57.333729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b50d1c560>]}
[0m10:02:57.340108 [info ] [MainThread]: 
[0m10:02:57.341632 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:02:57.343399 [info ] [MainThread]: 
[0m10:02:57.344846 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:02:57.356630 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:02:57.358580 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:02:58.064234 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m10:02:58.065892 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:02:58.577583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b72eb05c0>]}
[0m10:02:58.579938 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:02:58.593836 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_hospital_visits
[0m10:02:58.595310 [info ] [Thread-1 (]: 1 of 2 START sql table model hospital.bigquery_hospital_visits ................. [RUN]
[0m10:02:58.597797 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_hospital_visits)
[0m10:02:58.599266 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_hospital_visits
[0m10:02:58.600720 [debug] [Thread-2 (]: Began running node model.hospital.bigquery_model
[0m10:02:58.621242 [info ] [Thread-2 (]: 2 of 2 START sql view model hospital.bigquery_model ............................ [RUN]
[0m10:02:58.629742 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.bigquery_model'
[0m10:02:58.631839 [debug] [Thread-2 (]: Began compiling node model.hospital.bigquery_model
[0m10:02:58.636576 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_hospital_visits"
[0m10:02:58.646551 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m10:02:58.649006 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_hospital_visits
[0m10:02:58.650589 [debug] [Thread-2 (]: Began executing node model.hospital.bigquery_model
[0m10:02:59.074215 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m10:02:59.090054 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_hospital_visits"
[0m10:02:59.092817 [debug] [Thread-1 (]: On model.hospital.bigquery_hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`bigquery_hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp,
        doctor_id,
        diagnosis,
        treatment
    FROM hospital.visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_time,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_timeistamp) AS visit_number
FROM visits
    );
  
[0m10:02:59.094636 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:02:59.180792 [debug] [Thread-2 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:02:59.183408 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:02:59.770821 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:456f2adf-db8b-4679-aacf-18fe9afa6633&page=queryresults
[0m10:02:59.840433 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7bbaaa1a-49fa-45f7-828f-fde35518e3f7&page=queryresults
[0m10:03:00.041733 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7bbaaa1a-49fa-45f7-828f-fde35518e3f7&page=queryresults
[0m10:03:00.080511 [debug] [Thread-1 (]: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m10:03:00.090818 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5058f9b0>]}
[0m10:03:00.093345 [error] [Thread-1 (]: 1 of 2 ERROR creating sql table model hospital.bigquery_hospital_visits ........ [[31mERROR[0m in 1.48s]
[0m10:03:00.097628 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_hospital_visits
[0m10:03:00.100768 [debug] [Thread-7 (]: Marking all children of 'model.hospital.bigquery_hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql.
[0m10:03:00.271008 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ddad5b34-e968-4802-85a0-d2091e194bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5123c4a0>]}
[0m10:03:00.273680 [info ] [Thread-2 (]: 2 of 2 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 1.64s]
[0m10:03:00.276434 [debug] [Thread-2 (]: Finished running node model.hospital.bigquery_model
[0m10:03:00.288359 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:03:00.294245 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:00.295448 [debug] [MainThread]: Connection 'model.hospital.bigquery_hospital_visits' was properly closed.
[0m10:03:00.297256 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m10:03:00.298527 [info ] [MainThread]: 
[0m10:03:00.299883 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 2.95 seconds (2.95s).
[0m10:03:00.303063 [debug] [MainThread]: Command end result
[0m10:03:00.375935 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:03:00.382692 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:03:00.404387 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:03:00.405899 [info ] [MainThread]: 
[0m10:03:00.407590 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m10:03:00.409321 [info ] [MainThread]: 
[0m10:03:00.410819 [error] [MainThread]:   Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_time at [30:5]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m10:03:00.413813 [info ] [MainThread]: 
[0m10:03:00.415768 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m10:03:00.420708 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 11.750382, "process_in_blocks": "0", "process_kernel_time": 2.070978, "process_mem_max_rss": "212248", "process_out_blocks": "3056", "process_user_time": 13.184151}
[0m10:03:00.422621 [debug] [MainThread]: Command `dbt run` failed at 10:03:00.421916 after 11.75 seconds
[0m10:03:00.424438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b716b6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b511e3470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b71db7b30>]}
[0m10:03:00.426409 [debug] [MainThread]: Flushing usage events
[0m10:03:02.058110 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:03:40.566640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800d02d9f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800d1af23f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800d0272e70>]}


============================== 10:03:40.576455 | 50c2ac88-9773-48ff-b32c-b06462cd0841 ==============================
[0m10:03:40.576455 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:03:40.578635 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/root/.dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:03:43.417103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800b0728740>]}
[0m10:03:43.604301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800d08c1280>]}
[0m10:03:43.606257 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m10:03:44.292567 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m10:03:44.622853 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:03:44.625084 [debug] [MainThread]: Partial parsing: updated file: hospital://models/bigquery/bigquery_hospital_visits.sql
[0m10:03:45.435423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800ab967fb0>]}
[0m10:03:45.653359 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:03:45.662134 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:03:45.705535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800abc5e750>]}
[0m10:03:45.707504 [info ] [MainThread]: Found 6 models, 4 sources, 487 macros
[0m10:03:45.708950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800abe8fb90>]}
[0m10:03:45.714197 [info ] [MainThread]: 
[0m10:03:45.715979 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:03:45.717721 [info ] [MainThread]: 
[0m10:03:45.719428 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:03:45.731673 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:03:45.733524 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:46.478907 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m10:03:46.481199 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:03:47.108807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800abdf4680>]}
[0m10:03:47.110740 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:03:47.130907 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_hospital_visits
[0m10:03:47.132389 [debug] [Thread-2 (]: Began running node model.hospital.bigquery_model
[0m10:03:47.134610 [info ] [Thread-1 (]: 1 of 2 START sql table model hospital.bigquery_hospital_visits ................. [RUN]
[0m10:03:47.136936 [info ] [Thread-2 (]: 2 of 2 START sql view model hospital.bigquery_model ............................ [RUN]
[0m10:03:47.139617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_hospital_visits)
[0m10:03:47.147255 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_hospital_visits
[0m10:03:47.145338 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.bigquery_model'
[0m10:03:47.170517 [debug] [Thread-2 (]: Began compiling node model.hospital.bigquery_model
[0m10:03:47.182272 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_hospital_visits"
[0m10:03:47.190587 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m10:03:47.194552 [debug] [Thread-2 (]: Began executing node model.hospital.bigquery_model
[0m10:03:47.197000 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_hospital_visits
[0m10:03:47.659893 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m10:03:47.675988 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_hospital_visits"
[0m10:03:47.677624 [debug] [Thread-2 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:03:47.679312 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:03:47.765678 [debug] [Thread-1 (]: On model.hospital.bigquery_hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`bigquery_hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp,
        doctor_id,
        diagnosis,
        treatment
    FROM hospital.visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_timestamp,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_timeistamp) AS visit_number
FROM visits
    );
  
[0m10:03:47.767555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:03:48.568558 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:647997cc-fb04-48d4-9dc4-4e638631a13e&page=queryresults
[0m10:03:48.690595 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:647997cc-fb04-48d4-9dc4-4e638631a13e&page=queryresults
[0m10:03:48.707926 [debug] [Thread-1 (]: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_timeistamp; Did you mean visit_timestamp? at [31:53]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m10:03:48.713179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800ab9430e0>]}
[0m10:03:48.715448 [error] [Thread-1 (]: 1 of 2 ERROR creating sql table model hospital.bigquery_hospital_visits ........ [[31mERROR[0m in 1.57s]
[0m10:03:48.717771 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_hospital_visits
[0m10:03:48.719833 [debug] [Thread-7 (]: Marking all children of 'model.hospital.bigquery_hospital_visits' to be skipped because of status 'error'.  Reason: Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_timeistamp; Did you mean visit_timestamp? at [31:53]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql.
[0m10:03:49.619094 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bd3c2e38-0c11-4872-aee7-a60ba08acdac&page=queryresults
[0m10:03:50.045582 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50c2ac88-9773-48ff-b32c-b06462cd0841', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800b0113800>]}
[0m10:03:50.047837 [info ] [Thread-2 (]: 2 of 2 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 2.90s]
[0m10:03:50.051180 [debug] [Thread-2 (]: Finished running node model.hospital.bigquery_model
[0m10:03:50.057718 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:03:50.063736 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:50.064591 [debug] [MainThread]: Connection 'model.hospital.bigquery_hospital_visits' was properly closed.
[0m10:03:50.065565 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m10:03:50.067125 [info ] [MainThread]: 
[0m10:03:50.068695 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 4.35 seconds (4.35s).
[0m10:03:50.071673 [debug] [MainThread]: Command end result
[0m10:03:50.147586 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:03:50.153726 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:03:50.175335 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:03:50.176623 [info ] [MainThread]: 
[0m10:03:50.178271 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m10:03:50.179807 [info ] [MainThread]: 
[0m10:03:50.181473 [error] [MainThread]:   Database Error in model bigquery_hospital_visits (models/bigquery/bigquery_hospital_visits.sql)
  Unrecognized name: visit_timeistamp; Did you mean visit_timestamp? at [31:53]
  compiled code at target/run/hospital/models/bigquery/bigquery_hospital_visits.sql
[0m10:03:50.183407 [info ] [MainThread]: 
[0m10:03:50.184835 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m10:03:50.188233 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.904642, "process_in_blocks": "0", "process_kernel_time": 2.052075, "process_mem_max_rss": "211684", "process_out_blocks": "3048", "process_user_time": 13.37327}
[0m10:03:50.190170 [debug] [MainThread]: Command `dbt run` failed at 10:03:50.189414 after 9.91 seconds
[0m10:03:50.191266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800cfd591c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800cfd5a6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7800abaa23f0>]}
[0m10:03:50.191966 [debug] [MainThread]: Flushing usage events
[0m10:03:51.576962 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:04:51.855207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2e01b96780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2e00783080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2e00782d50>]}


============================== 10:04:51.867444 | e0832b57-cea7-4984-98bc-bf14f209ef37 ==============================
[0m10:04:51.867444 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:04:51.869580 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profile hospital_project --models bigquery.*', 'send_anonymous_usage_stats': 'True'}
[0m10:04:54.798517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2de03fe630>]}
[0m10:04:54.989573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2de0399610>]}
[0m10:04:54.992407 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m10:04:55.669994 [debug] [MainThread]: checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68, vars: {}, profile: hospital_project, target: , version: 1.9.0
[0m10:04:56.019554 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:04:56.022186 [debug] [MainThread]: Partial parsing: updated file: hospital://models/bigquery/bigquery_hospital_visits.sql
[0m10:04:56.826295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2dffb84c50>]}
[0m10:04:57.023574 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:04:57.030962 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:04:57.073982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2ddb53dd90>]}
[0m10:04:57.075826 [info ] [MainThread]: Found 6 models, 4 sources, 487 macros
[0m10:04:57.076831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2ddb9eb6e0>]}
[0m10:04:57.082121 [info ] [MainThread]: 
[0m10:04:57.083748 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:04:57.084707 [info ] [MainThread]: 
[0m10:04:57.086273 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:04:57.098746 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:04:57.100141 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:04:57.806418 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital)
[0m10:04:57.808222 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:04:58.266115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2ddbe60050>]}
[0m10:04:58.267382 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:04:58.280472 [debug] [Thread-1 (]: Began running node model.hospital.bigquery_hospital_visits
[0m10:04:58.282728 [info ] [Thread-1 (]: 1 of 2 START sql table model hospital.bigquery_hospital_visits ................. [RUN]
[0m10:04:58.283878 [debug] [Thread-2 (]: Began running node model.hospital.bigquery_model
[0m10:04:58.285950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital, now model.hospital.bigquery_hospital_visits)
[0m10:04:58.288111 [info ] [Thread-2 (]: 2 of 2 START sql view model hospital.bigquery_model ............................ [RUN]
[0m10:04:58.290076 [debug] [Thread-1 (]: Began compiling node model.hospital.bigquery_hospital_visits
[0m10:04:58.292197 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.hospital.bigquery_model'
[0m10:04:58.319935 [debug] [Thread-2 (]: Began compiling node model.hospital.bigquery_model
[0m10:04:58.324696 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital.bigquery_hospital_visits"
[0m10:04:58.337268 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital.bigquery_model"
[0m10:04:58.341573 [debug] [Thread-1 (]: Began executing node model.hospital.bigquery_hospital_visits
[0m10:04:58.550593 [debug] [Thread-2 (]: Began executing node model.hospital.bigquery_model
[0m10:04:58.753603 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital.bigquery_model"
[0m10:04:58.780692 [debug] [Thread-2 (]: On model.hospital.bigquery_model: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_model"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital`.`bigquery_model`
  OPTIONS()
  as SELECT
  patient_id,
  visit_timestamp,
  doctor_id,
  diagnosis,
  treatment
FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:04:58.782418 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:04:58.779204 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital.bigquery_hospital_visits"
[0m10:04:58.874159 [debug] [Thread-1 (]: On model.hospital.bigquery_hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_project", "target_name": "dev", "node_id": "model.hospital.bigquery_hospital_visits"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital`.`bigquery_hospital_visits`
      
    
    

    OPTIONS()
    as (
      

WITH visits AS (
    SELECT 
        patient_id,
        visit_timestamp,
        doctor_id,
        diagnosis,
        treatment
    FROM hospital.visits
)

SELECT 
    patient_id,
    doctor_id,
    diagnosis,
    treatment,
    visit_timestamp,
    COUNT(*) OVER (PARTITION BY patient_id ORDER BY visit_timestamp) AS visit_number
FROM visits
    );
  
[0m10:04:58.877047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:04:59.458620 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:98bcf8d6-52d0-4cae-9cb0-65bb09157c90&page=queryresults
[0m10:04:59.561697 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6150fed7-cd3c-4ad0-a8ce-4593671c48da&page=queryresults
[0m10:04:59.875617 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2ddbfcbb00>]}
[0m10:04:59.878380 [info ] [Thread-2 (]: 2 of 2 OK created sql view model hospital.bigquery_model ....................... [[32mCREATE VIEW (0 processed)[0m in 1.58s]
[0m10:04:59.883183 [debug] [Thread-2 (]: Finished running node model.hospital.bigquery_model
[0m10:05:01.073755 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0832b57-cea7-4984-98bc-bf14f209ef37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2ddad9e2d0>]}
[0m10:05:01.076486 [info ] [Thread-1 (]: 1 of 2 OK created sql table model hospital.bigquery_hospital_visits ............ [[32mCREATE TABLE (3.2k rows, 133.5 KiB processed)[0m in 2.79s]
[0m10:05:01.079758 [debug] [Thread-1 (]: Finished running node model.hospital.bigquery_hospital_visits
[0m10:05:01.094409 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:05:01.101113 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:05:01.102668 [debug] [MainThread]: Connection 'model.hospital.bigquery_hospital_visits' was properly closed.
[0m10:05:01.103675 [debug] [MainThread]: Connection 'model.hospital.bigquery_model' was properly closed.
[0m10:05:01.104816 [info ] [MainThread]: 
[0m10:05:01.106488 [info ] [MainThread]: Finished running 1 table model, 1 view model in 0 hours 0 minutes and 4.02 seconds (4.02s).
[0m10:05:01.109707 [debug] [MainThread]: Command end result
[0m10:05:01.178416 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:05:01.184810 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:05:01.205303 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:05:01.206777 [info ] [MainThread]: 
[0m10:05:01.209411 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:05:01.210827 [info ] [MainThread]: 
[0m10:05:01.212642 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:05:01.216738 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.63642, "process_in_blocks": "0", "process_kernel_time": 1.594541, "process_mem_max_rss": "211844", "process_out_blocks": "3048", "process_user_time": 10.564835}
[0m10:05:01.218649 [debug] [MainThread]: Command `dbt run` succeeded at 10:05:01.218251 after 9.64 seconds
[0m10:05:01.220263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2dfff33800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2de18870e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2e009037d0>]}
[0m10:05:01.221724 [debug] [MainThread]: Flushing usage events
[0m10:05:02.766145 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:16:56.264263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5f86021bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5f86021070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5f860231a0>]}


============================== 13:16:56.278180 | ce866d1e-7d07-41af-8a7d-87d0a38e136e ==============================
[0m13:16:56.278180 [info ] [MainThread]: Running with dbt=1.9.0
[0m13:16:56.280229 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/root/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt init hospital_analytics', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:16:56.374602 [info ] [MainThread]: Setting up your profile.
[0m13:22:21.277556 [info ] [MainThread]: Profile hospital written to /root/.dbt/profiles.yml using target's profile_template.yml and your supplied values. Run 'dbt debug' to validate the connection.
[0m13:22:21.291564 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": true, "command_wall_clock_time": 325.2976, "process_in_blocks": "832", "process_kernel_time": 1.684288, "process_mem_max_rss": "192496", "process_out_blocks": "32", "process_user_time": 9.35874}
[0m13:22:21.300452 [debug] [MainThread]: Command `dbt init` succeeded at 13:22:21.299874 after 325.31 seconds
[0m13:22:21.301636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5f85bde390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5f66298800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b5f65f99070>]}
[0m13:22:21.302970 [debug] [MainThread]: Flushing usage events
[0m13:22:22.826740 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:53:38.699647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad53932420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad53589df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad53933b30>]}


============================== 13:53:38.710332 | 2d94d89c-fb1f-4083-a344-efaf37e382c2 ==============================
[0m13:53:38.710332 [info ] [MainThread]: Running with dbt=1.9.0
[0m13:53:38.712650 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m13:53:38.745248 [info ] [MainThread]: dbt version: 1.9.0
[0m13:53:38.746667 [info ] [MainThread]: python version: 3.12.4
[0m13:53:38.748056 [info ] [MainThread]: python path: /usr/local/bin/python
[0m13:53:38.749385 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m13:53:43.945278 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m13:53:43.946862 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m13:53:43.953287 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m13:53:43.958805 [info ] [MainThread]: adapter type: bigquery
[0m13:53:43.965651 [info ] [MainThread]: adapter version: 1.9.1
[0m13:53:43.967120 [info ] [MainThread]: Configuration:
[0m13:53:43.973397 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:53:43.980575 [info ] [MainThread]:   dbt_project.yml file [[31mERROR not found[0m]
[0m13:53:43.981646 [info ] [MainThread]: Required dependencies:
[0m13:53:43.991793 [debug] [MainThread]: Executing "git --help"
[0m13:53:44.025035 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:53:44.029951 [debug] [MainThread]: STDERR: "b''"
[0m13:53:44.036952 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:53:44.044518 [info ] [MainThread]: Connection:
[0m13:53:44.052180 [info ] [MainThread]:   method: service-account
[0m13:53:44.054218 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m13:53:44.061198 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m13:53:44.062431 [info ] [MainThread]:   schema: hospital
[0m13:53:44.067664 [info ] [MainThread]:   location: asia-southeast2
[0m13:53:44.069913 [info ] [MainThread]:   priority: interactive
[0m13:53:44.076592 [info ] [MainThread]:   maximum_bytes_billed: None
[0m13:53:44.083915 [info ] [MainThread]:   impersonate_service_account: None
[0m13:53:44.094196 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m13:53:44.095975 [info ] [MainThread]:   job_retries: 1
[0m13:53:44.104218 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m13:53:44.110353 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m13:53:44.112574 [info ] [MainThread]:   timeout_seconds: 300
[0m13:53:44.113964 [info ] [MainThread]:   client_id: None
[0m13:53:44.115262 [info ] [MainThread]:   token_uri: None
[0m13:53:44.116412 [info ] [MainThread]:   dataproc_region: None
[0m13:53:44.117700 [info ] [MainThread]:   dataproc_cluster_name: None
[0m13:53:44.118976 [info ] [MainThread]:   gcs_bucket: None
[0m13:53:44.120486 [info ] [MainThread]:   dataproc_batch: None
[0m13:53:44.122338 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:53:45.168732 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m13:53:45.170613 [debug] [MainThread]: On debug: select 1 as id
[0m13:53:45.171945 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:53:45.962664 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:65fd401a-b73c-42d7-b3e5-4da361e7b489&page=queryresults
[0m13:53:46.404010 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:53:46.405513 [info ] [MainThread]: [31m1 check failed:[0m
[0m13:53:46.406554 [info ] [MainThread]: Project loading failed for the following reason:
 project path </usr/app/dbt/dbt_project.yml> not found

[0m13:53:46.409880 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 7.9775095, "process_in_blocks": "0", "process_kernel_time": 2.013044, "process_mem_max_rss": "199648", "process_out_blocks": "48", "process_user_time": 10.072677}
[0m13:53:46.413573 [debug] [MainThread]: Command `dbt debug` failed at 13:53:46.411306 after 7.98 seconds
[0m13:53:46.414917 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:53:46.416509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad5361e840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad2f518170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad2f58be90>]}
[0m13:53:46.417767 [debug] [MainThread]: Flushing usage events
[0m13:53:47.914464 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:58:23.040253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704b3041fa40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704b31b02510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704b301ab8f0>]}


============================== 13:58:23.049555 | 39fee923-ac66-4174-b140-b7e460e00239 ==============================
[0m13:58:23.049555 [info ] [MainThread]: Running with dbt=1.9.0
[0m13:58:23.051178 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m13:58:23.079839 [info ] [MainThread]: dbt version: 1.9.0
[0m13:58:23.081663 [info ] [MainThread]: python version: 3.12.4
[0m13:58:23.083418 [info ] [MainThread]: python path: /usr/local/bin/python
[0m13:58:23.085538 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m13:58:23.096094 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m13:58:23.098071 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m13:58:23.099465 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m13:58:23.403729 [info ] [MainThread]: Configuration:
[0m13:58:23.405002 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m13:58:23.407819 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:58:23.409740 [info ] [MainThread]: Required dependencies:
[0m13:58:23.411384 [debug] [MainThread]: Executing "git --help"
[0m13:58:23.424070 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:58:23.425729 [debug] [MainThread]: STDERR: "b''"
[0m13:58:23.426780 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:58:23.428370 [info ] [MainThread]: Connection test skipped since no profile was found
[0m13:58:23.429563 [info ] [MainThread]: [31m1 check failed:[0m
[0m13:58:23.430451 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Could not find profile named 'hospital_analytics'


[0m13:58:23.433704 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.6539932, "process_in_blocks": "0", "process_kernel_time": 0.659649, "process_mem_max_rss": "88580", "process_out_blocks": "16", "process_user_time": 4.281725}
[0m13:58:23.436020 [debug] [MainThread]: Command `dbt debug` failed at 13:58:23.435117 after 0.66 seconds
[0m13:58:23.437779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704b303826c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704b2ff0b140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704b30a50f20>]}
[0m13:58:23.439321 [debug] [MainThread]: Flushing usage events
[0m13:58:24.963997 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:00:15.472241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79831ee59550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79831c81dac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79831db3b170>]}


============================== 14:00:15.483413 | b68816c8-7399-4953-9cd6-9ebcd64ced9c ==============================
[0m14:00:15.483413 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:00:15.485781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:00:15.515053 [info ] [MainThread]: dbt version: 1.9.0
[0m14:00:15.516745 [info ] [MainThread]: python version: 3.12.4
[0m14:00:15.518129 [info ] [MainThread]: python path: /usr/local/bin/python
[0m14:00:15.519942 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m14:00:18.173488 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m14:00:18.174716 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m14:00:18.177029 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m14:00:18.179218 [info ] [MainThread]: adapter type: bigquery
[0m14:00:18.180591 [info ] [MainThread]: adapter version: 1.9.1
[0m14:00:18.503405 [info ] [MainThread]: Configuration:
[0m14:00:18.505531 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m14:00:18.507095 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m14:00:18.509425 [info ] [MainThread]: Required dependencies:
[0m14:00:18.511929 [debug] [MainThread]: Executing "git --help"
[0m14:00:18.522296 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m14:00:18.524016 [debug] [MainThread]: STDERR: "b''"
[0m14:00:18.525543 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m14:00:18.527122 [info ] [MainThread]: Connection:
[0m14:00:18.529037 [info ] [MainThread]:   method: service-account
[0m14:00:18.530959 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m14:00:18.532698 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m14:00:18.535123 [info ] [MainThread]:   schema: hospital
[0m14:00:18.537342 [info ] [MainThread]:   location: asia-southeast2
[0m14:00:18.538935 [info ] [MainThread]:   priority: interactive
[0m14:00:18.540536 [info ] [MainThread]:   maximum_bytes_billed: None
[0m14:00:18.542072 [info ] [MainThread]:   impersonate_service_account: None
[0m14:00:18.543606 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m14:00:18.545409 [info ] [MainThread]:   job_retries: 1
[0m14:00:18.546850 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m14:00:18.548137 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m14:00:18.549629 [info ] [MainThread]:   timeout_seconds: 300
[0m14:00:18.551108 [info ] [MainThread]:   client_id: None
[0m14:00:18.552608 [info ] [MainThread]:   token_uri: None
[0m14:00:18.554061 [info ] [MainThread]:   dataproc_region: None
[0m14:00:18.555895 [info ] [MainThread]:   dataproc_cluster_name: None
[0m14:00:18.558069 [info ] [MainThread]:   gcs_bucket: None
[0m14:00:18.559467 [info ] [MainThread]:   dataproc_batch: None
[0m14:00:18.561983 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:00:19.228457 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m14:00:19.230063 [debug] [MainThread]: On debug: select 1 as id
[0m14:00:19.231603 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:00:19.981703 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2a6abe8d-4d9d-4230-8baa-0449a5f2ab63&page=queryresults
[0m14:00:20.472470 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m14:00:20.475310 [info ] [MainThread]: [32mAll checks passed![0m
[0m14:00:20.479452 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.279491, "process_in_blocks": "0", "process_kernel_time": 1.575821, "process_mem_max_rss": "200644", "process_out_blocks": "24", "process_user_time": 7.945522}
[0m14:00:20.481748 [debug] [MainThread]: Command `dbt debug` succeeded at 14:00:20.481356 after 5.28 seconds
[0m14:00:20.484010 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m14:00:20.485722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79831cb23e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7982fcbe9100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79831c6f5520>]}
[0m14:00:20.487607 [debug] [MainThread]: Flushing usage events
[0m14:00:22.156407 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:01:03.488426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075d8d5e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075d8dc4830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075d8dc67e0>]}


============================== 14:01:03.499007 | ba5b7420-b139-4263-9868-2d05f14a2193 ==============================
[0m14:01:03.499007 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:01:03.500583 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:01:06.047020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba5b7420-b139-4263-9868-2d05f14a2193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075b89e3590>]}
[0m14:01:06.247614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba5b7420-b139-4263-9868-2d05f14a2193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075b94bb8f0>]}
[0m14:01:06.249544 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:01:06.903974 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:01:07.149793 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m14:01:07.151365 [debug] [MainThread]: previous checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, current checksum: becbb7336fe74fdf8175e50bbdadab6b32972a9844d2b175bc9a224da7c1ae68
[0m14:01:07.152676 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m14:01:07.154041 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m14:01:07.155715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ba5b7420-b139-4263-9868-2d05f14a2193', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075b858f560>]}
[0m14:01:11.380402 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.hospital_analytics.visits_enhanced' (models/visits_enhanced.sql) depends on a source named 'hospital.visits' which was not found
[0m14:01:11.386411 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.144715, "process_in_blocks": "3048", "process_kernel_time": 1.616255, "process_mem_max_rss": "204052", "process_out_blocks": "24", "process_user_time": 11.505719}
[0m14:01:11.388595 [debug] [MainThread]: Command `dbt run` failed at 14:01:11.388079 after 8.15 seconds
[0m14:01:11.390885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075d92f9b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075b86a4ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7075b847d5e0>]}
[0m14:01:11.392987 [debug] [MainThread]: Flushing usage events
[0m14:01:12.901981 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:20:01.954299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38e9ca120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38eb08320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38d20bf20>]}


============================== 14:20:01.964337 | eacf3f4a-84c2-4d89-8419-15cd40063afc ==============================
[0m14:20:01.964337 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:20:01.965897 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m14:20:02.304280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eacf3f4a-84c2-4d89-8419-15cd40063afc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38d044c80>]}
[0m14:20:02.355502 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.6600921, "process_in_blocks": "8", "process_kernel_time": 0.781097, "process_mem_max_rss": "87948", "process_out_blocks": "16", "process_user_time": 4.390306}
[0m14:20:02.357574 [debug] [MainThread]: Command `dbt clean` succeeded at 14:20:02.357198 after 0.66 seconds
[0m14:20:02.359038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38d737dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38cb2bdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c38ca18410>]}
[0m14:20:02.360542 [debug] [MainThread]: Flushing usage events
[0m14:20:03.840487 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:20:19.620791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9df969f200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9dfa431340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9df9ae2060>]}


============================== 14:20:19.631401 | 9d8242e6-824f-4474-9578-7b105276ca3c ==============================
[0m14:20:19.631401 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:20:19.633687 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:20:19.984660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d8242e6-824f-4474-9578-7b105276ca3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9df8d268a0>]}
[0m14:20:20.051116 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:20:20.053621 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:20:20.057206 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.7129903, "process_in_blocks": "176", "process_kernel_time": 0.79896, "process_mem_max_rss": "87980", "process_out_blocks": "8", "process_user_time": 5.258655}
[0m14:20:20.059022 [debug] [MainThread]: Command `dbt deps` succeeded at 14:20:20.058647 after 0.72 seconds
[0m14:20:20.060414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9df915d550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9df8f2a360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9df8d5ca10>]}
[0m14:20:20.062004 [debug] [MainThread]: Flushing usage events
[0m14:20:21.472413 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:20:42.437755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac650ca510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac647607d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac6462ccb0>]}


============================== 14:20:42.448254 | 06c0e3ab-5a5c-4888-9207-eeebb0c54f45 ==============================
[0m14:20:42.448254 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:20:42.449666 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:20:45.177583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac4fd912b0>]}
[0m14:20:45.371786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac444e70b0>]}
[0m14:20:45.373772 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:20:46.054732 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:20:46.057264 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:20:46.059469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac445acb60>]}
[0m14:20:50.637526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3ff072c0>]}
[0m14:20:50.881511 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:20:50.889667 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:20:50.950598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3fb87830>]}
[0m14:20:50.951632 [info ] [MainThread]: Found 11 models, 11 data tests, 6 sources, 487 macros
[0m14:20:50.952867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3fbd5df0>]}
[0m14:20:50.959483 [info ] [MainThread]: 
[0m14:20:50.961794 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:20:50.963390 [info ] [MainThread]: 
[0m14:20:50.965793 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:20:50.981282 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:20:50.982383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:50.985218 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:20:50.986662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:51.002892 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:20:51.004742 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:52.584435 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now create_de-zoomcamp-2025--id_hospital_staging)
[0m14:20:52.586326 [debug] [ThreadPool]: Creating schema "database: "de-zoomcamp-2025--id"
schema: "hospital_staging"
"
[0m14:20:52.594702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now create_de-zoomcamp-2025--id_hospital_analytics)
[0m14:20:52.596517 [debug] [ThreadPool]: Creating schema "database: "de-zoomcamp-2025--id"
schema: "hospital_analytics"
"
[0m14:20:52.618923 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now create_de-zoomcamp-2025--id_hospital_intermediate)
[0m14:20:52.632943 [debug] [ThreadPool]: Creating schema "database: "de-zoomcamp-2025--id"
schema: "hospital_intermediate"
"
[0m14:20:52.679062 [debug] [ThreadPool]: On create_de-zoomcamp-2025--id_hospital_staging: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "create_de-zoomcamp-2025--id_hospital_staging"} */
create schema if not exists `de-zoomcamp-2025--id`.`hospital_staging`
  
[0m14:20:52.680672 [debug] [ThreadPool]: On create_de-zoomcamp-2025--id_hospital_analytics: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "create_de-zoomcamp-2025--id_hospital_analytics"} */
create schema if not exists `de-zoomcamp-2025--id`.`hospital_analytics`
  
[0m14:20:52.686573 [debug] [ThreadPool]: On create_de-zoomcamp-2025--id_hospital_intermediate: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "create_de-zoomcamp-2025--id_hospital_intermediate"} */
create schema if not exists `de-zoomcamp-2025--id`.`hospital_intermediate`
  
[0m14:20:52.688037 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:52.689729 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:52.691479 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:53.389886 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:965fa9df-2c20-415e-af14-5b6c44a87afb&page=queryresults
[0m14:20:53.450269 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:204956bd-082e-4b0c-890a-a0c86fee0a51&page=queryresults
[0m14:20:53.478640 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a1a5e1ca-6028-4bf4-869e-af2da411852e&page=queryresults
[0m14:20:58.812394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_de-zoomcamp-2025--id_hospital_analytics, now list_de-zoomcamp-2025--id_hospital_staging)
[0m14:20:58.824286 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:58.866270 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_de-zoomcamp-2025--id_hospital_intermediate, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m14:20:58.934783 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:58.885441 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_de-zoomcamp-2025--id_hospital_staging, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m14:20:59.749852 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:21:00.504553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3ffcc3b0>]}
[0m14:21:00.506383 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:21:00.519537 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:21:00.521343 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctors
[0m14:21:00.523632 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m14:21:00.525829 [info ] [Thread-1 (]: 1 of 11 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m14:21:00.528788 [info ] [Thread-2 (]: 2 of 11 START sql table model hospital_staging.doctors ......................... [RUN]
[0m14:21:00.535918 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics.doctors)
[0m14:21:00.532346 [info ] [Thread-3 (]: 3 of 11 START sql table model hospital_staging.medicines ....................... [RUN]
[0m14:21:00.534246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m14:21:00.537749 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctors
[0m14:21:00.540527 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics.medicines)
[0m14:21:00.542101 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:21:00.530534 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m14:21:00.555424 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m14:21:00.569922 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m14:21:00.577903 [info ] [Thread-4 (]: 4 of 11 START sql table model hospital_staging.patients ........................ [RUN]
[0m14:21:00.598429 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:21:00.603406 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m14:21:00.606625 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctors
[0m14:21:00.608699 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.patients'
[0m14:21:00.611369 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:21:00.612982 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m14:21:00.641256 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m14:21:00.779666 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m14:21:00.887950 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:21:00.896703 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m14:21:00.906072 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m14:21:00.909970 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m14:21:00.922791 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  price,
  -- Categorize price level
  CASE
    WHEN price < 10 THEN 'Low-cost'
    WHEN price BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`
    );
  
[0m14:21:00.931044 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m14:21:00.933440 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:21:00.935035 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:21:00.938802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:21:01.029338 [debug] [Thread-4 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

SELECT
  patient_id,
  full_name AS patient_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Calculate age
  DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) AS age,
  -- Create age group
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`
    );
  
[0m14:21:01.031551 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:21:01.032900 [debug] [Thread-2 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m14:21:01.199169 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:21:01.791026 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b922a74b-8bfb-4034-80ce-c6396d2d150f&page=queryresults
[0m14:21:01.805901 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:96413daf-2642-4c0b-9d7c-cb76f7cb975b&page=queryresults
[0m14:21:01.819827 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8514d5d7-076f-45e6-9335-6677dee8f704&page=queryresults
[0m14:21:01.879249 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9c1310f5-b1d2-43fe-86f8-369dc8ce6b68&page=queryresults
[0m14:21:01.930633 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8514d5d7-076f-45e6-9335-6677dee8f704&page=queryresults
[0m14:21:01.977400 [debug] [Thread-4 (]: Database Error in model patients (models/staging/base/patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [24:3]
  compiled code at target/run/hospital_analytics/models/staging/base/patients.sql
[0m14:21:01.985753 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3e76c110>]}
[0m14:21:01.988229 [error] [Thread-4 (]: 4 of 11 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.37s]
[0m14:21:01.990498 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m14:21:01.994752 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/base/patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [24:3]
  compiled code at target/run/hospital_analytics/models/staging/base/patients.sql.
[0m14:21:02.004101 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:96413daf-2642-4c0b-9d7c-cb76f7cb975b&page=queryresults
[0m14:21:02.015295 [debug] [Thread-3 (]: Database Error in model medicines (models/staging/base/medicines.sql)
  No matching signature for operator < for argument types: STRING, INT64
    Signature: T1 < T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [23:10]
  compiled code at target/run/hospital_analytics/models/staging/base/medicines.sql
[0m14:21:02.017186 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3e7894f0>]}
[0m14:21:02.020500 [error] [Thread-3 (]: 3 of 11 ERROR creating sql table model hospital_staging.medicines .............. [[31mERROR[0m in 1.48s]
[0m14:21:02.035438 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m14:21:02.047481 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.medicines' to be skipped because of status 'error'.  Reason: Database Error in model medicines (models/staging/base/medicines.sql)
  No matching signature for operator < for argument types: STRING, INT64
    Signature: T1 < T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [23:10]
  compiled code at target/run/hospital_analytics/models/staging/base/medicines.sql.
[0m14:21:02.091752 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac447db830>]}
[0m14:21:02.094585 [info ] [Thread-1 (]: 1 of 11 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.56s]
[0m14:21:02.099355 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:21:03.684801 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06c0e3ab-5a5c-4888-9207-eeebb0c54f45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac3e78bdd0>]}
[0m14:21:03.686899 [info ] [Thread-2 (]: 2 of 11 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (3.0 rows, 191.0 Bytes processed)[0m in 3.15s]
[0m14:21:03.690501 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctors
[0m14:21:03.694104 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m14:21:03.696615 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m14:21:03.698337 [info ] [Thread-4 (]: 5 of 11 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m14:21:03.701715 [info ] [Thread-3 (]: 6 of 11 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m14:21:03.704242 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m14:21:03.706385 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m14:21:03.711024 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m14:21:03.713981 [info ] [Thread-2 (]: 7 of 11 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m14:21:03.716566 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m14:21:03.718622 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m14:21:03.720913 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m14:21:03.723411 [info ] [Thread-1 (]: 8 of 11 SKIP relation hospital_analytics.doctor_performance .................... [[33mSKIP[0m]
[0m14:21:03.727603 [info ] [Thread-2 (]: 9 of 11 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m14:21:03.730958 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m14:21:03.733419 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m14:21:03.735444 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m14:21:03.736866 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m14:21:03.739675 [info ] [Thread-3 (]: 10 of 11 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m14:21:03.743659 [info ] [Thread-4 (]: 11 of 11 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m14:21:03.746636 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m14:21:03.749301 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m14:21:03.761063 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:21:03.768550 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:21:03.770576 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m14:21:03.771988 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m14:21:03.773094 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m14:21:03.774610 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m14:21:03.775686 [info ] [MainThread]: 
[0m14:21:03.777517 [info ] [MainThread]: Finished running 10 table models, 1 view model in 0 hours 0 minutes and 12.81 seconds (12.81s).
[0m14:21:03.783418 [debug] [MainThread]: Command end result
[0m14:21:03.872034 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:21:03.876723 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:21:03.894936 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:21:03.896278 [info ] [MainThread]: 
[0m14:21:03.898377 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m14:21:03.900269 [info ] [MainThread]: 
[0m14:21:03.902939 [error] [MainThread]:   Database Error in model patients (models/staging/base/patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [24:3]
  compiled code at target/run/hospital_analytics/models/staging/base/patients.sql
[0m14:21:03.905147 [info ] [MainThread]: 
[0m14:21:03.908401 [error] [MainThread]:   Database Error in model medicines (models/staging/base/medicines.sql)
  No matching signature for operator < for argument types: STRING, INT64
    Signature: T1 < T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [23:10]
  compiled code at target/run/hospital_analytics/models/staging/base/medicines.sql
[0m14:21:03.911970 [info ] [MainThread]: 
[0m14:21:03.914599 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=7 TOTAL=11
[0m14:21:03.919617 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 21.758377, "process_in_blocks": "896", "process_kernel_time": 2.210946, "process_mem_max_rss": "215652", "process_out_blocks": "3464", "process_user_time": 17.46777}
[0m14:21:03.921637 [debug] [MainThread]: Command `dbt run` failed at 14:21:03.921242 after 21.76 seconds
[0m14:21:03.923133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac64688c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac44b56ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ac64849550>]}
[0m14:21:03.924651 [debug] [MainThread]: Flushing usage events
[0m14:21:05.447790 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:27:47.794960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbcc4df40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbcd44770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbc4c0f50>]}


============================== 14:27:47.806725 | 191a5212-5ce0-49f9-932b-eef959582877 ==============================
[0m14:27:47.806725 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:27:47.808814 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt clean', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:27:48.161791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '191a5212-5ce0-49f9-932b-eef959582877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbba70890>]}
[0m14:27:48.201573 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.6978635, "process_in_blocks": "0", "process_kernel_time": 0.812379, "process_mem_max_rss": "87816", "process_out_blocks": "8", "process_user_time": 4.382649}
[0m14:27:48.203400 [debug] [MainThread]: Command `dbt clean` succeeded at 14:27:48.203015 after 0.70 seconds
[0m14:27:48.204408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbbe76e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbbf77560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9fbb822d20>]}
[0m14:27:48.205545 [debug] [MainThread]: Flushing usage events
[0m14:27:49.679778 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:27:55.339324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abeab5550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abc4a9ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abc31b7a0>]}


============================== 14:27:55.389882 | 26b547f4-3db0-4bdb-a122-fb1187624044 ==============================
[0m14:27:55.389882 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:27:55.399894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:27:56.467444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '26b547f4-3db0-4bdb-a122-fb1187624044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abc269e80>]}
[0m14:27:56.614066 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:27:56.625987 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:27:56.633822 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 2.0276947, "process_in_blocks": "0", "process_kernel_time": 0.843112, "process_mem_max_rss": "87812", "process_out_blocks": "8", "process_user_time": 5.546418}
[0m14:27:56.635850 [debug] [MainThread]: Command `dbt deps` succeeded at 14:27:56.635465 after 2.03 seconds
[0m14:27:56.639998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abcd3ee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abc1d1fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765abc4a8e60>]}
[0m14:27:56.641771 [debug] [MainThread]: Flushing usage events
[0m14:27:58.167570 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:34:42.440914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af8339357f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af8353a0350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af833936f00>]}


============================== 14:34:42.451305 | 75a66152-a4a1-4b81-a221-2349ceafec26 ==============================
[0m14:34:42.451305 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:34:42.452874 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt clean', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:34:42.800488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75a66152-a4a1-4b81-a221-2349ceafec26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af833f35f40>]}
[0m14:34:42.838266 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.6754932, "process_in_blocks": "0", "process_kernel_time": 1.185804, "process_mem_max_rss": "87816", "process_out_blocks": "16", "process_user_time": 6.804426}
[0m14:34:42.839776 [debug] [MainThread]: Command `dbt clean` succeeded at 14:34:42.839511 after 0.68 seconds
[0m14:34:42.840781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af833525160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af8340b7200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af83336b110>]}
[0m14:34:42.841714 [debug] [MainThread]: Flushing usage events
[0m14:34:44.398273 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:34:53.704933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d5575d7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d57951730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d55cb4a70>]}


============================== 14:34:53.714438 | f0831133-4c45-448e-a709-9abc0cda47ee ==============================
[0m14:34:53.714438 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:34:53.715604 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m14:34:54.041720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f0831133-4c45-448e-a709-9abc0cda47ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d552420f0>]}
[0m14:34:54.082015 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:34:54.084576 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:34:54.087900 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.60041213, "process_in_blocks": "0", "process_kernel_time": 0.628432, "process_mem_max_rss": "87940", "process_out_blocks": "8", "process_user_time": 4.278947}
[0m14:34:54.089935 [debug] [MainThread]: Command `dbt deps` succeeded at 14:34:54.089574 after 0.60 seconds
[0m14:34:54.090585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d57951730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d552420f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712d551ae030>]}
[0m14:34:54.092121 [debug] [MainThread]: Flushing usage events
[0m14:34:55.490280 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:35:07.293515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f8a157800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f88482750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f88481580>]}


============================== 14:35:07.304300 | 79e98f02-a0c6-43db-9d55-c03f0a1c836a ==============================
[0m14:35:07.304300 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:35:07.306541 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:35:10.079742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f6880fda0>]}
[0m14:35:10.262523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f884ebda0>]}
[0m14:35:10.265013 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:35:10.920076 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:35:10.922756 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:35:10.924184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f688bf410>]}
[0m14:35:15.951022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f63dcacf0>]}
[0m14:35:16.260386 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:35:16.269027 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:35:16.320134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f6372e600>]}
[0m14:35:16.321778 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:35:16.323581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f63db6ab0>]}
[0m14:35:16.330488 [info ] [MainThread]: 
[0m14:35:16.332228 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:35:16.332920 [info ] [MainThread]: 
[0m14:35:16.333852 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:35:16.349654 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:35:16.351881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:35:17.202334 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m14:35:17.203876 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:35:17.287112 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m14:35:17.291865 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m14:35:17.293830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:35:17.296395 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:35:17.864532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f63bbc1a0>]}
[0m14:35:17.865962 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:35:17.876586 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m14:35:17.878885 [info ] [Thread-1 (]: 1 of 6 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m14:35:17.881454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m14:35:17.882976 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m14:35:17.893063 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:35:17.911035 [info ] [Thread-2 (]: 2 of 6 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:35:17.914807 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:35:17.917595 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m14:35:17.934720 [info ] [Thread-4 (]: 4 of 6 START sql table model hospital_staging.doctors .......................... [RUN]
[0m14:35:17.929550 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m14:35:17.932026 [info ] [Thread-3 (]: 3 of 6 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m14:35:17.919128 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m14:35:17.937838 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m14:35:17.940755 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m14:35:17.946549 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:35:17.944544 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m14:35:17.942783 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:35:17.960314 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:35:17.963628 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m14:35:17.973632 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m14:35:17.985336 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:35:18.006434 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:35:18.100173 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m14:35:18.102098 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:35:18.285748 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:35:18.288826 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:35:18.240612 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:35:18.292844 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m14:35:18.389533 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Perhitungan age yang benar:
  EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM date_of_birth) AS age
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:35:18.391645 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:35:18.403560 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:35:18.405237 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:35:18.479575 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m14:35:18.484766 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:35:19.027472 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m14:35:19.029767 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m14:35:19.174725 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6c650643-df36-4cc0-ba21-2d57ecadadb3&page=queryresults
[0m14:35:19.180970 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:91cffded-6fc5-484e-95ec-8ce26994c078&page=queryresults
[0m14:35:19.210645 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5816f3b9-6477-46fa-9d35-5faf6c1a6432&page=queryresults
[0m14:35:19.273810 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8a9ffd35-c22a-41a9-b5f6-c954f21e2293&page=queryresults
[0m14:35:19.341475 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5816f3b9-6477-46fa-9d35-5faf6c1a6432&page=queryresults
[0m14:35:19.359387 [debug] [Thread-2 (]: Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  No matching signature for function EXTRACT for argument types: DATE_TIME_PART FROM INT64
    Signature: EXTRACT(DATE_TIME_PART FROM DATE)
      Argument 1: Unable to coerce type INT64 to expected type DATE
    Signature: EXTRACT(DATE_TIME_PART FROM TIMESTAMP [AT TIME ZONE STRING])
      Argument 1: Unable to coerce type INT64 to expected type TIMESTAMP
    Signature: EXTRACT(DATE_TIME_PART FROM DATETIME)
      Argument 1: Unable to coerce type INT64 to expected type DATETIME
    Signature: EXTRACT(DATE_TIME_PART FROM TIME)
      Argument 1: Unable to coerce type INT64 to expected type TIME
    Signature: EXTRACT(DATE_TIME_PART FROM INTERVAL)
      Argument 1: Unable to coerce type INT64 to expected type INTERVAL at [17:39]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql
[0m14:35:19.365333 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f87f96570>]}
[0m14:35:19.369007 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model hospital_staging._hospital_patients ....... [[31mERROR[0m in 1.44s]
[0m14:35:19.374364 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:35:19.376427 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m14:35:19.378577 [info ] [Thread-2 (]: 5 of 6 START sql table model hospital_staging.medicines ........................ [RUN]
[0m14:35:19.385996 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics._hospital_patients' to be skipped because of status 'error'.  Reason: Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  No matching signature for function EXTRACT for argument types: DATE_TIME_PART FROM INT64
    Signature: EXTRACT(DATE_TIME_PART FROM DATE)
      Argument 1: Unable to coerce type INT64 to expected type DATE
    Signature: EXTRACT(DATE_TIME_PART FROM TIMESTAMP [AT TIME ZONE STRING])
      Argument 1: Unable to coerce type INT64 to expected type TIMESTAMP
    Signature: EXTRACT(DATE_TIME_PART FROM DATETIME)
      Argument 1: Unable to coerce type INT64 to expected type DATETIME
    Signature: EXTRACT(DATE_TIME_PART FROM TIME)
      Argument 1: Unable to coerce type INT64 to expected type TIME
    Signature: EXTRACT(DATE_TIME_PART FROM INTERVAL)
      Argument 1: Unable to coerce type INT64 to expected type INTERVAL at [17:39]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql.
[0m14:35:19.396084 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m14:35:19.402067 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m14:35:19.416402 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m14:35:19.418223 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m14:35:19.425847 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m14:35:19.428135 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  price,
  -- Categorize price level
  CASE
    WHEN price < 10 THEN 'Low-cost'
    WHEN price BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`
    );
  
[0m14:35:19.429646 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:35:20.328615 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c70a6730-8d13-454c-addd-0512a666e315&page=queryresults
[0m14:35:20.515232 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c70a6730-8d13-454c-addd-0512a666e315&page=queryresults
[0m14:35:20.743290 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f61fb1850>]}
[0m14:35:20.757806 [info ] [Thread-3 (]: 3 of 6 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 2.80s]
[0m14:35:20.780436 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:35:20.830381 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f62fded50>]}
[0m14:35:20.955190 [info ] [Thread-1 (]: 1 of 6 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 2.83s]
[0m14:35:20.964238 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m14:35:20.810051 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m14:35:21.022706 [info ] [Thread-3 (]: 6 of 6 START sql table model hospital_staging.patients ......................... [RUN]
[0m14:35:21.051491 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m14:35:21.150297 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m14:35:21.116924 [debug] [Thread-2 (]: Database Error in model medicines (models/staging/refined/medicines.sql)
  No matching signature for operator < for argument types: STRING, INT64
    Signature: T1 < T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [23:10]
  compiled code at target/run/hospital_analytics/models/staging/refined/medicines.sql
[0m14:35:21.215433 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f62b2d550>]}
[0m14:35:21.218593 [error] [Thread-2 (]: 5 of 6 ERROR creating sql table model hospital_staging.medicines ............... [[31mERROR[0m in 1.80s]
[0m14:35:21.232750 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m14:35:21.461702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f62f89ca0>]}
[0m14:35:21.415362 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m14:35:21.521735 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.medicines' to be skipped because of status 'error'.  Reason: Database Error in model medicines (models/staging/refined/medicines.sql)
  No matching signature for operator < for argument types: STRING, INT64
    Signature: T1 < T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [23:10]
  compiled code at target/run/hospital_analytics/models/staging/refined/medicines.sql.
[0m14:35:21.504578 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m14:35:21.541239 [info ] [Thread-4 (]: 4 of 6 OK created sql table model hospital_staging.doctors ..................... [[32mCREATE TABLE (3.0 rows, 191.0 Bytes processed)[0m in 3.52s]
[0m14:35:21.631695 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m14:35:21.653244 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m14:35:21.660417 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

SELECT
  patient_id,
  full_name AS patient_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Calculate age
  DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) AS age,
  -- Create age group
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`
    );
  
[0m14:35:21.679519 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:35:22.874739 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:93885549-f1ca-45d9-b9a2-7147c0076808&page=queryresults
[0m14:35:23.045399 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:93885549-f1ca-45d9-b9a2-7147c0076808&page=queryresults
[0m14:35:23.092328 [debug] [Thread-3 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [24:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:35:23.094341 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79e98f02-a0c6-43db-9d55-c03f0a1c836a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f62f9a120>]}
[0m14:35:23.096377 [error] [Thread-3 (]: 6 of 6 ERROR creating sql table model hospital_staging.patients ................ [[31mERROR[0m in 2.05s]
[0m14:35:23.099105 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m14:35:23.101530 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [24:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m14:35:23.113477 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:35:23.118582 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:35:23.119893 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m14:35:23.120884 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m14:35:23.122347 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m14:35:23.123671 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m14:35:23.125209 [info ] [MainThread]: 
[0m14:35:23.126374 [info ] [MainThread]: Finished running 3 table models, 3 view models in 0 hours 0 minutes and 6.79 seconds (6.79s).
[0m14:35:23.132676 [debug] [MainThread]: Command end result
[0m14:35:23.581940 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:35:23.603296 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:35:23.757351 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:35:23.767930 [info ] [MainThread]: 
[0m14:35:23.778302 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m14:35:23.788705 [info ] [MainThread]: 
[0m14:35:23.796606 [error] [MainThread]:   Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  No matching signature for function EXTRACT for argument types: DATE_TIME_PART FROM INT64
    Signature: EXTRACT(DATE_TIME_PART FROM DATE)
      Argument 1: Unable to coerce type INT64 to expected type DATE
    Signature: EXTRACT(DATE_TIME_PART FROM TIMESTAMP [AT TIME ZONE STRING])
      Argument 1: Unable to coerce type INT64 to expected type TIMESTAMP
    Signature: EXTRACT(DATE_TIME_PART FROM DATETIME)
      Argument 1: Unable to coerce type INT64 to expected type DATETIME
    Signature: EXTRACT(DATE_TIME_PART FROM TIME)
      Argument 1: Unable to coerce type INT64 to expected type TIME
    Signature: EXTRACT(DATE_TIME_PART FROM INTERVAL)
      Argument 1: Unable to coerce type INT64 to expected type INTERVAL at [17:39]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql
[0m14:35:23.803573 [info ] [MainThread]: 
[0m14:35:23.808571 [error] [MainThread]:   Database Error in model medicines (models/staging/refined/medicines.sql)
  No matching signature for operator < for argument types: STRING, INT64
    Signature: T1 < T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [23:10]
  compiled code at target/run/hospital_analytics/models/staging/refined/medicines.sql
[0m14:35:23.810235 [info ] [MainThread]: 
[0m14:35:23.816074 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [24:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:35:23.820400 [info ] [MainThread]: 
[0m14:35:23.822998 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 TOTAL=6
[0m14:35:23.827470 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 16.820097, "process_in_blocks": "0", "process_kernel_time": 2.410645, "process_mem_max_rss": "216584", "process_out_blocks": "3528", "process_user_time": 16.53524}
[0m14:35:23.829537 [debug] [MainThread]: Command `dbt run` failed at 14:35:23.829075 after 16.82 seconds
[0m14:35:23.830986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f882f05c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f633ceb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6f8835b5f0>]}
[0m14:35:23.832639 [debug] [MainThread]: Flushing usage events
[0m14:35:25.264498 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:39:50.174760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed7fb23b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed8004bc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed7f920bf0>]}


============================== 14:39:50.186003 | 38d8d98b-0d46-4161-938f-6a8f018906ff ==============================
[0m14:39:50.186003 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:39:50.187913 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt clean', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:39:50.523487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38d8d98b-0d46-4161-938f-6a8f018906ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed7fb86090>]}
[0m14:39:50.565470 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 1.6138959, "process_in_blocks": "0", "process_kernel_time": 1.122229, "process_mem_max_rss": "87944", "process_out_blocks": "8", "process_user_time": 7.528745}
[0m14:39:50.567910 [debug] [MainThread]: Command `dbt clean` succeeded at 14:39:50.567460 after 1.62 seconds
[0m14:39:50.569659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed7f175190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed7f8cb800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ed7f77acc0>]}
[0m14:39:50.571581 [debug] [MainThread]: Flushing usage events
[0m14:39:52.103204 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:40:00.231455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc0415fbaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc041502e70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc0415f84a0>]}


============================== 14:40:00.240529 | b9280fb1-5556-40d4-862a-b3a9da0ef85e ==============================
[0m14:40:00.240529 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:40:00.242690 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:40:00.587687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b9280fb1-5556-40d4-862a-b3a9da0ef85e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc042e3f7d0>]}
[0m14:40:00.630461 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:40:00.633531 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m14:40:00.637004 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.67090416, "process_in_blocks": "0", "process_kernel_time": 0.680971, "process_mem_max_rss": "87936", "process_out_blocks": "16", "process_user_time": 4.450813}
[0m14:40:00.638699 [debug] [MainThread]: Command `dbt deps` succeeded at 14:40:00.638358 after 0.67 seconds
[0m14:40:00.639823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc0415cf200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc041022030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc04101a240>]}
[0m14:40:00.641101 [debug] [MainThread]: Flushing usage events
[0m14:40:02.099026 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:40:21.595598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97293763c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9727f75eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9727933aa0>]}


============================== 14:40:21.605922 | 2f6a2910-684e-4c1e-be2d-d161ad1aa484 ==============================
[0m14:40:21.605922 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:40:21.608074 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging.base', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:40:24.460765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9727569340>]}
[0m14:40:24.661739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b972765d250>]}
[0m14:40:24.664055 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:40:25.326054 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:40:25.328892 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:40:25.330648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97035ab620>]}
[0m14:40:30.083622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97031f8ce0>]}
[0m14:40:30.353551 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:40:30.360836 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:40:30.407614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9702db5880>]}
[0m14:40:30.409427 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:40:30.410581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9703b5f5c0>]}
[0m14:40:30.416496 [info ] [MainThread]: 
[0m14:40:30.418370 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:40:30.419912 [info ] [MainThread]: 
[0m14:40:30.421952 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:40:30.435951 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:40:30.438075 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:40:31.238098 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m14:40:31.239867 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:40:31.323354 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m14:40:31.324981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:40:31.409719 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m14:40:31.412003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:40:31.868690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9702d707a0>]}
[0m14:40:31.870449 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:40:31.883790 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m14:40:31.887052 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:40:31.889570 [info ] [Thread-1 (]: 1 of 3 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m14:40:31.891823 [info ] [Thread-2 (]: 2 of 3 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:40:31.894272 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m14:40:31.895790 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:40:31.897955 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m14:40:31.900387 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m14:40:31.902497 [info ] [Thread-3 (]: 3 of 3 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m14:40:31.905013 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:40:31.913495 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m14:40:31.947008 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m14:40:31.949065 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:40:31.950933 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:40:31.963519 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:40:31.967750 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:40:31.970440 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:40:31.972677 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m14:40:32.191630 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m14:40:32.206840 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:40:32.209612 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:40:32.213761 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Perbaikan 1: Hitung usia dengan benar
  DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) AS age,
  -- Atau alternatif:
  -- EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM date_of_birth) AS age
  -- Perbaikan 2: Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:40:32.216066 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:40:32.300972 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m14:40:32.302793 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:40:32.304747 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:40:32.384684 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:40:33.267615 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a5aaf495-f89c-4070-8d86-4706763084ca&page=queryresults
[0m14:40:33.355912 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7d02b6bb-8f5d-4ffa-977d-571be2498835&page=queryresults
[0m14:40:33.429068 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e2413ec6-4e3b-4674-8493-f05ef664288a&page=queryresults
[0m14:40:33.506091 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a5aaf495-f89c-4070-8d86-4706763084ca&page=queryresults
[0m14:40:33.567327 [debug] [Thread-2 (]: Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql
[0m14:40:33.589181 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b970256e8a0>]}
[0m14:40:33.592268 [error] [Thread-2 (]: 2 of 3 ERROR creating sql view model hospital_staging._hospital_patients ....... [[31mERROR[0m in 1.68s]
[0m14:40:33.595583 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:40:33.598438 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics._hospital_patients' to be skipped because of status 'error'.  Reason: Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql.
[0m14:40:36.303750 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97036081a0>]}
[0m14:40:36.314975 [info ] [Thread-1 (]: 1 of 3 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 4.41s]
[0m14:40:36.324735 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m14:40:36.346653 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f6a2910-684e-4c1e-be2d-d161ad1aa484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97021aaa50>]}
[0m14:40:36.350520 [info ] [Thread-3 (]: 3 of 3 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 4.42s]
[0m14:40:36.359896 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:40:36.398867 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:40:36.407554 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:40:36.409868 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m14:40:36.411360 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m14:40:36.412412 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m14:40:36.414872 [info ] [MainThread]: 
[0m14:40:36.416923 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 5.99 seconds (5.99s).
[0m14:40:36.421265 [debug] [MainThread]: Command end result
[0m14:40:36.501344 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:40:36.506344 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:40:36.524578 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:40:36.525783 [info ] [MainThread]: 
[0m14:40:36.527395 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:40:36.528453 [info ] [MainThread]: 
[0m14:40:36.531073 [error] [MainThread]:   Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  No matching signature for function DATE_DIFF
    Argument types: DATE, INT64, DATE_TIME_PART
    Signature: DATE_DIFF(DATE, DATE, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATE
    Signature: DATE_DIFF(DATETIME, DATETIME, DATE_TIME_PART)
      Argument 2: Unable to coerce type INT64 to expected type DATETIME
    Signature: DATE_DIFF(TIMESTAMP, TIMESTAMP, DATE_TIME_PART)
      Argument 1: Unable to coerce type DATE to expected type TIMESTAMP at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql
[0m14:40:36.532860 [info ] [MainThread]: 
[0m14:40:36.534113 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m14:40:36.537382 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.228151, "process_in_blocks": "0", "process_kernel_time": 2.038603, "process_mem_max_rss": "214784", "process_out_blocks": "3464", "process_user_time": 16.335112}
[0m14:40:36.539191 [debug] [MainThread]: Command `dbt run` failed at 14:40:36.538753 after 15.23 seconds
[0m14:40:36.540346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b9728e6eea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b970294b980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b970153ae40>]}
[0m14:40:36.541565 [debug] [MainThread]: Flushing usage events
[0m14:40:37.984065 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:43:18.724513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc67fac30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc6407e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc5e50bc0>]}


============================== 14:43:18.734377 | 67cbfa1f-27f5-4301-84b0-8f99bf962922 ==============================
[0m14:43:18.734377 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:43:18.735487 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt clean', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:43:19.064779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67cbfa1f-27f5-4301-84b0-8f99bf962922', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc5b46210>]}
[0m14:43:19.109065 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.64288074, "process_in_blocks": "0", "process_kernel_time": 0.676626, "process_mem_max_rss": "87940", "process_out_blocks": "8", "process_user_time": 4.448543}
[0m14:43:19.111047 [debug] [MainThread]: Command `dbt clean` succeeded at 14:43:19.110714 after 0.65 seconds
[0m14:43:19.112097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc60213a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc6196ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78efc612a600>]}
[0m14:43:19.113990 [debug] [MainThread]: Flushing usage events
[0m14:43:20.662515 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:43:37.160517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada4fa84bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada4fd52990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada4fae9b80>]}


============================== 14:43:37.169542 | 56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c ==============================
[0m14:43:37.169542 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:43:37.171269 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select staging.base._hospital_patients', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:43:40.013693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2b9e5400>]}
[0m14:43:40.213374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2bf22450>]}
[0m14:43:40.215047 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:43:40.880299 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:43:40.882965 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:43:40.884448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2b8b2600>]}
[0m14:43:45.635788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2b5f88f0>]}
[0m14:43:45.908909 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:43:45.918883 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:43:45.964964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2a96b830>]}
[0m14:43:45.966579 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:43:45.968773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2b9ac0b0>]}
[0m14:43:45.974976 [info ] [MainThread]: 
[0m14:43:45.976462 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:43:45.977858 [info ] [MainThread]: 
[0m14:43:45.980722 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:43:45.984996 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:43:45.986711 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:46.868643 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m14:43:46.870198 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:43:46.955345 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m14:43:46.957054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:47.038325 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m14:43:47.042623 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:47.499454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada515e8770>]}
[0m14:43:47.501287 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:43:47.516618 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:43:47.518605 [info ] [Thread-1 (]: 1 of 1 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:43:47.520406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m14:43:47.522493 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:43:47.547941 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:43:47.550755 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:43:47.667443 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:43:47.669833 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Pastikan date_of_birth bertipe DATE
  CAST(date_of_birth AS DATE) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Versi 1: Menggunakan DATE_DIFF yang benar
  DATE_DIFF(CURRENT_DATE(), CAST(date_of_birth AS DATE), YEAR) AS age,
  
  -- Atau Versi 2: Alternatif menggunakan EXTRACT
  -- EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM CAST(date_of_birth AS DATE)) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), CAST(date_of_birth AS DATE), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), CAST(date_of_birth AS DATE), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), CAST(date_of_birth AS DATE), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:43:47.673553 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:43:48.301000 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e76b65b3-f99e-43d7-84e6-dfb1b14f3056&page=queryresults
[0m14:43:48.447826 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e76b65b3-f99e-43d7-84e6-dfb1b14f3056&page=queryresults
[0m14:43:48.500476 [debug] [Thread-1 (]: Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  Invalid cast from INT64 to DATE at [12:8]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql
[0m14:43:48.515832 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56bd7be5-7108-45d6-bb2c-c7ffb8dcc59c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada5046e660>]}
[0m14:43:48.523808 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model hospital_staging._hospital_patients ....... [[31mERROR[0m in 0.99s]
[0m14:43:48.529605 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:43:48.535839 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics._hospital_patients' to be skipped because of status 'error'.  Reason: Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  Invalid cast from INT64 to DATE at [12:8]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql.
[0m14:43:48.581749 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:43:48.602384 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:48.608819 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m14:43:48.610046 [debug] [MainThread]: Connection 'list_de-zoomcamp-2025--id_hospital_analytics' was properly closed.
[0m14:43:48.611232 [debug] [MainThread]: Connection 'list_de-zoomcamp-2025--id_hospital_intermediate' was properly closed.
[0m14:43:48.616756 [info ] [MainThread]: 
[0m14:43:48.623982 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.64 seconds (2.64s).
[0m14:43:48.638933 [debug] [MainThread]: Command end result
[0m14:43:48.857615 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:43:48.863731 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:43:48.897480 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:43:48.905651 [info ] [MainThread]: 
[0m14:43:48.915338 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:43:48.918363 [info ] [MainThread]: 
[0m14:43:48.926964 [error] [MainThread]:   Database Error in model _hospital_patients (models/staging/base/_hospital_patients.sql)
  Invalid cast from INT64 to DATE at [12:8]
  compiled code at target/run/hospital_analytics/models/staging/base/_hospital_patients.sql
[0m14:43:48.932824 [info ] [MainThread]: 
[0m14:43:48.938876 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:43:48.949010 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 12.073261, "process_in_blocks": "0", "process_kernel_time": 1.626907, "process_mem_max_rss": "209752", "process_out_blocks": "3384", "process_user_time": 13.88714}
[0m14:43:48.951058 [debug] [MainThread]: Command `dbt run` failed at 14:43:48.950678 after 12.08 seconds
[0m14:43:48.963030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada4fbc33b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada2b546ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ada4fe7dd60>]}
[0m14:43:48.971906 [debug] [MainThread]: Flushing usage events
[0m14:43:50.518581 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:48:10.738372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdceccb63f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdceb71e2a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdcec96d730>]}


============================== 14:48:10.748624 | ee20b2f2-8f96-4872-8745-3593f3ee2a9e ==============================
[0m14:48:10.748624 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:48:10.751101 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt clean', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:48:11.096687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ee20b2f2-8f96-4872-8745-3593f3ee2a9e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdcead35a00>]}
[0m14:48:11.140847 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.68970895, "process_in_blocks": "0", "process_kernel_time": 0.696106, "process_mem_max_rss": "87820", "process_out_blocks": "16", "process_user_time": 4.51221}
[0m14:48:11.142513 [debug] [MainThread]: Command `dbt clean` succeeded at 14:48:11.142102 after 0.69 seconds
[0m14:48:11.143914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdcece69190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdceaf79280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdceae85be0>]}
[0m14:48:11.145679 [debug] [MainThread]: Flushing usage events
[0m14:48:12.606084 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:48:24.846700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0727c55d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07280e7c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07277a5a60>]}


============================== 14:48:24.857581 | c26ba2c5-3d63-4182-a725-444c9b7d3c5a ==============================
[0m14:48:24.857581 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:48:24.859635 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select staging.base._hospital_patients', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:48:27.786991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0709948dd0>]}
[0m14:48:27.993099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07038c3620>]}
[0m14:48:27.995311 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:48:28.672827 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:48:28.675208 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:48:28.676757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0703af7740>]}
[0m14:48:33.535275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0703416540>]}
[0m14:48:33.811639 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:48:33.820298 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:48:33.871052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0703d3aed0>]}
[0m14:48:33.873462 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:48:33.875107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07035f3260>]}
[0m14:48:33.881642 [info ] [MainThread]: 
[0m14:48:33.883480 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:48:33.885308 [info ] [MainThread]: 
[0m14:48:33.887535 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:48:33.891543 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:48:33.893263 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:34.802272 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m14:48:34.804541 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:34.885427 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m14:48:34.889791 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:34.977295 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m14:48:34.979292 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:35.447133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0703d3aed0>]}
[0m14:48:35.448865 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:48:35.463675 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:48:35.465931 [info ] [Thread-1 (]: 1 of 1 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:48:35.468572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m14:48:35.470094 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:48:35.497721 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:48:35.501185 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:48:35.610107 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:48:35.612697 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:48:35.614514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:36.310825 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5c526acf-315f-43c6-8fab-e8f1f0846b33&page=queryresults
[0m14:48:36.738195 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c26ba2c5-3d63-4182-a725-444c9b7d3c5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07039b3b30>]}
[0m14:48:36.740753 [info ] [Thread-1 (]: 1 of 1 OK created sql view model hospital_staging._hospital_patients ........... [[32mCREATE VIEW (0 processed)[0m in 1.27s]
[0m14:48:36.743437 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:48:36.755412 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:48:36.765051 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:48:36.767790 [debug] [MainThread]: Connection 'list_de-zoomcamp-2025--id_hospital_intermediate' was properly closed.
[0m14:48:36.770395 [debug] [MainThread]: Connection 'list_de-zoomcamp-2025--id_hospital_analytics' was properly closed.
[0m14:48:36.772321 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m14:48:36.773727 [info ] [MainThread]: 
[0m14:48:36.777386 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.89 seconds (2.89s).
[0m14:48:36.781602 [debug] [MainThread]: Command end result
[0m14:48:36.871462 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:48:36.876707 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:48:36.895858 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:48:36.897184 [info ] [MainThread]: 
[0m14:48:36.898729 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:48:36.900541 [info ] [MainThread]: 
[0m14:48:36.902397 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:48:36.906681 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.326183, "process_in_blocks": "0", "process_kernel_time": 1.87527, "process_mem_max_rss": "213116", "process_out_blocks": "3400", "process_user_time": 16.403877}
[0m14:48:36.908772 [debug] [MainThread]: Command `dbt run` succeeded at 14:48:36.908130 after 12.33 seconds
[0m14:48:36.910736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07282a5a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0728188110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e07281890a0>]}
[0m14:48:36.912363 [debug] [MainThread]: Flushing usage events
[0m14:48:38.338462 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:49:36.346564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73596753ff80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735966936b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735966fb7110>]}


============================== 14:49:36.357135 | 9d2f046b-083b-441b-9129-af0761b3521f ==============================
[0m14:49:36.357135 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:49:36.358591 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select staging.base', 'send_anonymous_usage_stats': 'True'}
[0m14:49:39.297168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7359429b1fa0>]}
[0m14:49:39.494257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7359664313a0>]}
[0m14:49:39.496791 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:49:40.175857 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:49:40.593743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:49:40.595193 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:49:40.739112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7359423f2150>]}
[0m14:49:41.012701 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:49:41.020982 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:49:41.070666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735941f76030>]}
[0m14:49:41.072610 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:49:41.074354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7359423f05f0>]}
[0m14:49:41.080661 [info ] [MainThread]: 
[0m14:49:41.082098 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:49:41.082930 [info ] [MainThread]: 
[0m14:49:41.084491 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:49:41.096776 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:49:41.098575 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:49:41.919967 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m14:49:41.922817 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m14:49:41.924499 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:49:41.926467 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m14:49:41.928356 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:49:42.008980 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:49:42.560527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735942aea8a0>]}
[0m14:49:42.562521 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:49:42.576763 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m14:49:42.578683 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:49:42.579862 [info ] [Thread-1 (]: 1 of 3 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m14:49:42.582540 [info ] [Thread-2 (]: 2 of 3 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:49:42.584931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m14:49:42.586702 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:49:42.588826 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m14:49:42.590912 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m14:49:42.593268 [info ] [Thread-3 (]: 3 of 3 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m14:49:42.595928 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:49:42.625244 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m14:49:42.629469 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m14:49:42.638558 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:49:42.644132 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:49:42.659128 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:49:42.661372 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m14:49:42.671095 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:49:42.753989 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:49:42.920004 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:49:42.924349 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:49:42.915419 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m14:49:42.929081 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:49:42.932135 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m14:49:42.934875 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:49:42.937453 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:49:42.939053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:49:43.022858 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:49:43.712540 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f0497110-2023-4fdb-b215-4b2902e27c8b&page=queryresults
[0m14:49:43.726500 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:090f0209-6502-41b6-8d94-32aace4416f6&page=queryresults
[0m14:49:43.742189 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f77b3a20-0dfe-4e9d-b2aa-d52ec3018b0c&page=queryresults
[0m14:49:44.474649 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735940185ac0>]}
[0m14:49:44.476452 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735966fb6840>]}
[0m14:49:44.481057 [info ] [Thread-3 (]: 3 of 3 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 1.84s]
[0m14:49:44.488488 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:49:44.482865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2f046b-083b-441b-9129-af0761b3521f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735940b89b50>]}
[0m14:49:44.485507 [info ] [Thread-2 (]: 2 of 3 OK created sql view model hospital_staging._hospital_patients ........... [[32mCREATE VIEW (0 processed)[0m in 1.88s]
[0m14:49:44.493087 [info ] [Thread-1 (]: 1 of 3 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 1.90s]
[0m14:49:44.497755 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:49:44.500530 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m14:49:44.511844 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:49:44.518100 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:49:44.519836 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m14:49:44.521011 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m14:49:44.522291 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m14:49:44.524080 [info ] [MainThread]: 
[0m14:49:44.525263 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.44 seconds (3.44s).
[0m14:49:44.529476 [debug] [MainThread]: Command end result
[0m14:49:44.619395 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:49:44.625740 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:49:44.647091 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:49:44.648437 [info ] [MainThread]: 
[0m14:49:44.649699 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:49:44.650867 [info ] [MainThread]: 
[0m14:49:44.652809 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:49:44.657369 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.595525, "process_in_blocks": "0", "process_kernel_time": 1.916602, "process_mem_max_rss": "209000", "process_out_blocks": "2368", "process_user_time": 11.890804}
[0m14:49:44.659539 [debug] [MainThread]: Command `dbt run` succeeded at 14:49:44.658929 after 8.60 seconds
[0m14:49:44.660928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735966fcbda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7359664f92b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73594232fa10>]}
[0m14:49:44.662401 [debug] [MainThread]: Flushing usage events
[0m14:49:46.299020 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:50:19.263125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4eadeed8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4eae0633b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4eadeeeff0>]}


============================== 14:50:19.273795 | b53dbd93-b96e-4f97-9f8b-708e187519fa ==============================
[0m14:50:19.273795 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:50:19.276113 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:50:22.171357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8dc6b9e0>]}
[0m14:50:22.364879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8e2a9970>]}
[0m14:50:22.366565 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:50:23.044639 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:50:23.461093 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:50:23.462441 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:50:23.605481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8dabe8d0>]}
[0m14:50:23.882103 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:50:23.891189 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:50:23.940864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8d8f9f40>]}
[0m14:50:23.942209 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:50:23.943978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8dac8bf0>]}
[0m14:50:23.949602 [info ] [MainThread]: 
[0m14:50:23.951383 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:50:23.952300 [info ] [MainThread]: 
[0m14:50:23.953429 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:50:23.967824 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:50:23.969959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:24.834320 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m14:50:24.835877 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:50:24.925238 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m14:50:24.926830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:25.022346 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m14:50:25.023771 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:26.497240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4eaf7709b0>]}
[0m14:50:26.498856 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:50:26.512331 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m14:50:26.514415 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:50:26.516668 [info ] [Thread-1 (]: 1 of 6 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m14:50:26.518872 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:50:26.521020 [info ] [Thread-2 (]: 2 of 6 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:50:26.522984 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m14:50:26.525398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m14:50:26.527030 [info ] [Thread-3 (]: 3 of 6 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m14:50:26.528850 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m14:50:26.531608 [info ] [Thread-4 (]: 4 of 6 START sql table model hospital_staging.doctors .......................... [RUN]
[0m14:50:26.533970 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m14:50:26.535607 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m14:50:26.537012 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:50:26.538873 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m14:50:26.553892 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:50:26.598267 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m14:50:26.597563 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:50:26.600962 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m14:50:26.620040 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:50:26.627657 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m14:50:26.632461 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m14:50:26.649987 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m14:50:26.681803 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:50:26.694731 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:50:26.732458 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:50:26.907278 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m14:50:26.915973 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:50:26.917856 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m14:50:26.900610 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:50:27.004564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:50:27.007850 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:50:27.009753 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:50:27.098232 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:50:27.101106 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:50:27.900793 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m14:50:27.903824 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m14:50:28.361977 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1912c708-b937-41b8-aa69-ddd2d77bc202&page=queryresults
[0m14:50:28.381627 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d1bd34b9-e5e8-4f26-9c70-7f0c618bd823&page=queryresults
[0m14:50:29.004880 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0ef2beb1-cfbe-4b81-b60a-0cd4d746f7fc&page=queryresults
[0m14:50:29.017336 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1cf1a4cf-7fba-419d-82d3-8c9db6269349&page=queryresults
[0m14:50:29.199476 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8db184d0>]}
[0m14:50:29.201685 [info ] [Thread-2 (]: 2 of 6 OK created sql view model hospital_staging._hospital_patients ........... [[32mCREATE VIEW (0 processed)[0m in 2.67s]
[0m14:50:29.205451 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:50:29.208064 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m14:50:29.210091 [info ] [Thread-2 (]: 5 of 6 START sql table model hospital_staging.patients ......................... [RUN]
[0m14:50:29.212422 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m14:50:29.214106 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m14:50:29.223463 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m14:50:29.225552 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m14:50:29.232745 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m14:50:29.234752 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

SELECT
  patient_id,
  patient_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Perbaikan DATE_DIFF
  DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) AS age,
  -- Perbaikan age group
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
    );
  
[0m14:50:29.237399 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:50:29.332441 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8d5c9490>]}
[0m14:50:29.334965 [info ] [Thread-1 (]: 1 of 6 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 2.81s]
[0m14:50:29.337517 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m14:50:29.341710 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m14:50:29.343297 [info ] [Thread-1 (]: 6 of 6 START sql table model hospital_staging.medicines ........................ [RUN]
[0m14:50:29.345476 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m14:50:29.346875 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m14:50:29.357051 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m14:50:29.358470 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m14:50:29.366866 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m14:50:29.369531 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m14:50:29.370859 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:50:29.468874 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8d5b46e0>]}
[0m14:50:29.471260 [info ] [Thread-3 (]: 3 of 6 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 2.93s]
[0m14:50:29.474423 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:50:29.967224 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8dac80e0>]}
[0m14:50:29.968952 [info ] [Thread-4 (]: 4 of 6 OK created sql table model hospital_staging.doctors ..................... [[32mCREATE TABLE (3.0 rows, 191.0 Bytes processed)[0m in 3.43s]
[0m14:50:29.971601 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m14:50:32.283745 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f69e89b7-6492-400d-86c5-3f5670a47627&page=queryresults
[0m14:50:32.364539 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:463215ae-d30d-4687-929c-bf9f628c6a14&page=queryresults
[0m14:50:32.384259 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f69e89b7-6492-400d-86c5-3f5670a47627&page=queryresults
[0m14:50:32.401671 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Unrecognized name: patient_name; Did you mean patient_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:50:32.403539 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8dabfaa0>]}
[0m14:50:32.405584 [error] [Thread-2 (]: 5 of 6 ERROR creating sql table model hospital_staging.patients ................ [[31mERROR[0m in 3.19s]
[0m14:50:32.407741 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m14:50:32.410528 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Unrecognized name: patient_name; Did you mean patient_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m14:50:33.855389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b53dbd93-b96e-4f97-9f8b-708e187519fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8d7533e0>]}
[0m14:50:33.857897 [info ] [Thread-1 (]: 6 of 6 OK created sql table model hospital_staging.medicines ................... [[32mCREATE TABLE (4.0 rows, 186.0 Bytes processed)[0m in 4.51s]
[0m14:50:33.860685 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m14:50:33.870968 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:50:33.876649 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:50:33.877870 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m14:50:33.879065 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m14:50:33.880924 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m14:50:33.882107 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m14:50:33.883726 [info ] [MainThread]: 
[0m14:50:33.886054 [info ] [MainThread]: Finished running 3 table models, 3 view models in 0 hours 0 minutes and 9.93 seconds (9.93s).
[0m14:50:33.894013 [debug] [MainThread]: Command end result
[0m14:50:33.985594 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:50:33.991712 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:50:34.010438 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:50:34.011604 [info ] [MainThread]: 
[0m14:50:34.013650 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:50:34.015437 [info ] [MainThread]: 
[0m14:50:34.016790 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Unrecognized name: patient_name; Did you mean patient_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:50:34.018978 [info ] [MainThread]: 
[0m14:50:34.021834 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m14:50:34.026407 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.200258, "process_in_blocks": "0", "process_kernel_time": 2.11631, "process_mem_max_rss": "210520", "process_out_blocks": "2440", "process_user_time": 13.545087}
[0m14:50:34.028467 [debug] [MainThread]: Command `dbt run` failed at 14:50:34.027957 after 15.20 seconds
[0m14:50:34.030006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4eadf576e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4eadf55af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4e8db50290>]}
[0m14:50:34.033114 [debug] [MainThread]: Flushing usage events
[0m14:50:35.456976 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:53:01.385117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703872e75af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703872e425d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7038735479b0>]}


============================== 14:53:01.395956 | 10adb49b-3bb3-44da-b598-59137a2a0f54 ==============================
[0m14:53:01.395956 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:53:01.398571 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:53:04.342388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384eb0bce0>]}
[0m14:53:04.539895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7038733920c0>]}
[0m14:53:04.542182 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:53:05.238421 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:53:05.662266 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:53:05.664431 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m14:53:07.295444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384e4eca40>]}
[0m14:53:07.559076 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:53:07.568074 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:53:07.621464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384e4ed520>]}
[0m14:53:07.623344 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:53:07.624995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384ee3c8f0>]}
[0m14:53:07.631404 [info ] [MainThread]: 
[0m14:53:07.632740 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:53:07.634021 [info ] [MainThread]: 
[0m14:53:07.636327 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:53:07.648879 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:53:07.650339 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:08.929649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m14:53:08.932072 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:53:08.934230 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m14:53:08.937456 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:08.939113 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m14:53:08.941469 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:09.624962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384e50bc20>]}
[0m14:53:09.626995 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:53:09.642665 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m14:53:09.646525 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:53:09.648566 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:53:09.650215 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m14:53:09.644828 [info ] [Thread-1 (]: 1 of 6 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m14:53:09.651858 [info ] [Thread-2 (]: 2 of 6 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:53:09.654098 [info ] [Thread-3 (]: 3 of 6 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m14:53:09.657117 [info ] [Thread-4 (]: 4 of 6 START sql table model hospital_staging.doctors .......................... [RUN]
[0m14:53:09.660758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m14:53:09.663239 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m14:53:09.664803 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m14:53:09.667503 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m14:53:09.669101 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m14:53:09.670973 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:53:09.672605 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:53:09.674397 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m14:53:09.717914 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:53:09.722839 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:53:09.728577 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m14:53:09.739941 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m14:53:09.744258 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:53:09.749552 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m14:53:09.759633 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:53:09.761689 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m14:53:09.875012 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:53:10.128042 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:53:10.136504 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:53:10.139907 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:53:10.141955 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m14:53:10.144488 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:53:10.148788 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m14:53:10.151187 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:53:10.245743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:53:10.249583 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:53:10.712208 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m14:53:10.716394 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m14:53:10.964356 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:945431e2-6cdf-4989-abab-258be5f71866&page=queryresults
[0m14:53:10.980651 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5155064a-afab-495f-adbf-4f2f61e0c470&page=queryresults
[0m14:53:10.987131 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:04f23f99-fbae-466f-938a-ddc4fc7486c7&page=queryresults
[0m14:53:11.018592 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4a924b93-1531-4773-8c64-1efecffcf2de&page=queryresults
[0m14:53:11.466855 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384e5b4f20>]}
[0m14:53:11.469650 [info ] [Thread-2 (]: 2 of 6 OK created sql view model hospital_staging._hospital_patients ........... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m14:53:11.473020 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:53:11.474959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384d5422a0>]}
[0m14:53:11.479932 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384e510cb0>]}
[0m14:53:11.477674 [info ] [Thread-1 (]: 1 of 6 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m14:53:11.487079 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m14:53:11.490046 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m14:53:11.483310 [info ] [Thread-3 (]: 3 of 6 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m14:53:11.496708 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:53:11.498280 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m14:53:11.492894 [info ] [Thread-2 (]: 5 of 6 START sql table model hospital_staging.patients ......................... [RUN]
[0m14:53:11.504576 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m14:53:11.500692 [info ] [Thread-3 (]: 6 of 6 START sql table model hospital_staging.medicines ........................ [RUN]
[0m14:53:11.506986 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m14:53:11.508751 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m14:53:11.516888 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m14:53:11.528849 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m14:53:11.532081 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m14:53:11.543505 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m14:53:11.547325 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m14:53:11.549833 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m14:53:11.557610 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Perbaikan DATE_DIFF
  DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) AS age,
  -- Perbaikan age group
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
    );
  
[0m14:53:11.559653 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:53:11.563114 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:53:12.074352 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m14:53:12.076597 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m14:53:12.922116 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0f9e417d-1605-47e2-a898-f6923f50e6b9&page=queryresults
[0m14:53:12.926876 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384d167770>]}
[0m14:53:12.929848 [info ] [Thread-4 (]: 4 of 6 OK created sql table model hospital_staging.doctors ..................... [[32mCREATE TABLE (3.0 rows, 191.0 Bytes processed)[0m in 3.26s]
[0m14:53:12.931594 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m14:53:13.053695 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ef194a48-a117-4b4d-b97e-3ca10d9e60b3&page=queryresults
[0m14:53:13.219664 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ef194a48-a117-4b4d-b97e-3ca10d9e60b3&page=queryresults
[0m14:53:13.239510 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "-3498"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:53:13.241699 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384d15f500>]}
[0m14:53:13.243437 [error] [Thread-2 (]: 5 of 6 ERROR creating sql table model hospital_staging.patients ................ [[31mERROR[0m in 1.74s]
[0m14:53:13.245114 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m14:53:13.246686 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "-3498"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m14:53:14.824622 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10adb49b-3bb3-44da-b598-59137a2a0f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70384d52e270>]}
[0m14:53:14.829242 [info ] [Thread-3 (]: 6 of 6 OK created sql table model hospital_staging.medicines ................... [[32mCREATE TABLE (4.0 rows, 186.0 Bytes processed)[0m in 3.32s]
[0m14:53:14.833193 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m14:53:14.843502 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:53:14.849611 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:53:14.851214 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m14:53:14.852243 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m14:53:14.853119 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m14:53:14.854249 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m14:53:14.855702 [info ] [MainThread]: 
[0m14:53:14.857247 [info ] [MainThread]: Finished running 3 table models, 3 view models in 0 hours 0 minutes and 7.22 seconds (7.22s).
[0m14:53:14.863501 [debug] [MainThread]: Command end result
[0m14:53:14.963708 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:53:14.969929 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:53:14.989521 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:53:14.990981 [info ] [MainThread]: 
[0m14:53:14.992637 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:53:14.994574 [info ] [MainThread]: 
[0m14:53:14.996867 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "-3498"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:53:14.997979 [info ] [MainThread]: 
[0m14:53:14.998601 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m14:53:15.001687 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.908616, "process_in_blocks": "0", "process_kernel_time": 2.095551, "process_mem_max_rss": "214360", "process_out_blocks": "3536", "process_user_time": 14.500135}
[0m14:53:15.004011 [debug] [MainThread]: Command `dbt run` failed at 14:53:15.003083 after 13.91 seconds
[0m14:53:15.005665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7038730b6d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703873431220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703873430320>]}
[0m14:53:15.007230 [debug] [MainThread]: Flushing usage events
[0m14:53:16.909286 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:56:45.686952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb80cc05fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb80ba84dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb80aab8fb0>]}


============================== 14:56:45.704616 | a8f39c1c-57d9-4dc7-8edc-91cfff699eb6 ==============================
[0m14:56:45.704616 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:56:45.706887 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:56:48.626509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e61b5580>]}
[0m14:56:48.822715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb80a232f60>]}
[0m14:56:48.825200 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:56:49.525912 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m14:56:49.941404 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:56:49.944202 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m14:56:51.601925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e5a9fbc0>]}
[0m14:56:51.873200 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:56:51.882982 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:56:51.933123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e5c22660>]}
[0m14:56:51.934966 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m14:56:51.936875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e5a9fbc0>]}
[0m14:56:51.943364 [info ] [MainThread]: 
[0m14:56:51.944711 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:56:51.946685 [info ] [MainThread]: 
[0m14:56:51.948863 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:56:51.964376 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m14:56:51.966433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:52.741625 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m14:56:52.743511 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m14:56:52.744812 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:56:52.747225 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m14:56:52.749048 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:52.751837 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:53.399247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e5d0d2e0>]}
[0m14:56:53.400966 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:56:53.414113 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m14:56:53.416753 [info ] [Thread-1 (]: 1 of 6 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m14:56:53.418966 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m14:56:53.421074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m14:56:53.422797 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m14:56:53.424554 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m14:56:53.428585 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m14:56:53.426740 [info ] [Thread-2 (]: 2 of 6 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m14:56:53.430961 [info ] [Thread-3 (]: 3 of 6 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m14:56:53.467547 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m14:56:53.455531 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m14:56:53.434747 [info ] [Thread-4 (]: 4 of 6 START sql table model hospital_staging.doctors .......................... [RUN]
[0m14:56:53.475428 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m14:56:53.471586 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m14:56:53.473355 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m14:56:53.477135 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m14:56:53.469600 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m14:56:53.493600 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m14:56:53.504124 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m14:56:53.507232 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m14:56:53.545470 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m14:56:53.557283 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m14:56:53.602768 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m14:56:53.605324 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m14:56:53.692124 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:56:53.806135 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m14:56:53.825902 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m14:56:53.828687 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m14:56:53.831643 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m14:56:53.833593 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m14:56:53.836847 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:56:53.838836 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:56:53.840329 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m14:56:54.013269 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:54.511336 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m14:56:54.514818 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m14:56:54.737265 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d73b0bbf-2ac4-494d-b7c8-e73503c6aa85&page=queryresults
[0m14:56:54.752206 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5454aca0-f1f7-4afd-a708-8f6528af7d9b&page=queryresults
[0m14:56:54.768037 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0f52e5db-f04c-4416-8f00-4f81b319012c&page=queryresults
[0m14:56:54.859602 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4774b63c-4465-446f-9345-c988b02aa819&page=queryresults
[0m14:56:55.283548 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e610cf20>]}
[0m14:56:55.285034 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e57fbf80>]}
[0m14:56:55.290322 [info ] [Thread-1 (]: 1 of 6 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 1.86s]
[0m14:56:55.292939 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e6247f50>]}
[0m14:56:55.295719 [info ] [Thread-2 (]: 2 of 6 OK created sql view model hospital_staging._hospital_patients ........... [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m14:56:55.300580 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m14:56:55.306734 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m14:56:55.303602 [info ] [Thread-3 (]: 3 of 6 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m14:56:55.310816 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m14:56:55.314427 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m14:56:55.317316 [info ] [Thread-1 (]: 5 of 6 START sql table model hospital_staging.medicines ........................ [RUN]
[0m14:56:55.320313 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m14:56:55.323897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m14:56:55.326554 [info ] [Thread-3 (]: 6 of 6 START sql table model hospital_staging.patients ......................... [RUN]
[0m14:56:55.330474 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m14:56:55.332523 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m14:56:55.342617 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m14:56:55.352767 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m14:56:55.357011 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m14:56:55.359736 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m14:56:55.367604 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:55.451331 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m14:56:55.465685 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m14:56:55.468915 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH valid_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id,
    -- Validasi tanggal lahir (tidak negatif dan dalam range yang wajar)
    CASE
      WHEN date_of_birth > 0 AND date_of_birth < 30000000 THEN PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING))
      ELSE NULL  -- Atau gunakan tanggal default seperti '1900-01-01'
    END AS valid_date_of_birth
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  valid_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia hanya untuk tanggal yang valid
  CASE
    WHEN valid_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Age group calculation
  CASE
    WHEN valid_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM valid_patients
    );
  
[0m14:56:55.470921 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:56:55.856045 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m14:56:55.859784 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m14:56:56.386698 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:46deb21a-5a1f-483b-957e-6a9d2dd522a5&page=queryresults
[0m14:56:56.412069 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e57520c0>]}
[0m14:56:56.414268 [info ] [Thread-4 (]: 4 of 6 OK created sql table model hospital_staging.doctors ..................... [[32mCREATE TABLE (3.0 rows, 191.0 Bytes processed)[0m in 2.94s]
[0m14:56:56.416432 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m14:56:56.500112 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:46deb21a-5a1f-483b-957e-6a9d2dd522a5&page=queryresults
[0m14:56:56.521857 [debug] [Thread-3 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:56:56.524047 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e4716750>]}
[0m14:56:56.526567 [error] [Thread-3 (]: 6 of 6 ERROR creating sql table model hospital_staging.patients ................ [[31mERROR[0m in 1.19s]
[0m14:56:56.530503 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m14:56:56.533132 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m14:56:56.573018 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b4089c83-b091-475f-a6b8-6aebaf09ddfd&page=queryresults
[0m14:56:58.040187 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8f39c1c-57d9-4dc7-8edc-91cfff699eb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e4710170>]}
[0m14:56:58.041993 [info ] [Thread-1 (]: 5 of 6 OK created sql table model hospital_staging.medicines ................... [[32mCREATE TABLE (4.0 rows, 186.0 Bytes processed)[0m in 2.72s]
[0m14:56:58.044840 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m14:56:58.054800 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:56:58.060556 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:56:58.061980 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m14:56:58.063085 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m14:56:58.065253 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m14:56:58.066226 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m14:56:58.067491 [info ] [MainThread]: 
[0m14:56:58.068694 [info ] [MainThread]: Finished running 3 table models, 3 view models in 0 hours 0 minutes and 6.12 seconds (6.12s).
[0m14:56:58.075342 [debug] [MainThread]: Command end result
[0m14:56:58.159096 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m14:56:58.164447 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m14:56:58.183612 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m14:56:58.185212 [info ] [MainThread]: 
[0m14:56:58.186867 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:56:58.188548 [info ] [MainThread]: 
[0m14:56:58.190595 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m14:56:58.192483 [info ] [MainThread]: 
[0m14:56:58.194327 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m14:56:58.197404 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 12.804626, "process_in_blocks": "0", "process_kernel_time": 1.934144, "process_mem_max_rss": "214916", "process_out_blocks": "3560", "process_user_time": 13.519332}
[0m14:56:58.198681 [debug] [MainThread]: Command `dbt run` failed at 14:56:58.198384 after 12.81 seconds
[0m14:56:58.200357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb80a4d8230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb80a4d9550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb7e57e3080>]}
[0m14:56:58.202247 [debug] [MainThread]: Flushing usage events
[0m14:56:59.793970 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:00:31.837730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a06473fcfb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0648da4680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a06470f8c20>]}


============================== 15:00:31.845116 | 5c18de7c-8e9c-4879-859f-297fd41b3fce ==============================
[0m15:00:31.845116 [info ] [MainThread]: Running with dbt=1.9.0
[0m15:00:31.847324 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:00:34.821746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a06479420c0>]}
[0m15:00:35.017939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0623344ce0>]}
[0m15:00:35.020008 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m15:00:35.704902 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m15:00:36.127028 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:00:36.132491 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/schema.yml
[0m15:00:37.772773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0622987320>]}
[0m15:00:38.048587 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m15:00:38.057528 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m15:00:38.107872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0622985c70>]}
[0m15:00:38.109781 [info ] [MainThread]: Found 13 models, 9 data tests, 6 sources, 487 macros
[0m15:00:38.111334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a06229a3ec0>]}
[0m15:00:38.117738 [info ] [MainThread]: 
[0m15:00:38.119444 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:00:38.120961 [info ] [MainThread]: 
[0m15:00:38.123870 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:00:38.139876 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m15:00:38.141654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:39.151132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m15:00:39.152949 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:39.155757 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m15:00:39.158986 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m15:00:39.247442 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:39.249676 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:39.800527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a06229a3ec0>]}
[0m15:00:39.802318 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:00:39.814394 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m15:00:39.818513 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m15:00:39.816860 [info ] [Thread-1 (]: 1 of 6 START sql view model hospital_staging._hospital_medicines ............... [RUN]
[0m15:00:39.821636 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m15:00:39.819948 [info ] [Thread-2 (]: 2 of 6 START sql view model hospital_staging._hospital_patients ................ [RUN]
[0m15:00:39.828916 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m15:00:39.825763 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m15:00:39.824819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m15:00:39.830487 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m15:00:39.827534 [info ] [Thread-3 (]: 3 of 6 START sql view model hospital_staging._hospital_visits .................. [RUN]
[0m15:00:39.833731 [info ] [Thread-4 (]: 4 of 6 START sql table model hospital_staging.doctors .......................... [RUN]
[0m15:00:39.836504 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m15:00:39.844986 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m15:00:39.862881 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m15:00:39.882572 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m15:00:39.884573 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m15:00:39.888055 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m15:00:39.889929 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m15:00:39.900995 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m15:00:39.904612 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m15:00:39.912694 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m15:00:39.920694 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m15:00:39.935466 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m15:00:40.103634 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m15:00:40.119757 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m15:00:40.136794 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m15:00:40.146365 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m15:00:40.177550 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:00:40.180578 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m15:00:40.182573 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m15:00:40.267439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:40.269455 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m15:00:40.272558 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:00:40.277370 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:00:40.906523 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m15:00:40.909900 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m15:00:41.016386 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5f452097-0a93-4d9e-a939-0000aab495c6&page=queryresults
[0m15:00:41.032844 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:edaca9c3-7fa7-470c-ad16-1e470d2d6f81&page=queryresults
[0m15:00:41.052915 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bb86d2cf-9cb5-4a4c-bd94-54b11cd7e459&page=queryresults
[0m15:00:41.172992 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f361ffbd-dcd2-45e5-aa9d-17b34c13cc02&page=queryresults
[0m15:00:41.544112 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a06478de840>]}
[0m15:00:41.545564 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0646e3fce0>]}
[0m15:00:41.547088 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0622166990>]}
[0m15:00:41.549663 [info ] [Thread-1 (]: 1 of 6 OK created sql view model hospital_staging._hospital_medicines .......... [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m15:00:41.552415 [info ] [Thread-3 (]: 3 of 6 OK created sql view model hospital_staging._hospital_visits ............. [[32mCREATE VIEW (0 processed)[0m in 1.70s]
[0m15:00:41.555634 [info ] [Thread-2 (]: 2 of 6 OK created sql view model hospital_staging._hospital_patients ........... [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m15:00:41.558483 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m15:00:41.560876 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m15:00:41.563717 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m15:00:41.567197 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m15:00:41.571388 [info ] [Thread-1 (]: 5 of 6 START sql table model hospital_staging.medicines ........................ [RUN]
[0m15:00:41.574499 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m15:00:41.576638 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m15:00:41.586671 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m15:00:41.588965 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m15:00:41.592186 [info ] [Thread-2 (]: 6 of 6 START sql table model hospital_staging.patients ......................... [RUN]
[0m15:00:41.596404 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m15:00:41.598126 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m15:00:41.608897 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m15:00:41.611090 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m15:00:41.623215 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:41.625739 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m15:00:41.633977 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m15:00:41.717615 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH valid_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id,
    -- Validasi tanggal lahir (tidak negatif dan dalam range yang wajar)
    CASE
      WHEN date_of_birth > 0 AND date_of_birth < 30000000 THEN PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING))
      ELSE NULL  -- Atau gunakan tanggal default seperti '1900-01-01'
    END AS valid_date_of_birth
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  valid_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia hanya untuk tanggal yang valid
  CASE
    WHEN valid_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Age group calculation
  CASE
    WHEN valid_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM valid_patients
    );
  
[0m15:00:41.719959 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:00:42.394235 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m15:00:42.397615 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m15:00:42.937586 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a062291bc50>]}
[0m15:00:42.939997 [info ] [Thread-4 (]: 4 of 6 OK created sql table model hospital_staging.doctors ..................... [[32mCREATE TABLE (3.0 rows, 191.0 Bytes processed)[0m in 3.08s]
[0m15:00:42.942994 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m15:00:43.064578 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ce9fd86e-7458-4dbb-a080-086ea1b9cc1d&page=queryresults
[0m15:00:43.194110 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1ddedaff-cc70-4066-a6e0-98df22b74a73&page=queryresults
[0m15:00:43.282056 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1ddedaff-cc70-4066-a6e0-98df22b74a73&page=queryresults
[0m15:00:43.298397 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m15:00:43.300680 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0646e3e4e0>]}
[0m15:00:43.304629 [error] [Thread-2 (]: 6 of 6 ERROR creating sql table model hospital_staging.patients ................ [[31mERROR[0m in 1.70s]
[0m15:00:43.307701 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m15:00:43.310653 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m15:00:44.709278 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c18de7c-8e9c-4879-859f-297fd41b3fce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0621922120>]}
[0m15:00:44.748878 [info ] [Thread-1 (]: 5 of 6 OK created sql table model hospital_staging.medicines ................... [[32mCREATE TABLE (4.0 rows, 186.0 Bytes processed)[0m in 3.13s]
[0m15:00:44.771943 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m15:00:44.879611 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:00:44.898421 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:44.911186 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m15:00:44.912277 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m15:00:44.922688 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m15:00:44.923931 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m15:00:44.936357 [info ] [MainThread]: 
[0m15:00:44.959808 [info ] [MainThread]: Finished running 3 table models, 3 view models in 0 hours 0 minutes and 6.80 seconds (6.80s).
[0m15:00:45.002989 [debug] [MainThread]: Command end result
[0m15:00:45.241798 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m15:00:45.287302 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m15:00:45.414876 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m15:00:45.428209 [info ] [MainThread]: 
[0m15:00:45.429599 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m15:00:45.455648 [info ] [MainThread]: 
[0m15:00:45.471852 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m15:00:45.488128 [info ] [MainThread]: 
[0m15:00:45.502218 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m15:00:45.531569 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.943165, "process_in_blocks": "0", "process_kernel_time": 1.840482, "process_mem_max_rss": "214520", "process_out_blocks": "3536", "process_user_time": 12.987261}
[0m15:00:45.548921 [debug] [MainThread]: Command `dbt run` failed at 15:00:45.548430 after 13.96 seconds
[0m15:00:45.565631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0646efa390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0622aac110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0622b7a1b0>]}
[0m15:00:45.577848 [debug] [MainThread]: Flushing usage events
[0m15:00:47.134426 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:50:02.005557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee678ac53d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee676b41e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee676c64b30>]}


============================== 01:50:02.017446 | 6fa77977-2895-42ed-bd3d-0bcac6d02a46 ==============================
[0m01:50:02.017446 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:50:02.018799 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m01:50:02.387443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6fa77977-2895-42ed-bd3d-0bcac6d02a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee676a82150>]}
[0m01:50:02.491636 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.75081795, "process_in_blocks": "1496", "process_kernel_time": 0.616708, "process_mem_max_rss": "87948", "process_out_blocks": "8", "process_user_time": 4.157038}
[0m01:50:02.493820 [debug] [MainThread]: Command `dbt clean` succeeded at 01:50:02.493602 after 0.75 seconds
[0m01:50:02.494787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee676d5da60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee676b43560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee676b41e80>]}
[0m01:50:02.496258 [debug] [MainThread]: Flushing usage events
[0m01:50:04.030167 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:50:12.849248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc7974a7320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc797ee3fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc797311880>]}


============================== 01:50:12.859479 | d90f410c-1417-40c9-9fc7-48e7ac0ad717 ==============================
[0m01:50:12.859479 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:50:12.860903 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:50:13.186680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd90f410c-1417-40c9-9fc7-48e7ac0ad717', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc798c577a0>]}
[0m01:50:13.250601 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m01:50:13.255569 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m01:50:13.259019 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.654984, "process_in_blocks": "200", "process_kernel_time": 0.608648, "process_mem_max_rss": "88068", "process_out_blocks": "8", "process_user_time": 4.164755}
[0m01:50:13.260072 [debug] [MainThread]: Command `dbt deps` succeeded at 01:50:13.259830 after 0.66 seconds
[0m01:50:13.260643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc79706d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc797c26000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc7972a12b0>]}
[0m01:50:13.261534 [debug] [MainThread]: Flushing usage events
[0m01:50:14.702219 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:50:22.789570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d814ebe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d81dfec30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d814eb140>]}


============================== 01:50:22.799060 | 85dd76c6-33fd-4f46-a518-946b58167888 ==============================
[0m01:50:22.799060 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:50:22.801065 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:50:25.522332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d616adbb0>]}
[0m01:50:25.703087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d617df110>]}
[0m01:50:25.705030 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:50:26.373208 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m01:50:26.375098 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:50:26.375782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d6173fe30>]}
[0m01:50:30.989121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d61546cc0>]}
[0m01:50:31.236570 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:50:31.246793 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:50:31.305759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d60946450>]}
[0m01:50:31.307541 [info ] [MainThread]: Found 13 models, 9 data tests, 6 sources, 487 macros
[0m01:50:31.308487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d615720f0>]}
[0m01:50:31.314818 [info ] [MainThread]: 
[0m01:50:31.315984 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:50:31.317425 [info ] [MainThread]: 
[0m01:50:31.319387 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:50:31.334327 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:50:31.336162 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:50:31.339187 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:50:31.341056 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:50:31.418324 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:50:31.350349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:50:32.497770 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m01:50:32.500242 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m01:50:32.502207 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m01:50:32.503614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:50:32.506170 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:50:32.507718 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:50:33.095495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d826cc2c0>]}
[0m01:50:33.097602 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:50:33.109433 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:50:33.113326 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:50:33.115173 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:50:33.111527 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:50:33.121791 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:50:33.126832 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:50:33.129058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m01:50:33.124647 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:50:33.131603 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m01:50:33.136313 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:50:33.133918 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:50:33.140956 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:50:33.142836 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:50:33.167346 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:50:33.171455 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:50:33.172776 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:50:33.180427 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:50:33.182342 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:50:33.197310 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:50:33.200793 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:50:33.213089 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:50:33.214851 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:50:33.260445 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:50:33.293394 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:50:33.382807 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:50:33.389081 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:50:33.390367 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:50:33.425183 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:50:33.427408 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m01:50:33.431371 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m01:50:33.433068 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m01:50:33.501849 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:50:33.505632 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:50:33.507017 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:50:34.105844 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:50:34.108305 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m01:50:34.466039 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a4fa3c03-3326-4c03-961f-ecd92d38be7e&page=queryresults
[0m01:50:34.474812 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a9cb7522-777a-4c1c-8630-12485f27ddd3&page=queryresults
[0m01:50:34.492236 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4a8ca056-25c2-455e-b3a2-5e152c4135d8&page=queryresults
[0m01:50:34.722133 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a3559a36-4072-4065-9717-6c58aa695e5f&page=queryresults
[0m01:50:35.122847 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d5bfb4530>]}
[0m01:50:35.127212 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d820ce990>]}
[0m01:50:35.137112 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d6055a8d0>]}
[0m01:50:35.125903 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.99s]
[0m01:50:35.134316 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.98s]
[0m01:50:35.142767 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:50:35.145716 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:50:35.141378 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.00s]
[0m01:50:35.150052 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m01:50:35.152718 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:50:35.154223 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:50:35.157602 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m01:50:35.158991 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m01:50:35.172701 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:50:35.174319 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m01:50:35.181473 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m01:50:35.183400 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:50:35.192853 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m01:50:35.190913 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:50:35.195715 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m01:50:35.209242 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:50:35.211256 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH valid_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id,
    -- Validasi tanggal lahir (tidak negatif dan dalam range yang wajar)
    CASE
      WHEN date_of_birth > 0 AND date_of_birth < 30000000 THEN PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING))
      ELSE NULL  -- Atau gunakan tanggal default seperti '1900-01-01'
    END AS valid_date_of_birth
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  valid_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia hanya untuk tanggal yang valid
  CASE
    WHEN valid_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Age group calculation
  CASE
    WHEN valid_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), valid_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM valid_patients
    );
  
[0m01:50:35.213811 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:50:35.291410 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m01:50:35.300594 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:50:35.713636 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:50:35.716240 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:50:36.286853 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d605c7920>]}
[0m01:50:36.290073 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.12s]
[0m01:50:36.292809 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:50:36.571305 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:502f03a1-0385-49f9-b7ad-60b96be75291&page=queryresults
[0m01:50:36.753636 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:785686b2-0a82-4ba5-8773-79d0d4860973&page=queryresults
[0m01:50:36.793646 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:502f03a1-0385-49f9-b7ad-60b96be75291&page=queryresults
[0m01:50:36.831666 [debug] [Thread-3 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:50:36.833139 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d600d0830>]}
[0m01:50:36.835145 [error] [Thread-3 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.68s]
[0m01:50:36.837675 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m01:50:36.839881 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m01:50:36.845394 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:50:36.847291 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m01:50:36.853154 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:50:36.856250 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:50:36.857197 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:50:36.858483 [info ] [Thread-3 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m01:50:36.861244 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m01:50:36.863690 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:50:36.865776 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:50:38.118336 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85dd76c6-33fd-4f46-a518-946b58167888', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d5bfc1e80>]}
[0m01:50:38.121650 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.92s]
[0m01:50:38.124924 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m01:50:38.128273 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:50:38.129161 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m01:50:38.131304 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:50:38.135470 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:50:38.137039 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m01:50:38.138785 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:50:38.140965 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m01:50:38.143328 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m01:50:38.152557 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:50:38.147542 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m01:50:38.154721 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:50:38.150555 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:50:38.163843 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:50:38.170834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:50:38.173252 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m01:50:38.174012 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m01:50:38.175158 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m01:50:38.176607 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m01:50:38.182245 [info ] [MainThread]: 
[0m01:50:38.184064 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 6.86 seconds (6.86s).
[0m01:50:38.191781 [debug] [MainThread]: Command end result
[0m01:50:38.275535 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:50:38.281349 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:50:38.301831 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m01:50:38.303397 [info ] [MainThread]: 
[0m01:50:38.304715 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:50:38.306802 [info ] [MainThread]: 
[0m01:50:38.308417 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for operator > for argument types: DATE, INT64
    Signature: T1 > T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, DATE} at [26:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:50:38.309773 [info ] [MainThread]: 
[0m01:50:38.311227 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m01:50:38.314940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.78593, "process_in_blocks": "6280", "process_kernel_time": 1.696436, "process_mem_max_rss": "216812", "process_out_blocks": "3544", "process_user_time": 13.550508}
[0m01:50:38.316832 [debug] [MainThread]: Command `dbt run` failed at 01:50:38.316305 after 15.79 seconds
[0m01:50:38.317627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d815ea030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d816ebaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772d611cfb60>]}
[0m01:50:38.318589 [debug] [MainThread]: Flushing usage events
[0m01:50:39.775560 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:54:22.505576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17e636e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17e9136b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17e637b30>]}


============================== 01:54:22.515461 | d839646c-f007-4e86-aa9a-b863e295d5da ==============================
[0m01:54:22.515461 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:54:22.517311 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:54:25.356758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17f8f3620>]}
[0m01:54:25.547161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15e862240>]}
[0m01:54:25.549452 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:54:26.237180 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m01:54:26.648917 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:54:26.651401 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m01:54:28.282783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15d7b5940>]}
[0m01:54:28.549854 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:54:28.560025 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:54:28.608617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15d974290>]}
[0m01:54:28.610199 [info ] [MainThread]: Found 13 models, 9 data tests, 6 sources, 487 macros
[0m01:54:28.611409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15e0374a0>]}
[0m01:54:28.619589 [info ] [MainThread]: 
[0m01:54:28.620916 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:54:28.622293 [info ] [MainThread]: 
[0m01:54:28.624513 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:54:28.640013 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:54:28.642575 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:54:28.643953 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:54:28.646437 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:54:28.649163 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:54:28.733074 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:54:29.862202 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m01:54:29.864774 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m01:54:29.867088 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:54:29.869484 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m01:54:29.870747 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:54:29.952818 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:54:30.495071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17f99c6e0>]}
[0m01:54:30.496963 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:54:30.511267 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:54:30.513238 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:54:30.518940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m01:54:30.523868 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:54:30.526234 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:54:30.540386 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:54:30.542987 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:54:30.577854 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m01:54:30.560214 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:54:30.569206 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:54:30.591444 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:54:30.582566 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:54:30.593843 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m01:54:30.596371 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:54:30.606264 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:54:30.608417 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:54:30.610697 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:54:30.623677 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:54:30.678743 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:54:30.691586 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:54:30.712445 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:54:30.732241 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:54:30.762418 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:54:30.776588 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:54:30.810716 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:54:30.851037 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:54:30.836562 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:54:30.856456 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:54:30.858979 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m01:54:30.863355 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m01:54:30.865524 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m01:54:30.871524 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:54:30.873807 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:54:30.875999 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:54:31.616640 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:54:31.619757 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m01:54:31.677574 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1d3ff813-efad-4529-b337-ac7c6c1981d1&page=queryresults
[0m01:54:31.703817 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cc559bc8-46bb-4e37-bde9-cc80b331509d&page=queryresults
[0m01:54:31.854182 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:967d960a-3c0f-4f49-9c66-ea410500e61d&page=queryresults
[0m01:54:31.958054 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4b7c7f73-cf26-4d45-aa69-5b64eb41ab3d&page=queryresults
[0m01:54:32.194700 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15dd384d0>]}
[0m01:54:32.197497 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.61s]
[0m01:54:32.204818 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17e7fe6c0>]}
[0m01:54:32.209710 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:54:32.212153 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15d339d00>]}
[0m01:54:32.214386 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.60s]
[0m01:54:32.218216 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.70s]
[0m01:54:32.221989 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:54:32.226109 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:54:32.227655 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:54:32.234244 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:54:32.237306 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m01:54:32.239264 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m01:54:32.244132 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:54:32.241943 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:54:32.256266 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:54:32.258799 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m01:54:32.261214 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m01:54:32.274277 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:54:32.273192 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:54:32.284292 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:54:32.288138 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id,
    -- Validasi tanggal lahir
    CASE
      WHEN date_of_birth IS NULL THEN NULL
      WHEN date_of_birth > CURRENT_DATE() THEN NULL  -- Tanggal di masa depan tidak valid
      ELSE date_of_birth
    END AS validated_date_of_birth
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia hanya untuk tanggal yang valid
  CASE
    WHEN validated_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN validated_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM patient_data
    );
  
[0m01:54:32.290152 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:54:32.371491 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m01:54:32.388454 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:54:32.811231 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:54:32.814285 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:54:33.388285 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15d77ab70>]}
[0m01:54:33.390195 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.78s]
[0m01:54:33.392643 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:54:33.489625 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5c67716c-8602-4492-ac34-880b2e25fd95&page=queryresults
[0m01:54:33.704484 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1b3bb203-87b7-44f3-a607-5cbbeb12c499&page=queryresults
[0m01:54:34.165497 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1b3bb203-87b7-44f3-a607-5cbbeb12c499&page=queryresults
[0m01:54:34.195531 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:54:34.197488 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15d339220>]}
[0m01:54:34.200455 [error] [Thread-2 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.96s]
[0m01:54:34.203427 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:54:34.207314 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m01:54:34.212641 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:54:34.214485 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m01:54:34.216708 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:54:34.220337 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:54:34.222239 [info ] [Thread-2 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m01:54:34.224630 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:54:34.226466 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:54:34.228532 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m01:54:34.231584 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:54:35.227580 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd839646c-f007-4e86-aa9a-b863e295d5da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15cb9da60>]}
[0m01:54:35.230163 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.97s]
[0m01:54:35.233081 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m01:54:35.238801 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:54:35.241748 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m01:54:35.244567 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:54:35.249461 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:54:35.251239 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m01:54:35.256501 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:54:35.259152 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m01:54:35.260969 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:54:35.262417 [info ] [Thread-4 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m01:54:35.267098 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:54:35.265073 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m01:54:35.269809 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:54:35.275485 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:54:35.285278 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:54:35.286737 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m01:54:35.287956 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m01:54:35.289316 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m01:54:35.290717 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m01:54:35.292420 [info ] [MainThread]: 
[0m01:54:35.294080 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 6.67 seconds (6.67s).
[0m01:54:35.300521 [debug] [MainThread]: Command end result
[0m01:54:35.387785 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:54:35.393610 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:54:35.414379 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m01:54:35.415624 [info ] [MainThread]: 
[0m01:54:35.417410 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:54:35.418658 [info ] [MainThread]: 
[0m01:54:35.419344 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:54:35.419968 [info ] [MainThread]: 
[0m01:54:35.421191 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m01:54:35.425157 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.200398, "process_in_blocks": "448", "process_kernel_time": 1.685527, "process_mem_max_rss": "214664", "process_out_blocks": "3536", "process_user_time": 12.031522}
[0m01:54:35.427169 [debug] [MainThread]: Command `dbt run` failed at 01:54:35.426723 after 13.20 seconds
[0m01:54:35.428653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c15cbbb650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17e0e2990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c17e0e08c0>]}
[0m01:54:35.430472 [debug] [MainThread]: Flushing usage events
[0m01:54:36.890655 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:54:51.422579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce989b3e510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce9890f3530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce9891af140>]}


============================== 01:54:51.433077 | 01aff6fa-7afe-44f2-bce7-2b4dbc749f37 ==============================
[0m01:54:51.433077 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:54:51.435175 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:54:51.810274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01aff6fa-7afe-44f2-bce7-2b4dbc749f37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce988876690>]}
[0m01:54:51.855426 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.72980857, "process_in_blocks": "0", "process_kernel_time": 0.705557, "process_mem_max_rss": "87928", "process_out_blocks": "0", "process_user_time": 4.591119}
[0m01:54:51.857623 [debug] [MainThread]: Command `dbt clean` succeeded at 01:54:51.857153 after 0.73 seconds
[0m01:54:51.858960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce988df6060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce9887dc2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce9888eb8c0>]}
[0m01:54:51.860526 [debug] [MainThread]: Flushing usage events
[0m01:54:53.486690 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:55:03.615586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f648a02a870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f64890c0500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f648858e6c0>]}


============================== 01:55:03.626169 | 084bda92-66f2-4d17-adaf-9e2a35a41e2d ==============================
[0m01:55:03.626169 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:55:03.628776 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:55:03.976636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '084bda92-66f2-4d17-adaf-9e2a35a41e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6489ed3920>]}
[0m01:55:04.021108 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m01:55:04.023782 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m01:55:04.027172 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.6926345, "process_in_blocks": "0", "process_kernel_time": 0.672717, "process_mem_max_rss": "87820", "process_out_blocks": "8", "process_user_time": 4.648228}
[0m01:55:04.028700 [debug] [MainThread]: Command `dbt deps` succeeded at 01:55:04.028295 after 0.69 seconds
[0m01:55:04.029897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6488209100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6488d8faa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f648858e6c0>]}
[0m01:55:04.031339 [debug] [MainThread]: Flushing usage events
[0m01:55:05.587458 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:55:15.401675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710635bdc170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710634ece630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710635936330>]}


============================== 01:55:15.412091 | 28f0bafe-493b-4cbf-be26-0903ce7cf718 ==============================
[0m01:55:15.412091 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:55:15.413737 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:55:18.289151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710634ae4380>]}
[0m01:55:18.486305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71063426aa20>]}
[0m01:55:18.488671 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:55:19.219835 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m01:55:19.222600 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:55:19.223772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7106148f30e0>]}
[0m01:55:24.088152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060f7bfc20>]}
[0m01:55:24.363347 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:55:24.370692 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:55:24.422347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060f7f4500>]}
[0m01:55:24.423593 [info ] [MainThread]: Found 13 models, 9 data tests, 6 sources, 487 macros
[0m01:55:24.424970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060fdc4b60>]}
[0m01:55:24.431950 [info ] [MainThread]: 
[0m01:55:24.434009 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:55:24.435128 [info ] [MainThread]: 
[0m01:55:24.436853 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:55:24.451835 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:55:24.454971 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:55:24.456662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:55:24.459328 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:55:24.461075 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:55:24.464672 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:55:25.729636 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m01:55:25.731412 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:55:25.733554 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m01:55:25.735721 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m01:55:25.817530 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:55:25.821448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:55:26.356349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060f35fdd0>]}
[0m01:55:26.357883 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:55:26.375132 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:55:26.377174 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:55:26.379413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m01:55:26.380641 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:55:26.382131 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:55:26.383517 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:55:26.391306 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:55:26.407192 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:55:26.418348 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:55:26.416009 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:55:26.420065 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:55:26.423420 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m01:55:26.426682 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:55:26.430134 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:55:26.432751 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:55:26.434649 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:55:26.440433 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:55:26.448575 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:55:26.475286 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:55:26.509428 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:55:26.527491 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:55:26.543704 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:55:26.570995 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:55:26.573281 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:55:26.641319 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:55:26.651183 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:55:26.676436 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:55:26.679372 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:55:26.769612 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m01:55:26.771697 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:55:26.773654 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m01:55:26.777759 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m01:55:26.854468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:55:26.860302 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:55:27.375961 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:55:27.378435 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m01:55:27.473683 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:df99f038-ecd8-49aa-be5c-ef0431eec8b0&page=queryresults
[0m01:55:27.513807 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:080eaf72-e5a6-465b-9c3b-dc111e647319&page=queryresults
[0m01:55:27.762474 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:fd1d2cce-0e18-4509-bf2a-30fb3e891f41&page=queryresults
[0m01:55:27.921190 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a2440f56-a02e-4823-acc6-8598049f7352&page=queryresults
[0m01:55:27.958284 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710634a82900>]}
[0m01:55:27.963408 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7106142c3d10>]}
[0m01:55:27.960981 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.53s]
[0m01:55:27.968419 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:55:27.965775 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.54s]
[0m01:55:27.972129 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:55:27.974234 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:55:27.976280 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:55:27.977832 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m01:55:27.979822 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:55:27.989397 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:55:27.991511 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:55:27.998559 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:55:28.001462 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id,
    -- Validasi tanggal lahir
    CASE
      WHEN date_of_birth IS NULL THEN NULL
      WHEN date_of_birth > CURRENT_DATE() THEN NULL  -- Tanggal di masa depan tidak valid
      ELSE date_of_birth
    END AS validated_date_of_birth
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia hanya untuk tanggal yang valid
  CASE
    WHEN validated_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN validated_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), validated_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM patient_data
    );
  
[0m01:55:28.003341 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:55:28.105294 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060f7bf290>]}
[0m01:55:28.109567 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m01:55:28.115619 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:55:28.118481 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m01:55:28.120686 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:55:28.123093 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m01:55:28.124588 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m01:55:28.132938 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:55:28.134806 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m01:55:28.141192 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:55:28.603534 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:55:28.606233 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:55:29.053350 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:30fd295c-0c70-461f-a81a-b9afbcae4512&page=queryresults
[0m01:55:29.245476 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:55ee711b-c094-4ad4-9efd-31bbbc19f49a&page=queryresults
[0m01:55:29.430208 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060df16030>]}
[0m01:55:29.432695 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.00s]
[0m01:55:29.435710 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:55:29.504598 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:30fd295c-0c70-461f-a81a-b9afbcae4512&page=queryresults
[0m01:55:29.534210 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:55:29.536270 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060e3d9a60>]}
[0m01:55:29.538567 [error] [Thread-2 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.56s]
[0m01:55:29.542195 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:55:29.544709 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m01:55:29.550012 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:55:29.551434 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m01:55:29.555230 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:55:29.557578 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:55:29.560647 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:55:29.559155 [info ] [Thread-2 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m01:55:29.562774 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m01:55:29.568362 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:55:29.570549 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:55:30.679554 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28f0bafe-493b-4cbf-be26-0903ce7cf718', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060f35ff20>]}
[0m01:55:30.681935 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.56s]
[0m01:55:30.684161 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m01:55:30.687403 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:55:30.688912 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m01:55:30.690628 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:55:30.698524 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:55:30.708695 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m01:55:30.702813 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:55:30.711135 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:55:30.700950 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m01:55:30.713526 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m01:55:30.719377 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:55:30.717496 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m01:55:30.722165 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:55:30.732498 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:55:30.742981 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:55:30.745021 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m01:55:30.746623 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m01:55:30.747517 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m01:55:30.749681 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m01:55:30.752653 [info ] [MainThread]: 
[0m01:55:30.755825 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 6.31 seconds (6.31s).
[0m01:55:30.768469 [debug] [MainThread]: Command end result
[0m01:55:30.859072 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:55:30.865242 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:55:30.883563 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m01:55:30.885141 [info ] [MainThread]: 
[0m01:55:30.886744 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:55:30.888314 [info ] [MainThread]: 
[0m01:55:30.889697 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:55:30.890658 [info ] [MainThread]: 
[0m01:55:30.892215 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m01:55:30.895720 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.774402, "process_in_blocks": "0", "process_kernel_time": 1.737168, "process_mem_max_rss": "216944", "process_out_blocks": "3520", "process_user_time": 15.066096}
[0m01:55:30.897781 [debug] [MainThread]: Command `dbt run` failed at 01:55:30.897430 after 15.78 seconds
[0m01:55:30.899216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710634a2acc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060f36f6e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71060ffad880>]}
[0m01:55:30.900679 [debug] [MainThread]: Flushing usage events
[0m01:55:32.301489 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:57:26.828759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e19a6d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e157e6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e1184bc0>]}


============================== 01:57:26.838219 | db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7 ==============================
[0m01:57:26.838219 [info ] [MainThread]: Running with dbt=1.9.0
[0m01:57:26.840448 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:57:29.740103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e0ed1730>]}
[0m01:57:29.939727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c15252e0>]}
[0m01:57:29.941793 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:57:30.696757 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m01:57:31.147713 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:57:31.150041 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m01:57:32.896185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e2c38110>]}
[0m01:57:33.184518 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:57:33.194654 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:57:33.255378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c0a0c290>]}
[0m01:57:33.257617 [info ] [MainThread]: Found 13 models, 9 data tests, 6 sources, 487 macros
[0m01:57:33.259651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c0b4fce0>]}
[0m01:57:33.268391 [info ] [MainThread]: 
[0m01:57:33.270134 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:57:33.271711 [info ] [MainThread]: 
[0m01:57:33.273624 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:57:33.290544 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:57:33.292316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:57:33.296757 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:57:33.298363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:57:33.311679 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m01:57:33.487476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:57:34.592722 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m01:57:34.595626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m01:57:34.598325 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:57:34.600218 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:57:34.611552 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m01:57:34.692667 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:57:35.297285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e228ffe0>]}
[0m01:57:35.299050 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:57:35.317654 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:57:35.320161 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:57:35.323262 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:57:35.325153 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m01:57:35.329203 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:57:35.327585 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:57:35.341286 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m01:57:35.335287 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:57:35.338312 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:57:35.343117 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:57:35.333092 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:57:35.367633 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m01:57:35.377731 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:57:35.393364 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:57:35.395301 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:57:35.397792 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:57:35.401596 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:57:35.404324 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:57:35.419978 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:57:35.434619 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:57:35.453590 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:57:35.491029 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:57:35.510146 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:57:35.542952 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:57:35.747882 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:57:35.769383 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:57:35.771781 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:57:35.863674 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:57:35.875414 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m01:57:35.877809 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m01:57:35.880995 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:57:35.882833 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m01:57:35.884725 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:57:35.887349 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:57:36.523153 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:57:36.527794 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m01:57:36.627507 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c1873ffe-6401-4964-9200-a17ca9cf7967&page=queryresults
[0m01:57:36.629918 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:dcd93a1b-57eb-4e8e-b42f-788aa1134453&page=queryresults
[0m01:57:36.841011 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:48cdcaca-d1b6-419b-8a3c-0244b772a3ed&page=queryresults
[0m01:57:37.081669 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4a64dc7b-26d8-4624-8189-8ba59c75fb39&page=queryresults
[0m01:57:37.226605 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c00bd760>]}
[0m01:57:37.229173 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c0fafd40>]}
[0m01:57:37.234833 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c004b3b0>]}
[0m01:57:37.237960 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.88s]
[0m01:57:37.241051 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.86s]
[0m01:57:37.244311 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.90s]
[0m01:57:37.249098 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:57:37.252160 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:57:37.255427 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:57:37.260680 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:57:37.261929 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m01:57:37.264085 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:57:37.266485 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:57:37.269943 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m01:57:37.273181 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m01:57:37.275309 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:57:37.276746 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m01:57:37.296671 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:57:37.303769 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:57:37.308428 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m01:57:37.316314 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:57:37.325071 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:57:37.334772 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:57:37.425072 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle semua kemungkinan format tanggal
    CASE
      WHEN SAFE_CAST(date_of_birth AS DATE) IS NOT NULL THEN SAFE_CAST(date_of_birth AS DATE)
      WHEN REGEXP_CONTAINS(CAST(date_of_birth AS STRING), r'^\d{4}-\d{2}-\d{2}$') THEN PARSE_DATE('%Y-%m-%d', CAST(date_of_birth AS STRING))
      WHEN REGEXP_CONTAINS(CAST(date_of_birth AS STRING), r'^\d{8}$') THEN PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING))
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m01:57:37.427148 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:57:37.889631 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:57:37.894500 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:57:38.584493 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c0b0eae0>]}
[0m01:57:38.587007 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.18s]
[0m01:57:38.593349 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:57:38.596701 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9e0dee05-170d-45dd-9161-648c22e4143e&page=queryresults
[0m01:57:38.769697 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9028e5a7-8efa-4cc6-9c50-2bc1154efa1e&page=queryresults
[0m01:57:38.985036 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9028e5a7-8efa-4cc6-9c50-2bc1154efa1e&page=queryresults
[0m01:57:39.011322 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:57:39.013343 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c009f500>]}
[0m01:57:39.015824 [error] [Thread-2 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.74s]
[0m01:57:39.018779 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:57:39.022481 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m01:57:39.027224 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:57:39.029302 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m01:57:39.031840 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:57:39.035377 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:57:39.039781 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:57:39.037998 [info ] [Thread-2 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m01:57:39.043853 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m01:57:39.048970 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:57:39.050717 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:57:40.070009 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db9bf5cc-c2bc-4fd6-b8df-2f081be7ecf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59bbf6b4a0>]}
[0m01:57:40.072339 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.80s]
[0m01:57:40.074746 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m01:57:40.077982 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:57:40.079447 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m01:57:40.081048 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:57:40.085447 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:57:40.088765 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m01:57:40.091061 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:57:40.092771 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m01:57:40.094586 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m01:57:40.097569 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m01:57:40.100158 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:57:40.101950 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:57:40.103677 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:57:40.114381 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:57:40.120431 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:57:40.122139 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m01:57:40.123605 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m01:57:40.124684 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m01:57:40.126089 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m01:57:40.127547 [info ] [MainThread]: 
[0m01:57:40.128960 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 6.85 seconds (6.85s).
[0m01:57:40.135626 [debug] [MainThread]: Command end result
[0m01:57:40.225099 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m01:57:40.231027 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m01:57:40.251235 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m01:57:40.252657 [info ] [MainThread]: 
[0m01:57:40.254194 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:57:40.255586 [info ] [MainThread]: 
[0m01:57:40.257303 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m01:57:40.258654 [info ] [MainThread]: 
[0m01:57:40.260216 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m01:57:40.264260 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.722951, "process_in_blocks": "0", "process_kernel_time": 1.703217, "process_mem_max_rss": "215140", "process_out_blocks": "3552", "process_user_time": 12.523712}
[0m01:57:40.266142 [debug] [MainThread]: Command `dbt run` failed at 01:57:40.265587 after 13.73 seconds
[0m01:57:40.267653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59c0a10260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e19a6c60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e59e19a4620>]}
[0m01:57:40.269078 [debug] [MainThread]: Flushing usage events
[0m01:57:41.760169 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:00:14.333252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507e6ece0c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507e708b140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507e6c5ede0>]}


============================== 02:00:14.342932 | 46c78cfe-516f-46ba-bdaf-40bc18e88f6c ==============================
[0m02:00:14.342932 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:00:14.344894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:00:17.270091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507e843f6b0>]}
[0m02:00:17.469017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507e6756ea0>]}
[0m02:00:17.471119 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:00:18.189688 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:00:18.620096 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:00:18.622339 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m02:00:20.278899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c22aab10>]}
[0m02:00:20.557144 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:00:20.566192 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:00:20.620131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c22a8b30>]}
[0m02:00:20.622299 [info ] [MainThread]: Found 13 models, 9 data tests, 6 sources, 487 macros
[0m02:00:20.624036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c25a8aa0>]}
[0m02:00:20.630499 [info ] [MainThread]: 
[0m02:00:20.632131 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:00:20.633208 [info ] [MainThread]: 
[0m02:00:20.635251 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:00:20.650768 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:00:20.653800 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:00:20.655543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:00:20.657966 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:00:20.659900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:00:20.759453 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:00:22.013991 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:00:22.016334 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:00:22.018531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:00:22.020159 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:00:22.022131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:00:22.023516 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:00:23.421168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c25abd70>]}
[0m02:00:23.423000 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:00:23.436551 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:00:23.440971 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:00:23.445056 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:00:23.438783 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:00:23.443304 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:00:23.453084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m02:00:23.456217 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:00:23.459250 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:00:23.448367 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:00:23.461316 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:00:23.463224 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:00:23.465531 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:00:23.467795 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m02:00:23.500690 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:00:23.476757 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:00:23.511290 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:00:23.516104 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:00:23.527036 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:00:23.540835 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:00:23.552757 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:00:23.568449 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:00:23.571267 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:00:23.598341 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:00:23.625753 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:00:23.718496 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:00:23.957384 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:00:23.964839 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:00:23.971349 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:00:23.974683 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:00:23.977678 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:00:23.980217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:00:23.982655 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:00:23.984308 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:00:24.069807 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:00:25.463974 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:00:25.466739 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:00:25.566968 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:52d86e34-3d80-490d-aeb7-ccf21802518e&page=queryresults
[0m02:00:26.060654 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:806b416a-8d98-48ee-8d40-9dc16ea99ad8&page=queryresults
[0m02:00:26.101069 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c2a1b8c0>]}
[0m02:00:26.103390 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.64s]
[0m02:00:26.106146 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:00:26.108662 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m02:00:26.110805 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:00:26.113012 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m02:00:26.114543 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m02:00:26.125183 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:00:26.130287 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m02:00:26.138253 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:00:26.140988 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle semua kemungkinan format tanggal
    CASE
      WHEN SAFE_CAST(date_of_birth AS DATE) IS NOT NULL THEN SAFE_CAST(date_of_birth AS DATE)
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:00:26.142579 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:00:26.848218 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:26a1d2d7-a03f-4fae-a270-a9aa13f11e82&page=queryresults
[0m02:00:27.095513 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8ab8d4f5-a5de-4bdb-aa5d-b9c87410eba7&page=queryresults
[0m02:00:27.265838 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c1fe6960>]}
[0m02:00:27.269253 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 3.80s]
[0m02:00:27.271803 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:00:27.566294 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c279cb30>]}
[0m02:00:27.569193 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 4.11s]
[0m02:00:27.571797 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:00:27.574766 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m02:00:27.576224 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:00:27.580503 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m02:00:27.582466 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m02:00:27.596373 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:00:27.599381 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m02:00:27.605843 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:00:27.698638 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:47f0c021-ed57-44a1-8355-cca8cf0b44ff&page=queryresults
[0m02:00:27.934203 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:47f0c021-ed57-44a1-8355-cca8cf0b44ff&page=queryresults
[0m02:00:27.951093 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:00:27.952726 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c13f4d40>]}
[0m02:00:27.955051 [error] [Thread-2 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.84s]
[0m02:00:27.957318 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m02:00:27.959691 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:00:27.987994 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c1f2dfd0>]}
[0m02:00:27.990747 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 4.51s]
[0m02:00:27.993223 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:00:27.998010 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:00:28.000590 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:00:28.003682 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:00:28.007166 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:00:28.009040 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:00:28.010979 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:00:28.016476 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:00:28.013438 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:00:28.019471 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:00:28.376410 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:00:28.379327 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:00:29.203964 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:99ee407e-6c43-460e-8422-f3e7038a1a38&page=queryresults
[0m02:00:31.564228 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46c78cfe-516f-46ba-bdaf-40bc18e88f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c13f6600>]}
[0m02:00:31.567116 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.98s]
[0m02:00:31.569648 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m02:00:31.575881 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:00:31.577620 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:00:31.579711 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:00:31.590586 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:00:31.599469 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m02:00:31.592349 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:00:31.604234 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:00:31.606829 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:00:31.609926 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:00:31.611827 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:00:31.614642 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:00:31.618513 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:00:31.632923 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:00:31.641374 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:00:31.642618 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m02:00:31.644014 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:00:31.645304 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:00:31.646437 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:00:31.647968 [info ] [MainThread]: 
[0m02:00:31.649376 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 11.01 seconds (11.01s).
[0m02:00:31.656123 [debug] [MainThread]: Command end result
[0m02:00:31.738723 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:00:31.745273 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:00:31.766232 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:00:31.767339 [info ] [MainThread]: 
[0m02:00:31.769267 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:00:31.770597 [info ] [MainThread]: 
[0m02:00:31.772215 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:00:31.773395 [info ] [MainThread]: 
[0m02:00:31.774953 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:00:31.778698 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 17.724043, "process_in_blocks": "0", "process_kernel_time": 1.69974, "process_mem_max_rss": "213852", "process_out_blocks": "3560", "process_user_time": 12.423867}
[0m02:00:31.780552 [debug] [MainThread]: Command `dbt run` failed at 02:00:31.780205 after 17.73 seconds
[0m02:00:31.782198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507c2597d40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507d01e7aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7507e6cc66f0>]}
[0m02:00:31.784150 [debug] [MainThread]: Flushing usage events
[0m02:00:33.359228 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:04:56.196454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77202a4de540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772029210f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772029210ef0>]}


============================== 02:04:56.207704 | 18b0aab8-3ab2-4567-ad5e-2dee03dd00b1 ==============================
[0m02:04:56.207704 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:04:56.209959 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging.date_problems', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:04:59.152225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18b0aab8-3ab2-4567-ad5e-2dee03dd00b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77202a393620>]}
[0m02:04:59.359420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18b0aab8-3ab2-4567-ad5e-2dee03dd00b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772028a3aff0>]}
[0m02:04:59.361504 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:05:00.081753 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:05:00.513621 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 2 files changed.
[0m02:05:00.515797 [debug] [MainThread]: Partial parsing: added file: hospital_analytics://models/staging/date_problems.sql
[0m02:05:00.521638 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/schema.yml
[0m02:05:00.522981 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m02:05:02.228840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18b0aab8-3ab2-4567-ad5e-2dee03dd00b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7720081f8080>]}
[0m02:05:02.516465 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:05:02.527247 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:05:02.581985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18b0aab8-3ab2-4567-ad5e-2dee03dd00b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7720083bc4a0>]}
[0m02:05:02.584035 [info ] [MainThread]: Found 14 models, 9 data tests, 6 sources, 487 macros
[0m02:05:02.585579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18b0aab8-3ab2-4567-ad5e-2dee03dd00b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772029a77da0>]}
[0m02:05:02.591334 [info ] [MainThread]: 
[0m02:05:02.592797 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:05:02.594515 [info ] [MainThread]: 
[0m02:05:02.596728 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:05:02.613849 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m02:05:02.617114 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:02.700395 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m02:05:02.704401 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:02.707932 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m02:05:02.710589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:03.261539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18b0aab8-3ab2-4567-ad5e-2dee03dd00b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77202a43c590>]}
[0m02:05:03.263596 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:05:03.275701 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m02:05:03.277905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics.date_problems)
[0m02:05:03.279436 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:05:03.303896 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:05:03.306346 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:05:03.313231 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m02:05:03.321627 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:05:03.328927 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:05:03.333304 [debug] [MainThread]: Connection 'list_de-zoomcamp-2025--id_hospital_intermediate' was properly closed.
[0m02:05:03.338122 [debug] [MainThread]: Connection 'model.hospital_analytics.date_problems' was properly closed.
[0m02:05:03.340010 [debug] [MainThread]: Connection 'list_de-zoomcamp-2025--id_hospital_analytics' was properly closed.
[0m02:05:03.341257 [info ] [MainThread]: 
[0m02:05:03.343057 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.75 seconds (0.75s).
[0m02:05:03.345388 [debug] [MainThread]: Command end result
[0m02:05:03.432368 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:05:03.438613 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:05:03.449517 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:05:03.453104 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.5495124, "process_in_blocks": "0", "process_kernel_time": 1.515764, "process_mem_max_rss": "206712", "process_out_blocks": "3400", "process_user_time": 10.840856}
[0m02:05:03.454935 [debug] [MainThread]: Command `dbt run` succeeded at 02:05:03.454474 after 7.55 seconds
[0m02:05:03.456202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772029976330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772028937a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x772008400ad0>]}
[0m02:05:03.458562 [debug] [MainThread]: Flushing usage events
[0m02:05:04.725088 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:05:22.142363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3c0691850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3c21ac7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3c0bd5a00>]}


============================== 02:05:22.152263 | 3400ac00-d978-434b-bcb4-f270e43cf2d2 ==============================
[0m02:05:22.152263 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:05:22.154654 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:05:25.139571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3c1f27650>]}
[0m02:05:25.336918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a07d6810>]}
[0m02:05:25.338745 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:05:26.056176 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:05:26.491808 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:05:26.493447 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:05:26.645197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a1890740>]}
[0m02:05:26.932471 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:05:26.941942 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:05:26.994639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a0049640>]}
[0m02:05:26.996443 [info ] [MainThread]: Found 14 models, 9 data tests, 6 sources, 487 macros
[0m02:05:26.998666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a010deb0>]}
[0m02:05:27.004805 [info ] [MainThread]: 
[0m02:05:27.006584 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:05:27.008445 [info ] [MainThread]: 
[0m02:05:27.010526 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:05:27.026738 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:05:27.028259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:27.112257 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:05:27.117521 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:05:27.119291 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:27.125254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:05:28.956157 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:05:28.959096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:05:28.961389 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:05:28.964091 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:05:29.044515 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:05:29.049452 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:05:29.930269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a0505790>]}
[0m02:05:29.931938 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:05:29.951037 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:05:29.953409 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:05:29.961460 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:05:29.958750 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:05:29.968739 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:05:29.972671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:05:29.982400 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:05:29.975417 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:05:29.998259 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:05:29.999610 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:05:29.977467 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:05:30.050101 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:05:30.068209 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:05:29.980370 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:05:30.062264 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:05:30.058485 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:05:30.095756 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:05:30.123253 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:05:30.120651 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:05:30.147755 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:05:30.165626 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:05:30.185259 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:05:30.226240 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:05:30.266548 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:05:30.288775 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:05:30.291342 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:05:30.317650 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:05:30.326359 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:05:30.346352 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:05:30.433323 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:05:30.439284 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:05:30.441369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:05:30.612032 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:05:30.614987 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:05:31.341515 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f13f1ed6-1050-4fcd-b6c6-9427fbcfc92e&page=queryresults
[0m02:05:31.393797 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1946775c-b540-4ab2-a291-7c1810f45c3c&page=queryresults
[0m02:05:31.411486 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bc866c80-5ea2-4b89-9e8d-6855577d212b&page=queryresults
[0m02:05:31.493058 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:05:31.497750 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:05:31.867560 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:24a2b641-cf57-4104-b0ae-853806c7479b&page=queryresults
[0m02:05:32.151618 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e39a9888c0>]}
[0m02:05:32.153546 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e39a9db8f0>]}
[0m02:05:32.155989 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.16s]
[0m02:05:32.157771 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3c0e25f10>]}
[0m02:05:32.163567 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.09s]
[0m02:05:32.167216 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:05:32.170569 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.14s]
[0m02:05:32.174361 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:05:32.177572 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:05:32.179787 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:05:32.182279 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:05:32.186135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:05:32.188392 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:05:32.190178 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m02:05:32.191647 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:05:32.200839 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m02:05:32.203176 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:05:32.210613 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:05:32.212492 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:05:32.215807 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m02:05:32.225425 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:05:32.227243 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:05:32.239024 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:05:32.241099 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:05:32.248706 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:05:32.251834 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:05:32.264443 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:05:32.348585 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m02:05:32.362909 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:05:32.367073 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle semua kemungkinan format tanggal
    CASE
      WHEN SAFE_CAST(date_of_birth AS DATE) IS NOT NULL THEN SAFE_CAST(date_of_birth AS DATE)
      WHEN REGEXP_CONTAINS(CAST(date_of_birth AS STRING), r'^\d{4}-\d{2}-\d{2}$') THEN PARSE_DATE('%Y-%m-%d', CAST(date_of_birth AS STRING))
      WHEN REGEXP_CONTAINS(CAST(date_of_birth AS STRING), r'^\d{8}$') THEN PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING))
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:05:32.369268 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:05:32.856474 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:05:32.859353 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:05:33.469481 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e399f17b00>]}
[0m02:05:33.471976 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.37s]
[0m02:05:33.474591 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:05:33.603510 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:245c5269-a70e-41ba-a5f3-f43d95193f72&page=queryresults
[0m02:05:33.786791 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b3c0b8b8-f54a-414c-970d-ddd743444214&page=queryresults
[0m02:05:34.335436 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b3c0b8b8-f54a-414c-970d-ddd743444214&page=queryresults
[0m02:05:34.357833 [debug] [Thread-3 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:05:34.360409 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3c0c63740>]}
[0m02:05:34.362812 [error] [Thread-3 (]: 6 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 2.14s]
[0m02:05:34.365518 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:05:34.367539 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:05:34.373211 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:05:34.374913 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:05:34.377302 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:05:34.381036 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:05:34.383043 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:05:34.385441 [info ] [Thread-3 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:05:34.389759 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:05:34.387647 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:05:34.394735 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:05:35.512378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3400ac00-d978-434b-bcb4-f270e43cf2d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e39bd8d040>]}
[0m02:05:35.514509 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.33s]
[0m02:05:35.517116 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:05:35.521904 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:05:35.524795 [info ] [Thread-4 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:05:35.527571 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:05:35.531269 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:05:35.533129 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:05:35.536836 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:05:35.534983 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:05:35.539471 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:05:35.542980 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:05:35.545477 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:05:35.547379 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:05:35.549336 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:05:35.560784 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:05:35.567651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:05:35.569349 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:05:35.570641 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:05:35.572033 [debug] [MainThread]: Connection 'model.hospital_analytics.date_problems' was properly closed.
[0m02:05:35.573264 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:05:35.575402 [info ] [MainThread]: 
[0m02:05:35.577376 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 8.56 seconds (8.56s).
[0m02:05:35.588341 [debug] [MainThread]: Command end result
[0m02:05:35.676842 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:05:35.683346 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:05:35.702206 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:05:35.703895 [info ] [MainThread]: 
[0m02:05:35.706124 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:05:35.708696 [info ] [MainThread]: 
[0m02:05:35.710824 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:05:35.712738 [info ] [MainThread]: 
[0m02:05:35.714380 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:05:35.718144 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.865059, "process_in_blocks": "0", "process_kernel_time": 1.729361, "process_mem_max_rss": "211184", "process_out_blocks": "2472", "process_user_time": 11.132701}
[0m02:05:35.720475 [debug] [MainThread]: Command `dbt run` failed at 02:05:35.720033 after 13.87 seconds
[0m02:05:35.722437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a039d550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e3a039caa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e399f40ec0>]}
[0m02:05:35.724095 [debug] [MainThread]: Flushing usage events
[0m02:05:37.288135 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:08:32.190826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e773ae3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e75b42660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e75639160>]}


============================== 02:08:32.201977 | ca4ed7b8-62a8-44eb-ad90-ac81f53fe996 ==============================
[0m02:08:32.201977 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:08:32.204590 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:08:35.240388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5586b6b0>]}
[0m02:08:35.440928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e56afd4c0>]}
[0m02:08:35.442933 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:08:36.145682 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:08:36.574787 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:08:36.577587 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m02:08:38.276777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5515e780>]}
[0m02:08:38.562806 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:08:38.571815 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:08:38.625760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e552d5a60>]}
[0m02:08:38.627946 [info ] [MainThread]: Found 14 models, 9 data tests, 6 sources, 487 macros
[0m02:08:38.629222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e55bdf950>]}
[0m02:08:38.639048 [info ] [MainThread]: 
[0m02:08:38.640621 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:08:38.642688 [info ] [MainThread]: 
[0m02:08:38.644683 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:08:38.661852 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:08:38.664281 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:08:38.667153 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:08:38.670318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:08:38.671637 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:08:38.675590 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:08:41.410835 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:08:41.412976 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:08:41.418721 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:08:41.501995 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:08:41.505378 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:08:41.610501 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:08:42.085188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e552d5550>]}
[0m02:08:42.087683 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:08:42.104722 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:08:42.106592 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:08:42.109655 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:08:42.113453 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:08:42.108462 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:08:42.111818 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:08:42.117611 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:08:42.125513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m02:08:42.123169 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:08:42.134896 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:08:42.137307 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:08:42.128927 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:08:42.130992 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m02:08:42.144973 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:08:42.163820 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:08:42.179043 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:08:42.180731 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:08:42.209808 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:08:42.211735 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:08:42.219768 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:08:42.232584 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:08:42.235745 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:08:42.260171 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:08:42.280237 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:08:42.414837 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:08:42.636041 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:08:42.654483 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:08:42.656543 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:08:42.658341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:08:42.661338 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:08:42.663190 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:08:42.757960 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:08:42.762898 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:08:42.868336 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:08:43.262417 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:08:43.266989 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:08:43.481170 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:05d7840a-35cf-418e-9c88-a9b7f949ee67&page=queryresults
[0m02:08:43.534262 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:90edc482-407e-446e-8804-3ddd75cb7ff0&page=queryresults
[0m02:08:43.605501 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:14249594-bce7-4b41-95fa-db9d375c3db4&page=queryresults
[0m02:08:43.726616 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d7d83693-0a24-49c2-8af1-754e7ef953c8&page=queryresults
[0m02:08:43.875125 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5586bda0>]}
[0m02:08:43.877435 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m02:08:43.880524 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:08:43.883395 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m02:08:43.885014 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m02:08:43.886598 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:08:43.895341 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:08:43.898510 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:08:43.904534 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m02:08:43.906304 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m02:08:43.908400 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:08:43.911374 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.patients)
[0m02:08:43.912904 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m02:08:43.922693 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:08:43.927389 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m02:08:43.947776 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:08:43.950799 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle parsing tanggal secara eksplisit
    CASE
      WHEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth)
      WHEN SAFE.PARSE_DATE('%F', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%F', date_of_birth)
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:08:43.955967 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:08:43.954191 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e54df4290>]}
[0m02:08:44.050443 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m02:08:44.053528 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:08:44.058563 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e55284920>]}
[0m02:08:44.061214 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m02:08:44.069488 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:08:44.067505 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:08:44.075448 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:08:44.078696 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:08:44.080470 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:08:44.090413 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:08:44.093226 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:08:44.105515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:08:44.546336 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:08:44.549182 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:08:45.092045 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:27205156-9b24-4f09-9380-4bb6effd2b8f&page=queryresults
[0m02:08:45.148750 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:360d391e-2114-4f00-9fb1-75421b81ae1f&page=queryresults
[0m02:08:45.182484 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:27205156-9b24-4f09-9380-4bb6effd2b8f&page=queryresults
[0m02:08:45.203149 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function PARSE_DATE
    Argument types: STRING, DATE
    Signature: PARSE_DATE(STRING, STRING)
      Argument 2: Unable to coerce type DATE to expected type STRING at [21:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:08:45.205242 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5511bb90>]}
[0m02:08:45.207292 [error] [Thread-2 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.29s]
[0m02:08:45.209332 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m02:08:45.212202 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function PARSE_DATE
    Argument types: STRING, DATE
    Signature: PARSE_DATE(STRING, STRING)
      Argument 2: Unable to coerce type DATE to expected type STRING at [21:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:08:45.399420 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5419d1c0>]}
[0m02:08:45.401732 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.26s]
[0m02:08:45.405676 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:08:45.408085 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:08:45.409465 [info ] [Thread-3 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:08:45.412486 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:08:45.416660 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:08:45.418383 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:08:45.421658 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:08:45.420120 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:08:45.428913 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:08:45.431186 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:08:47.099826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca4ed7b8-62a8-44eb-ad90-ac81f53fe996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e541348f0>]}
[0m02:08:47.102230 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.02s]
[0m02:08:47.105915 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:08:47.109508 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:08:47.111448 [info ] [Thread-4 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:08:47.115443 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:08:47.118770 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:08:47.120437 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:08:47.122626 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:08:47.124083 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m02:08:47.125489 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:08:47.127838 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:08:47.129536 [info ] [Thread-1 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:08:47.131467 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:08:47.133832 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:08:47.142734 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:08:47.148481 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:08:47.149846 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:08:47.151133 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:08:47.152164 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m02:08:47.153374 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:08:47.154883 [info ] [MainThread]: 
[0m02:08:47.156617 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 8.51 seconds (8.51s).
[0m02:08:47.163998 [debug] [MainThread]: Command end result
[0m02:08:47.246094 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:08:47.252137 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:08:47.270099 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:08:47.271330 [info ] [MainThread]: 
[0m02:08:47.273154 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:08:47.274677 [info ] [MainThread]: 
[0m02:08:47.276338 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function PARSE_DATE
    Argument types: STRING, DATE
    Signature: PARSE_DATE(STRING, STRING)
      Argument 2: Unable to coerce type DATE to expected type STRING at [21:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:08:47.277956 [info ] [MainThread]: 
[0m02:08:47.279523 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:08:47.284072 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.383265, "process_in_blocks": "0", "process_kernel_time": 1.721034, "process_mem_max_rss": "214128", "process_out_blocks": "3552", "process_user_time": 12.587172}
[0m02:08:47.286475 [debug] [MainThread]: Command `dbt run` failed at 02:08:47.286063 after 15.39 seconds
[0m02:08:47.288029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e760e0e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e55207cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e54182c90>]}
[0m02:08:47.290017 [debug] [MainThread]: Flushing usage events
[0m02:08:49.030045 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:13:47.867397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4f34264b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4f21cf1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4f21cf7a0>]}


============================== 02:13:47.878292 | ef89e50f-df12-4d92-b25c-5d235fbcc11b ==============================
[0m02:13:47.878292 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:13:47.880277 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging.date_parsing_issues', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:13:50.816800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ef89e50f-df12-4d92-b25c-5d235fbcc11b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4d1bcee10>]}
[0m02:13:51.015049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ef89e50f-df12-4d92-b25c-5d235fbcc11b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4d207dac0>]}
[0m02:13:51.017190 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:13:51.713772 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:13:52.045419 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m02:13:52.047030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ef89e50f-df12-4d92-b25c-5d235fbcc11b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4f1bd0170>]}
[0m02:13:56.947644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ef89e50f-df12-4d92-b25c-5d235fbcc11b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4d137b920>]}
[0m02:13:57.222715 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:13:57.231814 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:13:57.285267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ef89e50f-df12-4d92-b25c-5d235fbcc11b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4d148f350>]}
[0m02:13:57.287135 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:13:57.288604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef89e50f-df12-4d92-b25c-5d235fbcc11b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4d0b42b10>]}
[0m02:13:57.291061 [warn ] [MainThread]: The selection criterion 'staging.date_parsing_issues' does not match any enabled nodes
[0m02:13:57.295633 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m02:13:57.298042 [debug] [MainThread]: Command end result
[0m02:13:57.378267 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:13:57.384321 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:13:57.395317 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:13:57.399086 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.818389, "process_in_blocks": "0", "process_kernel_time": 1.546594, "process_mem_max_rss": "207436", "process_out_blocks": "3392", "process_user_time": 13.294132}
[0m02:13:57.400753 [debug] [MainThread]: Command `dbt run` succeeded at 02:13:57.400442 after 9.82 seconds
[0m02:13:57.401851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4f1b2a8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4f1e605f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77e4d0f945c0>]}
[0m02:13:57.403318 [debug] [MainThread]: Flushing usage events
[0m02:13:58.895049 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:14:22.840444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77e7fc71a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77e7fc5730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77e9260da0>]}


============================== 02:14:22.849073 | ea708830-5414-4886-ae54-cc8867a500e9 ==============================
[0m02:14:22.849073 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:14:22.850547 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging.patients', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:14:25.708706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ea708830-5414-4886-ae54-cc8867a500e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77c38c5910>]}
[0m02:14:25.900980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ea708830-5414-4886-ae54-cc8867a500e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77c366cfb0>]}
[0m02:14:25.902941 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:14:26.622615 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:14:27.035516 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:14:27.037089 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:14:27.185618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ea708830-5414-4886-ae54-cc8867a500e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77c35a9610>]}
[0m02:14:27.457598 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:14:27.466140 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:14:27.517768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ea708830-5414-4886-ae54-cc8867a500e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77c315e060>]}
[0m02:14:27.519692 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:14:27.521630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ea708830-5414-4886-ae54-cc8867a500e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77c335ae70>]}
[0m02:14:27.525230 [warn ] [MainThread]: The selection criterion 'staging.patients' does not match any enabled nodes
[0m02:14:27.530548 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m02:14:27.537911 [debug] [MainThread]: Command end result
[0m02:14:27.617025 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:14:27.622261 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:14:27.633588 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:14:27.637259 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.0472817, "process_in_blocks": "0", "process_kernel_time": 1.376687, "process_mem_max_rss": "202172", "process_out_blocks": "2296", "process_user_time": 8.57192}
[0m02:14:27.639296 [debug] [MainThread]: Command `dbt run` succeeded at 02:14:27.638838 after 5.05 seconds
[0m02:14:27.640951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77e787a180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77e76099d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d77c35bba70>]}
[0m02:14:27.642530 [debug] [MainThread]: Flushing usage events
[0m02:14:29.161895 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:14:56.738465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52719f8a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52711d29c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5271888f80>]}


============================== 02:14:56.748364 | 5dda9316-b013-4bba-8f89-ae0739a8fd45 ==============================
[0m02:14:56.748364 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:14:56.750484 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:14:59.667693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5252a21340>]}
[0m02:14:59.865036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5251478f20>]}
[0m02:14:59.867642 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:15:00.592948 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:15:01.014190 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:15:01.015569 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:15:01.165350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5250e4dd00>]}
[0m02:15:01.444918 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:15:01.453581 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:15:01.502984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52509db230>]}
[0m02:15:01.504709 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:15:01.506325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5250a0f170>]}
[0m02:15:01.514106 [info ] [MainThread]: 
[0m02:15:01.515951 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:15:01.517727 [info ] [MainThread]: 
[0m02:15:01.520240 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:15:01.536007 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:15:01.537938 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:15:01.540217 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:15:01.631433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:15:01.635805 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:15:01.637672 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:15:02.848032 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:15:02.850045 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:15:02.852748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:15:02.854810 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:15:02.859263 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:15:02.856507 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:15:03.483263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5250db0050>]}
[0m02:15:03.485920 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:15:03.501417 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:15:03.503502 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:15:03.505618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:15:03.506477 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:15:03.513171 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:15:03.519268 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:15:03.521660 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:15:03.525420 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:15:03.527628 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:15:03.547553 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:15:03.557007 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:15:03.560242 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:15:03.564521 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:15:03.567455 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:15:03.571419 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:15:03.574353 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:15:03.582791 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:15:03.585291 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:15:03.588926 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:15:03.599563 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:15:03.669255 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:15:03.680919 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:15:03.715816 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:15:03.755527 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:15:03.758572 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:15:03.760450 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:15:03.771591 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:15:03.775755 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:15:03.778717 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:15:03.820569 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:15:03.823653 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:15:03.825719 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:15:03.828153 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:15:03.919311 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:15:04.562465 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:15:04.565160 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:15:04.603914 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:433f128e-faa6-4b55-9d2f-aef78e950653&page=queryresults
[0m02:15:04.632657 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:61dc69ec-f193-4d07-a0e5-582f8add655e&page=queryresults
[0m02:15:04.660320 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:628a2ce3-afab-4132-b73f-89a34b52bc05&page=queryresults
[0m02:15:04.920303 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bfb18b0d-6d3a-40bf-9678-bcf8d99f8c3c&page=queryresults
[0m02:15:05.470630 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52505fa480>]}
[0m02:15:05.473182 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.90s]
[0m02:15:05.476299 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e525109fb00>]}
[0m02:15:05.478743 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52508de750>]}
[0m02:15:05.482610 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:15:05.484979 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m02:15:05.492321 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:15:05.488329 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m02:15:05.495958 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:15:05.501654 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:15:05.503897 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m02:15:05.505266 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:15:05.506276 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m02:15:05.507396 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:15:05.514973 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m02:15:05.520010 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:15:05.523153 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:15:05.521726 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:15:05.526140 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:15:05.536632 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:15:05.538909 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:15:05.549518 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:15:05.558067 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:15:05.555809 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:15:05.553747 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:15:05.560680 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:15:05.583777 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:15:05.579021 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m02:15:05.586248 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m02:15:05.590282 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:15:05.603478 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:15:05.605619 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:15:05.614560 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:15:05.618694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:15:05.629684 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:15:05.643973 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle parsing tanggal secara eksplisit
    CASE
      WHEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth)
      WHEN SAFE.PARSE_DATE('%F', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%F', date_of_birth)
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:15:05.646316 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:15:06.348264 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:15:06.355584 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:15:06.450570 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52506741d0>]}
[0m02:15:06.453960 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.88s]
[0m02:15:06.458307 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:15:06.901737 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a9e32f95-ef2e-44f2-a503-d0917020271f&page=queryresults
[0m02:15:06.994081 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c4f608fb-e692-4dde-b3cb-6b0796d61d9f&page=queryresults
[0m02:15:07.012513 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a9e32f95-ef2e-44f2-a503-d0917020271f&page=queryresults
[0m02:15:07.042399 [debug] [Thread-3 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function PARSE_DATE
    Argument types: STRING, DATE
    Signature: PARSE_DATE(STRING, STRING)
      Argument 2: Unable to coerce type DATE to expected type STRING at [21:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:15:07.044946 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5250aa8c20>]}
[0m02:15:07.050339 [error] [Thread-3 (]: 6 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.46s]
[0m02:15:07.055431 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:15:07.057966 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function PARSE_DATE
    Argument types: STRING, DATE
    Signature: PARSE_DATE(STRING, STRING)
      Argument 2: Unable to coerce type DATE to expected type STRING at [21:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:15:07.063241 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:15:07.065304 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:15:07.067191 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:15:07.070526 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:15:07.074556 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:15:07.072478 [info ] [Thread-3 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:15:07.082783 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:15:07.078801 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:15:07.086158 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:15:08.646204 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dda9316-b013-4bba-8f89-ae0739a8fd45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5250675160>]}
[0m02:15:08.648490 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.11s]
[0m02:15:08.653342 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:15:08.663919 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:15:08.665358 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:15:08.667291 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:15:08.671819 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:15:08.673612 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:15:08.675454 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:15:08.684734 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:15:08.681622 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:15:08.679554 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:15:08.686929 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:15:08.688822 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:15:08.691175 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:15:08.701360 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:15:08.710174 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:15:08.714490 [debug] [MainThread]: Connection 'model.hospital_analytics.date_problems' was properly closed.
[0m02:15:08.716680 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:15:08.718770 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:15:08.719763 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:15:08.723557 [info ] [MainThread]: 
[0m02:15:08.728218 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 7.20 seconds (7.20s).
[0m02:15:08.736733 [debug] [MainThread]: Command end result
[0m02:15:08.823306 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:15:08.829467 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:15:08.849618 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:15:08.851262 [info ] [MainThread]: 
[0m02:15:08.852761 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:15:08.854532 [info ] [MainThread]: 
[0m02:15:08.856414 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function PARSE_DATE
    Argument types: STRING, DATE
    Signature: PARSE_DATE(STRING, STRING)
      Argument 2: Unable to coerce type DATE to expected type STRING at [21:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:15:08.858235 [info ] [MainThread]: 
[0m02:15:08.859942 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:15:08.863746 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 12.399597, "process_in_blocks": "0", "process_kernel_time": 1.685887, "process_mem_max_rss": "210828", "process_out_blocks": "2496", "process_user_time": 11.09147}
[0m02:15:08.865736 [debug] [MainThread]: Command `dbt run` failed at 02:15:08.865322 after 12.40 seconds
[0m02:15:08.867344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e527188b560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5270e3d190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e52717f4290>]}
[0m02:15:08.868806 [debug] [MainThread]: Flushing usage events
[0m02:15:10.407634 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:19:43.902788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e26525be420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e26510ef7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2650a933b0>]}


============================== 02:19:43.914000 | c1a165d5-3602-4f7b-bc8e-5241ff00791c ==============================
[0m02:19:43.914000 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:19:43.915994 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:19:47.001784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e26307dcd70>]}
[0m02:19:47.197133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2650d374d0>]}
[0m02:19:47.199224 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:19:47.903083 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:19:48.363666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:19:48.366774 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m02:19:50.071752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e263056d4c0>]}
[0m02:19:50.355624 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:19:50.364689 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:19:50.418520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e26302f56a0>]}
[0m02:19:50.420068 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:19:50.421260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2630303e60>]}
[0m02:19:50.428686 [info ] [MainThread]: 
[0m02:19:50.430636 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:19:50.432120 [info ] [MainThread]: 
[0m02:19:50.433768 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:19:50.449186 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:19:50.452433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:19:50.454839 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:19:50.457137 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:19:50.549332 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:19:50.551826 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:19:51.707118 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:19:51.708676 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:19:51.711004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:19:51.713474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:19:51.795899 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:19:51.800343 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:19:52.321583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e26303d5c70>]}
[0m02:19:52.323451 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:19:52.336152 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:19:52.338207 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:19:52.340409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m02:19:52.341851 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:19:52.344821 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:19:52.355139 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:19:52.349197 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:19:52.351728 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:19:52.347354 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:19:52.356933 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:19:52.364379 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:19:52.381425 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:19:52.395755 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:19:52.398129 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:19:52.400036 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:19:52.402256 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:19:52.415728 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:19:52.424236 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:19:52.426593 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:19:52.433192 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:19:52.460812 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:19:52.478404 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:19:52.586448 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:19:52.599294 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:19:52.725536 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:19:52.730560 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:19:52.755366 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:19:52.736649 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:19:52.759611 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:19:52.845499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:19:52.848452 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:19:52.850553 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:19:52.852754 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:19:52.935148 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:19:53.483300 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:19:53.486202 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:19:53.512160 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d6264e7b-a80a-42b0-9726-e35d4290a39f&page=queryresults
[0m02:19:53.560249 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cb52f65f-8d29-4acd-9005-f6eed0c00e1a&page=queryresults
[0m02:19:53.580751 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2c4f46e9-449a-484e-8be7-957797bfa0fc&page=queryresults
[0m02:19:53.782419 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b5b34599-1d24-4802-8313-d328e5337a53&page=queryresults
[0m02:19:54.109262 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e262bf85be0>]}
[0m02:19:54.111798 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m02:19:54.116061 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2630a9bb00>]}
[0m02:19:54.119987 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:19:54.121095 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2630245160>]}
[0m02:19:54.124196 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.77s]
[0m02:19:54.128581 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.75s]
[0m02:19:54.132066 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:19:54.134734 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:19:54.138348 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:19:54.140781 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m02:19:54.142736 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m02:19:54.145391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m02:19:54.147168 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m02:19:54.150910 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:19:54.153096 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:19:54.149213 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:19:54.171512 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:19:54.177405 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:19:54.181377 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m02:19:54.185636 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m02:19:54.188633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:19:54.197596 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:19:54.208775 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:19:54.216958 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:19:54.220265 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:19:54.222366 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:19:54.225659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.medicines)
[0m02:19:54.239070 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m02:19:54.240459 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m02:19:54.244206 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:19:54.259631 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:19:54.264253 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:19:54.268169 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle parsing tanggal secara eksplisit
    -- Ganti bagian parsing dengan:
    SAFE.PARSE_DATE('%Y-%m-%d', TRIM(date_of_birth))
    CASE
      WHEN REGEXP_CONTAINS(date_of_birth, r'^\d{4}-\d{2}-\d{2}') 
      THEN SAFE.PARSE_DATE('%Y-%m-%d', REGEXP_EXTRACT(date_of_birth, r'^\d{4}-\d{2}-\d{2}'))
      -- WHEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth)
      -- WHEN SAFE.PARSE_DATE('%F', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%F', date_of_birth)
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:19:54.270320 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:19:54.272145 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:19:54.279235 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:19:54.813189 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:19:54.816002 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:19:54.825314 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:dd6abcfb-95d1-426d-a23e-aa5e5fdcca46&page=queryresults
[0m02:19:54.827508 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:dd6abcfb-95d1-426d-a23e-aa5e5fdcca46&page=queryresults
[0m02:19:54.853812 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Syntax error: Expected ")" but got keyword CASE at [22:5]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:19:54.856074 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e26304654f0>]}
[0m02:19:54.859042 [error] [Thread-2 (]: 5 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 0.67s]
[0m02:19:54.862969 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m02:19:54.865411 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Syntax error: Expected ")" but got keyword CASE at [22:5]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:19:55.498049 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9b585c6d-5d23-488c-9eaf-7182ee00d20b&page=queryresults
[0m02:19:55.549403 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e263030fe60>]}
[0m02:19:55.551421 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.15s]
[0m02:19:55.554018 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:19:55.559223 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:19:55.561274 [info ] [Thread-3 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:19:55.564393 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:19:55.568524 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:19:55.570687 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:19:55.573716 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:19:55.576021 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:19:55.578585 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:19:55.580285 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:19:56.996543 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1a165d5-3602-4f7b-bc8e-5241ff00791c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2630a9bb00>]}
[0m02:19:56.998793 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.77s]
[0m02:19:57.002077 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:19:57.005379 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:19:57.007265 [info ] [Thread-3 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:19:57.010153 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:19:57.013470 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:19:57.017142 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:19:57.015291 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:19:57.021054 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:19:57.019321 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:19:57.023999 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:19:57.025641 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:19:57.030236 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:19:57.034717 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:19:57.042401 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:19:57.049284 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:19:57.050611 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:19:57.052137 [debug] [MainThread]: Connection 'model.hospital_analytics.date_problems' was properly closed.
[0m02:19:57.053425 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:19:57.054967 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:19:57.056556 [info ] [MainThread]: 
[0m02:19:57.058088 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 6.62 seconds (6.62s).
[0m02:19:57.065381 [debug] [MainThread]: Command end result
[0m02:19:57.153262 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:19:57.159663 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:19:57.179132 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:19:57.180648 [info ] [MainThread]: 
[0m02:19:57.182074 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:19:57.183336 [info ] [MainThread]: 
[0m02:19:57.184610 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Syntax error: Expected ")" but got keyword CASE at [22:5]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:19:57.186078 [info ] [MainThread]: 
[0m02:19:57.187502 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:19:57.191197 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.586724, "process_in_blocks": "0", "process_kernel_time": 1.771679, "process_mem_max_rss": "214564", "process_out_blocks": "3592", "process_user_time": 12.411802}
[0m02:19:57.193301 [debug] [MainThread]: Command `dbt run` failed at 02:19:57.192643 after 13.59 seconds
[0m02:19:57.194922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2650fc8da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e262bfa4920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2651255df0>]}
[0m02:19:57.196531 [debug] [MainThread]: Flushing usage events
[0m02:19:58.616470 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:23:56.387767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737045f0ca40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737044252480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737047492480>]}


============================== 02:23:56.397477 | 832bb20a-fc19-4262-b7de-1460674fdee0 ==============================
[0m02:23:56.397477 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:23:56.399948 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m02:23:59.332661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370243ab590>]}
[0m02:23:59.532483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370444bdbe0>]}
[0m02:23:59.533803 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:24:00.237628 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:24:00.661275 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:24:00.663388 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m02:24:02.338167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701fd4f440>]}
[0m02:24:02.612332 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:24:02.622038 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:24:02.673240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701ff1d0a0>]}
[0m02:24:02.675181 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:24:02.676371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370248d3b90>]}
[0m02:24:02.684259 [info ] [MainThread]: 
[0m02:24:02.685953 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:24:02.687259 [info ] [MainThread]: 
[0m02:24:02.688500 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:24:02.705177 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:24:02.706830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:24:02.708803 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:24:02.711274 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:24:02.713345 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:24:02.884685 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:24:04.148749 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:24:04.150459 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:24:04.152628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:24:04.231599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:24:04.236693 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:24:04.238286 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:24:05.013197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370240cd610>]}
[0m02:24:05.014797 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:24:05.031452 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:24:05.033941 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:24:05.036014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:24:05.037380 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:24:05.039369 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:24:05.040315 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:24:05.042399 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:24:05.045432 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:24:05.047930 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:24:05.069701 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:24:05.077810 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:24:05.084166 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:24:05.086320 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:24:05.088446 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:24:05.090271 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:24:05.093198 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:24:05.095275 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:24:05.112796 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:24:05.116410 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:24:05.118399 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:24:05.137332 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:24:05.159383 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:24:05.161202 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:24:05.200075 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:24:05.395767 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:24:05.407441 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:24:05.426540 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:24:05.430718 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:24:05.432982 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:24:05.525806 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:24:05.528261 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:24:05.533625 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:24:05.542137 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:24:05.699555 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:24:06.159855 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:24:06.162827 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:24:06.314742 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:fbf2e876-84eb-4fe5-812e-338e169a2940&page=queryresults
[0m02:24:06.319729 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:aceb8651-6c1b-44d6-b4c2-d62361f428e4&page=queryresults
[0m02:24:06.330184 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8484697d-cdb0-4948-8608-0c32f1f3c255&page=queryresults
[0m02:24:06.440689 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:719499bc-2e4d-4acb-8912-be91d022cbf2&page=queryresults
[0m02:24:06.864791 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737044e42960>]}
[0m02:24:06.867740 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m02:24:06.871454 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:24:06.872746 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701f5bd760>]}
[0m02:24:06.881252 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701fe895e0>]}
[0m02:24:06.883607 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m02:24:06.887555 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:24:06.893341 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:24:06.895747 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:24:06.889728 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m02:24:06.900285 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:24:06.903417 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:24:06.905606 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:24:06.917334 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:24:06.920715 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:24:06.929183 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m02:24:06.930788 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:24:06.926015 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m02:24:06.934275 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m02:24:06.944169 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:24:06.950183 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:24:06.952106 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:24:07.048238 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:24:07.058096 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:24:07.059822 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:24:07.066493 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:24:07.068167 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:24:07.070183 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:24:07.072265 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m02:24:07.073587 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:24:07.075176 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:24:07.088124 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m02:24:07.094200 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:24:07.098765 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:24:07.109689 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:24:07.113769 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    -- Handle parsing tanggal secara eksplisit
    -- Ganti bagian parsing dengan:
    -- SAFE.PARSE_DATE('%Y-%m-%d', TRIM(date_of_birth))
    CASE
      WHEN REGEXP_CONTAINS(date_of_birth, r'^\d{4}-\d{2}-\d{2}') 
      THEN SAFE.PARSE_DATE('%Y-%m-%d', REGEXP_EXTRACT(date_of_birth, r'^\d{4}-\d{2}-\d{2}'))
      -- WHEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%Y-%m-%d', date_of_birth)
      -- WHEN SAFE.PARSE_DATE('%F', date_of_birth) IS NOT NULL THEN SAFE.PARSE_DATE('%F', date_of_birth)
      ELSE NULL
    END AS cleaned_date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  cleaned_date_of_birth AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN cleaned_date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN cleaned_date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), cleaned_date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:24:07.116265 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:24:07.492565 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:24:07.495478 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:24:08.081155 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:013227d1-2e60-45b0-96ae-1ee5efa8741c&page=queryresults
[0m02:24:08.204658 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7303ab72-fcda-4518-ac1e-7660d766d121&page=queryresults
[0m02:24:08.210467 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:013227d1-2e60-45b0-96ae-1ee5efa8741c&page=queryresults
[0m02:24:08.228581 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701fd80620>]}
[0m02:24:08.234755 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.14s]
[0m02:24:08.242634 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:24:08.260705 [debug] [Thread-3 (]: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function REGEXP_CONTAINS
    Argument types: DATE, STRING
    Signature: REGEXP_CONTAINS(STRING, STRING)
      Argument 1: Unable to coerce type DATE to expected type STRING
    Signature: REGEXP_CONTAINS(BYTES, BYTES)
      Argument 1: Unable to coerce type DATE to expected type BYTES at [23:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:24:08.263245 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73702444bfe0>]}
[0m02:24:08.266282 [error] [Thread-3 (]: 6 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.19s]
[0m02:24:08.269924 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:24:08.274179 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function REGEXP_CONTAINS
    Argument types: DATE, STRING
    Signature: REGEXP_CONTAINS(STRING, STRING)
      Argument 1: Unable to coerce type DATE to expected type STRING
    Signature: REGEXP_CONTAINS(BYTES, BYTES)
      Argument 1: Unable to coerce type DATE to expected type BYTES at [23:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:24:08.283153 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:24:08.284534 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:24:08.288404 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:24:08.295648 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:24:08.297385 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:24:08.299438 [info ] [Thread-3 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:24:08.301782 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:24:08.304234 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:24:08.306199 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:24:09.795572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832bb20a-fc19-4262-b7de-1460674fdee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701fecd280>]}
[0m02:24:09.798459 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.90s]
[0m02:24:09.800951 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:24:09.804796 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:24:09.808539 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:24:09.810659 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:24:09.814281 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:24:09.817148 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:24:09.819987 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:24:09.822116 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:24:09.823978 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:24:09.826214 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:24:09.828697 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:24:09.827140 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:24:09.832955 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:24:09.841124 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:24:09.846702 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:24:09.848242 [debug] [MainThread]: Connection 'model.hospital_analytics.date_problems' was properly closed.
[0m02:24:09.849464 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:24:09.850879 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:24:09.852251 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:24:09.854079 [info ] [MainThread]: 
[0m02:24:09.855729 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 7.17 seconds (7.17s).
[0m02:24:09.862770 [debug] [MainThread]: Command end result
[0m02:24:09.948784 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:24:09.954157 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:24:09.973677 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:24:09.975063 [info ] [MainThread]: 
[0m02:24:09.976890 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:24:09.979842 [info ] [MainThread]: 
[0m02:24:09.982590 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  No matching signature for function REGEXP_CONTAINS
    Argument types: DATE, STRING
    Signature: REGEXP_CONTAINS(STRING, STRING)
      Argument 1: Unable to coerce type DATE to expected type STRING
    Signature: REGEXP_CONTAINS(BYTES, BYTES)
      Argument 1: Unable to coerce type DATE to expected type BYTES at [23:12]
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:24:09.984368 [info ] [MainThread]: 
[0m02:24:09.986437 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:24:09.991261 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 13.91793, "process_in_blocks": "0", "process_kernel_time": 1.765083, "process_mem_max_rss": "214840", "process_out_blocks": "3592", "process_user_time": 12.510977}
[0m02:24:09.993111 [debug] [MainThread]: Command `dbt run` failed at 02:24:09.992692 after 13.92 seconds
[0m02:24:09.994511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370455dfa70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73701fecf530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370441a66c0>]}
[0m02:24:09.996131 [debug] [MainThread]: Flushing usage events
[0m02:24:11.542762 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:27:22.768048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7265088aeab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7265092852e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726509287c50>]}


============================== 02:27:22.777732 | 7d895ae9-6589-4d29-9f07-6ae485828e6e ==============================
[0m02:27:22.777732 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:27:22.779702 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:27:25.672944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264ebd3f590>]}
[0m02:27:25.870068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72650864da60>]}
[0m02:27:25.872221 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:27:26.573227 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:27:26.991211 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:27:26.993559 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/patients.sql
[0m02:27:28.682149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e818af60>]}
[0m02:27:28.957487 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:27:28.966241 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:27:29.019222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e8188c20>]}
[0m02:27:29.020763 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:27:29.022093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e8174c50>]}
[0m02:27:29.029327 [info ] [MainThread]: 
[0m02:27:29.030897 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:27:29.032114 [info ] [MainThread]: 
[0m02:27:29.035764 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:27:29.050500 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:27:29.053153 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:27:29.141006 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:27:29.147435 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:27:29.145693 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:27:29.232586 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:27:30.470507 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:27:30.472040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:27:30.473783 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:27:30.477386 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:27:30.556839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:27:30.560833 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:27:31.287282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e83e9010>]}
[0m02:27:31.289038 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:27:31.304596 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:27:31.307206 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:27:31.310150 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:27:31.311786 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:27:31.314540 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:27:31.317043 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:27:31.318820 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m02:27:31.321460 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:27:31.323511 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m02:27:31.325480 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:27:31.328771 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:27:31.334922 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m02:27:31.337917 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:27:31.339681 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:27:31.361572 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:27:31.373608 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:27:31.385629 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:27:31.387478 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:27:31.396986 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:27:31.400050 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:27:31.403898 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:27:31.414325 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:27:31.417272 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:27:31.578368 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:27:31.709128 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:27:31.739715 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:27:31.749733 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:27:31.761524 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:27:31.855442 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:27:31.857907 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  -- Konversi dari INT64 (YYYYMMDD) ke DATE
  PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)) AS date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:27:31.863586 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:27:31.865177 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:27:31.868259 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:27:31.870970 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:27:32.581715 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:27:32.584627 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:27:32.634087 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:56d52549-64f3-4bd6-ac6a-19675ce919af&page=queryresults
[0m02:27:32.641163 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f0749602-5d74-437a-8ca2-d7f49b33c44d&page=queryresults
[0m02:27:32.648237 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:10213cdb-8b39-4449-a3cf-e325488df88d&page=queryresults
[0m02:27:32.893418 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:710593ef-49d5-45af-91aa-40a601e905f3&page=queryresults
[0m02:27:33.253301 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e83041d0>]}
[0m02:27:33.256574 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.92s]
[0m02:27:33.267382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e3fbe1b0>]}
[0m02:27:33.269198 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e8177140>]}
[0m02:27:33.271512 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m02:27:33.275605 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:27:33.264500 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:27:33.282343 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:27:33.280228 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.91s]
[0m02:27:33.285588 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:27:33.288129 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:27:33.290427 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:27:33.292452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:27:33.294900 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:27:33.297116 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m02:27:33.298991 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:27:33.300674 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:27:33.303560 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m02:27:33.315144 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:27:33.329400 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:27:33.335353 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:27:33.344302 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:27:33.360358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:27:33.363361 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:27:33.365576 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:27:33.456581 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:27:33.457990 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:27:33.463712 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m02:27:33.471311 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:27:33.473398 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m02:27:33.474992 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m02:27:33.483940 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m02:27:33.488300 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:27:33.491503 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m02:27:33.499764 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:27:33.502607 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:27:33.504652 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:27:33.894265 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:27:33.899226 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:27:34.486701 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c801708f-f727-4b97-8e3d-8c3d7000430a&page=queryresults
[0m02:27:34.568981 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c8798b03-164a-43a9-910e-8f96cafcbd2f&page=queryresults
[0m02:27:34.695425 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e337fda0>]}
[0m02:27:34.700500 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.35s]
[0m02:27:34.709694 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:27:34.713842 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c801708f-f727-4b97-8e3d-8c3d7000430a&page=queryresults
[0m02:27:34.744177 [debug] [Thread-2 (]: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:27:34.746647 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e81bfd40>]}
[0m02:27:34.749104 [error] [Thread-2 (]: 6 of 13 ERROR creating sql table model hospital_staging.patients ............... [[31mERROR[0m in 1.27s]
[0m02:27:34.753838 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m02:27:34.758856 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patients' to be skipped because of status 'error'.  Reason: Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql.
[0m02:27:34.780164 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:27:34.782345 [info ] [Thread-3 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m02:27:34.786135 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:27:34.794379 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:27:34.796580 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:27:34.798934 [info ] [Thread-2 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:27:34.803346 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:27:34.802094 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m02:27:34.805977 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:27:36.326898 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d895ae9-6589-4d29-9f07-6ae485828e6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e3fbe300>]}
[0m02:27:36.332495 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.03s]
[0m02:27:36.339747 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:27:36.347155 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:27:36.348833 [info ] [Thread-3 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m02:27:36.351414 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:27:36.357643 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:27:36.361529 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:27:36.365531 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:27:36.363554 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:27:36.367585 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:27:36.374494 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:27:36.370631 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:27:36.373000 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:27:36.376502 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:27:36.387145 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:27:36.393446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:27:36.397513 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m02:27:36.400465 [debug] [MainThread]: Connection 'model.hospital_analytics.date_problems' was properly closed.
[0m02:27:36.402025 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:27:36.402824 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:27:36.404159 [info ] [MainThread]: 
[0m02:27:36.407362 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 7.37 seconds (7.37s).
[0m02:27:36.418179 [debug] [MainThread]: Command end result
[0m02:27:36.512447 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:27:36.518610 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:27:36.538195 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:27:36.540726 [info ] [MainThread]: 
[0m02:27:36.543050 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:27:36.544643 [info ] [MainThread]: 
[0m02:27:36.546515 [error] [MainThread]:   Database Error in model patients (models/staging/refined/patients.sql)
  Failed to parse input string "1972-12-22"
  compiled code at target/run/hospital_analytics/models/staging/refined/patients.sql
[0m02:27:36.547566 [info ] [MainThread]: 
[0m02:27:36.549079 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m02:27:36.553144 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 14.072776, "process_in_blocks": "0", "process_kernel_time": 1.745317, "process_mem_max_rss": "215248", "process_out_blocks": "3584", "process_user_time": 12.457168}
[0m02:27:36.554416 [debug] [MainThread]: Command `dbt run` failed at 02:27:36.554145 after 14.07 seconds
[0m02:27:36.555148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7265088aeab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e870faa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264e870dc40>]}
[0m02:27:36.556365 [debug] [MainThread]: Flushing usage events
[0m02:27:38.087776 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:33:08.246799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c76d228a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c78387da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c76eaaf30>]}


============================== 02:33:08.258096 | acac6402-10f6-452b-89a8-cba30b00fe87 ==============================
[0m02:33:08.258096 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:33:08.260181 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m02:33:08.631283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acac6402-10f6-452b-89a8-cba30b00fe87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c76a7a240>]}
[0m02:33:08.676328 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.73476124, "process_in_blocks": "0", "process_kernel_time": 0.701219, "process_mem_max_rss": "87424", "process_out_blocks": "8", "process_user_time": 4.85866}
[0m02:33:08.678261 [debug] [MainThread]: Command `dbt clean` succeeded at 02:33:08.677589 after 0.74 seconds
[0m02:33:08.679732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c77167b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c76fa8a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c4c78760320>]}
[0m02:33:08.681420 [debug] [MainThread]: Flushing usage events
[0m02:33:10.194076 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:34:13.244172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74424fc3a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74424f995160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74425001b3b0>]}


============================== 02:34:13.255421 | 5e81a32f-de16-47dd-a9d1-a06908ddcf16 ==============================
[0m02:34:13.255421 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:34:13.257393 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m02:34:16.297511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744251457650>]}
[0m02:34:16.484705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422befeb10>]}
[0m02:34:16.487047 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:34:17.205768 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:34:17.208835 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m02:34:17.210503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422b878ef0>]}
[0m02:34:22.056192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422b7b14c0>]}
[0m02:34:22.339402 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:34:22.348331 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:34:22.396004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422abb2180>]}
[0m02:34:22.397406 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:34:22.398909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422ab9d490>]}
[0m02:34:22.406837 [info ] [MainThread]: 
[0m02:34:22.408693 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:34:22.410011 [info ] [MainThread]: 
[0m02:34:22.412139 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:34:22.427116 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:34:22.429623 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:34:22.431720 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:34:22.437199 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:34:22.527225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:34:22.528554 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:34:24.057612 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:34:24.060080 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:34:24.061646 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:34:24.063649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:34:24.065225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:34:24.143807 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:34:24.694347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422b8782f0>]}
[0m02:34:24.696072 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:34:24.709427 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:34:24.712988 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:34:24.717233 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:34:24.711838 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:34:24.719192 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:34:24.721125 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:34:24.724703 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:34:24.722941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m02:34:24.728258 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:34:24.731334 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:34:24.736281 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:34:24.734318 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:34:24.750554 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:34:24.780647 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:34:24.784853 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:34:24.788507 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:34:24.790391 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:34:24.792478 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:34:24.795935 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:34:24.799346 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:34:24.809605 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:34:24.824271 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:34:24.881945 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:34:24.955445 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:34:25.100344 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:34:25.151250 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:34:25.236780 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:34:25.150129 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:34:25.251536 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:34:25.254788 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:34:25.257291 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:34:25.259299 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:34:25.261748 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:34:25.341335 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:34:25.867372 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:34:25.870228 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:34:25.996843 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2dc45127-ad84-44ea-9176-38bc35f13142&page=queryresults
[0m02:34:26.010844 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:73f84908-19df-4865-8cf4-59441a854af2&page=queryresults
[0m02:34:26.030243 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:60067d20-4d05-4e78-b965-cdca8e68e9a1&page=queryresults
[0m02:34:26.160238 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f720693d-47ea-4bd0-bef2-4dd3c68feef5&page=queryresults
[0m02:34:26.523429 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422b9e7e00>]}
[0m02:34:26.526047 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422ab4ea50>]}
[0m02:34:26.529211 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m02:34:26.532041 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m02:34:26.536142 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422abd17f0>]}
[0m02:34:26.539143 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:34:26.542180 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:34:26.544374 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m02:34:26.550398 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:34:26.553269 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:34:26.554568 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m02:34:26.556189 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:34:26.557724 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:34:26.560141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m02:34:26.562912 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:34:26.567109 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:34:26.568568 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:34:26.582439 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m02:34:26.587952 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:34:26.597425 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:34:26.599341 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:34:26.602441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:34:26.610006 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:34:26.615696 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:34:26.625294 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m02:34:26.637109 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:34:26.639274 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:34:26.641450 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:34:26.650141 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:34:26.654574 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:34:26.659035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.medicines)
[0m02:34:26.661259 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:34:26.663168 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:34:26.665638 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:34:26.679132 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:34:26.685414 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:34:26.771401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:34:27.241472 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:34:27.246061 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:34:27.674919 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7442297ce150>]}
[0m02:34:27.677346 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.89s]
[0m02:34:27.680331 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:34:27.813008 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:94c6afa6-e56f-416a-8dc5-9bd098278372&page=queryresults
[0m02:34:27.882745 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7b0fbe5e-4776-477a-924a-d22d993aa945&page=queryresults
[0m02:34:29.324430 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422a7e22a0>]}
[0m02:34:29.326586 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.74s]
[0m02:34:29.330316 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:34:29.333294 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:34:29.335332 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:34:29.337943 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m02:34:29.339618 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:34:29.357178 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:34:29.360412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7442297a9f40>]}
[0m02:34:29.363841 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.70s]
[0m02:34:29.369328 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:34:29.372809 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:34:29.383184 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:34:29.385256 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:34:29.389300 [info ] [Thread-3 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:34:29.393612 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m02:34:29.396273 [debug] [Thread-2 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.patient_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:34:29.397996 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:34:29.399909 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:34:29.494074 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:34:29.498353 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:34:29.506628 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:34:29.508701 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.patient_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:34:29.510581 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:34:30.111688 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c29aaf8e-4f8d-4d81-ba7f-364957c32574&page=queryresults
[0m02:34:30.130205 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ba951a01-e1fc-448d-927b-7b8d96dd1274&page=queryresults
[0m02:34:30.204380 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ba951a01-e1fc-448d-927b-7b8d96dd1274&page=queryresults
[0m02:34:30.215637 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c29aaf8e-4f8d-4d81-ba7f-364957c32574&page=queryresults
[0m02:34:30.248729 [debug] [Thread-2 (]: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name patient_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m02:34:30.251008 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744229307e00>]}
[0m02:34:30.242916 [debug] [Thread-3 (]: Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name patient_name not found inside p at [20:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql
[0m02:34:30.255004 [error] [Thread-2 (]: 7 of 13 ERROR creating sql table model hospital_intermediate.visits_enhanced ... [[31mERROR[0m in 0.91s]
[0m02:34:30.257545 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e81a32f-de16-47dd-a9d1-a06908ddcf16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74422afbca70>]}
[0m02:34:30.260374 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:34:30.262585 [error] [Thread-3 (]: 8 of 13 ERROR creating sql table model hospital_intermediate.prescriptions_enhanced  [[31mERROR[0m in 0.87s]
[0m02:34:30.265152 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.visits_enhanced' to be skipped because of status 'error'.  Reason: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name patient_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql.
[0m02:34:30.268352 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:34:30.274976 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.prescriptions_enhanced' to be skipped because of status 'error'.  Reason: Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name patient_name not found inside p at [20:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql.
[0m02:34:30.277993 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:34:30.279496 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:34:30.283475 [info ] [Thread-1 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:34:30.285511 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:34:30.289519 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:34:30.287273 [info ] [Thread-4 (]: 10 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m02:34:30.292085 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:34:30.295127 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:34:30.297159 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:34:30.300276 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m02:34:30.308753 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:34:30.303096 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:34:30.311367 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:34:30.313690 [info ] [Thread-1 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:34:30.317071 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:34:30.325199 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:34:30.330779 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:34:30.332196 [debug] [MainThread]: Connection 'model.hospital_analytics.prescriptions_enhanced' was properly closed.
[0m02:34:30.333429 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:34:30.334731 [debug] [MainThread]: Connection 'model.hospital_analytics.visits_enhanced' was properly closed.
[0m02:34:30.336388 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:34:30.338141 [info ] [MainThread]: 
[0m02:34:30.339987 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 7.93 seconds (7.93s).
[0m02:34:30.350944 [debug] [MainThread]: Command end result
[0m02:34:30.436688 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:34:30.442341 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:34:30.460182 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:34:30.461573 [info ] [MainThread]: 
[0m02:34:30.464424 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m02:34:30.466451 [info ] [MainThread]: 
[0m02:34:30.469030 [error] [MainThread]:   Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name patient_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m02:34:30.471035 [info ] [MainThread]: 
[0m02:34:30.472839 [error] [MainThread]:   Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name patient_name not found inside p at [20:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql
[0m02:34:30.474691 [info ] [MainThread]: 
[0m02:34:30.476004 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=2 SKIP=5 TOTAL=13
[0m02:34:30.480167 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 17.544598, "process_in_blocks": "472", "process_kernel_time": 1.740358, "process_mem_max_rss": "216632", "process_out_blocks": "3632", "process_user_time": 15.607378}
[0m02:34:30.482068 [debug] [MainThread]: Command `dbt run` failed at 02:34:30.481638 after 17.55 seconds
[0m02:34:30.483474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74424f6ba8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74424f6b9ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74424f6b9340>]}
[0m02:34:30.484994 [debug] [MainThread]: Flushing usage events
[0m02:34:31.933355 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:36:37.343537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d66b1ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d696eab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d64d0aa0>]}


============================== 02:36:37.355149 | b836a56c-5f3c-4170-b7f3-e8ed8e2dd997 ==============================
[0m02:36:37.355149 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:36:37.357116 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m02:36:40.326429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b23ad370>]}
[0m02:36:40.530219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d6adf9e0>]}
[0m02:36:40.532541 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:36:41.259070 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:36:41.687106 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:36:41.689819 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/intermediate/visits_enhanced.sql
[0m02:36:43.399347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1939310>]}
[0m02:36:43.688286 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:36:43.694465 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:36:43.744804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1debbc0>]}
[0m02:36:43.746367 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:36:43.747474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1ee0950>]}
[0m02:36:43.754776 [info ] [MainThread]: 
[0m02:36:43.756794 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:36:43.758591 [info ] [MainThread]: 
[0m02:36:43.761636 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:36:43.777643 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:36:43.780203 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:36:43.785691 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:36:43.793637 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:36:43.795624 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:36:43.797540 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:36:45.399763 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:36:45.401707 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:36:45.404009 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:36:45.411616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:36:45.508652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:36:45.514075 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:36:46.093104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546d7f847d0>]}
[0m02:36:46.095065 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:36:46.119284 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:36:46.120552 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:36:46.121724 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:36:46.123385 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:36:46.133384 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:36:46.129037 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:36:46.140572 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:36:46.125314 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:36:46.135657 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:36:46.131389 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m02:36:46.144146 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:36:46.145661 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:36:46.162320 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:36:46.154021 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:36:46.157972 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:36:46.147525 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:36:46.204973 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:36:46.216120 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:36:46.244080 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:36:46.246000 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:36:46.250063 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:36:46.253021 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:36:46.255272 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:36:46.266230 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:36:46.611146 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:36:46.636482 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:36:46.644638 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:36:46.665728 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:36:46.758686 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:36:46.761778 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:36:46.763786 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:36:46.766138 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:36:46.772552 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:36:46.861508 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:36:47.420253 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:36:47.423245 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:36:47.490145 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9813696c-05b5-4539-8ebb-fc05dd6974f4&page=queryresults
[0m02:36:47.602401 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:50a9dbd8-805d-4315-9b41-921d66ed7e01&page=queryresults
[0m02:36:47.614325 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:331b2b8b-34c7-4ebf-a115-33fdad056269&page=queryresults
[0m02:36:47.703644 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:446b0b97-7640-47c1-89a5-02ebc7b04cb3&page=queryresults
[0m02:36:48.083700 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1164f80>]}
[0m02:36:48.089194 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b11663c0>]}
[0m02:36:48.086823 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m02:36:48.095597 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m02:36:48.098834 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:36:48.100506 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b249bdd0>]}
[0m02:36:48.103543 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:36:48.116426 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m02:36:48.112845 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.94s]
[0m02:36:48.123845 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:36:48.119078 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:36:48.128669 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m02:36:48.130429 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m02:36:48.143181 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:36:48.146350 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:36:48.150202 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m02:36:48.151756 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m02:36:48.153589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m02:36:48.155401 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m02:36:48.162721 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:36:48.164521 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:36:48.166447 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:36:48.286788 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:36:48.292655 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:36:48.298820 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:36:48.310078 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:36:48.322561 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m02:36:48.324612 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m02:36:48.328334 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:36:48.330225 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:36:48.335709 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.patients)
[0m02:36:48.337025 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m02:36:48.349608 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:36:48.352250 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m02:36:48.359620 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:36:49.111573 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:36:49.115961 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:36:49.430703 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:36:49.435453 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:36:49.467750 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b23ac740>]}
[0m02:36:49.475511 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.32s]
[0m02:36:49.479829 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:36:49.750260 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:75ca0992-7e2e-4d91-8015-ef73ce3fb361&page=queryresults
[0m02:36:50.069772 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ba874736-98a9-46a5-815f-109a0f304ae2&page=queryresults
[0m02:36:51.255567 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b09220c0>]}
[0m02:36:51.257958 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.92s]
[0m02:36:51.261140 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m02:36:51.263639 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:36:51.265584 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:36:51.267512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m02:36:51.269320 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:36:51.282468 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:36:51.284794 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:36:51.293659 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:36:51.296458 [debug] [Thread-1 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.fullt_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:36:51.298106 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:36:51.609102 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1d0c680>]}
[0m02:36:51.612994 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.48s]
[0m02:36:51.617113 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m02:36:51.621976 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:36:51.623967 [info ] [Thread-2 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:36:51.626895 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m02:36:51.630002 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:36:51.649443 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:36:51.653985 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:36:51.667621 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:36:51.671123 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.patient_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:36:51.673826 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:36:52.082748 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d9d5d2c8-3bc6-42c5-b888-c0085221fba2&page=queryresults
[0m02:36:52.172805 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d9d5d2c8-3bc6-42c5-b888-c0085221fba2&page=queryresults
[0m02:36:52.197312 [debug] [Thread-1 (]: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name fullt_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m02:36:52.200671 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b0922000>]}
[0m02:36:52.204235 [error] [Thread-1 (]: 7 of 13 ERROR creating sql table model hospital_intermediate.visits_enhanced ... [[31mERROR[0m in 0.93s]
[0m02:36:52.209093 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:36:52.212116 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.visits_enhanced' to be skipped because of status 'error'.  Reason: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name fullt_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql.
[0m02:36:52.222103 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:36:52.225797 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:36:52.230284 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:36:52.237735 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:36:52.234730 [info ] [Thread-4 (]: 10 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m02:36:52.243309 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:36:52.307609 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:65993623-2d26-44fa-a58e-72ce252932c2&page=queryresults
[0m02:36:52.430618 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:65993623-2d26-44fa-a58e-72ce252932c2&page=queryresults
[0m02:36:52.446229 [debug] [Thread-2 (]: Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name patient_name not found inside p at [20:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql
[0m02:36:52.449755 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b836a56c-5f3c-4170-b7f3-e8ed8e2dd997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b0962c00>]}
[0m02:36:52.452332 [error] [Thread-2 (]: 8 of 13 ERROR creating sql table model hospital_intermediate.prescriptions_enhanced  [[31mERROR[0m in 0.82s]
[0m02:36:52.455540 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:36:52.459460 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.prescriptions_enhanced' to be skipped because of status 'error'.  Reason: Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name patient_name not found inside p at [20:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql.
[0m02:36:52.463502 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:36:52.469425 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m02:36:52.474356 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:36:52.466584 [info ] [Thread-1 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:36:52.472701 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:36:52.481342 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:36:52.483358 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:36:52.477188 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:36:52.486666 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:36:52.496158 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:36:52.502188 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:36:52.503530 [debug] [MainThread]: Connection 'model.hospital_analytics.visits_enhanced' was properly closed.
[0m02:36:52.504635 [debug] [MainThread]: Connection 'model.hospital_analytics.prescriptions_enhanced' was properly closed.
[0m02:36:52.505995 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:36:52.507151 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:36:52.509163 [info ] [MainThread]: 
[0m02:36:52.510440 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 8.75 seconds (8.75s).
[0m02:36:52.519155 [debug] [MainThread]: Command end result
[0m02:36:52.608993 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:36:52.615379 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:36:52.636511 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:36:52.638163 [info ] [MainThread]: 
[0m02:36:52.639197 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m02:36:52.640695 [info ] [MainThread]: 
[0m02:36:52.642360 [error] [MainThread]:   Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name fullt_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m02:36:52.643940 [info ] [MainThread]: 
[0m02:36:52.645445 [error] [MainThread]:   Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name patient_name not found inside p at [20:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql
[0m02:36:52.647267 [info ] [MainThread]: 
[0m02:36:52.648854 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=2 SKIP=5 TOTAL=13
[0m02:36:52.653213 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.605983, "process_in_blocks": "0", "process_kernel_time": 1.786871, "process_mem_max_rss": "214716", "process_out_blocks": "3640", "process_user_time": 13.106036}
[0m02:36:52.655317 [debug] [MainThread]: Command `dbt run` failed at 02:36:52.654837 after 15.61 seconds
[0m02:36:52.656808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1e96780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1e95460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546b1152060>]}
[0m02:36:52.658290 [debug] [MainThread]: Flushing usage events
[0m02:36:54.290217 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:37:10.121197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7149c71940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e714a3f00e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7149afbb30>]}


============================== 02:37:10.130444 | 2376aa96-7011-4e5d-912b-037127cc1cf2 ==============================
[0m02:37:10.130444 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:37:10.132766 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:37:13.158388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e714b50b6b0>]}
[0m02:37:13.369057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e714a2d4f20>]}
[0m02:37:13.371554 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:37:14.096953 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:37:14.528032 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:37:14.530333 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/intermediate/prescriptions_enhanced.sql
[0m02:37:15.505161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71293a24b0>]}
[0m02:37:15.783683 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:37:15.793924 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:37:16.058592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71293eb9b0>]}
[0m02:37:16.060393 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:37:16.061853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71294a63c0>]}
[0m02:37:16.070415 [info ] [MainThread]: 
[0m02:37:16.072536 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:37:16.073839 [info ] [MainThread]: 
[0m02:37:16.076536 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:37:16.093168 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:37:16.094954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:16.097945 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:37:16.099995 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:16.107308 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:37:16.109333 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:17.340732 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:37:17.342330 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:37:17.344800 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:37:17.347746 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:37:17.430145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:37:17.434262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:37:18.246660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e712956fd10>]}
[0m02:37:18.249106 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:37:18.262642 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:37:18.266179 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:37:18.267589 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:37:18.264728 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:37:18.278093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:37:18.272729 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:37:18.275327 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:37:18.279659 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:37:18.269806 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:37:18.282050 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:37:18.284813 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:37:18.318449 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:37:18.330493 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:37:18.332989 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:37:18.341302 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:37:18.343108 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:37:18.346581 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:37:18.358435 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:37:18.379417 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:37:18.385205 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:37:18.390249 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:37:18.419490 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:37:18.441756 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:37:18.491328 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:37:18.570094 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:37:18.746722 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:37:18.774263 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:37:18.780014 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:37:18.787243 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:37:18.788938 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:37:18.792473 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:18.794077 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:37:18.795809 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:37:18.800549 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:37:19.438005 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:37:19.444585 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:37:19.514892 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d99852a4-7a97-46a3-93b5-79a509adb5ac&page=queryresults
[0m02:37:19.546802 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:48f99fdd-89cb-4acd-87fe-5fa5b1a81f34&page=queryresults
[0m02:37:19.560533 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bfe6954d-c32a-4604-984d-90af55ad061b&page=queryresults
[0m02:37:19.719926 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9eefbf1e-bf83-496b-8c3e-19c8282ad947&page=queryresults
[0m02:37:20.033818 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7129358f80>]}
[0m02:37:20.036134 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7129996de0>]}
[0m02:37:20.038682 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m02:37:20.040826 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7129ad0350>]}
[0m02:37:20.046195 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:37:20.043376 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.76s]
[0m02:37:20.050906 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m02:37:20.054822 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:37:20.058761 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:37:20.062408 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m02:37:20.066388 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:37:20.068762 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m02:37:20.074750 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m02:37:20.072536 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m02:37:20.070614 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:37:20.089396 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:37:20.091828 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m02:37:20.093675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m02:37:20.096726 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:37:20.098803 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:37:20.101909 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m02:37:20.119314 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:37:20.129162 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:37:20.138552 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:37:20.143025 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:20.151101 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m02:37:20.162340 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:37:20.164562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:37:20.166980 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:37:20.263774 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:37:20.265599 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.patients)
[0m02:37:20.267722 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:37:20.278347 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:37:20.281032 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:37:20.287411 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:20.686442 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:37:20.689631 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:37:20.744656 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:37:20.748000 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:37:21.320611 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:946e91e7-f7dd-4d84-9efb-ba17aa5f1954&page=queryresults
[0m02:37:21.339733 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0c3a6a83-f588-4ff2-b480-00fe287d03fa&page=queryresults
[0m02:37:21.716150 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7128f4b980>]}
[0m02:37:21.718774 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.39s]
[0m02:37:21.722551 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:37:22.753211 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71283abaa0>]}
[0m02:37:22.765449 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.49s]
[0m02:37:22.770857 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:37:22.777677 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:37:22.787015 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71283abe00>]}
[0m02:37:22.780586 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:37:22.793417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m02:37:22.799318 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:37:22.795816 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.72s]
[0m02:37:22.811407 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m02:37:22.821283 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:37:22.823405 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:37:22.831522 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:37:22.830052 [info ] [Thread-3 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:37:22.842789 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:37:22.844719 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m02:37:22.848178 [debug] [Thread-1 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.fullt_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:37:22.850010 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:37:22.851963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:37:22.953109 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:37:22.959589 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:37:22.974767 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:37:22.978749 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:37:22.982499 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:23.530327 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:639225a5-954d-407d-8ecb-1b0849462d0b&page=queryresults
[0m02:37:23.552815 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:262c1da2-d470-4444-85bf-1bbc12bded3c&page=queryresults
[0m02:37:23.653797 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:262c1da2-d470-4444-85bf-1bbc12bded3c&page=queryresults
[0m02:37:23.693234 [debug] [Thread-1 (]: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name fullt_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m02:37:23.694608 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71287c4f20>]}
[0m02:37:23.696353 [error] [Thread-1 (]: 7 of 13 ERROR creating sql table model hospital_intermediate.visits_enhanced ... [[31mERROR[0m in 0.90s]
[0m02:37:23.699219 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:37:23.701424 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.visits_enhanced' to be skipped because of status 'error'.  Reason: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name fullt_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql.
[0m02:37:23.713389 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:37:23.723776 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:37:23.725478 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m02:37:23.730233 [info ] [Thread-4 (]: 10 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m02:37:23.733906 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:37:23.735740 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:37:25.345817 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2376aa96-7011-4e5d-912b-037127cc1cf2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e712838fe60>]}
[0m02:37:25.348344 [info ] [Thread-3 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.50s]
[0m02:37:25.350913 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:37:25.356001 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:37:25.357648 [info ] [Thread-1 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m02:37:25.361411 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m02:37:25.363474 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:37:25.365776 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:37:25.369492 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:37:25.372185 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:37:25.374460 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:37:25.378153 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:37:25.389474 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:37:25.402433 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:37:25.408170 [debug] [MainThread]: Connection 'model.hospital_analytics.visits_enhanced' was properly closed.
[0m02:37:25.409401 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m02:37:25.412171 [debug] [MainThread]: Connection 'model.hospital_analytics.prescriptions_enhanced' was properly closed.
[0m02:37:25.413470 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m02:37:25.415395 [info ] [MainThread]: 
[0m02:37:25.420070 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 9.34 seconds (9.34s).
[0m02:37:25.442171 [debug] [MainThread]: Command end result
[0m02:37:25.541984 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:37:25.547794 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:37:25.569275 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:37:25.570590 [info ] [MainThread]: 
[0m02:37:25.572118 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:37:25.573697 [info ] [MainThread]: 
[0m02:37:25.575451 [error] [MainThread]:   Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name fullt_name not found inside p at [21:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m02:37:25.577343 [info ] [MainThread]: 
[0m02:37:25.578669 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=5 TOTAL=13
[0m02:37:25.582981 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.763818, "process_in_blocks": "0", "process_kernel_time": 1.822623, "process_mem_max_rss": "213184", "process_out_blocks": "3632", "process_user_time": 12.642706}
[0m02:37:25.585210 [debug] [MainThread]: Command `dbt run` failed at 02:37:25.584623 after 15.77 seconds
[0m02:37:25.586726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7149d32d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e7129f5f530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e71497453d0>]}
[0m02:37:25.588270 [debug] [MainThread]: Flushing usage events
[0m02:37:27.067560 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:37:42.267636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78684f291e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78684f5bef30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78684f06af30>]}


============================== 02:37:42.279605 | 6f331dfd-f021-4ea9-91be-804f73383ca8 ==============================
[0m02:37:42.279605 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:37:42.282189 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:37:45.244006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682ab423c0>]}
[0m02:37:45.447786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868502e8800>]}
[0m02:37:45.450302 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:37:46.172429 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:37:46.602648 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:37:46.605152 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/intermediate/visits_enhanced.sql
[0m02:37:48.275098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a68db50>]}
[0m02:37:48.546808 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:37:48.557309 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:37:48.611330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a68fe30>]}
[0m02:37:48.613275 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:37:48.614843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a678dd0>]}
[0m02:37:48.622761 [info ] [MainThread]: 
[0m02:37:48.624282 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:37:48.625785 [info ] [MainThread]: 
[0m02:37:48.628060 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:37:48.643751 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:37:48.645400 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:48.647627 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:37:48.650310 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:48.663365 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:37:48.667223 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:37:50.032792 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:37:50.034806 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:37:50.036783 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:37:50.038546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:37:50.120174 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:37:50.122462 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:37:50.658700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a865940>]}
[0m02:37:50.660676 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:37:50.674883 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:37:50.676620 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:37:50.680226 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:37:50.678635 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:37:50.685677 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:37:50.682519 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:37:50.697051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m02:37:50.693587 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:37:50.703487 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m02:37:50.701329 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:37:50.706428 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:37:50.708297 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m02:37:50.710397 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:37:50.712604 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:37:50.732281 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:37:50.759164 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:37:50.764808 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:37:50.766916 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:37:50.783150 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:37:50.788278 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:37:50.795989 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:37:50.801749 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:37:50.841297 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:37:50.857602 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:37:51.003267 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:37:51.267149 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:37:51.270455 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:37:51.274846 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:37:51.277503 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:37:51.279810 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:37:51.292193 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:37:51.362742 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:37:51.365694 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:51.369295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:37:51.834075 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:37:51.837198 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:37:51.989625 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9caf2c37-d607-4775-8b91-a79c9b074843&page=queryresults
[0m02:37:52.028108 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b41ff09c-b00a-47fc-9bc3-4a86839103d4&page=queryresults
[0m02:37:52.053484 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c8eb3ea7-6f24-48bb-b670-b326a9abfeef&page=queryresults
[0m02:37:52.072346 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d196f386-0104-4965-89e7-31d30eb9cae4&page=queryresults
[0m02:37:52.497062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786829b43e60>]}
[0m02:37:52.499930 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a742c00>]}
[0m02:37:52.502577 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m02:37:52.504419 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a9fa930>]}
[0m02:37:52.511191 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:37:52.507516 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m02:37:52.514307 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m02:37:52.522998 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:37:52.519515 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:37:52.524777 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:37:52.528718 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:37:52.531787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:37:52.535901 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:37:52.546999 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:37:52.549240 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:37:52.552293 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m02:37:52.554005 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:37:52.570458 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:37:52.576180 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m02:37:52.581541 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:37:52.591110 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:37:52.592939 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m02:37:52.596368 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:52.598081 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:37:52.698764 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:37:52.700278 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:37:52.702437 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:37:52.704753 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:37:52.706643 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:37:52.708608 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m02:37:52.715431 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m02:37:52.717387 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:37:52.728225 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:37:52.730767 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:37:52.738690 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:53.101531 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:37:53.104532 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:37:53.177282 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:37:53.182337 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:37:53.505431 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a743e90>]}
[0m02:37:53.506671 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.79s]
[0m02:37:53.508469 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:37:53.730539 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8ffc6d46-6b50-4bdd-968a-96f0689483db&page=queryresults
[0m02:37:53.833229 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:11f19859-0341-458d-8971-83a94ea71172&page=queryresults
[0m02:37:55.309620 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a9fa750>]}
[0m02:37:55.313504 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.78s]
[0m02:37:55.316213 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:37:55.566151 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786829356ae0>]}
[0m02:37:55.568545 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.86s]
[0m02:37:55.572765 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:37:55.576314 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:37:55.579392 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:37:55.582633 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:37:55.586399 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:37:55.590011 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m02:37:55.591753 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m02:37:55.593609 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:37:55.595283 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:37:55.616200 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:37:55.625241 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:37:55.628602 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:37:55.636991 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:37:55.719292 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:37:55.731298 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:37:55.733935 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:37:55.735614 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:37:56.224413 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:37:56.227261 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:37:56.350997 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:33318d54-ffdd-493e-8cda-6d1131314889&page=queryresults
[0m02:37:56.609586 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bde5dde8-6bd2-45af-bcee-d967f2e9caea&page=queryresults
[0m02:37:58.079753 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786829356a80>]}
[0m02:37:58.083946 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.49s]
[0m02:37:58.088621 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:37:58.122046 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682ace0d70>]}
[0m02:37:58.125636 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.53s]
[0m02:37:58.128454 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:37:58.132227 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:37:58.133515 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:37:58.139818 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:37:58.142842 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:37:58.146037 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:37:58.150015 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m02:37:58.155607 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:37:58.148433 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:37:58.152282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m02:37:58.165334 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m02:37:58.184441 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:37:58.186207 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:37:58.188516 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:37:58.190923 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:37:58.212779 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:37:58.232849 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:37:58.238636 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:37:58.235242 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:37:58.241968 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.patient_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:37:58.256914 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:37:58.254960 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:37:58.250818 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:37:58.365652 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:37:58.370326 [debug] [Thread-1 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:37:58.373386 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:37:58.375317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:37:58.378482 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:37:59.069578 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6d3cf63a-1ae6-48d9-a3d0-0332158472f1&page=queryresults
[0m02:37:59.100978 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:99877673-8052-4bbf-9325-d586de3a496e&page=queryresults
[0m02:37:59.120012 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9c1e75fa-6be4-4508-acc6-e9e4a5f081db&page=queryresults
[0m02:37:59.190356 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:99877673-8052-4bbf-9325-d586de3a496e&page=queryresults
[0m02:37:59.213318 [debug] [Thread-3 (]: Database Error in model billing_enhanced (models/intermediate/billing_enhanced.sql)
  Name patient_name not found inside p at [26:5]
  compiled code at target/run/hospital_analytics/models/intermediate/billing_enhanced.sql
[0m02:37:59.215298 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786829b8fe90>]}
[0m02:37:59.217643 [error] [Thread-3 (]: 9 of 13 ERROR creating sql table model hospital_intermediate.billing_enhanced .. [[31mERROR[0m in 1.07s]
[0m02:37:59.220527 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:37:59.222704 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.billing_enhanced' to be skipped because of status 'error'.  Reason: Database Error in model billing_enhanced (models/intermediate/billing_enhanced.sql)
  Name patient_name not found inside p at [26:5]
  compiled code at target/run/hospital_analytics/models/intermediate/billing_enhanced.sql.
[0m02:37:59.228268 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m02:37:59.230277 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:37:59.232223 [info ] [Thread-4 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m02:37:59.234553 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m02:37:59.237643 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:37:59.240042 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:38:01.430740 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682934fb00>]}
[0m02:38:01.433662 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 3.28s]
[0m02:38:01.436359 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:38:01.763202 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f331dfd-f021-4ea9-91be-804f73383ca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682973ed50>]}
[0m02:38:01.765759 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 3.60s]
[0m02:38:01.769030 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:38:01.776166 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:38:01.782030 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:38:01.783683 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m02:38:01.784941 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m02:38:01.786340 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:38:01.787474 [debug] [MainThread]: Connection 'model.hospital_analytics.visits_enhanced' was properly closed.
[0m02:38:01.789323 [info ] [MainThread]: 
[0m02:38:01.790813 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 13.16 seconds (13.16s).
[0m02:38:01.800615 [debug] [MainThread]: Command end result
[0m02:38:01.892631 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:38:01.898450 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:38:01.919138 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:38:01.920510 [info ] [MainThread]: 
[0m02:38:01.922185 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:38:01.923545 [info ] [MainThread]: 
[0m02:38:01.925157 [error] [MainThread]:   Database Error in model billing_enhanced (models/intermediate/billing_enhanced.sql)
  Name patient_name not found inside p at [26:5]
  compiled code at target/run/hospital_analytics/models/intermediate/billing_enhanced.sql
[0m02:38:01.927066 [info ] [MainThread]: 
[0m02:38:01.928737 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=1 SKIP=2 TOTAL=13
[0m02:38:01.932208 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 19.966705, "process_in_blocks": "0", "process_kernel_time": 1.8232, "process_mem_max_rss": "214960", "process_out_blocks": "3712", "process_user_time": 13.63064}
[0m02:38:01.934177 [debug] [MainThread]: Command `dbt run` failed at 02:38:01.933672 after 19.97 seconds
[0m02:38:01.935656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78684f291e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78684eae9ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78682a68cf20>]}
[0m02:38:01.937169 [debug] [MainThread]: Flushing usage events
[0m02:38:03.368252 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:38:42.348269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b97ba5a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b97bb800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b97bbce0>]}


============================== 02:38:42.358208 | 355c5419-38a4-4b31-b8d4-48ef5e56bab4 ==============================
[0m02:38:42.358208 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:38:42.359849 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:38:45.333695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74329a210650>]}
[0m02:38:45.525700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b8b85fd0>]}
[0m02:38:45.527770 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:38:46.232135 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:38:46.673203 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:38:46.675039 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/intermediate/billing_enhanced.sql
[0m02:38:47.588181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432987cdbe0>]}
[0m02:38:47.854848 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:38:47.862803 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:38:48.140793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743298820fb0>]}
[0m02:38:48.142520 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:38:48.143906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432987c7920>]}
[0m02:38:48.151422 [info ] [MainThread]: 
[0m02:38:48.153105 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:38:48.154338 [info ] [MainThread]: 
[0m02:38:48.156101 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:38:48.171061 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:38:48.176271 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:38:48.174753 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:38:48.180747 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:38:48.284957 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:38:48.185054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:38:49.794554 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:38:49.797107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:38:49.798575 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:38:49.802129 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:38:49.804310 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:38:49.809245 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:38:50.456460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b97b8b30>]}
[0m02:38:50.458343 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:38:50.478737 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:38:50.480984 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:38:50.483153 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:38:50.487612 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:38:50.502202 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:38:50.492448 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:38:50.485590 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:38:50.506662 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:38:50.517193 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:38:50.518928 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:38:50.510662 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:38:50.514803 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:38:50.512795 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:38:50.556956 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:38:50.541663 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:38:50.526546 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:38:50.558566 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:38:50.572172 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:38:50.591167 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:38:50.596965 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:38:50.599793 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:38:50.604144 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:38:50.621022 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:38:50.653689 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:38:50.711366 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:38:50.977788 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:38:50.979682 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:38:50.986535 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:38:50.991418 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:38:50.993341 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:38:51.080555 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:38:51.082845 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:38:51.086725 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:38:51.179404 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:38:51.582795 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:38:51.585775 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:38:51.711190 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:08f7fed6-838e-4418-af86-f8c017e08c75&page=queryresults
[0m02:38:51.730629 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c8188daa-4839-4073-8546-fb56ae284d7f&page=queryresults
[0m02:38:51.764302 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:027dab22-7cb4-4b74-a094-d757a777c665&page=queryresults
[0m02:38:51.831396 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8d6722d4-03b7-41c3-85b9-71e77a723d3c&page=queryresults
[0m02:38:52.232314 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74329885bf20>]}
[0m02:38:52.237816 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.70s]
[0m02:38:52.244747 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743298892090>]}
[0m02:38:52.247480 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:38:52.249788 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743298eeff80>]}
[0m02:38:52.252666 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m02:38:52.256590 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m02:38:52.260806 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:38:52.263779 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:38:52.266849 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:38:52.278685 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:38:52.274064 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:38:52.280493 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:38:52.268725 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m02:38:52.285648 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:38:52.297423 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:38:52.300011 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m02:38:52.302319 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m02:38:52.304620 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:38:52.306217 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:38:52.308267 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:38:52.322949 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:38:52.337653 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:38:52.345698 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m02:38:52.342571 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:38:52.350004 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:38:52.347284 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:38:52.359598 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.medicines)
[0m02:38:52.356501 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:38:52.362924 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m02:38:52.368640 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m02:38:52.374742 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:38:52.385837 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:38:52.471938 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m02:38:52.480763 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:38:52.942517 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:38:52.946194 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:38:52.961789 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:38:52.964179 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:38:53.539629 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:db2f5e59-fa07-4156-b70c-5c0808436bc8&page=queryresults
[0m02:38:53.552347 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b9723200>]}
[0m02:38:53.554994 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.04s]
[0m02:38:53.557272 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:38:53.560551 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:37b5baf2-319f-4077-bfc7-29e4ea302ddd&page=queryresults
[0m02:38:54.986393 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432983634d0>]}
[0m02:38:54.988816 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.63s]
[0m02:38:55.000613 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m02:38:55.004468 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432980b41d0>]}
[0m02:38:55.007074 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.70s]
[0m02:38:55.010604 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:38:55.013761 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:38:55.015604 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:38:55.019439 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:38:55.023296 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:38:55.029264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m02:38:55.031975 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m02:38:55.034776 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:38:55.036661 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:38:55.068034 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:38:55.071371 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:38:55.074228 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:38:55.076487 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:38:55.085433 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:38:55.092718 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:38:55.627172 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:38:55.632365 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:38:55.636480 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:38:55.641941 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:38:55.871351 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f8b8066b-01ee-4ae9-bad4-e50ba7e21aad&page=queryresults
[0m02:38:55.878170 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a14af838-6b3b-4b4b-859c-e8e8de0a00a2&page=queryresults
[0m02:38:57.325365 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432981875c0>]}
[0m02:38:57.327771 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.29s]
[0m02:38:57.330927 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:38:57.334848 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:38:57.338390 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:38:57.336655 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:38:57.343660 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m02:38:57.345552 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:38:57.340843 [info ] [Thread-2 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:38:57.357218 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:38:57.359389 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m02:38:57.362422 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:38:57.377724 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:38:57.381502 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:38:57.383518 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:38:57.396705 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:38:57.399943 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:38:57.507622 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:38:57.511491 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:38:57.735824 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432980c84a0>]}
[0m02:38:57.738055 [info ] [Thread-1 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.71s]
[0m02:38:57.740819 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:38:57.743804 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:38:57.745608 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:38:57.748307 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m02:38:57.750174 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:38:57.762403 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:38:57.764953 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:38:57.777282 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:38:58.064832 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:38:58.071092 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:38:58.265968 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:120ad251-3b35-4654-93b1-623a2d465a3c&page=queryresults
[0m02:38:58.275853 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:01b90c5a-e568-4619-bbed-7e5734c7c205&page=queryresults
[0m02:38:58.462925 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:38:58.466673 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:38:58.711063 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:34115a88-8917-4ac5-b65c-64a12044ce9c&page=queryresults
[0m02:38:59.835649 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432980c7e60>]}
[0m02:38:59.838093 [info ] [Thread-2 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.48s]
[0m02:38:59.840575 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:38:59.883321 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432981bc0b0>]}
[0m02:38:59.885488 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.54s]
[0m02:38:59.888580 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:38:59.892852 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:38:59.894666 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:38:59.897435 [info ] [Thread-1 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m02:38:59.900066 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m02:38:59.902738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m02:38:59.904409 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m02:38:59.907424 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:38:59.906133 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:38:59.917850 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:38:59.935351 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:38:59.939367 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:38:59.947155 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m02:38:59.950191 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:38:59.951973 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.patient_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m02:38:59.964567 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m02:38:59.967111 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:39:00.047459 [debug] [Thread-1 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.patient_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.visit_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  ON vd.visit_id = pd.visit_id 
  AND vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  ON vd.visit_id = bd.visit_id 
  AND vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m02:39:00.049497 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:39:00.465215 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432980c8200>]}
[0m02:39:00.468360 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.72s]
[0m02:39:00.470280 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:39:00.611809 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:60936493-a3e6-48ba-954a-8342b77b2860&page=queryresults
[0m02:39:00.696161 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:60936493-a3e6-48ba-954a-8342b77b2860&page=queryresults
[0m02:39:00.702001 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:07dfc9a4-f87b-45ea-8b07-9fc0c398d9cd&page=queryresults
[0m02:39:00.720690 [debug] [Thread-2 (]: Database Error in model patient_spending_analysis (models/marts/patient_spending_analysis.sql)
  Name patient_name not found inside p at [17:5]
  compiled code at target/run/hospital_analytics/models/marts/patient_spending_analysis.sql
[0m02:39:00.722927 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743298049520>]}
[0m02:39:00.725387 [error] [Thread-2 (]: 13 of 13 ERROR creating sql table model hospital_analytics.patient_spending_analysis  [[31mERROR[0m in 0.82s]
[0m02:39:00.728926 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:39:00.731385 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_spending_analysis' to be skipped because of status 'error'.  Reason: Database Error in model patient_spending_analysis (models/marts/patient_spending_analysis.sql)
  Name patient_name not found inside p at [17:5]
  compiled code at target/run/hospital_analytics/models/marts/patient_spending_analysis.sql.
[0m02:39:00.840820 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:07dfc9a4-f87b-45ea-8b07-9fc0c398d9cd&page=queryresults
[0m02:39:00.851728 [debug] [Thread-1 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name patient_name not found inside v at [20:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:39:00.853761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '355c5419-38a4-4b31-b8d4-48ef5e56bab4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432980f04a0>]}
[0m02:39:00.857253 [error] [Thread-1 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 0.95s]
[0m02:39:00.860819 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:39:00.864577 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name patient_name not found inside v at [20:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m02:39:00.873419 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:39:00.882975 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:39:00.885672 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:39:00.887674 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m02:39:00.888679 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:39:00.890188 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:39:00.893016 [info ] [MainThread]: 
[0m02:39:00.894988 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 12.74 seconds (12.74s).
[0m02:39:00.905815 [debug] [MainThread]: Command end result
[0m02:39:00.998009 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:39:01.003602 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:39:01.026700 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:39:01.027833 [info ] [MainThread]: 
[0m02:39:01.029638 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m02:39:01.030882 [info ] [MainThread]: 
[0m02:39:01.032284 [error] [MainThread]:   Database Error in model patient_spending_analysis (models/marts/patient_spending_analysis.sql)
  Name patient_name not found inside p at [17:5]
  compiled code at target/run/hospital_analytics/models/marts/patient_spending_analysis.sql
[0m02:39:01.033583 [info ] [MainThread]: 
[0m02:39:01.036318 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name patient_name not found inside v at [20:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:39:01.037517 [info ] [MainThread]: 
[0m02:39:01.039118 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=2 SKIP=0 TOTAL=13
[0m02:39:01.042987 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 18.97933, "process_in_blocks": "0", "process_kernel_time": 1.789236, "process_mem_max_rss": "213412", "process_out_blocks": "3776", "process_user_time": 12.817567}
[0m02:39:01.044688 [debug] [MainThread]: Command `dbt run` failed at 02:39:01.044366 after 18.98 seconds
[0m02:39:01.046044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432b9051580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74329882ee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7432988e4710>]}
[0m02:39:01.047752 [debug] [MainThread]: Flushing usage events
[0m02:39:02.559841 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:41:55.064145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1548092570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15481c84a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1546763500>]}


============================== 02:41:55.075178 | 1359b622-f625-4776-8a8f-bb44f8d99a87 ==============================
[0m02:41:55.075178 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:41:55.077472 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m02:41:58.034995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1547f474d0>]}
[0m02:41:58.238009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1547ff03b0>]}
[0m02:41:58.239832 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:41:58.947165 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:41:59.374127 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m02:41:59.376704 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/schema.yml
[0m02:41:59.380720 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m02:41:59.382246 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_spending_analysis.sql
[0m02:42:00.600579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1521ff7920>]}
[0m02:42:01.073794 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:42:01.083915 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:42:01.140331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1521d9d490>]}
[0m02:42:01.142182 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:42:01.143836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15226f5070>]}
[0m02:42:01.152121 [info ] [MainThread]: 
[0m02:42:01.154083 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:42:01.155571 [info ] [MainThread]: 
[0m02:42:01.157813 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:42:01.173645 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:42:01.175375 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:42:01.258294 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:42:01.261675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:42:01.265301 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:42:01.267670 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:42:02.688398 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:42:02.690641 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:42:02.693006 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:42:02.694723 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:42:02.696839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:42:02.699795 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:42:03.370614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1522071b50>]}
[0m02:42:03.373761 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:42:03.387697 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:42:03.389803 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:42:03.391656 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m02:42:03.395117 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:42:03.397398 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:42:03.399030 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:42:03.402979 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:42:03.401576 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:42:03.423560 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:42:03.427078 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:42:03.435741 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:42:03.437964 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:42:03.442134 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m02:42:03.444519 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:42:03.454043 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:42:03.450285 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:42:03.451695 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:42:03.447374 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:42:03.474330 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:42:03.489502 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:42:03.518360 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:42:03.537423 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:42:03.545081 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:42:03.588799 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:42:03.819824 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:42:04.022758 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:42:04.026107 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:42:04.031382 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:42:04.034648 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:42:04.055651 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:42:04.146889 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:42:04.151068 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:42:04.157187 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:42:04.162379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:04.650937 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:42:04.654234 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:42:04.798312 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:009fcd23-ab6c-462e-b482-4183af552819&page=queryresults
[0m02:42:04.820552 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:42d682be-1bd7-46f1-b7a9-b4f4a9e5225e&page=queryresults
[0m02:42:04.863084 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:89b856f7-689f-4b97-9678-12d4ac51f063&page=queryresults
[0m02:42:04.888883 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8aac2e32-c5cc-44d4-afa8-876caef2b0c2&page=queryresults
[0m02:42:05.367495 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1521e7a810>]}
[0m02:42:05.380536 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1521dd6600>]}
[0m02:42:05.370617 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.93s]
[0m02:42:05.384298 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.94s]
[0m02:42:05.388972 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f152252ff20>]}
[0m02:42:05.391528 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:42:05.395708 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:42:05.398686 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.00s]
[0m02:42:05.404283 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:42:05.406447 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:42:05.409333 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:42:05.411827 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:42:05.421276 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m02:42:05.424924 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m02:42:05.429070 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:42:05.444053 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m02:42:05.442301 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:42:05.446518 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:42:05.453849 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:42:05.458816 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m02:42:05.462069 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:42:05.463726 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m02:42:05.474479 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:42:05.479998 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:42:05.498532 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m02:42:05.504682 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:42:05.512490 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m02:42:05.506928 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m02:42:05.520110 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:42:05.522314 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.medicines)
[0m02:42:05.523997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:05.526420 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m02:42:05.630420 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:42:05.636477 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m02:42:05.642888 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:42:06.072930 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:42:06.075394 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:42:06.130556 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:42:06.135956 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:42:06.463754 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1521f276e0>]}
[0m02:42:06.466335 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.02s]
[0m02:42:06.468686 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:42:06.768429 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:73c26bf8-05ca-48a1-8c05-388487966c4d&page=queryresults
[0m02:42:06.788601 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ea362101-c709-4ed7-a5f2-5bad43cce700&page=queryresults
[0m02:42:08.238708 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15211d9730>]}
[0m02:42:08.244711 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.72s]
[0m02:42:08.250212 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m02:42:08.523143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f152111d880>]}
[0m02:42:08.525455 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 3.06s]
[0m02:42:08.527698 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m02:42:08.532217 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:42:08.534107 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:42:08.536598 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:42:08.541946 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m02:42:08.543608 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:42:08.539956 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:42:08.554375 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m02:42:08.556161 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:42:08.580841 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:42:08.578891 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:42:08.587621 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:42:08.596044 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:42:08.599277 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:42:08.692233 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:42:09.130213 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:42:09.133564 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:42:09.150260 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:42:09.152905 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:42:09.368651 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:88a5d664-3597-4152-9c43-cbb3c72be3a3&page=queryresults
[0m02:42:09.478362 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7bcb90e8-1cb5-4061-82a0-e2c18828a041&page=queryresults
[0m02:42:11.134030 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1521119ee0>]}
[0m02:42:11.139400 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.58s]
[0m02:42:11.143427 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:42:11.148411 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:42:11.149841 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:42:11.154708 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:42:11.157498 [info ] [Thread-2 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:42:11.161470 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m02:42:11.163092 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m02:42:11.164639 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:42:11.166907 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:42:11.179268 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:42:11.195568 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:42:11.198128 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:42:11.210318 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:11.310270 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:42:11.325356 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:42:11.329481 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1520d017c0>]}
[0m02:42:11.332681 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.79s]
[0m02:42:11.335275 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:42:11.420389 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:42:11.422801 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:42:11.429531 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m02:42:11.431837 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:42:11.443509 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:42:11.448138 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:42:11.459013 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:42:11.790557 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:42:11.796556 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:42:11.890588 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:42:11.895546 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:42:11.930696 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:42:11.933416 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:42:12.088890 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8eb62b6a-2446-4462-a6df-58e4e20e44f6&page=queryresults
[0m02:42:12.158964 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:101fbf0d-5c2e-4f35-8274-e4b1cd98d625&page=queryresults
[0m02:42:12.181718 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:96ea0a17-70f7-4e3c-b0a0-bd6fde0ddf6b&page=queryresults
[0m02:42:13.826830 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1520d180e0>]}
[0m02:42:13.829424 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.67s]
[0m02:42:13.832674 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:42:13.844907 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m02:42:13.849056 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:42:13.846943 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m02:42:13.851081 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m02:42:13.854619 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m02:42:13.856357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m02:42:13.858451 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:42:13.860086 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:42:13.875956 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:42:13.896226 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:42:13.899756 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1520d18350>]}
[0m02:42:13.901557 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:42:13.908098 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:42:13.905467 [info ] [Thread-2 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.74s]
[0m02:42:13.923214 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m02:42:13.943846 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:42:13.941629 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m02:42:13.952649 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m02:42:13.954578 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.visit_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  ON vd.visit_id = pd.visit_id 
  AND vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  ON vd.visit_id = bd.visit_id 
  AND vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m02:42:13.958682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:13.961128 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:42:13.975735 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1520d0d8e0>]}
[0m02:42:14.145423 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.55s]
[0m02:42:14.150615 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:42:14.668707 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f81410ff-aba7-490d-8119-b3ce82ebd645&page=queryresults
[0m02:42:14.729310 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:57269144-bba4-4e9d-9f88-d8203709c57f&page=queryresults
[0m02:42:14.809444 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:57269144-bba4-4e9d-9f88-d8203709c57f&page=queryresults
[0m02:42:14.828271 [debug] [Thread-3 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name visit_id not found inside p at [33:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:42:14.830070 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f152200caa0>]}
[0m02:42:14.832414 [error] [Thread-3 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 0.98s]
[0m02:42:14.835121 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:42:14.837557 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name visit_id not found inside p at [33:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m02:42:16.413270 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1359b622-f625-4776-8a8f-bb44f8d99a87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1520d19190>]}
[0m02:42:16.415170 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.56s]
[0m02:42:16.417355 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:42:16.429297 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:42:16.435098 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:42:16.436187 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:42:16.437629 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:42:16.438652 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m02:42:16.439566 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:42:16.441295 [info ] [MainThread]: 
[0m02:42:16.443463 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.28 seconds (15.28s).
[0m02:42:16.456051 [debug] [MainThread]: Command end result
[0m02:42:16.549342 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:42:16.555007 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:42:16.576643 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:42:16.578116 [info ] [MainThread]: 
[0m02:42:16.579720 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:42:16.581186 [info ] [MainThread]: 
[0m02:42:16.583241 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name visit_id not found inside p at [33:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:42:16.584719 [info ] [MainThread]: 
[0m02:42:16.586180 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m02:42:16.589961 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 21.813986, "process_in_blocks": "0", "process_kernel_time": 1.893482, "process_mem_max_rss": "213960", "process_out_blocks": "3760", "process_user_time": 13.705065}
[0m02:42:16.591754 [debug] [MainThread]: Command `dbt run` failed at 02:42:16.591415 after 21.82 seconds
[0m02:42:16.593702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f154670b2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15469d6330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1522301c70>]}
[0m02:42:16.595071 [debug] [MainThread]: Flushing usage events
[0m02:42:18.136355 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:46:00.699665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca68da2f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca68da2210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca68da30e0>]}


============================== 02:46:00.710411 | c71140df-53c2-4e38-97c0-e4896bdc9b36 ==============================
[0m02:46:00.710411 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:46:00.712429 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:46:03.662533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca4921b320>]}
[0m02:46:03.861513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca68ca3440>]}
[0m02:46:03.863649 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:46:04.561030 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:46:04.995507 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:46:04.997752 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m02:46:06.114050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca483a8d10>]}
[0m02:46:06.600741 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:46:06.608442 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:46:06.661557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca48482270>]}
[0m02:46:06.663410 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:46:06.664687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca486313a0>]}
[0m02:46:06.672558 [info ] [MainThread]: 
[0m02:46:06.674466 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:46:06.675682 [info ] [MainThread]: 
[0m02:46:06.677761 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:46:06.693252 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:46:06.695305 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:46:06.697757 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:46:06.700030 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:46:06.719689 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:46:06.901497 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:46:08.051332 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:46:08.053168 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:46:08.055275 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:46:08.061446 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:46:08.076772 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:46:08.166205 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:46:08.696192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca484738c0>]}
[0m02:46:08.697900 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:46:08.712111 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:46:08.713947 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:46:08.716411 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:46:08.720690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m02:46:08.718692 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:46:08.725742 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:46:08.728711 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:46:08.731990 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:46:08.736133 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:46:08.773598 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:46:08.762024 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:46:08.751004 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:46:08.783995 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:46:08.793251 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:46:08.795757 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:46:08.797609 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m02:46:08.814818 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:46:08.809838 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:46:08.812536 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:46:08.800612 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:46:08.824570 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:46:08.886911 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:46:08.890423 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:46:08.943334 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:46:09.118967 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:46:09.330336 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:46:09.327267 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:46:09.342817 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:46:09.345868 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:46:09.347654 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:46:09.349575 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:46:09.431449 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:46:09.436213 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:46:09.438098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:46:09.988907 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:46:09.991945 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:46:10.097322 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:258c1c3f-de31-49f4-9534-e5deb1e6c577&page=queryresults
[0m02:46:10.112658 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:95e45064-cac2-40ec-85d2-9a5b1c9e4e56&page=queryresults
[0m02:46:10.122124 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:47aa3c8e-10aa-475a-bb6e-52db0f893129&page=queryresults
[0m02:46:10.238024 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:23be4f5a-4685-490a-adca-69d2a42418b6&page=queryresults
[0m02:46:10.587409 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca4813e6c0>]}
[0m02:46:10.591106 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca48470f80>]}
[0m02:46:10.596975 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca69522480>]}
[0m02:46:10.595713 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.84s]
[0m02:46:10.599598 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.87s]
[0m02:46:10.604629 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m02:46:10.614174 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:46:10.617172 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:46:10.610448 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:46:10.622316 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m02:46:10.624249 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:46:10.626481 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m02:46:10.630146 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m02:46:10.639912 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:46:10.642363 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m02:46:10.645580 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m02:46:10.648295 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:46:10.655786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m02:46:10.653835 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:46:10.666416 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:46:10.668812 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:46:10.672476 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m02:46:10.681288 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:46:10.696519 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:46:10.694507 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:46:10.789681 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:46:10.794098 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:46:10.797274 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:46:10.801173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:46:10.803335 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m02:46:10.810831 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m02:46:10.813208 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:46:10.824710 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:46:10.827295 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:46:10.835442 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:46:11.240036 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:46:11.243197 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:46:11.283790 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:46:11.287379 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:46:11.941549 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:16566354-1820-4249-80df-7bc939dbcc8d&page=queryresults
[0m02:46:11.948518 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:32366422-3787-4b30-851a-b19f325d168e&page=queryresults
[0m02:46:12.595970 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43b3a690>]}
[0m02:46:12.598498 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.80s]
[0m02:46:12.601455 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:46:13.694028 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca48470260>]}
[0m02:46:13.696201 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.07s]
[0m02:46:13.707397 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m02:46:13.704593 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43b21850>]}
[0m02:46:13.710437 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.90s]
[0m02:46:13.713350 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:46:13.717061 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:46:13.719473 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:46:13.721543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m02:46:13.723272 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:46:13.725369 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:46:13.727909 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:46:13.751541 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:46:13.754255 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m02:46:13.757296 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:46:13.759268 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:46:13.769131 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:46:13.781566 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:46:13.870799 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:46:13.881739 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:46:14.366089 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:46:14.369353 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:46:14.379426 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:46:14.382392 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:46:14.627115 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a60f7974-0ed3-4866-afb2-d190953f7c94&page=queryresults
[0m02:46:14.659683 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f34041d3-8d1b-4d2a-aeff-8712a891a7e6&page=queryresults
[0m02:46:16.173236 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca485889e0>]}
[0m02:46:16.175820 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.42s]
[0m02:46:16.179712 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:46:16.182754 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:46:16.184499 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:46:16.189056 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:46:16.193179 [info ] [Thread-2 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:46:16.197700 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m02:46:16.201955 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m02:46:16.203779 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:46:16.205277 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:46:16.222194 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:46:16.232641 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:46:16.235828 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:46:16.243399 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:46:16.245025 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:46:16.251235 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:46:16.514326 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca48475f10>]}
[0m02:46:16.516902 [info ] [Thread-1 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.79s]
[0m02:46:16.521375 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:46:16.524625 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:46:16.527695 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:46:16.529459 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m02:46:16.530821 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:46:16.541545 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:46:16.543927 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:46:16.549738 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:46:16.840761 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:46:16.853167 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:46:16.850433 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:46:16.860088 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:46:17.009067 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:46:17.012083 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:46:17.079759 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8401a751-5d3a-4e33-8705-15925943b1a7&page=queryresults
[0m02:46:17.117799 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:640d8acc-e7b1-4f67-b6f0-3df279c81951&page=queryresults
[0m02:46:17.247932 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:acae223c-e0fd-4d6b-abd5-85f51e2e8d8a&page=queryresults
[0m02:46:19.073796 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43b27dd0>]}
[0m02:46:19.076475 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.88s]
[0m02:46:19.079201 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:46:19.084021 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m02:46:19.085558 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:46:19.091249 [info ] [Thread-1 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m02:46:19.097646 [info ] [Thread-3 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m02:46:19.100813 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m02:46:19.102403 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m02:46:19.104236 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:46:19.106470 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:46:19.119553 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:46:19.160753 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:46:19.165914 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43b600b0>]}
[0m02:46:19.157786 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:46:19.178162 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m02:46:19.181404 [info ] [Thread-2 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.96s]
[0m02:46:19.187565 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:46:19.190763 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:46:19.199920 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:46:19.217812 [debug] [Thread-1 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  ON vd.visit_id = pd.visit_id 
  AND vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  ON vd.visit_id = bd.visit_id 
  AND vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m02:46:19.305536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:46:19.402941 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43b1a390>]}
[0m02:46:19.405783 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.87s]
[0m02:46:19.409171 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:46:19.741049 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m02:46:19.745499 [debug] [Thread-3 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m02:46:19.958778 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f28e4874-990d-4234-a3e2-222e518bc27d&page=queryresults
[0m02:46:19.965028 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b7825baa-e617-44c8-a9de-c766de8b9b63&page=queryresults
[0m02:46:20.051379 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f28e4874-990d-4234-a3e2-222e518bc27d&page=queryresults
[0m02:46:20.074609 [debug] [Thread-1 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name visit_id not found inside pd at [74:23]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:46:20.076707 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43f76390>]}
[0m02:46:20.079169 [error] [Thread-1 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 0.98s]
[0m02:46:20.082392 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:46:20.084982 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name visit_id not found inside pd at [74:23]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m02:46:21.685565 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c71140df-53c2-4e38-97c0-e4896bdc9b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca43b5b3b0>]}
[0m02:46:21.688651 [info ] [Thread-3 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.58s]
[0m02:46:21.693311 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:46:21.701176 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:46:21.709347 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:46:21.711037 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:46:21.712996 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m02:46:21.714657 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:46:21.716140 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:46:21.718501 [info ] [MainThread]: 
[0m02:46:21.721428 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.04 seconds (15.04s).
[0m02:46:21.733604 [debug] [MainThread]: Command end result
[0m02:46:21.824837 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:46:21.830296 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:46:21.851100 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:46:21.852473 [info ] [MainThread]: 
[0m02:46:21.854178 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:46:21.855515 [info ] [MainThread]: 
[0m02:46:21.857037 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name visit_id not found inside pd at [74:23]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:46:21.858435 [info ] [MainThread]: 
[0m02:46:21.859957 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m02:46:21.863972 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 21.465902, "process_in_blocks": "0", "process_kernel_time": 1.867471, "process_mem_max_rss": "214296", "process_out_blocks": "3768", "process_user_time": 13.488403}
[0m02:46:21.866452 [debug] [MainThread]: Command `dbt run` failed at 02:46:21.865611 after 21.47 seconds
[0m02:46:21.868150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca68c77560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca483b37d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ca483aaa20>]}
[0m02:46:21.869714 [debug] [MainThread]: Flushing usage events
[0m02:46:23.382401 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:48:55.795202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913c27fb380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913c3ba4380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913c27f9f40>]}


============================== 02:48:55.806479 | 601b5817-2c48-43dc-bc33-92ac1e314227 ==============================
[0m02:48:55.806479 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:48:55.808761 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m02:48:58.803974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913c39137a0>]}
[0m02:48:59.003086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a1c519a0>]}
[0m02:48:59.005383 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:48:59.736127 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:49:00.178026 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:49:00.180382 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m02:49:01.307567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a16b4ec0>]}
[0m02:49:01.805554 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:49:01.815526 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:49:01.872751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a178ae70>]}
[0m02:49:01.875073 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:49:01.876590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a19411c0>]}
[0m02:49:01.884333 [info ] [MainThread]: 
[0m02:49:01.886277 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:49:01.887804 [info ] [MainThread]: 
[0m02:49:01.890082 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:49:01.904539 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:49:01.907117 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:49:01.908141 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:49:01.910346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:49:01.911957 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:49:02.105795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:49:03.135570 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:49:03.137968 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:49:03.139694 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:49:03.142190 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:49:03.146447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:49:03.152173 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:49:03.788547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a17887a0>]}
[0m02:49:03.790027 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:49:03.807080 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:49:03.809209 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:49:03.811072 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:49:03.813343 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:49:03.814932 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:49:03.816624 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:49:03.821114 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:49:03.819362 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:49:03.823817 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:49:03.827575 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:49:03.838704 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m02:49:03.864748 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:49:03.867076 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m02:49:03.869684 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:49:03.872135 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:49:03.877031 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:49:03.880286 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:49:03.904655 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:49:03.924346 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:49:03.926657 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:49:03.934420 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:49:03.936678 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:49:03.938464 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:49:03.993718 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:49:04.250159 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:49:04.269902 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:49:04.274252 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:49:04.358745 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:49:04.365134 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:49:04.368456 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:49:04.373582 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:49:04.458442 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:49:04.462626 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:49:04.552289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:49:04.989630 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:49:04.992751 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:49:05.087173 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0f632385-bbb6-414c-8cbe-3938cb041b05&page=queryresults
[0m02:49:05.135240 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:918fc71c-73b4-4460-8f88-fc7748148d26&page=queryresults
[0m02:49:05.146681 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e700838b-9fdb-4406-aa6e-90febaf89a06&page=queryresults
[0m02:49:05.310633 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c2a63817-0f8c-4d42-91b4-02257e50cdce&page=queryresults
[0m02:49:05.652816 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a16b3860>]}
[0m02:49:05.658363 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a1d34230>]}
[0m02:49:05.656679 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m02:49:05.661993 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0ffbc80>]}
[0m02:49:05.667805 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:49:05.664753 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m02:49:05.671750 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m02:49:05.675549 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:49:05.678501 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:49:05.680556 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:49:05.683378 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:49:05.685012 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m02:49:05.687510 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:49:05.689896 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:49:05.692182 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m02:49:05.694133 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:49:05.695727 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:49:05.697598 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:49:05.699395 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:49:05.711339 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:49:05.721715 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:49:05.735322 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:49:05.741951 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:49:05.745532 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:49:05.748287 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:49:05.761520 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m02:49:05.763517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:49:05.771813 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:49:05.773796 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:49:05.859206 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:49:05.861756 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.patients)
[0m02:49:05.863816 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:49:05.875551 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:49:05.878430 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:49:05.885292 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:49:06.381544 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:49:06.387854 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:49:06.390472 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:49:06.392552 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:49:07.038721 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0e75969f-835e-4bde-bea3-ae6e36a5fa0b&page=queryresults
[0m02:49:07.077544 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:de272f83-34c6-4aca-889c-a28210ea8ee4&page=queryresults
[0m02:49:07.104695 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a189a630>]}
[0m02:49:07.107172 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.24s]
[0m02:49:07.109349 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:49:08.542339 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0b9ff20>]}
[0m02:49:08.544559 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.68s]
[0m02:49:08.547303 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:49:08.551461 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:49:08.554008 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:49:08.557357 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m02:49:08.559109 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:49:08.571168 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:49:08.573784 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:49:08.596195 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:49:08.811577 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0bd10a0>]}
[0m02:49:08.813725 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.12s]
[0m02:49:08.816046 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:49:08.821250 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:49:08.823379 [info ] [Thread-3 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:49:08.827317 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m02:49:08.829624 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:49:08.844329 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:49:08.848519 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:49:08.860217 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:49:09.127970 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:49:09.131758 [debug] [Thread-2 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:49:09.319061 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:49:09.322369 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:49:09.357552 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c6a321d1-1b60-4b59-ba06-516028ae202c&page=queryresults
[0m02:49:09.539240 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a70e41b0-ab96-4643-acd7-6399edf7f88e&page=queryresults
[0m02:49:11.121791 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a1765850>]}
[0m02:49:11.124375 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.56s]
[0m02:49:11.126746 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:49:11.129680 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:49:11.131530 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:49:11.133783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m02:49:11.135453 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:49:11.137237 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:49:11.150099 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:49:11.161417 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:49:11.165171 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:49:11.167272 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m02:49:11.176247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:49:11.179765 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:49:11.276341 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:49:11.285780 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0bbe810>]}
[0m02:49:11.290003 [info ] [Thread-3 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.46s]
[0m02:49:11.292486 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:49:11.297475 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:49:11.300260 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:49:11.310355 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:49:11.313409 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:49:11.393579 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m02:49:11.398030 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:49:11.413738 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:49:11.416196 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:49:11.422420 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:49:11.789616 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:49:11.792925 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:49:11.808443 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:49:11.811643 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:49:11.869542 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:49:11.872271 [debug] [Thread-2 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:49:12.027283 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:68240a61-b1ac-4e05-b877-0b81f4e3fc01&page=queryresults
[0m02:49:12.038273 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c0a082dc-ab86-4c96-9c97-530b3b9c9591&page=queryresults
[0m02:49:12.157331 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:069c5327-aaef-43db-97ce-586b84577b41&page=queryresults
[0m02:49:13.734483 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0720d70>]}
[0m02:49:13.736596 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.57s]
[0m02:49:13.739056 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:49:13.747458 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0721700>]}
[0m02:49:13.750149 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.61s]
[0m02:49:13.753007 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:49:13.757584 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m02:49:13.761279 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:49:13.759786 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m02:49:13.764386 [info ] [Thread-4 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m02:49:13.768330 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m02:49:13.770797 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m02:49:13.773360 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:49:13.775235 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:49:13.804416 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:49:13.816285 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:49:13.818767 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:49:13.830145 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m02:49:13.832253 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:49:13.840344 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:49:13.930258 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  AND vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  AND vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m02:49:13.933378 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:49:13.946928 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a072be60>]}
[0m02:49:13.949556 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.55s]
[0m02:49:13.952423 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:49:14.393815 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m02:49:14.401121 [debug] [Thread-4 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m02:49:14.449320 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bf208d31-e40a-44f2-b0a4-b2ac5b7473b0&page=queryresults
[0m02:49:14.451518 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bf208d31-e40a-44f2-b0a4-b2ac5b7473b0&page=queryresults
[0m02:49:14.470980 [debug] [Thread-3 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Syntax error: Expected ")" but got keyword AND at [74:3]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:49:14.475319 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a185bfe0>]}
[0m02:49:14.476824 [error] [Thread-3 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 0.71s]
[0m02:49:14.480392 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:49:14.483195 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Syntax error: Expected ")" but got keyword AND at [74:3]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m02:49:14.680713 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:aeff63f1-8285-493b-982c-b389615f1eaa&page=queryresults
[0m02:49:16.880332 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '601b5817-2c48-43dc-bc33-92ac1e314227', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a0bdc920>]}
[0m02:49:16.885032 [info ] [Thread-4 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 3.11s]
[0m02:49:16.888976 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:49:16.900747 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:49:16.911832 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:49:16.914245 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:49:16.917208 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:49:16.920080 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m02:49:16.921208 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:49:16.923072 [info ] [MainThread]: 
[0m02:49:16.926284 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.03 seconds (15.03s).
[0m02:49:16.942408 [debug] [MainThread]: Command end result
[0m02:49:17.033186 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:49:17.038253 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:49:17.059918 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:49:17.061463 [info ] [MainThread]: 
[0m02:49:17.063060 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:49:17.064085 [info ] [MainThread]: 
[0m02:49:17.065644 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Syntax error: Expected ")" but got keyword AND at [74:3]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:49:17.067961 [info ] [MainThread]: 
[0m02:49:17.069502 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m02:49:17.073501 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 21.569994, "process_in_blocks": "0", "process_kernel_time": 1.871534, "process_mem_max_rss": "214156", "process_out_blocks": "3768", "process_user_time": 13.730238}
[0m02:49:17.076210 [debug] [MainThread]: Command `dbt run` failed at 02:49:17.075639 after 21.57 seconds
[0m02:49:17.077739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913c22ff1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913a1799610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7913c1d5d1f0>]}
[0m02:49:17.079254 [debug] [MainThread]: Flushing usage events
[0m02:49:18.733435 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:50:22.476151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae0465ee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae0465df40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae0465deb0>]}


============================== 02:50:22.487147 | e8596687-194e-4a21-b6e5-4d558eae2d3b ==============================
[0m02:50:22.487147 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:50:22.489212 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:50:25.474394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dade47153a0>]}
[0m02:50:25.676190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae041898e0>]}
[0m02:50:25.678280 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:50:26.400467 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:50:26.820678 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:50:26.822927 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m02:50:27.909461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dade421bf50>]}
[0m02:50:28.406802 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:50:28.416316 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:50:28.470745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddfd8df10>]}
[0m02:50:28.472602 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:50:28.473794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddfdc6750>]}
[0m02:50:28.482456 [info ] [MainThread]: 
[0m02:50:28.483985 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:50:28.485139 [info ] [MainThread]: 
[0m02:50:28.487235 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:50:28.503344 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:50:28.504992 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:50:28.507699 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:50:28.510583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:50:28.522237 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:50:28.609543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:50:30.024686 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:50:30.026539 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:50:30.028290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:50:30.029835 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:50:30.191679 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:50:30.197128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:50:30.684534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddfd8d310>]}
[0m02:50:30.686115 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:50:30.700627 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:50:30.703198 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:50:30.707143 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:50:30.705927 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:50:30.709325 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:50:30.711195 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:50:30.713707 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:50:30.716161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m02:50:30.722790 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:50:30.721761 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m02:50:30.718378 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:50:30.720055 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:50:30.733831 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:50:30.745560 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:50:30.768561 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:50:30.769795 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:50:30.781417 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:50:30.783510 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:50:30.793317 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:50:30.806423 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:50:30.808407 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:50:30.810432 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:50:30.835502 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:50:30.843253 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:50:31.019459 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:50:31.182850 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:50:31.194128 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:50:31.197120 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:50:31.199401 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:50:31.204303 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:50:31.207385 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:50:31.219399 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:50:31.221023 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:50:31.222608 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:50:31.839345 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:50:31.842130 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:50:31.967689 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6a05c340-d660-45e0-b377-9d76e3132bfd&page=queryresults
[0m02:50:31.986793 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4595aa4d-9987-4f1a-bdee-b5ee9cdd4a60&page=queryresults
[0m02:50:32.008078 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1796c133-5735-4f56-aa74-6491fe6cbf2a&page=queryresults
[0m02:50:32.137194 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:85c127bd-f933-4ec8-81bc-3121f29616dd&page=queryresults
[0m02:50:32.519806 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae04dddeb0>]}
[0m02:50:32.521182 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddf1c7c20>]}
[0m02:50:32.522246 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddfe64bf0>]}
[0m02:50:32.524802 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m02:50:32.529918 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m02:50:32.537309 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:50:32.535011 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:50:32.533054 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m02:50:32.544904 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:50:32.547073 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m02:50:32.549254 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:50:32.555773 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m02:50:32.553881 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m02:50:32.551902 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:50:32.557625 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m02:50:32.561093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m02:50:32.562835 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:50:32.569909 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:50:32.576807 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:50:32.578292 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:50:32.588794 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:50:32.603975 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m02:50:32.601312 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:50:32.606379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:50:32.621549 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:50:32.623447 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:50:32.625327 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m02:50:32.711764 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m02:50:32.723392 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:50:32.727133 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:50:32.730243 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.patients)
[0m02:50:32.731532 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m02:50:32.739582 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:50:32.742288 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m02:50:32.747200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:50:33.167462 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:50:33.169967 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:50:33.198311 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:50:33.199650 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:50:33.682695 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddede76b0>]}
[0m02:50:33.686756 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.94s]
[0m02:50:33.689343 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:50:33.862328 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a9fbdc3e-1fca-47d8-8399-fec0f183fc37&page=queryresults
[0m02:50:33.873608 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:40ab3821-fc59-415a-b6a0-8e0ad0f72a0b&page=queryresults
[0m02:50:35.345531 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddff65040>]}
[0m02:50:35.349074 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.79s]
[0m02:50:35.351744 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m02:50:35.374272 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddede9970>]}
[0m02:50:35.377477 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.64s]
[0m02:50:35.381461 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m02:50:35.390685 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:50:35.394055 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:50:35.396717 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:50:35.403369 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.prescriptions_enhanced)
[0m02:50:35.400934 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:50:35.406571 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:50:35.409098 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m02:50:35.417938 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:50:35.444362 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:50:35.454717 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:50:35.457361 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:50:35.463943 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:50:35.466623 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:50:35.485112 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:50:36.302189 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:50:36.309078 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:50:36.310794 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:50:36.317658 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:50:36.532939 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:44740028-7c3d-4305-a846-9f3364abce42&page=queryresults
[0m02:50:36.539302 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1f091735-e441-4e9f-a865-e6e20fd3508f&page=queryresults
[0m02:50:38.105909 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dadded1fe30>]}
[0m02:50:38.107726 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.70s]
[0m02:50:38.115740 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:50:38.558287 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddfd63740>]}
[0m02:50:38.561735 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 3.15s]
[0m02:50:38.568199 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:50:38.573026 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:50:38.576389 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:50:38.579168 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:50:38.574962 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:50:38.581225 [info ] [Thread-3 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:50:38.583727 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:50:38.586527 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m02:50:38.590762 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m02:50:38.594349 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:50:38.592488 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:50:38.588644 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m02:50:38.619988 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:50:38.603851 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:50:38.630651 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:50:38.646393 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:50:38.649522 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:50:38.651052 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:50:38.660170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:50:38.679064 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:50:38.677117 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:50:38.770575 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:50:39.321049 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:50:39.326763 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:50:39.329526 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:50:39.331206 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:50:39.409044 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:50:39.412901 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:50:39.547653 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c0337304-acca-46e3-bccd-3cdc8c971ab5&page=queryresults
[0m02:50:39.566702 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:72ca677e-8def-437b-96e7-c7a7f7a728e2&page=queryresults
[0m02:50:39.623308 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c8a7d06d-b79d-4e7f-ba84-16f1ccbb710c&page=queryresults
[0m02:50:40.983627 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dadde93cd40>]}
[0m02:50:40.985931 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.40s]
[0m02:50:40.993629 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:50:40.996383 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m02:50:40.999315 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:50:40.997910 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m02:50:41.002470 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m02:50:41.006106 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m02:50:41.008390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m02:50:41.010320 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:50:41.014315 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:50:41.046364 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:50:41.052396 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:50:41.061781 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:50:41.065691 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:50:41.085303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:50:41.087544 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m02:50:41.189176 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m02:50:41.190844 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:50:41.303117 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddedf3c20>]}
[0m02:50:41.305646 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.71s]
[0m02:50:41.309608 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:50:41.604409 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddfe9ce60>]}
[0m02:50:41.609125 [info ] [Thread-3 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 3.02s]
[0m02:50:41.615444 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:50:41.642689 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m02:50:41.645837 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m02:50:41.679089 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8283e2df-683b-4e87-95e7-fc8915423c56&page=queryresults
[0m02:50:41.680722 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8283e2df-683b-4e87-95e7-fc8915423c56&page=queryresults
[0m02:50:41.726800 [debug] [Thread-4 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Syntax error: Expected ")" but got identifier "vd" at [74:3]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:50:41.729783 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddedf35f0>]}
[0m02:50:41.733559 [error] [Thread-4 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 0.72s]
[0m02:50:41.737149 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:50:41.740153 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Syntax error: Expected ")" but got identifier "vd" at [74:3]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m02:50:41.860589 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:681cf4b5-fca5-46a2-aecf-45d7a54de1a2&page=queryresults
[0m02:50:43.611680 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8596687-194e-4a21-b6e5-4d558eae2d3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dadde92b830>]}
[0m02:50:43.613907 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.60s]
[0m02:50:43.616319 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:50:43.624575 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:50:43.630265 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:50:43.631644 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:50:43.632840 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m02:50:43.633971 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:50:43.637553 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:50:43.638610 [info ] [MainThread]: 
[0m02:50:43.639753 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.15 seconds (15.15s).
[0m02:50:43.648680 [debug] [MainThread]: Command end result
[0m02:50:43.733316 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:50:43.739247 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:50:43.761557 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:50:43.763058 [info ] [MainThread]: 
[0m02:50:43.764612 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m02:50:43.766548 [info ] [MainThread]: 
[0m02:50:43.768524 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Syntax error: Expected ")" but got identifier "vd" at [74:3]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m02:50:43.770038 [info ] [MainThread]: 
[0m02:50:43.771642 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m02:50:43.775365 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 21.59645, "process_in_blocks": "0", "process_kernel_time": 1.87535, "process_mem_max_rss": "214376", "process_out_blocks": "3768", "process_user_time": 13.174166}
[0m02:50:43.777502 [debug] [MainThread]: Command `dbt run` failed at 02:50:43.777225 after 21.60 seconds
[0m02:50:43.778835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae04166210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7daddf9b3fe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dae042262d0>]}
[0m02:50:43.780321 [debug] [MainThread]: Flushing usage events
[0m02:50:45.320203 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:53:43.054361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5c83e6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5c8da750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5c83ccb0>]}


============================== 02:53:43.064947 | 34a4e6ad-9f8a-42e6-a16d-d1315678da40 ==============================
[0m02:53:43.064947 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:53:43.067229 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:53:46.095452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3c623f50>]}
[0m02:53:46.301826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3c7b1460>]}
[0m02:53:46.304088 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:53:47.053513 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:53:47.491275 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:53:47.493696 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m02:53:48.628154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb37dbcc80>]}
[0m02:53:49.129778 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:53:49.139499 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:53:49.197398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb37e9fd10>]}
[0m02:53:49.199087 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:53:49.200600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3c1df950>]}
[0m02:53:49.209407 [info ] [MainThread]: 
[0m02:53:49.211045 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:53:49.212998 [info ] [MainThread]: 
[0m02:53:49.215240 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:53:49.231675 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:53:49.233541 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:53:49.237242 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:53:49.324007 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m02:53:49.334662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:53:49.327922 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:53:50.509325 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m02:53:50.512017 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:53:50.525269 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m02:53:50.527721 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:53:50.612122 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m02:53:50.618131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:53:51.195126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb37dbdaf0>]}
[0m02:53:51.196836 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:53:51.213586 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:53:51.215271 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:53:51.224159 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:53:51.217178 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m02:53:51.220701 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:53:51.240002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:53:51.243592 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:53:51.234608 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m02:53:51.236584 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m02:53:51.260302 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m02:53:51.284926 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:53:51.279324 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:53:51.282079 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:53:51.241697 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m02:53:51.305659 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:53:51.303307 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:53:51.307825 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m02:53:51.309753 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:53:51.323681 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:53:51.326721 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:53:51.329772 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:53:51.378421 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:53:51.553407 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:53:51.586691 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:53:51.747483 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m02:53:51.751348 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:53:51.756416 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m02:53:51.766074 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m02:53:51.770721 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m02:53:51.773201 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m02:53:51.775814 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:53:51.778796 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:53:51.787803 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m02:53:51.889887 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:53:52.408773 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m02:53:52.412732 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m02:53:52.531504 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ef1889ac-a6ec-4b78-83bc-38974cc0a07e&page=queryresults
[0m02:53:52.637967 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:3ee5776b-7837-4567-9c3b-1dc87e2f6a3d&page=queryresults
[0m02:53:52.644743 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:11faa9d5-59a8-41cc-afe5-832d5817297e&page=queryresults
[0m02:53:52.656997 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c31dc0ed-bcba-420f-a78f-481b9fd84519&page=queryresults
[0m02:53:53.212139 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb37537ec0>]}
[0m02:53:53.215668 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.96s]
[0m02:53:53.222494 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:53:53.233120 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5cf5a420>]}
[0m02:53:53.235695 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3c365c40>]}
[0m02:53:53.239759 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.94s]
[0m02:53:53.242396 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:53:53.245922 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.90s]
[0m02:53:53.249798 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:53:53.251805 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m02:53:53.255380 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:53:53.258058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:53:53.261494 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:53:53.263436 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m02:53:53.265093 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:53:53.266744 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:53:53.269075 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m02:53:53.282624 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:53:53.284629 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:53:53.286348 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:53:53.296071 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:53:53.304637 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:53:53.309471 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:53:53.319096 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:53:53.322970 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:53:53.340771 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:53:53.343196 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:53:53.345629 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m02:53:53.442111 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m02:53:53.444352 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m02:53:53.448811 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m02:53:53.450422 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m02:53:53.463615 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:53:53.468110 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m02:53:53.477438 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:53:53.898089 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m02:53:53.901270 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m02:53:53.967847 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m02:53:53.971789 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m02:53:54.429059 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb37ec04a0>]}
[0m02:53:54.433049 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.15s]
[0m02:53:54.435976 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:53:54.532485 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:70aa399a-6ea4-49fe-a33b-fb12161c7ebf&page=queryresults
[0m02:53:54.563613 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:845a8f53-1cf1-44f1-b07f-14732ce7befb&page=queryresults
[0m02:53:56.002176 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb371fef00>]}
[0m02:53:56.006816 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.74s]
[0m02:53:56.009387 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:53:56.025661 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb36d23bc0>]}
[0m02:53:56.033233 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.58s]
[0m02:53:56.037804 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m02:53:56.043546 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:53:56.045282 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:53:56.047391 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m02:53:56.052230 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m02:53:56.054615 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:53:56.050524 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m02:53:56.069310 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m02:53:56.071476 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:53:56.086274 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:53:56.096941 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:53:56.099580 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:53:56.101206 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:53:56.129143 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:53:56.226198 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:53:56.682681 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:53:56.689679 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m02:53:56.707971 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m02:53:56.711185 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m02:53:56.936683 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:32d85e29-b636-48e8-b425-498eb607af4a&page=queryresults
[0m02:53:56.950767 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:37cb9be1-e865-4cf2-8f0e-2df75a010b1f&page=queryresults
[0m02:53:58.367114 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb36d1ba10>]}
[0m02:53:58.375975 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb36d1a2d0>]}
[0m02:53:58.379178 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.31s]
[0m02:53:58.383536 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.31s]
[0m02:53:58.387443 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:53:58.389772 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:53:58.398661 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:53:58.401042 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:53:58.402660 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:53:58.404435 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m02:53:58.410819 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m02:53:58.409073 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m02:53:58.413148 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:53:58.406533 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m02:53:58.417576 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m02:53:58.439793 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m02:53:58.441220 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:53:58.444503 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:53:58.446458 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:53:58.452365 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:53:58.475209 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:53:58.483179 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:53:58.493939 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:53:58.497177 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:53:58.499354 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:53:58.516711 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:53:58.625340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:53:59.133835 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m02:53:59.129297 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m02:53:59.140785 [debug] [Thread-1 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m02:53:59.146638 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m02:53:59.154288 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m02:53:59.162677 [debug] [Thread-3 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m02:53:59.379487 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bbf7ee20-63af-4e74-a9e2-c011990af2de&page=queryresults
[0m02:53:59.410536 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9fac4bc3-684f-4dd7-b90b-b5e50f396bbe&page=queryresults
[0m02:53:59.431541 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:38081de3-e861-4e4e-ab36-8921f2e1836b&page=queryresults
[0m02:54:00.823749 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3715d1c0>]}
[0m02:54:00.826345 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.41s]
[0m02:54:00.829136 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:54:00.832925 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m02:54:00.834379 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:54:00.836509 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m02:54:00.838860 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m02:54:00.842725 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m02:54:00.844386 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m02:54:00.846254 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:54:00.848671 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:54:00.880303 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:54:00.888646 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:54:00.895203 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:00.897055 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:54:00.905653 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:54:01.007805 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m02:54:01.016693 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  ON vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  ON vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m02:54:01.022641 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:54:01.235361 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3c36dbb0>]}
[0m02:54:01.246134 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb36d58fe0>]}
[0m02:54:01.250528 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.79s]
[0m02:54:01.257077 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.83s]
[0m02:54:01.260527 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:54:01.263686 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:54:01.489143 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m02:54:01.492361 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m02:54:01.633782 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9c7d4ec6-842b-41f9-9afd-ce42321708cd&page=queryresults
[0m02:54:01.743503 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2b2c23c5-7997-42a1-9a59-f5764e5d0049&page=queryresults
[0m02:54:03.218286 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb3cdc5dc0>]}
[0m02:54:03.220490 [info ] [Thread-4 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (355.0 rows, 34.3 KiB processed)[0m in 2.38s]
[0m02:54:03.223412 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:54:03.322416 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a4e6ad-9f8a-42e6-a16d-d1315678da40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb371f2030>]}
[0m02:54:03.325070 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.48s]
[0m02:54:03.328367 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:54:03.336083 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:54:03.342143 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:54:03.343498 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:54:03.344546 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m02:54:03.345528 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m02:54:03.346791 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:54:03.348685 [info ] [MainThread]: 
[0m02:54:03.350536 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 14.13 seconds (14.13s).
[0m02:54:03.361745 [debug] [MainThread]: Command end result
[0m02:54:03.460068 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:54:03.466965 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:54:03.488073 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:54:03.489374 [info ] [MainThread]: 
[0m02:54:03.490809 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:54:03.491794 [info ] [MainThread]: 
[0m02:54:03.493475 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m02:54:03.497563 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 20.779598, "process_in_blocks": "0", "process_kernel_time": 1.99459, "process_mem_max_rss": "213840", "process_out_blocks": "3760", "process_user_time": 13.586222}
[0m02:54:03.499790 [debug] [MainThread]: Command `dbt run` succeeded at 02:54:03.499380 after 20.78 seconds
[0m02:54:03.501576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5c6bf800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5c7d7e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fb5d3c9a30>]}
[0m02:54:03.503105 [debug] [MainThread]: Flushing usage events
[0m02:54:05.017510 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:54:48.024024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e137e26c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e12ec5100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e13918680>]}


============================== 02:54:48.034792 | 124615d3-7745-4019-8a71-21df44b40f08 ==============================
[0m02:54:48.034792 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:54:48.036651 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:54:50.871029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '124615d3-7745-4019-8a71-21df44b40f08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712df2b4b500>]}
[0m02:54:51.053233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '124615d3-7745-4019-8a71-21df44b40f08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712df1c8a090>]}
[0m02:54:51.054605 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:54:51.708422 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:54:52.090754 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:54:52.091996 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:54:52.223839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '124615d3-7745-4019-8a71-21df44b40f08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e11f304d0>]}
[0m02:54:52.275906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '124615d3-7745-4019-8a71-21df44b40f08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712df1613200>]}
[0m02:54:52.276996 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:54:52.278032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '124615d3-7745-4019-8a71-21df44b40f08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712df1a44770>]}
[0m02:54:52.284841 [info ] [MainThread]: 
[0m02:54:52.286563 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:54:52.288201 [info ] [MainThread]: 
[0m02:54:52.290528 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:54:52.305381 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m02:54:52.308271 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m02:54:52.310489 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m02:54:52.315600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:52.313574 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:52.312200 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:53.012315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '124615d3-7745-4019-8a71-21df44b40f08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e13738830>]}
[0m02:54:53.013854 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:54:53.028618 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:54:53.030500 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:54:53.032018 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m02:54:53.034619 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:54:53.036649 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m02:54:53.038731 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:54:53.040493 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:54:53.045341 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m02:54:53.048216 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:54:53.049738 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:54:53.071688 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:54:53.085449 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:54:53.095884 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:54:53.097533 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:54:53.120577 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:54:53.124674 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:54:53.127047 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:54:53.129562 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:54:53.132905 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:54:53.134861 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:54:53.136946 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:54:53.138270 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:53.140059 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:54:53.142336 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:54:53.148726 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:54:53.159071 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:54:53.165648 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:54:53.170968 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:54:53.173562 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m02:54:53.177161 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:54:53.178996 [debug] [Thread-4 (]: Began running node model.hospital_analytics.date_problems
[0m02:54:53.180021 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:54:53.182819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m02:54:53.184645 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m02:54:53.185820 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.date_problems)
[0m02:54:53.187294 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m02:54:53.189613 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m02:54:53.192494 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:54:53.194669 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:54:53.196751 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:54:53.208436 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:54:53.225943 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:54:53.232547 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:54:53.252181 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:54:53.254002 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m02:54:53.256255 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:53.259443 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:54:53.261713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:54:53.263550 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:54:53.270213 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:54:53.286661 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:54:53.282852 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m02:54:53.284480 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:54:53.276210 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.date_problems
[0m02:54:53.288479 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m02:54:53.290655 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:54:53.293092 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:54:53.299562 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:54:53.302439 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:54:53.304555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m02:54:53.306408 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m02:54:53.307705 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:54:53.357578 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m02:54:53.346531 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:54:53.355254 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m02:54:53.324391 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:54:53.359301 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:54:53.378603 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m02:54:53.386484 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:54:53.393450 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m02:54:53.419005 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m02:54:53.421347 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:54:53.423366 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:53.426756 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:54:53.429483 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:54:53.431085 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:54:53.442785 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:54:53.444139 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:54:53.449196 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:54:53.452406 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:54:53.454319 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:54:53.461703 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:54:53.478976 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:54:53.477451 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:54:53.481266 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m02:54:53.492107 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:54:53.484314 [debug] [Thread-3 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:54:53.489081 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:54:53.486768 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.visits_enhanced)
[0m02:54:53.510685 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m02:54:53.512156 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:54:53.513903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m02:54:53.515429 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:54:53.517234 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:54:53.520051 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:54:53.521534 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:54:53.550051 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:54:53.558960 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m02:54:53.571324 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m02:54:53.573185 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:53.575837 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:54:53.578707 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:54:53.580605 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:54:53.582606 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:54:53.589850 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:54:53.591495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:54:53.598331 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:54:53.600044 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:54:53.609112 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:54:53.616369 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:54:53.619902 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:54:53.622852 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.billing_enhanced)
[0m02:54:53.624541 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:54:53.631467 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:54:53.634434 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:54:53.636841 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now model.hospital_analytics.doctor_performance)
[0m02:54:53.638523 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:54:53.642966 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:54:53.645906 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now model.hospital_analytics.monthly_visit_stats)
[0m02:54:53.648430 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:54:53.650206 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m02:54:53.668394 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:54:53.661199 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:54:53.666682 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:54:53.653447 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:54:53.680118 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m02:54:53.681785 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:53.689797 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:54:53.693798 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:54:53.694949 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:54:53.700324 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:54:53.701707 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:54:53.704103 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:54:53.705533 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:54:53.706975 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:54:53.714626 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:54:53.719142 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:54:53.721310 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:54:53.723044 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m02:54:53.724730 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:54:53.725673 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m02:54:53.727147 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:54:53.735119 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:54:53.736797 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m02:54:53.751849 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:54:53.748376 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m02:54:53.749872 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:54:53.737951 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_journey)
[0m02:54:53.763216 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m02:54:53.765352 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:54:53.767296 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m02:54:53.768254 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:54:53.769957 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:54:53.779783 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:54:53.782697 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:54:53.793679 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:54:53.992298 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:54:53.976700 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:54:53.988585 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:54:53.974942 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:54:53.994227 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:54:54.008986 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:54:54.017801 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:54:54.021455 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:54:54.023357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:54:54.031376 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:54:54.038180 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:54:54.039670 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m02:54:54.040801 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m02:54:54.041892 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:54:54.043741 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:54:54.064590 [debug] [MainThread]: Command end result
[0m02:54:54.353371 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:54:54.362448 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:54:54.391831 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:54:54.409677 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m02:54:54.411310 [info ] [MainThread]: Building catalog
[0m02:54:54.433101 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:54:54.435457 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:54:54.439245 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:54:54.453687 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:54:54.620738 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:54:54.636529 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:54:54.639438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:54.628487 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:54:54.654987 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:54:54.663557 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:54.671742 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:54.694043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:54:55.472317 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:364d2003-ed4e-4de9-948d-0227f83bf872&page=queryresults
[0m02:54:55.485235 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:aaa36259-05b4-48dc-b4f8-1b6b3fbbd831&page=queryresults
[0m02:54:55.491272 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4cd21ef8-3a94-48ee-a9a6-1e371d39cc2b&page=queryresults
[0m02:54:55.516244 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ac6bb731-08c8-45af-a26c-8834b11b9b73&page=queryresults
[0m02:54:57.143584 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:54:57.200788 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m02:54:57.279598 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:54:57.284439 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:54:57.285586 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m02:54:57.293439 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.559175, "process_in_blocks": "3408", "process_kernel_time": 1.680285, "process_mem_max_rss": "208596", "process_out_blocks": "6136", "process_user_time": 10.819763}
[0m02:54:57.296202 [debug] [MainThread]: Command `dbt docs generate` succeeded at 02:54:57.295612 after 9.57 seconds
[0m02:54:57.297944 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m02:54:57.299062 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:54:57.300012 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:54:57.301160 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:54:57.302195 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:54:57.303512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e12ec5100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712e119ae210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712df2b49160>]}
[0m02:54:57.304941 [debug] [MainThread]: Flushing usage events
[0m02:54:58.686335 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:55:08.554689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70634fe06660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70634f490410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70634fe051f0>]}


============================== 02:55:08.566337 | 0914e39a-369e-4f32-a86c-e6a3223686f8 ==============================
[0m02:55:08.566337 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:55:08.568614 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt docs serve', 'send_anonymous_usage_stats': 'True'}
[0m02:55:11.582700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0914e39a-369e-4f32-a86c-e6a3223686f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70632a367920>]}
[0m02:55:11.779402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0914e39a-369e-4f32-a86c-e6a3223686f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70632a1ea690>]}
[0m02:55:48.463568 [error] [MainThread]: Encountered an error:

[0m02:55:48.480949 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m02:55:48.485465 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 40.22067, "process_in_blocks": "368", "process_kernel_time": 1.067954, "process_mem_max_rss": "197832", "process_out_blocks": "3520", "process_user_time": 7.426824}
[0m02:55:48.487677 [debug] [MainThread]: Command `dbt docs serve` failed at 02:55:48.487284 after 40.22 seconds
[0m02:55:48.489372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70634e3bb380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70634e1effb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70632bafb0b0>]}
[0m02:55:48.490653 [debug] [MainThread]: Flushing usage events
[0m02:55:49.957431 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:56:23.213606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932133af8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793212f090d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793212c9af90>]}


============================== 02:56:23.224781 | a0769caa-5318-492f-977a-979fae0c3ab7 ==============================
[0m02:56:23.224781 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:56:23.227295 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs serve --port 8089', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:56:26.192040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0769caa-5318-492f-977a-979fae0c3ab7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793212769ac0>]}
[0m02:56:26.393968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a0769caa-5318-492f-977a-979fae0c3ab7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793214434d70>]}
[0m02:56:52.159589 [error] [MainThread]: Encountered an error:

[0m02:56:52.167323 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m02:56:52.172666 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 29.259846, "process_in_blocks": "0", "process_kernel_time": 1.10795, "process_mem_max_rss": "196260", "process_out_blocks": "3368", "process_user_time": 7.609789}
[0m02:56:52.174981 [debug] [MainThread]: Command `dbt docs serve` failed at 02:56:52.174284 after 29.26 seconds
[0m02:56:52.176423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7932130c7b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931ee85bbc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7931ee6cf4d0>]}
[0m02:56:52.178073 [debug] [MainThread]: Flushing usage events
[0m02:56:54.169681 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:57:09.442960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76306a9430b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76306b8353a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76306ac848c0>]}


============================== 02:57:09.453914 | 37fe3427-47a4-492b-a100-d86515b6e0e2 ==============================
[0m02:57:09.453914 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:57:09.455807 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8086', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:57:12.381514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '37fe3427-47a4-492b-a100-d86515b6e0e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76306c257980>]}
[0m02:57:12.601299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '37fe3427-47a4-492b-a100-d86515b6e0e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x763047521a30>]}
[0m02:57:44.194482 [error] [MainThread]: Encountered an error:

[0m02:57:44.204308 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m02:57:44.209058 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 35.077255, "process_in_blocks": "0", "process_kernel_time": 1.218678, "process_mem_max_rss": "196644", "process_out_blocks": "3368", "process_user_time": 7.40697}
[0m02:57:44.211272 [debug] [MainThread]: Command `dbt docs serve` failed at 02:57:44.210807 after 35.08 seconds
[0m02:57:44.212567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76306c4e4b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7630464da060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76306a87c500>]}
[0m02:57:44.213942 [debug] [MainThread]: Flushing usage events
[0m02:57:45.697106 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:57:56.056217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ec90f24e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ec8b93290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ec90f0f20>]}


============================== 02:57:56.068134 | 6a8576e5-b0bc-401d-a413-a8d1e901c3d2 ==============================
[0m02:57:56.068134 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:57:56.070728 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:57:59.110119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6a8576e5-b0bc-401d-a413-a8d1e901c3d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ec9092000>]}
[0m02:57:59.322994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6a8576e5-b0bc-401d-a413-a8d1e901c3d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ea8a05eb0>]}
[0m02:58:21.496462 [error] [MainThread]: Encountered an error:

[0m02:58:21.502850 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m02:58:21.507536 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 25.762411, "process_in_blocks": "0", "process_kernel_time": 1.227748, "process_mem_max_rss": "196132", "process_out_blocks": "3360", "process_user_time": 7.548455}
[0m02:58:21.510138 [debug] [MainThread]: Command `dbt docs serve` failed at 02:58:21.509557 after 25.77 seconds
[0m02:58:21.511621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ec8f031a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ec88f5ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789ea8ace660>]}
[0m02:58:21.513178 [debug] [MainThread]: Flushing usage events
[0m02:58:23.071797 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:58:38.610273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e3a308200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e3a92aae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e3a09e540>]}


============================== 02:58:38.620819 | f2b4a8c9-9f97-4ce9-becc-1f49172577e7 ==============================
[0m02:58:38.620819 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:58:38.623079 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:58:41.500614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2b4a8c9-9f97-4ce9-becc-1f49172577e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e3a9293d0>]}
[0m02:58:41.698156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2b4a8c9-9f97-4ce9-becc-1f49172577e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e160a7a40>]}
[0m02:58:41.700232 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m02:58:42.433377 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m02:58:42.857895 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:58:42.859212 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:58:43.005990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2b4a8c9-9f97-4ce9-becc-1f49172577e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e15e543b0>]}
[0m02:58:43.055098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2b4a8c9-9f97-4ce9-becc-1f49172577e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e159c6ae0>]}
[0m02:58:43.057122 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m02:58:43.058607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2b4a8c9-9f97-4ce9-becc-1f49172577e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e15c233b0>]}
[0m02:58:43.067438 [info ] [MainThread]: 
[0m02:58:43.069005 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m02:58:43.070287 [info ] [MainThread]: 
[0m02:58:43.072094 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:58:43.087337 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m02:58:43.091236 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m02:58:43.093136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:43.097814 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m02:58:43.099355 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:43.192249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:43.776458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2b4a8c9-9f97-4ce9-becc-1f49172577e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e15caa360>]}
[0m02:58:43.778637 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:58:43.794914 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m02:58:43.797065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m02:58:43.798691 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m02:58:43.808256 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m02:58:43.811374 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m02:58:43.813703 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m02:58:43.816837 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m02:58:43.824837 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m02:58:43.862629 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m02:58:43.859258 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m02:58:43.856268 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m02:58:43.857185 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m02:58:43.864221 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m02:58:43.866106 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m02:58:43.870630 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m02:58:43.881347 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m02:58:43.888630 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m02:58:43.896135 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:43.903815 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:43.905716 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m02:58:43.908604 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m02:58:43.915815 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m02:58:43.925336 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m02:58:43.927780 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:58:43.929635 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m02:58:43.933521 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m02:58:43.942398 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:58:43.946124 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m02:58:43.948581 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m02:58:43.950536 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m02:58:43.958519 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m02:58:43.960533 [debug] [Thread-4 (]: Began running node model.hospital_analytics.date_problems
[0m02:58:43.962297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m02:58:43.965118 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m02:58:43.966824 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m02:58:43.968465 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.date_problems)
[0m02:58:43.970226 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m02:58:43.980801 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m02:58:43.982954 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m02:58:43.984486 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.date_problems
[0m02:58:43.993562 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m02:58:43.996103 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m02:58:43.998209 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m02:58:44.006402 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m02:58:44.009674 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:44.020189 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m02:58:44.022252 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:44.030765 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m02:58:44.032106 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:58:44.039807 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m02:58:44.042385 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m02:58:44.044657 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:58:44.051390 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.date_problems
[0m02:58:44.054049 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:58:44.056082 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:58:44.058464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m02:58:44.060421 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:58:44.062311 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m02:58:44.065054 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:58:44.071379 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m02:58:44.083740 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:58:44.074482 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:58:44.072996 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m02:58:44.085959 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m02:58:44.137992 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:58:44.147178 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m02:58:44.151166 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m02:58:44.153267 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:58:44.166184 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m02:58:44.169648 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:58:44.171409 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:58:44.191611 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:44.195666 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m02:58:44.197263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:44.203246 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m02:58:44.205331 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:58:44.208340 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:58:44.209613 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m02:58:44.215893 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m02:58:44.218083 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:58:44.219755 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:58:44.228614 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.prescriptions_enhanced)
[0m02:58:44.230661 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m02:58:44.240219 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m02:58:44.246422 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m02:58:44.248173 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m02:58:44.249616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.visits_enhanced)
[0m02:58:44.251546 [debug] [Thread-4 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:58:44.254246 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:58:44.267348 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m02:58:44.269263 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m02:58:44.271474 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m02:58:44.273474 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m02:58:44.282513 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m02:58:44.287679 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m02:58:44.289574 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:58:44.292122 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:58:44.294648 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:44.315252 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m02:58:44.333204 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m02:58:44.344901 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m02:58:44.346542 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m02:58:44.348489 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:44.352320 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:58:44.361089 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m02:58:44.363295 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:58:44.367959 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:58:44.379994 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:58:44.382293 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m02:58:44.384591 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m02:58:44.386632 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m02:58:44.393465 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m02:58:44.395205 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.billing_enhanced)
[0m02:58:44.397281 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m02:58:44.400736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m02:58:44.403175 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:58:44.405503 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m02:58:44.408104 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now model.hospital_analytics.monthly_visit_stats)
[0m02:58:44.410592 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m02:58:44.412327 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m02:58:44.424714 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m02:58:44.427357 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m02:58:44.435937 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:58:44.442975 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m02:58:44.455027 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m02:58:44.457028 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m02:58:44.467370 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m02:58:44.471418 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m02:58:44.473732 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:44.475379 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m02:58:44.477113 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:44.479079 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:58:44.487106 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m02:58:44.488709 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:58:44.495070 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m02:58:44.497276 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:58:44.498946 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:58:44.512394 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m02:58:44.506742 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m02:58:44.509338 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:58:44.514528 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:58:44.517813 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m02:58:44.524267 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m02:58:44.526316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m02:58:44.540805 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m02:58:44.542565 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_journey)
[0m02:58:44.543987 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m02:58:44.546977 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:58:44.548965 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m02:58:44.551358 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:58:44.553162 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m02:58:44.573687 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m02:58:44.789982 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:44.792111 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m02:58:44.808479 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m02:58:44.815914 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m02:58:44.831166 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m02:58:44.833835 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:58:44.836447 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m02:58:44.839999 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:44.843540 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m02:58:44.845100 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m02:58:44.848285 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:58:44.861238 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m02:58:44.857764 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m02:58:44.873307 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m02:58:44.880338 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:58:44.881595 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m02:58:44.882530 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m02:58:44.883808 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m02:58:44.885081 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m02:58:44.899002 [debug] [MainThread]: Command end result
[0m02:58:45.185629 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:58:45.195415 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:58:45.219425 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m02:58:45.232755 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m02:58:45.234350 [info ] [MainThread]: Building catalog
[0m02:58:45.257800 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:58:45.260716 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:58:45.277573 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:58:45.290165 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m02:58:45.413676 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:58:45.417666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:45.447756 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:58:45.462563 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:58:45.465213 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m02:58:45.569156 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:45.575075 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:45.578001 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:46.435578 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e9c1c4f4-17f5-4632-92bc-962eb1f261b4&page=queryresults
[0m02:58:46.451144 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:292a36b2-0983-4cef-9885-1ee49162e188&page=queryresults
[0m02:58:46.458630 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c4c6f2e8-ce99-479a-a5eb-878df97eeeb9&page=queryresults
[0m02:58:46.506528 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5c57ef1f-2030-4eb9-9187-418cdafc24e1&page=queryresults
[0m02:58:47.833696 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:58:47.887083 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m02:58:47.967637 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m02:58:47.973289 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m02:58:47.974770 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m02:58:47.979161 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.65992, "process_in_blocks": "0", "process_kernel_time": 1.668164, "process_mem_max_rss": "208980", "process_out_blocks": "6144", "process_user_time": 11.273594}
[0m02:58:47.981446 [debug] [MainThread]: Command `dbt docs generate` succeeded at 02:58:47.981025 after 9.66 seconds
[0m02:58:47.983522 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m02:58:47.984641 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:58:47.986124 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:58:47.987415 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:58:47.988544 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m02:58:47.990093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e39ea7ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e15f3c260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e15aa6c90>]}
[0m02:58:47.991473 [debug] [MainThread]: Flushing usage events
[0m02:58:49.510998 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:59:08.984014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c5a86f2480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c5a6c37650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c5a7062120>]}


============================== 02:59:08.993907 | 475e040f-c5a6-4f26-9dd3-1f493cfbd106 ==============================
[0m02:59:08.993907 [info ] [MainThread]: Running with dbt=1.9.0
[0m02:59:08.995798 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs serve --port 8087', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:59:11.782153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '475e040f-c5a6-4f26-9dd3-1f493cfbd106', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c58ef8a0c0>]}
[0m02:59:11.976578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '475e040f-c5a6-4f26-9dd3-1f493cfbd106', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c582b4a9f0>]}
[0m03:00:43.903685 [error] [MainThread]: Encountered an error:

[0m03:00:43.916245 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m03:00:43.921395 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 95.22981, "process_in_blocks": "0", "process_kernel_time": 1.094416, "process_mem_max_rss": "196012", "process_out_blocks": "3368", "process_user_time": 7.189752}
[0m03:00:43.924043 [debug] [MainThread]: Command `dbt docs serve` failed at 03:00:43.923545 after 95.23 seconds
[0m03:00:43.925644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c5a74be7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c58334a510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c582aecb60>]}
[0m03:00:43.928442 [debug] [MainThread]: Flushing usage events
[0m03:00:45.442485 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:00:56.975777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765e1ac564b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765e1aa20800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765e197c8c20>]}


============================== 03:00:56.987128 | 59f47e75-970a-4a8d-882e-bfc2659c58b0 ==============================
[0m03:00:56.987128 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:00:56.989211 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs serve', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:00:59.882542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59f47e75-970a-4a8d-882e-bfc2659c58b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765dfa035af0>]}
[0m03:01:00.088596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59f47e75-970a-4a8d-882e-bfc2659c58b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765df91c29f0>]}
[0m03:09:15.272999 [error] [MainThread]: Encountered an error:

[0m03:09:15.285231 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m03:09:15.293659 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 498.62155, "process_in_blocks": "0", "process_kernel_time": 1.146059, "process_mem_max_rss": "196516", "process_out_blocks": "3368", "process_user_time": 7.587534}
[0m03:09:15.296448 [debug] [MainThread]: Command `dbt docs serve` failed at 03:09:15.296042 after 498.62 seconds
[0m03:09:15.298055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765e19a16f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765e1951e2a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765df8eb64e0>]}
[0m03:09:15.299367 [debug] [MainThread]: Flushing usage events
[0m03:09:17.133733 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:21:14.177068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe678ccf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe68cd4530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe671b91c0>]}


============================== 03:21:14.191604 | 0f6975fa-2665-4313-a971-a86fee0deae1 ==============================
[0m03:21:14.191604 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:21:14.194304 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt docs serve', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:21:17.112061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0f6975fa-2665-4313-a971-a86fee0deae1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe4332a3c0>]}
[0m03:21:17.317197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0f6975fa-2665-4313-a971-a86fee0deae1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe43404590>]}
[0m03:22:22.715517 [error] [MainThread]: Encountered an error:

[0m03:22:22.721802 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m03:22:22.738787 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 68.84834, "process_in_blocks": "0", "process_kernel_time": 1.15862, "process_mem_max_rss": "197456", "process_out_blocks": "3368", "process_user_time": 7.399255}
[0m03:22:22.742180 [debug] [MainThread]: Command `dbt docs serve` failed at 03:22:22.741706 after 68.86 seconds
[0m03:22:22.743421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe674c0ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe42f2bad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fe42ce3110>]}
[0m03:22:22.744920 [debug] [MainThread]: Flushing usage events
[0m03:22:24.267715 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:46:14.071760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda28aef800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda2a61c530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda28b21580>]}


============================== 03:46:14.096972 | 1ee4321d-dc06-44f9-8d19-27cca60ff58c ==============================
[0m03:46:14.096972 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:46:14.098902 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt docs generate', 'send_anonymous_usage_stats': 'True'}
[0m03:46:14.115575 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m03:46:14.117554 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!
[0m03:46:14.123140 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": false, "command_wall_clock_time": 0.339781, "process_in_blocks": "752", "process_kernel_time": 0.716692, "process_mem_max_rss": "86480", "process_out_blocks": "64", "process_user_time": 4.359046}
[0m03:46:14.125152 [debug] [MainThread]: Command `dbt docs generate` failed at 03:46:14.124750 after 0.34 seconds
[0m03:46:14.126453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda286b9be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda28e66240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda2862ecc0>]}
[0m03:46:14.127575 [debug] [MainThread]: Flushing usage events
[0m03:46:15.636553 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:46:30.307049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d20f2a26c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d20eddbb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d2102f6510>]}


============================== 03:46:30.317524 | cb5c0874-2fcd-4de4-8d36-948e19a23c7f ==============================
[0m03:46:30.317524 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:46:30.319798 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:46:30.338021 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m03:46:30.339738 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!
[0m03:46:30.343656 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 0.32265407, "process_in_blocks": "0", "process_kernel_time": 0.670222, "process_mem_max_rss": "85916", "process_out_blocks": "8", "process_user_time": 4.310586}
[0m03:46:30.345800 [debug] [MainThread]: Command `dbt docs serve` failed at 03:46:30.345036 after 0.33 seconds
[0m03:46:30.347388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d20ebeebd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d20eddbb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d20ec1a600>]}
[0m03:46:30.348573 [debug] [MainThread]: Flushing usage events
[0m03:46:31.813724 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:46:57.513644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f794fef23f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f794fb18320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7950aa6570>]}


============================== 03:46:57.524360 | f636059c-8ff4-4929-a2b3-bc1f4a67d8ea ==============================
[0m03:46:57.524360 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:46:57.526343 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:46:57.611168 [info ] [MainThread]: dbt version: 1.9.0
[0m03:46:57.612475 [info ] [MainThread]: python version: 3.12.4
[0m03:46:57.613894 [info ] [MainThread]: python path: /usr/local/bin/python
[0m03:46:57.615101 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m03:46:57.635157 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m03:46:57.636983 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m03:46:57.638317 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m03:46:57.639588 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m03:46:57.959014 [info ] [MainThread]: Configuration:
[0m03:46:57.960431 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m03:46:57.961992 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m03:46:57.963469 [info ] [MainThread]: Required dependencies:
[0m03:46:57.964985 [debug] [MainThread]: Executing "git --help"
[0m03:46:58.024117 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m03:46:58.025802 [debug] [MainThread]: STDERR: "b''"
[0m03:46:58.027277 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m03:46:58.028642 [info ] [MainThread]: Connection test skipped since no profile was found
[0m03:46:58.029788 [info ] [MainThread]: [31m1 check failed:[0m
[0m03:46:58.031277 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!


[0m03:46:58.035503 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.8173759, "process_in_blocks": "1272", "process_kernel_time": 0.685392, "process_mem_max_rss": "88076", "process_out_blocks": "24", "process_user_time": 4.634653}
[0m03:46:58.037638 [debug] [MainThread]: Command `dbt debug` failed at 03:46:58.037283 after 0.82 seconds
[0m03:46:58.039476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f794fef23f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f794fcf35c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7950068bc0>]}
[0m03:46:58.040915 [debug] [MainThread]: Flushing usage events
[0m03:46:59.504482 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:50:22.056319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7324707abb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7324705e6a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732470df9160>]}


============================== 03:50:22.067058 | f493f8b7-84bb-4c4b-83f9-a6dcb412f5e1 ==============================
[0m03:50:22.067058 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:50:22.069182 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m03:50:22.104628 [info ] [MainThread]: dbt version: 1.9.0
[0m03:50:22.106107 [info ] [MainThread]: python version: 3.12.4
[0m03:50:22.107593 [info ] [MainThread]: python path: /usr/local/bin/python
[0m03:50:22.108961 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m03:50:24.565845 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m03:50:24.567761 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m03:50:24.568947 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m03:50:24.570646 [info ] [MainThread]: adapter type: bigquery
[0m03:50:24.572057 [info ] [MainThread]: adapter version: 1.9.1
[0m03:50:24.883069 [info ] [MainThread]: Configuration:
[0m03:50:24.884647 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m03:50:24.886260 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m03:50:24.887725 [info ] [MainThread]: Required dependencies:
[0m03:50:24.889719 [debug] [MainThread]: Executing "git --help"
[0m03:50:24.900362 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m03:50:24.902806 [debug] [MainThread]: STDERR: "b''"
[0m03:50:24.903737 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m03:50:24.905658 [info ] [MainThread]: Connection:
[0m03:50:24.907199 [info ] [MainThread]:   method: service-account
[0m03:50:24.908512 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m03:50:24.909783 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m03:50:24.910564 [info ] [MainThread]:   schema: hospital
[0m03:50:24.911691 [info ] [MainThread]:   location: asia-southeast2
[0m03:50:24.913214 [info ] [MainThread]:   priority: interactive
[0m03:50:24.914514 [info ] [MainThread]:   maximum_bytes_billed: None
[0m03:50:24.915650 [info ] [MainThread]:   impersonate_service_account: None
[0m03:50:24.916940 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m03:50:24.918332 [info ] [MainThread]:   job_retries: 1
[0m03:50:24.919462 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m03:50:24.921007 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m03:50:24.922327 [info ] [MainThread]:   timeout_seconds: 300
[0m03:50:24.923714 [info ] [MainThread]:   client_id: None
[0m03:50:24.925178 [info ] [MainThread]:   token_uri: None
[0m03:50:24.926288 [info ] [MainThread]:   dataproc_region: None
[0m03:50:24.927521 [info ] [MainThread]:   dataproc_cluster_name: None
[0m03:50:24.928556 [info ] [MainThread]:   gcs_bucket: None
[0m03:50:24.929968 [info ] [MainThread]:   dataproc_batch: None
[0m03:50:24.931441 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m03:50:25.641759 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m03:50:25.643124 [debug] [MainThread]: On debug: select 1 as id
[0m03:50:25.643845 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:50:26.289736 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9d6eae74-1172-4196-bf7a-d8dbc17685e5&page=queryresults
[0m03:50:26.802179 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m03:50:26.804273 [info ] [MainThread]: [32mAll checks passed![0m
[0m03:50:26.808452 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.0359116, "process_in_blocks": "2344", "process_kernel_time": 1.440065, "process_mem_max_rss": "202352", "process_out_blocks": "48", "process_user_time": 7.668723}
[0m03:50:26.810385 [debug] [MainThread]: Command `dbt debug` succeeded at 03:50:26.809986 after 5.04 seconds
[0m03:50:26.811737 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m03:50:26.813266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732470683560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732472991760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732470df9160>]}
[0m03:50:26.815011 [debug] [MainThread]: Flushing usage events
[0m03:50:28.327462 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:50:42.363787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393aeb4500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393adb18b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393c3cdaf0>]}


============================== 03:50:42.374601 | dbe24ea6-b8ad-4dde-b2cc-9ba372873324 ==============================
[0m03:50:42.374601 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:50:42.377062 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:50:45.381090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393b3b5fd0>]}
[0m03:50:45.576948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3916b5f530>]}
[0m03:50:45.579606 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m03:50:46.275565 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m03:50:46.855753 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:50:46.857339 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:50:47.008617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3916963500>]}
[0m03:50:47.287618 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m03:50:47.297079 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m03:50:47.386051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3916a226f0>]}
[0m03:50:47.388135 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m03:50:47.389709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3916963dd0>]}
[0m03:50:47.397706 [info ] [MainThread]: 
[0m03:50:47.399280 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m03:50:47.401257 [info ] [MainThread]: 
[0m03:50:47.403621 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m03:50:47.419521 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m03:50:47.422780 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m03:50:47.424341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:50:47.426665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:50:47.428698 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m03:50:47.515952 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:50:48.946782 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m03:50:48.948554 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:50:48.951594 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m03:50:49.035045 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:50:49.041064 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m03:50:49.119365 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:50:49.848715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3916514f80>]}
[0m03:50:49.850816 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:50:49.868264 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m03:50:49.871456 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m03:50:49.874772 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m03:50:49.870400 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m03:50:49.886660 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m03:50:49.884914 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m03:50:49.888116 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m03:50:49.873220 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m03:50:49.882714 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m03:50:49.894349 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m03:50:49.907282 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m03:50:49.932911 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m03:50:49.942017 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m03:50:49.944735 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m03:50:49.946938 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m03:50:49.948584 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m03:50:49.950749 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m03:50:49.952768 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m03:50:49.964765 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m03:50:49.979787 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m03:50:50.000371 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m03:50:49.999516 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m03:50:50.045038 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m03:50:50.053324 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m03:50:50.252924 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:50:50.329402 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m03:50:50.336829 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m03:50:50.342571 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m03:50:50.420750 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m03:50:50.427158 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:50:50.431480 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m03:50:50.434627 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m03:50:50.515773 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:50:50.520108 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:50:51.113562 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m03:50:51.116313 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m03:50:51.257724 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f3e1710e-04d1-43c4-911c-3579764b3cbb&page=queryresults
[0m03:50:51.275618 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:776e0a0c-02bc-466b-ab4d-3ea3e63db801&page=queryresults
[0m03:50:51.296716 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:742cbb76-eed3-454b-b46e-b8765b8eec5a&page=queryresults
[0m03:50:51.377353 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b04c3a06-d5d6-464f-bf29-ce5240ed83e9&page=queryresults
[0m03:50:52.038500 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d391654bd40>]}
[0m03:50:52.040965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393b34e270>]}
[0m03:50:52.043320 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.09s]
[0m03:50:52.050919 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m03:50:52.045473 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.14s]
[0m03:50:52.056640 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3916c67b60>]}
[0m03:50:52.061577 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m03:50:52.068476 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.13s]
[0m03:50:52.071803 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m03:50:52.076774 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m03:50:52.081307 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m03:50:52.078743 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m03:50:52.082562 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m03:50:52.084500 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m03:50:52.086212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m03:50:52.100714 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m03:50:52.098316 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m03:50:52.104830 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m03:50:52.106671 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m03:50:52.114852 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m03:50:52.122387 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:50:52.127680 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m03:50:52.141692 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m03:50:52.151802 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m03:50:52.167106 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m03:50:52.165003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:50:52.177517 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m03:50:52.154378 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m03:50:52.169000 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m03:50:52.187572 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m03:50:52.189725 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m03:50:52.198679 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:50:52.213276 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m03:50:52.317043 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m03:50:52.327445 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:50:52.768401 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m03:50:52.772560 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m03:50:52.798647 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m03:50:52.801616 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m03:50:53.164594 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d39146c71d0>]}
[0m03:50:53.167046 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.22s]
[0m03:50:53.177134 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m03:50:53.385949 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:faa07b11-ef21-49ac-894c-f36b1c5d8374&page=queryresults
[0m03:50:53.477451 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4f52638f-d591-4fda-8c03-e31794c8aa8c&page=queryresults
[0m03:50:54.831453 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3914633ad0>]}
[0m03:50:54.833826 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.72s]
[0m03:50:54.838810 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m03:50:55.017133 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d39164e9010>]}
[0m03:50:55.020139 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.83s]
[0m03:50:55.024011 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m03:50:55.028664 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m03:50:55.033331 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m03:50:55.031235 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m03:50:55.038726 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m03:50:55.041681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m03:50:55.044652 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m03:50:55.046269 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m03:50:55.047953 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m03:50:55.073486 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m03:50:55.086682 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m03:50:55.090124 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m03:50:55.098277 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m03:50:55.103535 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:50:55.120626 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:50:55.710704 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m03:50:55.713987 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m03:50:55.747825 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m03:50:55.751919 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m03:50:56.014757 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6dc023a8-8ade-4ffe-a479-09c8c959a2f6&page=queryresults
[0m03:50:56.021189 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:026b6dab-cb8c-4a9f-81e3-09b1dc816eda&page=queryresults
[0m03:50:57.690025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3914630b00>]}
[0m03:50:57.693536 [info ] [Thread-1 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.65s]
[0m03:50:57.696484 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m03:50:57.757274 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d39146faff0>]}
[0m03:50:57.762361 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.71s]
[0m03:50:57.767561 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m03:50:57.777380 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m03:50:57.780463 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m03:50:57.786558 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m03:50:57.783751 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m03:50:57.795794 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m03:50:57.799588 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m03:50:57.788986 [info ] [Thread-2 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m03:50:57.792745 [info ] [Thread-1 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m03:50:57.829886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m03:50:57.827872 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m03:50:57.817427 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m03:50:57.833326 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m03:50:57.831512 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m03:50:57.855984 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m03:50:57.858291 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m03:50:57.874060 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m03:50:57.866655 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m03:50:57.880899 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:50:57.887440 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:50:58.000573 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m03:50:58.086117 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:50:58.540549 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m03:50:58.544361 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m03:50:58.551702 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m03:50:58.561821 [debug] [Thread-2 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m03:50:58.575447 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m03:50:58.578588 [debug] [Thread-1 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m03:50:58.799817 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9a53de09-d0a6-45fe-8dce-0e0b813ef29b&page=queryresults
[0m03:50:58.834987 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:59203d80-732f-47c9-bd85-b3876da3940a&page=queryresults
[0m03:50:58.871511 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7f252638-2e27-4292-a039-0fe455a0e695&page=queryresults
[0m03:51:00.348375 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d39146e3260>]}
[0m03:51:00.352752 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.55s]
[0m03:51:00.360037 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m03:51:00.363920 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m03:51:00.366042 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m03:51:00.368425 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m03:51:00.370051 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m03:51:00.372070 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m03:51:00.376209 [info ] [Thread-3 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m03:51:00.391305 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m03:51:00.393578 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m03:51:00.395447 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m03:51:00.404335 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m03:51:00.413518 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:51:00.425247 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m03:51:00.429037 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m03:51:00.521377 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:00.736847 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3914610500>]}
[0m03:51:00.739436 [info ] [Thread-2 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.92s]
[0m03:51:00.744760 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m03:51:00.753572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d39146e3ec0>]}
[0m03:51:00.759829 [info ] [Thread-1 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.92s]
[0m03:51:00.763347 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m03:51:00.986309 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m03:51:00.991189 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate some derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance
FROM visit_details vd
LEFT JOIN prescription_details pd 
  ON vd.patient_id = pd.patient_id 
  AND vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd 
  ON vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m03:51:00.998403 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m03:51:01.001363 [debug] [Thread-3 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m03:51:01.216138 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4f288483-db1c-47fd-aceb-a7558b78a5a7&page=queryresults
[0m03:51:01.246583 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a7563c37-2bb7-4cd1-aa0f-68a7de87fa19&page=queryresults
[0m03:51:02.944535 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d39145498e0>]}
[0m03:51:02.947318 [info ] [Thread-4 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (355.0 rows, 34.3 KiB processed)[0m in 2.58s]
[0m03:51:02.949688 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m03:51:02.985317 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbe24ea6-b8ad-4dde-b2cc-9ba372873324', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3914548980>]}
[0m03:51:02.987588 [info ] [Thread-3 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.59s]
[0m03:51:02.991728 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m03:51:03.002493 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m03:51:03.011170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:51:03.012494 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m03:51:03.013541 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m03:51:03.014527 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m03:51:03.015455 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m03:51:03.016929 [info ] [MainThread]: 
[0m03:51:03.018618 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.61 seconds (15.61s).
[0m03:51:03.029167 [debug] [MainThread]: Command end result
[0m03:51:03.119336 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m03:51:03.126413 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m03:51:03.148729 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m03:51:03.150018 [info ] [MainThread]: 
[0m03:51:03.151626 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:51:03.153260 [info ] [MainThread]: 
[0m03:51:03.154555 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m03:51:03.158639 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 21.091915, "process_in_blocks": "3552", "process_kernel_time": 1.847804, "process_mem_max_rss": "212244", "process_out_blocks": "2808", "process_user_time": 12.474414}
[0m03:51:03.160704 [debug] [MainThread]: Command `dbt run` succeeded at 03:51:03.160254 after 21.09 seconds
[0m03:51:03.162261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393a8812e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393c891040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d393c1e37d0>]}
[0m03:51:03.163498 [debug] [MainThread]: Flushing usage events
[0m03:51:04.592032 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:51:33.837207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754719cbf3e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75471b6747d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754719cbf5f0>]}


============================== 03:51:33.848348 | 81ae85e1-c49e-424e-9d49-d2722a14ea21 ==============================
[0m03:51:33.848348 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:51:33.850371 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:51:36.704486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '81ae85e1-c49e-424e-9d49-d2722a14ea21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546fa075160>]}
[0m03:51:36.897109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '81ae85e1-c49e-424e-9d49-d2722a14ea21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546fcf83ef0>]}
[0m03:51:36.899420 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m03:51:37.564146 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m03:51:37.959114 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:51:37.960429 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:51:38.114217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '81ae85e1-c49e-424e-9d49-d2722a14ea21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546fa0b1820>]}
[0m03:51:38.171825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '81ae85e1-c49e-424e-9d49-d2722a14ea21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546f941bad0>]}
[0m03:51:38.174030 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m03:51:38.175621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81ae85e1-c49e-424e-9d49-d2722a14ea21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546f9899d00>]}
[0m03:51:38.184409 [info ] [MainThread]: 
[0m03:51:38.186525 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m03:51:38.188127 [info ] [MainThread]: 
[0m03:51:38.190481 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m03:51:38.206206 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m03:51:38.207526 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:38.210229 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m03:51:38.213488 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m03:51:38.232776 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:38.311653 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:38.992092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81ae85e1-c49e-424e-9d49-d2722a14ea21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75471b530740>]}
[0m03:51:38.994032 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:51:39.009580 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m03:51:39.011303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m03:51:39.012662 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m03:51:39.014240 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m03:51:39.016768 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m03:51:39.018764 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m03:51:39.020253 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m03:51:39.039847 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m03:51:39.056353 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m03:51:39.057842 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m03:51:39.059559 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m03:51:39.061640 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m03:51:39.074423 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m03:51:39.075620 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m03:51:39.076828 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m03:51:39.091227 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m03:51:39.094452 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m03:51:39.103991 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m03:51:39.105654 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:51:39.108374 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:51:39.110592 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m03:51:39.120174 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m03:51:39.127351 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m03:51:39.129184 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:39.130994 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m03:51:39.133261 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:51:39.142640 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m03:51:39.144736 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m03:51:39.146211 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m03:51:39.162504 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m03:51:39.157690 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m03:51:39.159821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m03:51:39.155884 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m03:51:39.163956 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m03:51:39.165653 [debug] [Thread-4 (]: Began running node model.hospital_analytics.medicines
[0m03:51:39.168404 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m03:51:39.170671 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m03:51:39.180269 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m03:51:39.196352 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:51:39.191458 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m03:51:39.194013 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m03:51:39.183526 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.medicines)
[0m03:51:39.203005 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m03:51:39.212271 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m03:51:39.215081 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.medicines
[0m03:51:39.217800 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:51:39.219734 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m03:51:39.229560 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m03:51:39.234826 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m03:51:39.242665 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m03:51:39.244937 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m03:51:39.246430 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:39.248616 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.medicines
[0m03:51:39.251616 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m03:51:39.253910 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m03:51:39.260765 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m03:51:39.262848 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:51:39.264358 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m03:51:39.285586 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m03:51:39.306249 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m03:51:39.308499 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m03:51:39.317305 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.medicines
[0m03:51:39.319029 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m03:51:39.329953 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m03:51:39.331830 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m03:51:39.333250 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m03:51:39.335638 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m03:51:39.337698 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m03:51:39.338965 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m03:51:39.346495 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:51:39.352739 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m03:51:39.354787 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m03:51:39.357422 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:51:39.364327 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m03:51:39.378572 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m03:51:39.385047 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m03:51:39.398924 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m03:51:39.390594 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:39.396111 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m03:51:39.387271 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m03:51:39.400154 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:51:39.402384 [debug] [Thread-1 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m03:51:39.408337 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m03:51:39.423365 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m03:51:39.416685 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m03:51:39.422156 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m03:51:39.409124 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.visits_enhanced)
[0m03:51:39.429506 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m03:51:39.426376 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m03:51:39.428169 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m03:51:39.424716 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m03:51:39.449169 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now model.hospital_analytics.prescriptions_enhanced)
[0m03:51:39.468374 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m03:51:39.476697 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m03:51:39.478516 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m03:51:39.480227 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m03:51:39.488925 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m03:51:39.503281 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m03:51:39.506043 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m03:51:39.494992 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m03:51:39.508964 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:51:39.511645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:51:39.512305 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m03:51:39.525425 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m03:51:39.526659 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m03:51:39.528464 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m03:51:39.529783 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:51:39.533695 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:39.537012 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m03:51:39.535488 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m03:51:39.542663 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m03:51:39.544998 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now model.hospital_analytics.monthly_visit_stats)
[0m03:51:39.550750 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m03:51:39.552469 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.billing_enhanced)
[0m03:51:39.555091 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m03:51:39.557384 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m03:51:39.559165 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m03:51:39.560722 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m03:51:39.562539 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m03:51:39.571118 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m03:51:39.575267 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m03:51:39.587319 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m03:51:39.588204 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m03:51:39.589181 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m03:51:39.596605 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m03:51:39.600610 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m03:51:39.614072 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m03:51:39.615820 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:51:39.617322 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m03:51:39.619942 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:51:39.622395 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m03:51:39.631085 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m03:51:39.637385 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m03:51:39.639340 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:51:39.640955 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m03:51:39.642987 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:39.644703 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m03:51:39.648609 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m03:51:39.655571 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m03:51:39.662502 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m03:51:39.664412 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m03:51:39.666786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.doctor_performance)
[0m03:51:39.668759 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m03:51:39.671713 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m03:51:39.673356 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m03:51:39.675239 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m03:51:39.676547 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c, now model.hospital_analytics.patient_journey)
[0m03:51:39.677923 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m03:51:39.688154 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m03:51:39.704471 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m03:51:39.706268 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m03:51:39.707786 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m03:51:39.718332 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m03:51:39.877510 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m03:51:39.893555 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m03:51:39.895320 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:51:39.901388 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m03:51:39.903442 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:51:39.910747 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m03:51:39.913189 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m03:51:39.924528 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:51:39.923127 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m03:51:39.915254 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m03:51:39.930276 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m03:51:39.932601 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:51:39.938982 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m03:51:39.946659 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:51:39.948045 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m03:51:39.949661 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m03:51:39.950747 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m03:51:39.952115 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m03:51:39.966164 [debug] [MainThread]: Command end result
[0m03:51:40.242758 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m03:51:40.251124 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m03:51:40.273518 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m03:51:40.294215 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m03:51:40.295765 [info ] [MainThread]: Building catalog
[0m03:51:40.317730 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m03:51:40.330704 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m03:51:40.346097 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m03:51:40.406782 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m03:51:40.544535 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m03:51:40.563751 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m03:51:40.582480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:40.569813 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:40.573848 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m03:51:40.567080 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m03:51:40.763497 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:40.765991 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:51:41.368519 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0261e022-5aef-4cb3-9471-557ccd355db6&page=queryresults
[0m03:51:41.376777 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c61deb9a-b9c8-4242-936a-a2f6e44883f0&page=queryresults
[0m03:51:41.382140 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:aaf507d9-26a3-458e-ad1f-a62804bf4d39&page=queryresults
[0m03:51:41.462734 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:31b6f8aa-df49-487b-b979-e9b068279dff&page=queryresults
[0m03:51:42.935201 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:51:42.991411 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m03:51:43.068766 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m03:51:43.074211 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m03:51:43.075193 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m03:51:43.081155 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.526512, "process_in_blocks": "3400", "process_kernel_time": 1.708386, "process_mem_max_rss": "210296", "process_out_blocks": "6144", "process_user_time": 10.655514}
[0m03:51:43.085445 [debug] [MainThread]: Command `dbt docs generate` succeeded at 03:51:43.084758 after 9.53 seconds
[0m03:51:43.086342 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m03:51:43.087536 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m03:51:43.088703 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m03:51:43.091076 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m03:51:43.092137 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m03:51:43.093371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754719852420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546f94b0710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7546f8742c00>]}
[0m03:51:43.095154 [debug] [MainThread]: Flushing usage events
[0m03:51:44.662544 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:51:54.053261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c03c296d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c03c2ade0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c03c2b560>]}


============================== 03:51:54.063523 | d9caa1c7-3d0b-4181-a0c0-59251a3093ab ==============================
[0m03:51:54.063523 [info ] [MainThread]: Running with dbt=1.9.0
[0m03:51:54.066338 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt docs serve', 'send_anonymous_usage_stats': 'True'}
[0m03:51:56.918130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9caa1c7-3d0b-4181-a0c0-59251a3093ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bdf73b9b0>]}
[0m03:51:57.113819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9caa1c7-3d0b-4181-a0c0-59251a3093ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c03c93a70>]}
[0m04:02:10.760402 [error] [MainThread]: Encountered an error:

[0m04:02:10.774028 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m04:02:10.779577 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 617.03143, "process_in_blocks": "272", "process_kernel_time": 1.157667, "process_mem_max_rss": "199196", "process_out_blocks": "3536", "process_user_time": 7.52334}
[0m04:02:10.781721 [debug] [MainThread]: Command `dbt docs serve` failed at 04:02:10.781334 after 617.03 seconds
[0m04:02:10.783356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1c037323f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bdfb9dd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1be48c43e0>]}
[0m04:02:10.785000 [debug] [MainThread]: Flushing usage events
[0m04:02:12.251756 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:02:41.501186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb978268bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb977772c60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb977d7f3b0>]}


============================== 04:02:41.511144 | d803d35c-cdc3-4299-a039-3f67d0dac173 ==============================
[0m04:02:41.511144 [info ] [MainThread]: Running with dbt=1.9.0
[0m04:02:41.513080 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:02:44.555027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd803d35c-cdc3-4299-a039-3f67d0dac173', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb9535163c0>]}
[0m04:02:44.768334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd803d35c-cdc3-4299-a039-3f67d0dac173', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb977b13680>]}
[0m04:02:44.771029 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m04:02:45.762296 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m04:02:46.274617 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:02:46.276236 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:02:46.443841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd803d35c-cdc3-4299-a039-3f67d0dac173', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb9535a8d10>]}
[0m04:02:46.506191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd803d35c-cdc3-4299-a039-3f67d0dac173', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb953541c40>]}
[0m04:02:46.508201 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m04:02:46.509758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd803d35c-cdc3-4299-a039-3f67d0dac173', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb9775d6150>]}
[0m04:02:46.520142 [info ] [MainThread]: 
[0m04:02:46.522064 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m04:02:46.523593 [info ] [MainThread]: 
[0m04:02:46.526579 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m04:02:46.543402 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m04:02:46.545910 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m04:02:46.548477 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:46.551328 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:46.553540 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m04:02:46.660715 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:47.969434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd803d35c-cdc3-4299-a039-3f67d0dac173', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb9775932f0>]}
[0m04:02:47.971387 [debug] [MainThread]: Opening a new connection, currently in state init
[0m04:02:47.991683 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m04:02:47.993212 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m04:02:47.995506 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m04:02:47.997096 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m04:02:48.001074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m04:02:48.003642 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m04:02:48.006500 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m04:02:48.008646 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m04:02:48.010836 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m04:02:48.012578 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m04:02:48.014148 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m04:02:48.018480 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m04:02:48.105161 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m04:02:48.115367 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m04:02:48.117902 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m04:02:48.125548 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m04:02:48.128897 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m04:02:48.137201 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m04:02:48.138665 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m04:02:48.134196 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m04:02:48.141307 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m04:02:48.143347 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m04:02:48.150691 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m04:02:48.179226 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:02:48.171171 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m04:02:48.177415 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m04:02:48.168979 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m04:02:48.185773 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m04:02:48.193368 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m04:02:48.197434 [debug] [Thread-4 (]: Began running node model.hospital_analytics.date_problems
[0m04:02:48.198505 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m04:02:48.199817 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m04:02:48.202490 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m04:02:48.205184 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.date_problems)
[0m04:02:48.206214 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m04:02:48.208523 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m04:02:48.210465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m04:02:48.212382 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.date_problems
[0m04:02:48.223005 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m04:02:48.224603 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m04:02:48.226135 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m04:02:48.234913 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m04:02:48.245918 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m04:02:48.247540 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m04:02:48.257909 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m04:02:48.260363 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m04:02:48.270231 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m04:02:48.274635 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m04:02:48.275770 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m04:02:48.278532 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m04:02:48.287191 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.date_problems
[0m04:02:48.289292 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m04:02:48.304968 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m04:02:48.290725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:02:48.301629 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m04:02:48.293536 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m04:02:48.306381 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m04:02:48.308550 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m04:02:48.311313 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m04:02:48.332899 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m04:02:48.357369 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m04:02:48.355054 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m04:02:48.342729 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m04:02:48.398499 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m04:02:48.380983 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m04:02:48.396062 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m04:02:48.377197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m04:02:48.416968 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m04:02:48.414782 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m04:02:48.411296 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m04:02:48.439205 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m04:02:48.441399 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m04:02:48.443401 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m04:02:48.447069 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m04:02:48.449217 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m04:02:48.459639 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m04:02:48.462081 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m04:02:48.465804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:02:48.468927 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m04:02:48.471026 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m04:02:48.499693 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m04:02:48.500969 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m04:02:48.497941 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m04:02:48.513776 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m04:02:48.492709 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m04:02:48.479812 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m04:02:48.512150 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m04:02:48.517178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now model.hospital_analytics.visits_enhanced)
[0m04:02:48.519568 [debug] [Thread-3 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m04:02:48.521382 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m04:02:48.530511 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m04:02:48.527159 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m04:02:48.528707 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m04:02:48.531942 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m04:02:48.525437 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m04:02:48.533453 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m04:02:48.535618 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m04:02:48.567596 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m04:02:48.572705 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m04:02:48.580107 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m04:02:48.611287 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m04:02:48.615673 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m04:02:48.618126 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m04:02:48.619538 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m04:02:48.621113 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m04:02:48.623016 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:02:48.624845 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m04:02:48.635421 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m04:02:48.642343 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m04:02:48.653892 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m04:02:48.658485 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m04:02:48.665693 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.billing_enhanced)
[0m04:02:48.660428 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m04:02:48.663409 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m04:02:48.661567 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m04:02:48.667329 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m04:02:48.672265 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now model.hospital_analytics.doctor_performance)
[0m04:02:48.675015 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m04:02:48.676722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m04:02:48.688412 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m04:02:48.691258 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m04:02:48.694420 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m04:02:48.696005 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m04:02:48.721638 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m04:02:48.723571 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m04:02:48.732280 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m04:02:48.730601 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m04:02:48.754460 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m04:02:48.757596 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m04:02:48.761163 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m04:02:48.762589 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m04:02:48.766607 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m04:02:48.768823 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m04:02:48.772600 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m04:02:48.774542 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m04:02:48.775910 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m04:02:48.777493 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:02:48.779149 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m04:02:48.786468 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m04:02:48.818610 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m04:02:48.816422 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m04:02:48.810517 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m04:02:48.820055 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m04:02:48.803738 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m04:02:48.829511 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m04:02:48.824397 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m04:02:48.826806 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m04:02:48.822323 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m04:02:48.831805 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m04:02:48.834398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m04:02:48.849854 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_journey)
[0m04:02:48.854133 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m04:02:48.859982 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m04:02:48.861524 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m04:02:48.863011 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m04:02:48.865722 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m04:02:49.080546 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m04:02:49.082577 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m04:02:49.083952 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m04:02:49.087974 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m04:02:49.090006 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m04:02:49.096630 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m04:02:49.104689 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m04:02:49.106746 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m04:02:49.108742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:02:49.114764 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m04:02:49.120609 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:02:49.122099 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m04:02:49.123094 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m04:02:49.125708 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m04:02:49.126971 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m04:02:49.144806 [debug] [MainThread]: Command end result
[0m04:02:49.431063 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m04:02:49.440529 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m04:02:49.465534 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m04:02:49.477883 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m04:02:49.478870 [info ] [MainThread]: Building catalog
[0m04:02:49.501795 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m04:02:49.510304 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m04:02:49.517187 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m04:02:49.529097 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m04:02:49.691899 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m04:02:49.702091 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:49.710369 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m04:02:49.716981 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m04:02:49.720685 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:49.727801 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:49.818542 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m04:02:49.933571 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:02:50.556200 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7e23cf48-69ce-4ddd-a78f-e9695ede124d&page=queryresults
[0m04:02:50.567670 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d2e583ae-a254-4edd-97a0-e93fac63f80e&page=queryresults
[0m04:02:50.580618 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:22c46dc9-cdc7-433c-827c-f91bea87a44b&page=queryresults
[0m04:02:50.641407 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5147c2e2-9357-4ba2-98cf-b7dc2b3d60fc&page=queryresults
[0m04:02:53.146261 [debug] [MainThread]: Opening a new connection, currently in state init
[0m04:02:53.198722 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m04:02:53.284268 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m04:02:53.289486 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m04:02:53.290554 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m04:02:53.294384 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 12.074212, "process_in_blocks": "0", "process_kernel_time": 1.862034, "process_mem_max_rss": "210388", "process_out_blocks": "6144", "process_user_time": 11.971368}
[0m04:02:53.296384 [debug] [MainThread]: Command `dbt docs generate` succeeded at 04:02:53.296066 after 12.08 seconds
[0m04:02:53.297380 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m04:02:53.298170 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m04:02:53.299490 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m04:02:53.300518 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m04:02:53.301925 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m04:02:53.303378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb9780c7aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb9536d6060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb953694350>]}
[0m04:02:53.304585 [debug] [MainThread]: Flushing usage events
[0m04:02:54.723604 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:03:18.939934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7657a13867b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7657a0bc9730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7657a100dac0>]}


============================== 04:03:18.950464 | 54e0b55e-89b5-4312-bb12-5e3650a0d280 ==============================
[0m04:03:18.950464 [info ] [MainThread]: Running with dbt=1.9.0
[0m04:03:18.953161 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt docs serve --port 8080', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:03:22.012936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54e0b55e-89b5-4312-bb12-5e3650a0d280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76578107dd30>]}
[0m04:03:22.205095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54e0b55e-89b5-4312-bb12-5e3650a0d280', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765780996690>]}
[0m04:18:31.691255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503c547ebd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503c36f2600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503c365c6e0>]}


============================== 04:18:31.705185 | a83e5f8c-c95e-435e-9994-e339468ceecf ==============================
[0m04:18:31.705185 [info ] [MainThread]: Running with dbt=1.9.0
[0m04:18:31.707516 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:18:34.575563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a83e5f8c-c95e-435e-9994-e339468ceecf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75039f9121b0>]}
[0m04:18:34.780654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a83e5f8c-c95e-435e-9994-e339468ceecf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503c3a2e2a0>]}
[0m04:25:42.013487 [error] [MainThread]: Encountered an error:

[0m04:25:42.028853 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m04:25:42.035452 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 430.6235, "process_in_blocks": "5096", "process_kernel_time": 1.24858, "process_mem_max_rss": "196044", "process_out_blocks": "3360", "process_user_time": 7.291388}
[0m04:25:42.038529 [debug] [MainThread]: Command `dbt docs serve` failed at 04:25:42.037487 after 430.63 seconds
[0m04:25:42.040229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503c3f43b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503c3543710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7503a42680b0>]}
[0m04:25:42.041683 [debug] [MainThread]: Flushing usage events
[0m04:25:43.520113 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m04:29:45.641745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797aa4ebe3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797aa692c380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797aa522cbf0>]}


============================== 04:29:45.652659 | 458175c0-c896-4837-b845-e9f0b671b755 ==============================
[0m04:29:45.652659 [info ] [MainThread]: Running with dbt=1.9.0
[0m04:29:45.655398 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:29:48.606098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '458175c0-c896-4837-b845-e9f0b671b755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797aa49b61e0>]}
[0m04:29:48.817760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '458175c0-c896-4837-b845-e9f0b671b755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797a85b0db50>]}
[0m04:49:22.528570 [error] [MainThread]: Encountered an error:

[0m04:49:22.535289 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m04:49:22.540050 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 1177.2078, "process_in_blocks": "1832", "process_kernel_time": 1.252927, "process_mem_max_rss": "196400", "process_out_blocks": "3368", "process_user_time": 7.806081}
[0m04:49:22.542482 [debug] [MainThread]: Command `dbt docs serve` failed at 04:49:22.542083 after 1177.21 seconds
[0m04:49:22.544188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797aa692c380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797a84e6db50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797a84948350>]}
[0m04:49:22.546382 [debug] [MainThread]: Flushing usage events
[0m04:49:24.054280 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:02:15.460102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897f1206990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897efd25160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897efd25220>]}


============================== 05:02:15.470958 | ba647ab2-bb10-44ea-a667-41279d1daf90 ==============================
[0m05:02:15.470958 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:02:15.472849 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m05:02:18.360118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897cbae1a00>]}
[0m05:02:18.557545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897d2b6f800>]}
[0m05:02:18.559542 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m05:02:19.295158 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:02:19.997617 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:02:19.999768 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m05:02:21.123434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897cabbd370>]}
[0m05:02:21.609280 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:02:21.621404 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:02:21.686260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897caf67bc0>]}
[0m05:02:21.688228 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m05:02:21.689695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897caf61e20>]}
[0m05:02:21.697371 [info ] [MainThread]: 
[0m05:02:21.698794 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m05:02:21.700333 [info ] [MainThread]: 
[0m05:02:21.702181 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m05:02:21.718201 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m05:02:21.719893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:02:21.722561 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m05:02:21.723515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:02:21.727320 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m05:02:21.736516 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:02:23.082937 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m05:02:23.085310 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m05:02:23.087118 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:02:23.088527 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:02:23.174033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m05:02:23.178363 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:02:23.772373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897caf603e0>]}
[0m05:02:23.774149 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:02:23.787241 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m05:02:23.788720 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m05:02:23.791303 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m05:02:23.799509 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m05:02:23.793574 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m05:02:23.798047 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m05:02:23.795094 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m05:02:23.800905 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m05:02:23.803092 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m05:02:23.805520 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m05:02:23.808584 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m05:02:23.831355 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m05:02:23.838665 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m05:02:23.841441 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m05:02:23.844224 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m05:02:23.855479 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m05:02:23.858185 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m05:02:23.860002 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m05:02:23.863091 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m05:02:23.866514 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m05:02:23.877687 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m05:02:23.911539 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m05:02:24.013450 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m05:02:24.057229 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m05:02:24.099031 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m05:02:24.277806 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m05:02:24.291827 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m05:02:24.273194 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m05:02:24.299023 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m05:02:24.300724 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m05:02:24.302459 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:02:24.304631 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:02:24.307119 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m05:02:24.310468 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:02:25.343193 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m05:02:25.345686 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m05:02:25.459146 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:34daadb2-2108-42ac-af54-b1ca30b49aff&page=queryresults
[0m05:02:25.478628 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b903828d-409e-42c3-86bf-0c61c5aa433e&page=queryresults
[0m05:02:25.510398 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e75933e4-9f52-4460-bc2f-d653ff9ccbe2&page=queryresults
[0m05:02:25.669574 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:265e2b62-0c44-4baf-ace5-58e2322ea807&page=queryresults
[0m05:02:26.119723 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897cb450740>]}
[0m05:02:26.122688 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.27s]
[0m05:02:26.124335 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897ca3aec00>]}
[0m05:02:26.126783 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m05:02:26.128135 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897cb5140e0>]}
[0m05:02:26.133291 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.31s]
[0m05:02:26.137397 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.32s]
[0m05:02:26.141048 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m05:02:26.144457 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m05:02:26.151702 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m05:02:26.153615 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m05:02:26.155555 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m05:02:26.157502 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m05:02:26.160091 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m05:02:26.163802 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m05:02:26.168411 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m05:02:26.170137 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m05:02:26.171816 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m05:02:26.195266 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m05:02:26.193584 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m05:02:26.183112 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m05:02:26.206096 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m05:02:26.212210 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:02:26.217605 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:02:26.231142 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m05:02:26.225390 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m05:02:26.233417 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m05:02:26.236283 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m05:02:26.238218 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m05:02:26.245815 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:02:26.247750 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.medicines)
[0m05:02:26.328930 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m05:02:26.338730 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m05:02:26.341682 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m05:02:26.348349 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:02:27.024618 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m05:02:27.028402 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m05:02:27.148338 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m05:02:27.151249 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m05:02:27.559612 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897ca322cc0>]}
[0m05:02:27.561823 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.72s]
[0m05:02:27.564570 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m05:02:27.697026 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8014f71d-02e4-4943-9f8a-b84cbf536881&page=queryresults
[0m05:02:27.767454 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f4149017-a3a2-4af2-bd02-05ed8e06df7f&page=queryresults
[0m05:02:29.175502 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897cb450740>]}
[0m05:02:29.178040 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 3.00s]
[0m05:02:29.182556 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m05:02:29.185210 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m05:02:29.186187 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m05:02:29.189075 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m05:02:29.190700 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m05:02:29.202444 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m05:02:29.205092 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m05:02:29.218728 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:02:29.647234 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9b08ce0>]}
[0m05:02:29.649495 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.40s]
[0m05:02:29.651934 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m05:02:29.654237 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m05:02:29.656298 [info ] [Thread-1 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m05:02:29.658498 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m05:02:29.659556 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m05:02:29.671839 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m05:02:29.675219 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m05:02:29.682481 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:02:30.142587 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m05:02:30.144522 [debug] [Thread-3 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m05:02:30.310080 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m05:02:30.314033 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m05:02:30.409688 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9c5fca5c-1e4d-41b7-8893-54987c4bc656&page=queryresults
[0m05:02:30.603722 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d74fb5ba-24ac-4dbd-b276-4803c5fc1520&page=queryresults
[0m05:02:32.208290 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9b20a40>]}
[0m05:02:32.210814 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 3.02s]
[0m05:02:32.213467 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m05:02:32.216551 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m05:02:32.218425 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m05:02:32.220384 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m05:02:32.222166 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m05:02:32.225591 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m05:02:32.230270 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m05:02:32.246705 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m05:02:32.244014 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m05:02:32.257452 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m05:02:32.266612 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m05:02:32.272269 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m05:02:32.281407 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:02:32.378013 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m05:02:32.393765 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:02:32.396261 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9f52780>]}
[0m05:02:32.399330 [info ] [Thread-1 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.74s]
[0m05:02:32.489960 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m05:02:32.496505 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m05:02:32.499015 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m05:02:32.501526 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m05:02:32.504448 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m05:02:32.517959 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m05:02:32.521110 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m05:02:32.530124 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:02:32.904155 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m05:02:32.909671 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m05:02:32.913194 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m05:02:32.919391 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m05:02:32.956990 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m05:02:32.960131 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m05:02:33.165184 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7bb1e653-76db-46da-9058-a4faf4f3d3a4&page=queryresults
[0m05:02:33.193819 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:defaad5a-8370-4f8c-8562-7eece183b766&page=queryresults
[0m05:02:33.251103 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:42e62f24-6323-4393-8098-147543e8424a&page=queryresults
[0m05:02:34.937988 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9b4c0b0>]}
[0m05:02:34.940265 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.72s]
[0m05:02:34.942282 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m05:02:34.944751 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m05:02:34.948354 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m05:02:34.946493 [info ] [Thread-1 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m05:02:34.953721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m05:02:34.955094 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_journey
[0m05:02:34.950042 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m05:02:34.964965 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m05:02:34.972317 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m05:02:34.980771 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m05:02:34.990102 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m05:02:35.002403 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m05:02:35.004044 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_journey
[0m05:02:35.013231 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:02:35.023424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:02:35.419203 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9b58770>]}
[0m05:02:35.421577 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 3.17s]
[0m05:02:35.424613 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m05:02:35.470836 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9fe4140>]}
[0m05:02:35.473607 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.97s]
[0m05:02:35.478740 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m05:02:35.782851 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m05:02:35.787665 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m05:02:35.796041 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m05:02:35.799584 [debug] [Thread-1 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.patient_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Use prescription date or join with visits to get approximate visit association
    (SELECT MIN(v.visit_date) 
      FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
      WHERE v.patient_id = p.patient_id 
        AND v.doctor_id = p.doctor_id
    ) AS approximate_visit_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance,
  -- Additional analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  COUNT(pd.prescription_id) OVER (PARTITION BY vd.patient_id) AS total_prescriptions_for_patient,
  AVG(vd.visit_cost) OVER (PARTITION BY vd.patient_id) AS avg_visit_cost_per_patient
FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id AND
  vd.visit_date = pd.approximate_visit_date
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id AND 
  vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m05:02:36.112839 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5f3459f8-6682-4851-a410-6759e5186471&page=queryresults
[0m05:02:36.144667 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c4bac5af-fa83-476e-b41e-c8145165129c&page=queryresults
[0m05:02:36.295565 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5f3459f8-6682-4851-a410-6759e5186471&page=queryresults
[0m05:02:36.332452 [debug] [Thread-1 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name patient_name not found inside v at [20:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m05:02:36.334497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9b46000>]}
[0m05:02:36.336530 [error] [Thread-1 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 1.38s]
[0m05:02:36.339209 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m05:02:36.341522 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name patient_name not found inside v at [20:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m05:02:38.365207 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba647ab2-bb10-44ea-a667-41279d1daf90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897c9b47c20>]}
[0m05:02:38.367151 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 3.40s]
[0m05:02:38.370001 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m05:02:38.376842 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:02:38.382799 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:02:38.384178 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m05:02:38.385186 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m05:02:38.386667 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m05:02:38.388340 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m05:02:38.391667 [info ] [MainThread]: 
[0m05:02:38.393749 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 16.69 seconds (16.69s).
[0m05:02:38.403431 [debug] [MainThread]: Command end result
[0m05:02:38.501361 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:02:38.512912 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:02:38.533551 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m05:02:38.534901 [info ] [MainThread]: 
[0m05:02:38.536523 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m05:02:38.538798 [info ] [MainThread]: 
[0m05:02:38.540048 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name patient_name not found inside v at [20:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m05:02:38.541221 [info ] [MainThread]: 
[0m05:02:38.543756 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m05:02:38.547912 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 23.391455, "process_in_blocks": "6816", "process_kernel_time": 1.882451, "process_mem_max_rss": "214256", "process_out_blocks": "3768", "process_user_time": 13.538899}
[0m05:02:38.550895 [debug] [MainThread]: Command `dbt run` failed at 05:02:38.549899 after 23.39 seconds
[0m05:02:38.552238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897cab18080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897ef5d0500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7897ef5d0a70>]}
[0m05:02:38.553212 [debug] [MainThread]: Flushing usage events
[0m05:02:40.003173 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:48:58.121937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757941fb3b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757941bb4a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757941bb53a0>]}


============================== 05:48:58.132304 | 4e9b82b2-d8a2-41b1-8394-883605ff8221 ==============================
[0m05:48:58.132304 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:48:58.134599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:49:01.099122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757941635e50>]}
[0m05:49:01.304284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757941e8e930>]}
[0m05:49:01.306455 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m05:49:02.045479 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:49:02.476363 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m05:49:02.478399 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m05:49:03.636039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579210fd490>]}
[0m05:49:04.121380 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:49:04.130253 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:49:04.187035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579211b52b0>]}
[0m05:49:04.188956 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m05:49:04.190618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579211d6840>]}
[0m05:49:04.197945 [info ] [MainThread]: 
[0m05:49:04.199473 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m05:49:04.200540 [info ] [MainThread]: 
[0m05:49:04.202275 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m05:49:04.217012 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m05:49:04.219014 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:49:04.220814 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m05:49:04.223697 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m05:49:04.311225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:49:04.315515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:49:05.459129 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m05:49:05.460593 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:49:05.462816 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m05:49:05.467409 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m05:49:05.554414 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:49:05.557168 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:49:06.130504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579210fd1c0>]}
[0m05:49:06.133304 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:49:06.152348 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m05:49:06.154455 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m05:49:06.156420 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m05:49:06.158134 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m05:49:06.159570 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m05:49:06.161322 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m05:49:06.164548 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m05:49:06.167124 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m05:49:06.170693 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m05:49:06.172915 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m05:49:06.175844 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m05:49:06.177704 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m05:49:06.179712 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m05:49:06.200585 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m05:49:06.219160 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m05:49:06.224046 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m05:49:06.226398 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m05:49:06.244627 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m05:49:06.248359 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m05:49:06.257853 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m05:49:06.259745 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m05:49:06.263973 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m05:49:06.268603 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m05:49:06.338012 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m05:49:06.523383 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m05:49:06.750644 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m05:49:06.754691 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m05:49:06.759125 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m05:49:06.762208 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m05:49:06.767354 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:49:06.852807 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m05:49:06.858360 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:49:06.875705 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m05:49:06.955960 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:49:07.608539 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m05:49:07.612346 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m05:49:07.781325 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:183d82a0-fee8-4a53-bab8-a2e13aec32d1&page=queryresults
[0m05:49:07.915425 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f704edb8-1fe9-4776-ad1f-2720e2647920&page=queryresults
[0m05:49:08.329391 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579217684d0>]}
[0m05:49:08.332566 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.16s]
[0m05:49:08.335619 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m05:49:08.338416 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m05:49:08.340852 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m05:49:08.342640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m05:49:08.343972 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m05:49:08.353238 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m05:49:08.355770 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m05:49:08.363144 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:49:08.459836 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1a167e11-f176-45b0-ae59-8f4fc091d9a6&page=queryresults
[0m05:49:08.475759 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ac8dfea6-b251-4587-b348-f083db676963&page=queryresults
[0m05:49:08.737321 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579213c53d0>]}
[0m05:49:08.739799 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.56s]
[0m05:49:08.742836 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m05:49:08.766504 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75792124c260>]}
[0m05:49:08.769176 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.59s]
[0m05:49:08.773272 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m05:49:08.777176 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m05:49:08.779070 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m05:49:08.780525 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m05:49:08.782292 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m05:49:08.794734 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m05:49:08.796568 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m05:49:08.799587 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:49:08.801371 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m05:49:08.809142 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m05:49:08.816623 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m05:49:08.818653 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m05:49:08.821492 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m05:49:08.823011 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m05:49:08.829666 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m05:49:08.855036 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m05:49:08.858841 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m05:49:08.863491 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m05:49:08.865555 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:49:08.875953 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:49:08.878683 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m05:49:08.887485 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m05:49:09.356628 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m05:49:09.360084 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m05:49:09.460940 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579212271a0>]}
[0m05:49:09.463326 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.28s]
[0m05:49:09.474281 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m05:49:09.665838 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6c0c49e8-4557-43eb-a54e-46dfb7d84836&page=queryresults
[0m05:49:09.959312 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b42fadc2-6745-4e7a-b493-a1ec843e3767&page=queryresults
[0m05:49:11.150510 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757920133560>]}
[0m05:49:11.155201 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.81s]
[0m05:49:11.166754 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m05:49:11.481278 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579201013d0>]}
[0m05:49:11.484807 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.66s]
[0m05:49:11.488276 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m05:49:11.491642 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m05:49:11.495594 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m05:49:11.493600 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m05:49:11.497834 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m05:49:11.500510 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m05:49:11.502693 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m05:49:11.505921 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m05:49:11.508029 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m05:49:11.536349 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m05:49:11.542757 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m05:49:11.545256 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m05:49:11.553639 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:49:11.638182 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m05:49:11.647411 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:49:12.112851 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m05:49:12.118421 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m05:49:12.122161 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m05:49:12.124496 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m05:49:12.374547 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:dba8927d-5c65-4e64-b5f1-490cb6cdc0d6&page=queryresults
[0m05:49:12.395027 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:40b6b1cc-7eee-41fe-82a9-200b54a42cd4&page=queryresults
[0m05:49:13.881580 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579212610a0>]}
[0m05:49:13.883663 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.38s]
[0m05:49:13.885792 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m05:49:13.933179 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579201310d0>]}
[0m05:49:13.936553 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.43s]
[0m05:49:13.940511 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m05:49:13.944618 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m05:49:13.946753 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m05:49:13.950203 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m05:49:13.953070 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m05:49:13.956511 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m05:49:13.959048 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m05:49:13.960949 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m05:49:13.965975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m05:49:13.967321 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m05:49:13.968965 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m05:49:13.971259 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m05:49:13.973667 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m05:49:13.986482 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m05:49:14.005172 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m05:49:14.010959 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m05:49:14.015274 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m05:49:14.025318 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m05:49:14.035662 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:49:14.121349 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:49:14.126480 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m05:49:14.143009 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:49:14.588266 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m05:49:14.593753 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m05:49:14.656916 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m05:49:14.658959 [debug] [Thread-1 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m05:49:14.702383 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m05:49:14.705377 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m05:49:14.884715 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d18670f3-9dd2-429a-ae1f-955f6057854e&page=queryresults
[0m05:49:14.917225 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:23fbefe3-f244-4db9-a2dd-ea31f05e1d15&page=queryresults
[0m05:49:14.946537 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a18f2b22-2b5e-4bed-a459-295f3bfbaeea&page=queryresults
[0m05:49:16.641235 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757920148140>]}
[0m05:49:16.644281 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.68s]
[0m05:49:16.648411 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m05:49:16.663048 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757920173d10>]}
[0m05:49:16.665076 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757920170f80>]}
[0m05:49:16.668666 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.70s]
[0m05:49:16.672203 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.70s]
[0m05:49:16.676579 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m05:49:16.679717 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m05:49:16.684581 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m05:49:16.688562 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m05:49:16.687106 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m05:49:16.695983 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m05:49:16.692221 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m05:49:16.700604 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m05:49:16.703641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now model.hospital_analytics.patient_spending_analysis)
[0m05:49:16.717683 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m05:49:16.725654 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m05:49:16.731810 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m05:49:16.734540 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m05:49:16.741710 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:49:16.744051 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m05:49:16.840376 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:49:17.301106 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m05:49:17.306630 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m05:49:17.309070 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    v.full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Use prescription date or join with visits to get approximate visit association
    (SELECT MIN(v.visit_date) 
      FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
      WHERE v.patient_id = p.patient_id 
        AND v.doctor_id = p.doctor_id
    ) AS approximate_visit_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.*,
  pd.prescription_id,
  pd.medicine_name,
  pd.dosage,
  pd.duration,
  pd.prescription_cost,
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  bd.payment_status,
  bd.days_to_bill,
  -- Calculate derived metrics
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE bd.total_amount
  END AS outstanding_balance,
  -- Additional analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  COUNT(pd.prescription_id) OVER (PARTITION BY vd.patient_id) AS total_prescriptions_for_patient,
  AVG(vd.visit_cost) OVER (PARTITION BY vd.patient_id) AS avg_visit_cost_per_patient
FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id AND
  vd.visit_date = pd.approximate_visit_date
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id AND 
  vd.patient_id = bd.patient_id
ORDER BY vd.patient_id, vd.visit_date
    );
  
[0m05:49:17.316428 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m05:49:17.548198 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:019a32f1-f6b5-4c05-8588-c6cc81d83f45&page=queryresults
[0m05:49:17.554338 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9327413b-a63b-4b08-a90d-1b5148aeda17&page=queryresults
[0m05:49:19.503990 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757920132690>]}
[0m05:49:19.507810 [info ] [Thread-4 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (235.0 rows, 36.0 KiB processed)[0m in 2.81s]
[0m05:49:19.517551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e9b82b2-d8a2-41b1-8394-883605ff8221', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757920127740>]}
[0m05:49:19.520027 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.81s]
[0m05:49:19.522902 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m05:49:19.515024 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m05:49:19.534198 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m05:49:19.539456 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:49:19.540680 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m05:49:19.542189 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m05:49:19.543607 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m05:49:19.544702 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m05:49:19.546160 [info ] [MainThread]: 
[0m05:49:19.547309 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.34 seconds (15.34s).
[0m05:49:19.558379 [debug] [MainThread]: Command end result
[0m05:49:19.646546 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:49:19.652519 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:49:19.675166 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m05:49:19.676155 [info ] [MainThread]: 
[0m05:49:19.678157 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:49:19.679715 [info ] [MainThread]: 
[0m05:49:19.681330 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m05:49:19.685369 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 21.867413, "process_in_blocks": "0", "process_kernel_time": 1.874144, "process_mem_max_rss": "213324", "process_out_blocks": "3768", "process_user_time": 13.597496}
[0m05:49:19.688016 [debug] [MainThread]: Command `dbt run` succeeded at 05:49:19.687494 after 21.87 seconds
[0m05:49:19.689595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75794174d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579211d6660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7579211d6690>]}
[0m05:49:19.691157 [debug] [MainThread]: Flushing usage events
[0m05:49:21.226843 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:51:05.467368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff9bd2570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff8322120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff83208f0>]}


============================== 05:51:05.478764 | c93fabe5-bb0f-4723-973c-46ed38a2e974 ==============================
[0m05:51:05.478764 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:51:05.480465 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:51:08.343363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c93fabe5-bb0f-4723-973c-46ed38a2e974', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784fd3ec4f80>]}
[0m05:51:08.549377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c93fabe5-bb0f-4723-973c-46ed38a2e974', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff98b4c20>]}
[0m05:51:08.551696 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m05:51:09.280155 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m05:51:09.688583 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:51:09.690144 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:51:09.835997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c93fabe5-bb0f-4723-973c-46ed38a2e974', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784fd3dd94c0>]}
[0m05:51:09.887914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c93fabe5-bb0f-4723-973c-46ed38a2e974', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784fd3990530>]}
[0m05:51:09.889281 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m05:51:09.890964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93fabe5-bb0f-4723-973c-46ed38a2e974', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784fd393f4a0>]}
[0m05:51:09.899528 [info ] [MainThread]: 
[0m05:51:09.901132 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m05:51:09.902625 [info ] [MainThread]: 
[0m05:51:09.904640 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m05:51:09.919069 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m05:51:09.920808 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:10.004511 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m05:51:10.008115 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:10.091405 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m05:51:10.097126 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:10.571513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93fabe5-bb0f-4723-973c-46ed38a2e974', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784fd393e210>]}
[0m05:51:10.573072 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:51:10.590305 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m05:51:10.592417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m05:51:10.594126 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m05:51:10.595467 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m05:51:10.605293 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m05:51:10.606633 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m05:51:10.609695 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m05:51:10.618899 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m05:51:10.626254 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m05:51:10.635094 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m05:51:10.655373 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m05:51:10.656535 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m05:51:10.658994 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m05:51:10.674185 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m05:51:10.675750 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m05:51:10.678884 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m05:51:10.680203 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m05:51:10.683735 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:51:10.687002 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m05:51:10.700539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:51:10.698331 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m05:51:10.703237 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:51:10.709129 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m05:51:10.715366 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m05:51:10.720950 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m05:51:10.725239 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m05:51:10.727288 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m05:51:10.729088 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m05:51:10.731274 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m05:51:10.734181 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m05:51:10.736360 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m05:51:10.738177 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m05:51:10.741038 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m05:51:10.743895 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m05:51:10.746465 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m05:51:10.755236 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m05:51:10.757285 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m05:51:10.766703 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m05:51:10.774688 [debug] [Thread-4 (]: Began running node model.hospital_analytics.medicines
[0m05:51:10.784173 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m05:51:10.788267 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m05:51:10.790948 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.medicines)
[0m05:51:10.794305 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.medicines
[0m05:51:10.801084 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m05:51:10.802648 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:51:10.808994 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m05:51:10.810998 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m05:51:10.813202 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m05:51:10.815013 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m05:51:10.824968 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m05:51:10.833965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:51:10.858685 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.medicines
[0m05:51:10.860577 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:51:10.867613 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.medicines
[0m05:51:10.874299 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m05:51:10.877690 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m05:51:10.885678 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m05:51:10.886935 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:51:10.894146 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m05:51:10.897439 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m05:51:10.900431 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m05:51:10.906298 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m05:51:10.908159 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m05:51:10.911349 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m05:51:10.912706 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m05:51:10.914608 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m05:51:10.937515 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m05:51:10.940275 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:51:10.942476 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m05:51:10.950310 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m05:51:10.957467 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m05:51:10.959170 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m05:51:10.961684 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m05:51:10.963709 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m05:51:10.982970 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m05:51:10.986725 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m05:51:10.988321 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:51:10.989727 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.visits_enhanced)
[0m05:51:10.992136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:51:11.002274 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m05:51:11.003697 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m05:51:11.001601 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m05:51:11.022370 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:51:11.028527 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m05:51:11.030137 [debug] [Thread-4 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m05:51:11.035548 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m05:51:11.040738 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m05:51:11.042513 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m05:51:11.045101 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m05:51:11.047380 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m05:51:11.050479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m05:51:11.048971 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m05:51:11.052803 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m05:51:11.055011 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now model.hospital_analytics.prescriptions_enhanced)
[0m05:51:11.056631 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m05:51:11.060132 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:51:11.084173 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m05:51:11.089421 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m05:51:11.102004 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m05:51:11.123125 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m05:51:11.120213 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m05:51:11.124548 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:51:11.108970 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m05:51:11.126511 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m05:51:11.133797 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m05:51:11.142680 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m05:51:11.143971 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now model.hospital_analytics.monthly_visit_stats)
[0m05:51:11.138330 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m05:51:11.139410 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m05:51:11.145486 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m05:51:11.141225 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:51:11.147331 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:51:11.148700 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.billing_enhanced)
[0m05:51:11.158925 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m05:51:11.171390 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m05:51:11.173770 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m05:51:11.175504 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m05:51:11.178330 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m05:51:11.181208 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m05:51:11.184291 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m05:51:11.193757 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m05:51:11.199910 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m05:51:11.201423 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m05:51:11.203200 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:51:11.204778 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m05:51:11.206623 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m05:51:11.209365 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m05:51:11.215270 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m05:51:11.228057 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m05:51:11.237104 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m05:51:11.238400 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:51:11.241030 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m05:51:11.243045 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m05:51:11.249056 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m05:51:11.250326 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m05:51:11.256668 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:51:11.253391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:51:11.255331 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m05:51:11.251711 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m05:51:11.264511 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m05:51:11.271302 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m05:51:11.272744 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.doctor_performance)
[0m05:51:11.274213 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m05:51:11.275775 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m05:51:11.279023 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m05:51:11.280706 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m05:51:11.289556 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c, now model.hospital_analytics.patient_journey)
[0m05:51:11.327991 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m05:51:11.307406 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m05:51:11.326316 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m05:51:11.297362 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m05:51:11.338485 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m05:51:11.342157 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m05:51:11.343852 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m05:51:11.346372 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:51:11.348371 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m05:51:11.559930 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:51:11.557596 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m05:51:11.541936 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m05:51:11.570103 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m05:51:11.576963 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m05:51:11.579149 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:51:11.586487 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m05:51:11.588384 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m05:51:11.589929 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:51:11.596474 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m05:51:11.600986 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:51:11.602290 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m05:51:11.603196 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m05:51:11.604002 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m05:51:11.605005 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m05:51:11.617592 [debug] [MainThread]: Command end result
[0m05:51:11.904547 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:51:11.913429 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:51:11.936219 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m05:51:11.947162 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m05:51:11.948676 [info ] [MainThread]: Building catalog
[0m05:51:11.968927 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m05:51:11.971799 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m05:51:11.994046 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m05:51:12.004350 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m05:51:12.181671 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m05:51:12.185400 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:12.193144 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m05:51:12.211666 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m05:51:12.215172 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m05:51:12.316453 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:12.320975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:12.323569 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:51:12.925721 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a8cb30a3-7ca5-4de3-8521-9702ae830913&page=queryresults
[0m05:51:13.028073 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5ac2f0e6-c52c-413f-b145-5c93e3aacacc&page=queryresults
[0m05:51:13.044627 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b1b59b37-7079-45dd-8501-a76d0310b461&page=queryresults
[0m05:51:13.112664 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a519ace7-0d09-4fe2-9117-529c875baf34&page=queryresults
[0m05:51:14.845392 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:51:14.900078 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m05:51:14.978465 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m05:51:14.984842 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m05:51:14.986508 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m05:51:14.991753 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.802296, "process_in_blocks": "40", "process_kernel_time": 1.587614, "process_mem_max_rss": "208916", "process_out_blocks": "6136", "process_user_time": 10.83789}
[0m05:51:14.994439 [debug] [MainThread]: Command `dbt docs generate` succeeded at 05:51:14.994053 after 9.81 seconds
[0m05:51:14.995523 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m05:51:14.996655 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m05:51:14.997704 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m05:51:14.999157 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m05:51:15.000396 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m05:51:15.001803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff7e83d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff841a720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784ff84197f0>]}
[0m05:51:15.003346 [debug] [MainThread]: Flushing usage events
[0m05:51:16.619228 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:51:22.546844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddce01b7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddcde84230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddce019610>]}


============================== 05:51:22.557375 | d2587472-3e83-4371-9c46-6538ba330e1b ==============================
[0m05:51:22.557375 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:51:22.559460 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:51:25.490995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2587472-3e83-4371-9c46-6538ba330e1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddcf8978f0>]}
[0m05:51:25.686412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2587472-3e83-4371-9c46-6538ba330e1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddce207200>]}
[0m05:56:59.667358 [error] [MainThread]: Encountered an error:

[0m05:56:59.676333 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m05:56:59.682640 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 337.41623, "process_in_blocks": "0", "process_kernel_time": 1.127377, "process_mem_max_rss": "196368", "process_out_blocks": "3360", "process_user_time": 7.376927}
[0m05:56:59.685053 [debug] [MainThread]: Command `dbt docs serve` failed at 05:56:59.684599 after 337.42 seconds
[0m05:56:59.686522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddce9e1af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddcdd40b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ddadd6acc0>]}
[0m05:56:59.687724 [debug] [MainThread]: Flushing usage events
[0m05:57:01.132996 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:57:55.367927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71972dc3f170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71972f8a8350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71972d9a9580>]}


============================== 05:57:55.378271 | bf35439b-987c-428b-a561-9397bb95006b ==============================
[0m05:57:55.378271 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:57:55.380164 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m05:57:58.255240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bf35439b-987c-428b-a561-9397bb95006b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719715f5b620>]}
[0m05:57:58.464400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bf35439b-987c-428b-a561-9397bb95006b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71972f24a4b0>]}
[0m05:58:32.286853 [error] [MainThread]: Encountered an error:

[0m05:58:32.296338 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m05:58:32.301208 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 37.213684, "process_in_blocks": "0", "process_kernel_time": 1.127453, "process_mem_max_rss": "195932", "process_out_blocks": "3360", "process_user_time": 7.241066}
[0m05:58:32.303584 [debug] [MainThread]: Command `dbt docs serve` failed at 05:58:32.303163 after 37.22 seconds
[0m05:58:32.305024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71972db6c1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71970da85580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71970dbd2960>]}
[0m05:58:32.306596 [debug] [MainThread]: Flushing usage events
[0m05:58:33.848430 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m05:59:28.680328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76418a9e9a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76418a73e540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76418aafe600>]}


============================== 05:59:28.690972 | 3d7b5b84-a607-4836-8cae-b7c12d53f729 ==============================
[0m05:59:28.690972 [info ] [MainThread]: Running with dbt=1.9.0
[0m05:59:28.693212 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt docs serve --port=8080 --host=0.0.0.0.0', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m05:59:31.409344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d7b5b84-a607-4836-8cae-b7c12d53f729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76418c1638c0>]}
[0m05:59:31.608918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d7b5b84-a607-4836-8cae-b7c12d53f729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7641665e6630>]}
[0m05:59:31.663608 [error] [MainThread]: Encountered an error:
[Errno -2] Name or service not known
[0m05:59:31.669490 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socketserver.py", line 457, in __init__
    self.server_bind()
  File "/usr/local/lib/python3.12/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
socket.gaierror: [Errno -2] Name or service not known

[0m05:59:31.673304 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 3.2605052, "process_in_blocks": "0", "process_kernel_time": 1.113813, "process_mem_max_rss": "196400", "process_out_blocks": "3360", "process_user_time": 7.053152}
[0m05:59:31.675778 [debug] [MainThread]: Command `dbt docs serve` failed at 05:59:31.675364 after 3.26 seconds
[0m05:59:31.677327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76418accf620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76418dbfea50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764166df98e0>]}
[0m05:59:31.678529 [debug] [MainThread]: Flushing usage events
[0m05:59:33.212214 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:00:04.631294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71000669b830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71000669a540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710007d4c2f0>]}


============================== 06:00:04.642744 | bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae ==============================
[0m06:00:04.642744 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:00:04.644957 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:00:07.448014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710007ac7530>]}
[0m06:00:07.647438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ffe2a8cd40>]}
[0m06:00:07.649584 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m06:00:08.358513 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m06:00:08.775342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:00:08.776766 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:00:08.927191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ffe1e690d0>]}
[0m06:00:08.978023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ffe21c64e0>]}
[0m06:00:08.979346 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m06:00:08.980392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ffe1b36930>]}
[0m06:00:08.988321 [info ] [MainThread]: 
[0m06:00:08.989809 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m06:00:08.992082 [info ] [MainThread]: 
[0m06:00:08.994225 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m06:00:09.009235 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m06:00:09.011237 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:09.013631 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m06:00:09.016773 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m06:00:09.107318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:09.109044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:09.829956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb05c843-5fc0-4adc-ac0d-1b38bcc1bcae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710007b70530>]}
[0m06:00:09.831679 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:00:09.848011 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m06:00:09.849598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m06:00:09.851240 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m06:00:09.852637 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m06:00:09.854853 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m06:00:09.856681 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m06:00:09.860087 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m06:00:09.882558 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m06:00:09.897201 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m06:00:09.899059 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m06:00:09.902560 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m06:00:09.904405 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m06:00:09.913137 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m06:00:09.916332 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m06:00:09.919587 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m06:00:09.935310 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:00:09.937246 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m06:00:09.945723 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m06:00:09.950567 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m06:00:09.957121 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m06:00:09.959679 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:00:09.964486 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m06:00:09.967631 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:00:09.969632 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m06:00:09.975551 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m06:00:09.978173 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m06:00:09.979619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m06:00:09.985074 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m06:00:09.987571 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:00:09.989791 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m06:00:10.000799 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m06:00:10.002017 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m06:00:10.009574 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m06:00:10.013531 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m06:00:10.015726 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m06:00:10.024687 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.patients)
[0m06:00:10.019478 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m06:00:10.021065 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m06:00:10.026599 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m06:00:10.028342 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m06:00:10.030305 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m06:00:10.031571 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m06:00:10.047397 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m06:00:10.051640 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m06:00:10.060601 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m06:00:10.062379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:00:10.065594 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m06:00:10.069376 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:00:10.078976 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m06:00:10.080614 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:00:10.082754 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:00:10.089217 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m06:00:10.092159 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m06:00:10.098213 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m06:00:10.105133 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m06:00:10.107206 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m06:00:10.109287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m06:00:10.111415 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m06:00:10.113057 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m06:00:10.115763 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m06:00:10.119659 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m06:00:10.122319 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m06:00:10.124710 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m06:00:10.126835 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m06:00:10.146226 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m06:00:10.162254 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m06:00:10.171595 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m06:00:10.183997 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m06:00:10.196361 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m06:00:10.213453 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m06:00:10.221517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:00:10.226471 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m06:00:10.228188 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m06:00:10.237127 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m06:00:10.240470 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m06:00:10.248986 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:00:10.244497 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:00:10.246701 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m06:00:10.258183 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m06:00:10.260613 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m06:00:10.266476 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m06:00:10.268045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m06:00:10.270810 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:00:10.272993 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m06:00:10.276571 [debug] [Thread-2 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m06:00:10.278412 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m06:00:10.291543 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m06:00:10.293404 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.visits_enhanced)
[0m06:00:10.295052 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m06:00:10.308377 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m06:00:10.315185 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m06:00:10.306650 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m06:00:10.313425 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m06:00:10.311565 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m06:00:10.316651 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m06:00:10.343569 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m06:00:10.347400 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m06:00:10.357889 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m06:00:10.373658 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m06:00:10.380143 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m06:00:10.375700 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:00:10.381529 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:00:10.382703 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m06:00:10.385019 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m06:00:10.390753 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m06:00:10.397343 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m06:00:10.399628 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:00:10.402516 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:00:10.413368 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m06:00:10.416502 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m06:00:10.418245 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m06:00:10.435358 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m06:00:10.424039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.billing_enhanced)
[0m06:00:10.433348 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m06:00:10.420156 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m06:00:10.436738 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m06:00:10.438228 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m06:00:10.440189 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m06:00:10.442693 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now model.hospital_analytics.monthly_visit_stats)
[0m06:00:10.459510 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m06:00:10.461625 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m06:00:10.465603 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m06:00:10.467425 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m06:00:10.469620 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m06:00:10.471047 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m06:00:10.481297 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m06:00:10.490105 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m06:00:10.495819 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m06:00:10.497306 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:00:10.499729 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m06:00:10.501729 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:00:10.505322 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m06:00:10.507007 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:00:10.513301 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m06:00:10.515664 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:00:10.518361 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m06:00:10.524152 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m06:00:10.531496 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m06:00:10.533971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m06:00:10.536152 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m06:00:10.543024 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m06:00:10.545323 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m06:00:10.547458 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m06:00:10.548905 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m06:00:10.550205 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m06:00:10.551579 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_journey)
[0m06:00:10.565280 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m06:00:10.566648 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m06:00:10.568629 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m06:00:10.570771 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m06:00:10.588574 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m06:00:10.591260 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m06:00:10.596400 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m06:00:10.809470 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m06:00:10.817207 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m06:00:10.819318 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:00:10.822768 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m06:00:10.824210 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m06:00:10.826525 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m06:00:10.833044 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m06:00:10.835296 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:00:10.837565 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:00:10.839781 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:00:10.847906 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m06:00:10.854185 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m06:00:10.859710 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m06:00:10.868461 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:00:10.870362 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m06:00:10.871720 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m06:00:10.873071 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m06:00:10.874282 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m06:00:10.887070 [debug] [MainThread]: Command end result
[0m06:00:11.178338 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m06:00:11.187509 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m06:00:11.211785 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m06:00:11.227079 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m06:00:11.228541 [info ] [MainThread]: Building catalog
[0m06:00:11.258064 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m06:00:11.266944 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m06:00:11.273398 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m06:00:11.306541 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m06:00:11.467399 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m06:00:11.494180 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:11.508661 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m06:00:11.499829 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m06:00:11.541366 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m06:00:11.635342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:11.641985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:11.650023 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:00:12.515557 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:354abc7a-26ef-42d7-ac05-e1e8175cf2b5&page=queryresults
[0m06:00:12.573383 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:da2ebf2a-f34f-4a6b-9b3e-5456001207ad&page=queryresults
[0m06:00:12.593710 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:854a7c78-0d2f-49a1-b45c-4919e8154566&page=queryresults
[0m06:00:12.614112 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d9dd1f4b-b16c-4a38-a6a6-a48e13d6a71f&page=queryresults
[0m06:00:14.285799 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:00:14.342286 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m06:00:14.419159 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m06:00:14.424913 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m06:00:14.426287 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m06:00:14.430427 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 10.085779, "process_in_blocks": "0", "process_kernel_time": 1.76333, "process_mem_max_rss": "209268", "process_out_blocks": "6144", "process_user_time": 10.877182}
[0m06:00:14.432403 [debug] [MainThread]: Command `dbt docs generate` succeeded at 06:00:14.432040 after 10.09 seconds
[0m06:00:14.433636 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m06:00:14.434688 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m06:00:14.435702 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m06:00:14.436705 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m06:00:14.437832 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m06:00:14.438799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71000600e5a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ffe20c3650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ffe0e14500>]}
[0m06:00:14.440303 [debug] [MainThread]: Flushing usage events
[0m06:00:15.967203 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:00:36.549603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afef64fbc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78aff11244d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afef88bbf0>]}


============================== 06:00:36.561086 | f34693e0-60f2-4b04-b28f-f7398adea369 ==============================
[0m06:00:36.561086 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:00:36.566602 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt docs serve --port=8080 --host=0.0.0.0', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m06:00:39.451703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f34693e0-60f2-4b04-b28f-f7398adea369', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afd0a68170>]}
[0m06:00:39.657577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f34693e0-60f2-4b04-b28f-f7398adea369', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afef71ddf0>]}
[0m06:02:16.015808 [error] [MainThread]: Encountered an error:

[0m06:02:16.025325 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m06:02:16.032358 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 99.78046, "process_in_blocks": "0", "process_kernel_time": 1.142825, "process_mem_max_rss": "196136", "process_out_blocks": "3360", "process_user_time": 7.41241}
[0m06:02:16.035031 [debug] [MainThread]: Command `dbt docs serve` failed at 06:02:16.034576 after 99.78 seconds
[0m06:02:16.036302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afef83ce00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afef14c5c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78afcb220f50>]}
[0m06:02:16.038121 [debug] [MainThread]: Flushing usage events
[0m06:02:17.521157 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:03:55.946017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3cbc803b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3cb7feea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3cb7fede0>]}


============================== 06:03:55.956785 | ea20dcf5-bd25-4afb-ad97-95cd41b41040 ==============================
[0m06:03:55.956785 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:03:55.958559 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs serve --port=8080 --host=192.168.241.136', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:03:58.815027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ea20dcf5-bd25-4afb-ad97-95cd41b41040', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3a74d2f90>]}
[0m06:03:59.011973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ea20dcf5-bd25-4afb-ad97-95cd41b41040', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3cb528a40>]}
[0m06:03:59.063002 [error] [MainThread]: Encountered an error:
[Errno 99] Cannot assign requested address
[0m06:03:59.068848 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socketserver.py", line 457, in __init__
    self.server_bind()
  File "/usr/local/lib/python3.12/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
OSError: [Errno 99] Cannot assign requested address

[0m06:03:59.072779 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 3.420068, "process_in_blocks": "0", "process_kernel_time": 1.093275, "process_mem_max_rss": "196252", "process_out_blocks": "3360", "process_user_time": 7.30511}
[0m06:03:59.075133 [debug] [MainThread]: Command `dbt docs serve` failed at 06:03:59.074560 after 3.42 seconds
[0m06:03:59.076388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3ce16c500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3cd2d81a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a3a73b6390>]}
[0m06:03:59.078027 [debug] [MainThread]: Flushing usage events
[0m06:04:00.603676 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:04:17.616097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a46915f1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a469037ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a469104f80>]}


============================== 06:04:17.626436 | bed575cf-377c-4a58-af57-9ff5edf991b1 ==============================
[0m06:04:17.626436 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:04:17.628989 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt docs serve --port=8080 --host=127.0.0.1', 'send_anonymous_usage_stats': 'True'}
[0m06:04:20.553236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bed575cf-377c-4a58-af57-9ff5edf991b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a4695757c0>]}
[0m06:04:20.767731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bed575cf-377c-4a58-af57-9ff5edf991b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a4492a2e10>]}
[0m06:04:34.206460 [error] [MainThread]: Encountered an error:

[0m06:04:34.213641 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m06:04:34.218883 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 16.88949, "process_in_blocks": "0", "process_kernel_time": 1.120188, "process_mem_max_rss": "196292", "process_out_blocks": "3360", "process_user_time": 7.293671}
[0m06:04:34.221379 [debug] [MainThread]: Command `dbt docs serve` failed at 06:04:34.220671 after 16.89 seconds
[0m06:04:34.222841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a468d2a450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a448ec72c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a468c477d0>]}
[0m06:04:34.224196 [debug] [MainThread]: Flushing usage events
[0m06:04:35.779552 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:05:11.602435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714455dcfec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714457238740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714455dcee10>]}


============================== 06:05:11.613516 | 1438c702-cff1-4809-ad96-4368e48738ce ==============================
[0m06:05:11.613516 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:05:11.615942 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:05:14.502307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1438c702-cff1-4809-ad96-4368e48738ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7144354bbb90>]}
[0m06:05:14.715839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1438c702-cff1-4809-ad96-4368e48738ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714436d88200>]}
[0m06:27:40.601179 [error] [MainThread]: Encountered an error:

[0m06:27:40.613428 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m06:27:40.621483 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 1349.3115, "process_in_blocks": "0", "process_kernel_time": 1.189741, "process_mem_max_rss": "196172", "process_out_blocks": "3368", "process_user_time": 7.66778}
[0m06:27:40.626706 [debug] [MainThread]: Command `dbt docs serve` failed at 06:27:40.625957 after 1349.32 seconds
[0m06:27:40.633414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714455a51bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714455e5d580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714435c23380>]}
[0m06:27:40.635034 [debug] [MainThread]: Flushing usage events
[0m06:27:42.102250 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:28:39.463542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a3067c5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a2f5922d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a30926660>]}


============================== 06:28:39.479379 | 6707c177-fa6c-419a-8b63-de204478dfe6 ==============================
[0m06:28:39.479379 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:28:39.482275 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m06:28:43.689337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6707c177-fa6c-419a-8b63-de204478dfe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a2eb3b920>]}
[0m06:28:43.897137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6707c177-fa6c-419a-8b63-de204478dfe6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a2eca31a0>]}
[0m06:54:02.674319 [error] [MainThread]: Encountered an error:

[0m06:54:02.692019 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m06:54:02.698445 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 1523.5347, "process_in_blocks": "69912", "process_kernel_time": 1.741261, "process_mem_max_rss": "196136", "process_out_blocks": "3376", "process_user_time": 7.822472}
[0m06:54:02.701061 [debug] [MainThread]: Command `dbt docs serve` failed at 06:54:02.700530 after 1523.54 seconds
[0m06:54:02.703120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a2ebd6300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a2eeadf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740a0b2f7800>]}
[0m06:54:02.704830 [debug] [MainThread]: Flushing usage events
[0m06:54:04.119349 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:54:21.650334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759364e96720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759363340cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759363b62ea0>]}


============================== 06:54:21.661127 | f676096c-dd3e-4eb0-abae-66008b8ffb68 ==============================
[0m06:54:21.661127 [info ] [MainThread]: Running with dbt=1.9.0
[0m06:54:21.663113 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m06:54:24.544525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759364d477d0>]}
[0m06:54:24.739168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759364df4440>]}
[0m06:54:24.741075 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m06:54:25.458645 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m06:54:26.178890 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m06:54:26.180653 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m06:54:27.333233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933e7d11c0>]}
[0m06:54:27.828530 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m06:54:27.838520 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m06:54:27.887922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933eb91970>]}
[0m06:54:27.888811 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m06:54:27.889487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7593640b0830>]}
[0m06:54:27.895455 [info ] [MainThread]: 
[0m06:54:27.896287 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m06:54:27.896891 [info ] [MainThread]: 
[0m06:54:27.897727 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m06:54:27.910212 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m06:54:27.914041 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:54:27.912749 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m06:54:27.917524 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m06:54:28.004980 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:54:28.008518 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:54:29.316660 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m06:54:29.319518 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m06:54:29.321175 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:54:29.323564 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m06:54:29.325110 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:54:29.414783 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:54:30.030495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933eb7f4a0>]}
[0m06:54:30.032425 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:54:30.047700 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m06:54:30.050355 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m06:54:30.054129 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m06:54:30.059181 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m06:54:30.049201 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m06:54:30.052282 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m06:54:30.064233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m06:54:30.056965 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m06:54:30.066801 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m06:54:30.061762 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m06:54:30.069317 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m06:54:30.071961 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m06:54:30.074833 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m06:54:30.079587 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m06:54:30.096347 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m06:54:30.118176 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m06:54:30.121668 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m06:54:30.132350 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m06:54:30.144270 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m06:54:30.159697 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m06:54:30.158330 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m06:54:30.178722 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m06:54:30.180850 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m06:54:30.238461 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m06:54:30.326973 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:54:30.506253 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m06:54:30.511094 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m06:54:30.522363 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m06:54:30.524261 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m06:54:30.527361 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m06:54:30.530397 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:54:30.532588 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m06:54:30.623175 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:54:30.534542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:54:31.169558 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m06:54:31.172997 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m06:54:31.383574 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:596a30b1-85bd-491f-ad55-f2116276f3c2&page=queryresults
[0m06:54:31.394671 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0d821e1e-6c03-4bda-acc0-c3b05639876d&page=queryresults
[0m06:54:31.408772 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5880c22f-769a-4c59-8a5e-0a960f790c9f&page=queryresults
[0m06:54:31.449387 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ff83fd79-5950-44c5-a36d-a7c5977c8284&page=queryresults
[0m06:54:31.969426 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933f110590>]}
[0m06:54:31.970731 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933ec55040>]}
[0m06:54:31.978230 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933eff8380>]}
[0m06:54:31.973433 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.89s]
[0m06:54:31.989823 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m06:54:31.982969 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.89s]
[0m06:54:31.992589 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m06:54:31.985899 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.90s]
[0m06:54:31.995906 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m06:54:32.001414 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m06:54:32.005072 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m06:54:32.007417 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m06:54:32.009290 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m06:54:32.011262 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m06:54:32.013615 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m06:54:32.024909 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m06:54:32.032120 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m06:54:32.029835 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m06:54:32.043739 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m06:54:32.046203 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m06:54:32.048319 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:54:32.050042 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m06:54:32.052363 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:54:32.058465 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m06:54:32.069400 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m06:54:32.072883 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m06:54:32.079370 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m06:54:32.084253 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m06:54:32.088222 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.medicines)
[0m06:54:32.090409 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m06:54:32.098850 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m06:54:32.110251 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m06:54:32.114142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:54:32.196331 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m06:54:32.208449 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:54:32.625949 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m06:54:32.629792 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m06:54:32.651959 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m06:54:32.654716 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m06:54:32.994217 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d70c5f0>]}
[0m06:54:32.996553 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.92s]
[0m06:54:32.999211 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m06:54:33.306493 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8ad90876-394e-4abb-b361-42498fb2497a&page=queryresults
[0m06:54:33.311289 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:dfe85bb4-1139-4d58-8dfd-67ef0acaa784&page=queryresults
[0m06:54:34.568159 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d7206b0>]}
[0m06:54:34.571490 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.52s]
[0m06:54:34.575576 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m06:54:34.584511 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m06:54:34.586681 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m06:54:34.588932 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.visits_enhanced)
[0m06:54:34.590671 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m06:54:34.605464 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m06:54:34.608206 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m06:54:34.619973 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:54:34.833712 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d71aed0>]}
[0m06:54:34.836497 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.75s]
[0m06:54:34.839357 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m06:54:34.843522 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m06:54:34.845583 [info ] [Thread-1 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m06:54:34.847919 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m06:54:34.849511 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m06:54:34.862204 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m06:54:34.865152 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m06:54:34.872170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:54:35.190551 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m06:54:35.192962 [debug] [Thread-3 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m06:54:35.330207 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m06:54:35.334558 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m06:54:35.448960 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:75a66484-5f00-45a6-87fc-b48fd3e71b73&page=queryresults
[0m06:54:35.568417 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f4e75951-dc78-4ade-86f7-3473459aed7e&page=queryresults
[0m06:54:36.953161 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933ec916a0>]}
[0m06:54:36.955658 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.36s]
[0m06:54:36.958389 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m06:54:36.968516 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m06:54:36.971247 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m06:54:36.973656 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m06:54:36.975749 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m06:54:36.980025 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m06:54:36.981563 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m06:54:36.984832 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m06:54:36.988306 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m06:54:37.013543 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m06:54:37.017337 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m06:54:37.022031 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m06:54:37.024342 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m06:54:37.031629 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:54:37.118382 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:54:37.132437 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d71acf0>]}
[0m06:54:37.136839 [info ] [Thread-1 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.28s]
[0m06:54:37.139204 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m06:54:37.222239 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m06:54:37.227296 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m06:54:37.235172 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m06:54:37.236147 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m06:54:37.250695 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m06:54:37.253412 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m06:54:37.259291 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:54:37.630949 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m06:54:37.633970 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m06:54:37.660648 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m06:54:37.663673 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m06:54:37.720772 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m06:54:37.723731 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m06:54:37.905095 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:678d926b-44dd-4765-ae41-22341cdb1953&page=queryresults
[0m06:54:37.911191 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e3d1e069-6aa8-42cb-bdda-1e6b206b2ce8&page=queryresults
[0m06:54:37.990029 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0ed9ed23-693a-431c-985b-a437b7d9323f&page=queryresults
[0m06:54:39.380623 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d75fdd0>]}
[0m06:54:39.385334 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.40s]
[0m06:54:39.390235 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m06:54:39.427574 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d74cb60>]}
[0m06:54:39.435692 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.45s]
[0m06:54:39.439113 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m06:54:39.452443 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m06:54:39.465186 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m06:54:39.454534 [info ] [Thread-1 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m06:54:39.477534 [info ] [Thread-4 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m06:54:39.481128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m06:54:39.482580 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m06:54:39.484837 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_journey
[0m06:54:39.486616 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m06:54:39.519177 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m06:54:39.521097 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m06:54:39.532724 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m06:54:39.541040 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_journey
[0m06:54:39.543773 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:54:39.550562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:54:39.662714 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933d73cb00>]}
[0m06:54:39.742323 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.43s]
[0m06:54:39.745238 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m06:54:40.121788 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m06:54:40.125136 [debug] [Thread-4 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m06:54:40.152821 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m06:54:40.155498 [debug] [Thread-1 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,  -- Using correct field name from patients table
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,  -- Renamed to full_name
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    p.prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
),

enhanced_prescriptions AS (
  SELECT
    pd.*,
    (SELECT MIN(v.visit_id) 
      FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
      WHERE v.patient_id = pd.patient_id 
        AND v.doctor_id = pd.doctor_id
        AND v.visit_date <= pd.prescription_date
      ORDER BY v.visit_date DESC
      LIMIT 1
    ) AS associated_visit_id
  FROM prescription_details pd
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,  -- Using consistent naming
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  ep.prescription_id,
  COALESCE(ep.medicine_name, 'No Prescription') AS medicine_name,
  ep.dosage,
  ep.duration,
  COALESCE(ep.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(ep.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN ep.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(ep.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient,
  
  -- Timeline analysis
  FIRST_VALUE(vd.diagnosis) OVER (
    PARTITION BY vd.patient_id 
    ORDER BY vd.visit_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
  ) AS first_diagnosis,
  
  LAST_VALUE(vd.diagnosis) OVER (
    PARTITION BY vd.patient_id 
    ORDER BY vd.visit_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
  ) AS latest_diagnosis

FROM visit_details vd
LEFT JOIN enhanced_prescriptions ep ON 
  vd.visit_id = ep.associated_visit_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m06:54:40.369674 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:88acadc2-9fb7-42fe-b337-be43449bca22&page=queryresults
[0m06:54:40.390039 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2a68808a-7ca2-4f05-9356-6211e5388beb&page=queryresults
[0m06:54:40.511450 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2a68808a-7ca2-4f05-9356-6211e5388beb&page=queryresults
[0m06:54:40.555361 [debug] [Thread-1 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name prescription_date not found inside p at [51:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m06:54:40.557505 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933ecabfe0>]}
[0m06:54:40.559975 [error] [Thread-1 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 1.08s]
[0m06:54:40.562474 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m06:54:40.565039 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name prescription_date not found inside p at [51:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m06:54:41.856476 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f676096c-dd3e-4eb0-abae-66008b8ffb68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933dbf2810>]}
[0m06:54:41.858948 [info ] [Thread-4 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.37s]
[0m06:54:41.861564 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m06:54:41.869658 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m06:54:41.876330 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:54:41.878017 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m06:54:41.879221 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m06:54:41.880306 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m06:54:41.881347 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m06:54:41.882852 [info ] [MainThread]: 
[0m06:54:41.884073 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 13.98 seconds (13.98s).
[0m06:54:41.895634 [debug] [MainThread]: Command end result
[0m06:54:41.985837 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m06:54:41.991147 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m06:54:42.014300 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m06:54:42.015653 [info ] [MainThread]: 
[0m06:54:42.018336 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m06:54:42.019974 [info ] [MainThread]: 
[0m06:54:42.021396 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Name prescription_date not found inside p at [51:7]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m06:54:42.022931 [info ] [MainThread]: 
[0m06:54:42.024676 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m06:54:42.029152 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 20.668669, "process_in_blocks": "6368", "process_kernel_time": 1.936304, "process_mem_max_rss": "214308", "process_out_blocks": "3840", "process_user_time": 13.219462}
[0m06:54:42.031563 [debug] [MainThread]: Command `dbt run` failed at 06:54:42.031077 after 20.67 seconds
[0m06:54:42.032843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759363775af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75933f54a7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75934f338740>]}
[0m06:54:42.034182 [debug] [MainThread]: Flushing usage events
[0m06:54:43.480452 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:02:51.444758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f055de7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f055ddcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f055dc800>]}


============================== 07:02:51.455625 | 4dbdaa08-0818-4c34-8db3-1ea173aa033b ==============================
[0m07:02:51.455625 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:02:51.458068 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m07:02:54.373320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f05059ac0>]}
[0m07:02:54.567387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee54ad160>]}
[0m07:02:54.569587 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m07:02:55.291604 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m07:02:55.708495 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:02:55.710634 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m07:02:56.788694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4ca9a00>]}
[0m07:02:57.260616 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:02:57.270672 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:02:57.321988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4c69970>]}
[0m07:02:57.323759 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m07:02:57.324668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f050d08c0>]}
[0m07:02:57.331746 [info ] [MainThread]: 
[0m07:02:57.333347 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:02:57.334800 [info ] [MainThread]: 
[0m07:02:57.337074 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:02:57.351103 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:02:57.353240 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:02:57.355073 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:02:57.357436 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:02:57.360590 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:02:57.368905 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:02:58.856650 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m07:02:58.859245 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m07:02:58.865264 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:02:58.863302 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m07:02:58.861356 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:02:58.950025 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:02:59.534163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4c7b470>]}
[0m07:02:59.535723 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:02:59.550633 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:02:59.552357 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:02:59.553825 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:02:59.555749 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:02:59.558927 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:02:59.561262 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:02:59.565634 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:02:59.569197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m07:02:59.571076 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m07:02:59.573527 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:02:59.577969 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m07:02:59.580381 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:02:59.582266 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:02:59.584603 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:02:59.586360 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:02:59.623226 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:02:59.624845 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:02:59.621553 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:02:59.635234 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:02:59.645795 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:02:59.647363 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:02:59.654343 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:02:59.668851 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:02:59.686290 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:02:59.844584 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:02:59.974677 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:02:59.987457 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:02:59.992493 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m07:02:59.995015 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:03:00.002471 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m07:03:00.091558 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:03:00.096231 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:03:00.186403 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m07:03:00.189128 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:03:00.569352 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:03:00.571970 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m07:03:00.780471 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:66a9ec07-f4ad-4f0f-be73-c90d34674e9e&page=queryresults
[0m07:03:00.788357 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4fe53fae-1e42-4730-8c83-ad33b1c1c54d&page=queryresults
[0m07:03:00.817607 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9ecebce6-692b-4615-ab86-141146bdff33&page=queryresults
[0m07:03:00.867583 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cfed719d-fae0-486f-8244-4f2ef620f29d&page=queryresults
[0m07:03:01.297319 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f05cf6480>]}
[0m07:03:01.299987 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m07:03:01.302537 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:03:01.304544 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4333050>]}
[0m07:03:01.306967 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4dcd8e0>]}
[0m07:03:01.309276 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.72s]
[0m07:03:01.314145 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m07:03:01.317472 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:03:01.320399 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:03:01.325589 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m07:03:01.327516 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m07:03:01.329378 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m07:03:01.330835 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m07:03:01.332429 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m07:03:01.334063 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m07:03:01.336166 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:03:01.338243 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m07:03:01.349326 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m07:03:01.351250 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m07:03:01.366212 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m07:03:01.365029 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m07:03:01.377460 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:03:01.387179 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:03:01.397239 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m07:03:01.401016 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m07:03:01.403303 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:03:01.406776 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m07:03:01.408828 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m07:03:01.411403 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:03:01.413525 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m07:03:01.426479 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:03:01.524375 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:03:01.536253 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m07:03:01.541469 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m07:03:01.548571 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:03:01.966149 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:03:01.974307 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:03:01.978428 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:03:01.986260 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:03:02.343422 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee42f4e90>]}
[0m07:03:02.345669 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.76s]
[0m07:03:02.348782 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:03:02.568569 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cce76f1e-a35a-4d80-b577-721076abf724&page=queryresults
[0m07:03:02.633130 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:fcc9c276-852e-432f-8127-376ee66ceb43&page=queryresults
[0m07:03:04.144040 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4116090>]}
[0m07:03:04.145809 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.74s]
[0m07:03:04.148281 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m07:03:04.151655 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:03:04.153426 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:03:04.155970 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.visits_enhanced)
[0m07:03:04.157263 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:03:04.168971 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:03:04.171768 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:03:04.178672 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:03:04.263542 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee42f4f80>]}
[0m07:03:04.266081 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.91s]
[0m07:03:04.269064 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m07:03:04.272400 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:03:04.274013 [info ] [Thread-3 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:03:04.276218 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m07:03:04.277900 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:03:04.294910 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:03:04.297650 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:03:04.304521 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:03:04.934196 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:03:04.937324 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:03:04.970007 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:03:04.973455 [debug] [Thread-2 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:03:05.232449 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:78e378b9-3221-416d-8dd1-06c3e5a43c22&page=queryresults
[0m07:03:05.278401 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4c026be0-d862-4a9d-8c82-81c8ef61b862&page=queryresults
[0m07:03:06.685912 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee43e4890>]}
[0m07:03:06.688532 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.53s]
[0m07:03:06.699954 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:03:06.707938 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:03:06.709550 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:03:06.712077 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m07:03:06.716961 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m07:03:06.723551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m07:03:06.727791 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m07:03:06.731546 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:03:06.733442 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:03:06.746511 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:03:06.757723 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:03:06.761822 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:03:06.768940 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:03:06.770449 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:03:06.862735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:03:06.953804 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee43d4dd0>]}
[0m07:03:06.959272 [info ] [Thread-3 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.68s]
[0m07:03:06.967409 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:03:06.973197 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:03:06.976094 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m07:03:06.978390 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m07:03:06.980155 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:03:06.990505 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:03:06.992751 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:03:06.999754 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:03:07.514083 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m07:03:07.516549 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m07:03:07.531550 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m07:03:07.534957 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m07:03:07.538678 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m07:03:07.540477 [debug] [Thread-2 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m07:03:07.788232 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:72af20a5-7718-42d9-8bb6-eb4f022f1072&page=queryresults
[0m07:03:07.960476 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6b91576c-5ca4-42c5-ac98-7dabfaf1ac00&page=queryresults
[0m07:03:07.964088 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5929ee9f-68aa-40f4-8552-d98d9520073c&page=queryresults
[0m07:03:09.315734 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee413c2f0>]}
[0m07:03:09.318086 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.59s]
[0m07:03:09.320021 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:03:09.323537 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m07:03:09.326530 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:03:09.325464 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m07:03:09.331178 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m07:03:09.329453 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m07:03:09.333847 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:03:09.335874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m07:03:09.349884 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:03:09.352052 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:03:09.376574 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:03:09.372289 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:03:09.385738 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:03:09.390780 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:03:09.481790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:03:09.754010 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee43d4dd0>]}
[0m07:03:09.755846 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.78s]
[0m07:03:09.757319 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:03:09.803724 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4109a00>]}
[0m07:03:09.805822 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 3.08s]
[0m07:03:09.817788 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:03:09.931015 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m07:03:09.934376 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m07:03:09.943451 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m07:03:09.947925 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,  -- Using correct field name from patients table
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,  -- Renamed to full_name
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
),

enhanced_prescriptions AS (
  SELECT
    pd.*,
    (SELECT MIN(v.visit_id) 
      FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
      WHERE v.patient_id = pd.patient_id 
        AND v.doctor_id = pd.doctor_id
      ORDER BY v.visit_date DESC
      LIMIT 1
    ) AS associated_visit_id
  FROM prescription_details pd
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,  -- Using consistent naming
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  ep.prescription_id,
  COALESCE(ep.medicine_name, 'No Prescription') AS medicine_name,
  ep.dosage,
  ep.duration,
  COALESCE(ep.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(ep.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN ep.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(ep.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient,
  
  -- Timeline analysis
  FIRST_VALUE(vd.diagnosis) OVER (
    PARTITION BY vd.patient_id 
    ORDER BY vd.visit_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
  ) AS first_diagnosis,
  
  LAST_VALUE(vd.diagnosis) OVER (
    PARTITION BY vd.patient_id 
    ORDER BY vd.visit_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
  ) AS latest_diagnosis

FROM visit_details vd
LEFT JOIN enhanced_prescriptions ep ON 
  vd.visit_id = ep.associated_visit_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m07:03:10.179673 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d9a67c32-03f8-4478-8c6b-630cecb89845&page=queryresults
[0m07:03:10.199654 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:51ebb043-4652-42db-90ca-052d1965c40a&page=queryresults
[0m07:03:10.388739 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:51ebb043-4652-42db-90ca-052d1965c40a&page=queryresults
[0m07:03:10.408704 [debug] [Thread-3 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  ORDER BY clause expression references v.visit_date which is neither grouped nor aggregated at [73:16]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m07:03:10.411079 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee411c5c0>]}
[0m07:03:10.413301 [error] [Thread-3 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 1.08s]
[0m07:03:10.417219 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:03:10.419384 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  ORDER BY clause expression references v.visit_date which is neither grouped nor aggregated at [73:16]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m07:03:11.942011 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dbdaa08-0818-4c34-8db3-1ea173aa033b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4156810>]}
[0m07:03:11.947645 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.61s]
[0m07:03:11.953157 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:03:11.967217 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:03:11.978451 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:03:11.979748 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:03:11.983368 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:03:11.984580 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:03:11.985747 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m07:03:11.990056 [info ] [MainThread]: 
[0m07:03:11.995839 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 14.65 seconds (14.65s).
[0m07:03:12.008559 [debug] [MainThread]: Command end result
[0m07:03:12.096052 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:03:12.101028 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:03:12.120728 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m07:03:12.121980 [info ] [MainThread]: 
[0m07:03:12.123454 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m07:03:12.124670 [info ] [MainThread]: 
[0m07:03:12.126316 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  ORDER BY clause expression references v.visit_date which is neither grouped nor aggregated at [73:16]
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m07:03:12.127635 [info ] [MainThread]: 
[0m07:03:12.129300 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m07:03:12.133561 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 20.961718, "process_in_blocks": "0", "process_kernel_time": 1.837298, "process_mem_max_rss": "214260", "process_out_blocks": "3808", "process_user_time": 13.11045}
[0m07:03:12.135764 [debug] [MainThread]: Command `dbt run` failed at 07:03:12.135307 after 20.96 seconds
[0m07:03:12.137103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f055dc800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4d7a720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7ee4b042c0>]}
[0m07:03:12.138445 [debug] [MainThread]: Flushing usage events
[0m07:03:13.623000 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:06:05.272050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128bafe5a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128a9fa2a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128a0f83b0>]}


============================== 07:06:05.282417 | 14477b3b-e1ed-4808-b777-f2fe372b4613 ==============================
[0m07:06:05.282417 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:06:05.284281 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:06:08.280324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128b9e7500>]}
[0m07:06:08.491965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128a1cb2c0>]}
[0m07:06:08.494699 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m07:06:09.229331 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m07:06:09.667649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:06:09.670037 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/marts/patient_journey.sql
[0m07:06:10.811334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012697998e0>]}
[0m07:06:11.278844 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:06:11.288579 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:06:11.341202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012698543e0>]}
[0m07:06:11.343155 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m07:06:11.345080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128aaf54c0>]}
[0m07:06:11.352027 [info ] [MainThread]: 
[0m07:06:11.353701 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:06:11.355284 [info ] [MainThread]: 
[0m07:06:11.357118 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:06:11.373644 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:06:11.376746 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:06:11.465054 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:06:11.471935 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:06:11.473626 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:06:11.481122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:06:12.725422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m07:06:12.727315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:06:12.729004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m07:06:12.731831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m07:06:12.733982 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:06:12.819135 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:06:13.354519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70126987acf0>]}
[0m07:06:13.357003 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:06:13.368639 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:06:13.372269 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:06:13.374608 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:06:13.376912 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:06:13.373778 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:06:13.378734 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:06:13.386136 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:06:13.391572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:06:13.388807 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:06:13.396220 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:06:13.398637 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:06:13.400477 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:06:13.403227 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:06:13.407049 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:06:13.411538 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:06:13.431216 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:06:13.439280 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:06:13.456535 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:06:13.466769 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:06:13.473832 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:06:13.477389 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:06:13.479928 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:06:13.482035 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:06:13.489294 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:06:13.752213 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:06:13.930206 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:06:13.939532 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:06:13.944131 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:06:13.950075 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m07:06:13.951191 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:06:14.041436 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m07:06:14.044902 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:06:14.047278 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m07:06:14.131951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:06:14.569687 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:06:14.572947 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m07:06:14.748350 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8de88840-4b8a-4f26-828f-d67a600614e1&page=queryresults
[0m07:06:14.794352 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a377b8ae-9fea-492d-90f7-aad00c469f8b&page=queryresults
[0m07:06:14.802441 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9a1627f9-0649-40c5-ba78-a348a7daced3&page=queryresults
[0m07:06:14.827889 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8d9de64f-8626-4712-8191-2c24ec40d3ae&page=queryresults
[0m07:06:15.215269 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268f3f650>]}
[0m07:06:15.216495 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012698427e0>]}
[0m07:06:15.218826 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m07:06:15.222507 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701269844e90>]}
[0m07:06:15.225108 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m07:06:15.229254 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:06:15.232339 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m07:06:15.236325 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:06:15.241894 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m07:06:15.240841 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:06:15.239434 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m07:06:15.248690 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m07:06:15.244713 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m07:06:15.242797 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m07:06:15.253389 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m07:06:15.251999 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:06:15.250328 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m07:06:15.261293 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m07:06:15.263037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m07:06:15.273303 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m07:06:15.275291 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m07:06:15.277789 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:06:15.286409 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:06:15.289730 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:06:15.297467 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m07:06:15.299988 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m07:06:15.306419 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m07:06:15.315224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:06:15.316987 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m07:06:15.320545 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:06:15.401233 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.medicines)
[0m07:06:15.406223 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m07:06:15.419551 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:06:15.421971 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m07:06:15.430602 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:06:15.840417 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:06:15.843229 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:06:15.909632 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:06:15.912547 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:06:16.436929 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:43590a6d-9834-4963-a17f-e63546e04839&page=queryresults
[0m07:06:16.582231 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:38b4ee42-db4f-437c-a854-5c1b40851821&page=queryresults
[0m07:06:16.584559 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701269991f10>]}
[0m07:06:16.591183 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.18s]
[0m07:06:16.594246 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:06:17.932661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268b3c350>]}
[0m07:06:17.934738 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.67s]
[0m07:06:17.936653 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m07:06:17.939061 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:06:17.940659 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:06:17.944524 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m07:06:17.945536 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:06:17.957231 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:06:17.963070 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:06:17.976389 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:06:18.103421 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70126871f380>]}
[0m07:06:18.107758 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.70s]
[0m07:06:18.116084 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m07:06:18.121783 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:06:18.123738 [info ] [Thread-1 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:06:18.133119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m07:06:18.134488 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:06:18.160189 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:06:18.162653 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:06:18.168552 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:06:18.675415 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:06:18.679817 [debug] [Thread-2 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:06:18.978828 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:06:18.980924 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:06:19.117514 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:44ef8d28-5ffe-46ae-8d25-2d4318f32c90&page=queryresults
[0m07:06:19.259069 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b84eb611-81b4-4c6d-8487-3bc83d076245&page=queryresults
[0m07:06:20.762118 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268fcecc0>]}
[0m07:06:20.763691 [info ] [Thread-1 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.63s]
[0m07:06:20.765977 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:06:20.901678 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268720bf0>]}
[0m07:06:20.904626 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.96s]
[0m07:06:20.909568 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:06:20.916054 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:06:20.918439 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:06:20.920718 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m07:06:20.923648 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m07:06:20.925994 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:06:20.927763 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m07:06:20.929587 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.doctor_performance)
[0m07:06:20.931379 [info ] [Thread-1 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m07:06:20.933669 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:06:20.936164 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:06:20.938211 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m07:06:20.954395 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:06:20.962327 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:06:20.979576 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:06:20.990946 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:06:20.994149 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:06:20.997419 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:06:21.007954 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:06:21.012681 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:06:21.110536 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:06:21.125519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:06:21.828785 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m07:06:21.831626 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m07:06:21.869523 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m07:06:21.872398 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m07:06:21.895545 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m07:06:21.898720 [debug] [Thread-1 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m07:06:22.125691 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:30df69e5-9859-4e6c-b88b-08a752a5adad&page=queryresults
[0m07:06:22.133639 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:28a934c5-e693-4dd5-b9c7-eee87d0594a2&page=queryresults
[0m07:06:22.167393 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4b5f17dc-e61e-4a79-9784-c0b8dca6759e&page=queryresults
[0m07:06:23.713247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268762ae0>]}
[0m07:06:23.715250 [info ] [Thread-1 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.78s]
[0m07:06:23.717622 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:06:23.862598 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012687632c0>]}
[0m07:06:23.864209 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.94s]
[0m07:06:23.866748 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:06:23.870653 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m07:06:23.872541 [info ] [Thread-2 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m07:06:23.874498 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:06:23.877116 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m07:06:23.881583 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m07:06:23.884395 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:06:23.886116 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m07:06:23.906377 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:06:23.909215 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268754860>]}
[0m07:06:23.910791 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:06:23.914454 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.98s]
[0m07:06:23.924224 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:06:23.926818 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:06:23.935817 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:06:23.946125 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:06:24.033714 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:06:24.043223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:06:24.608072 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m07:06:24.613491 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m07:06:24.617394 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m07:06:24.619696 [debug] [Thread-2 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,  -- Using correct field name from patients table
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,  -- Renamed to full_name
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
),

enhanced_prescriptions AS (
  SELECT
    pd.*,
    (SELECT MIN(v.visit_id) 
      FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
      WHERE v.patient_id = pd.patient_id 
        AND v.doctor_id = pd.doctor_id
      LIMIT 1
    ) AS associated_visit_id
  FROM prescription_details pd
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,  -- Using consistent naming
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  ep.prescription_id,
  COALESCE(ep.medicine_name, 'No Prescription') AS medicine_name,
  ep.dosage,
  ep.duration,
  COALESCE(ep.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(ep.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN ep.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(ep.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient,
  
  -- Timeline analysis
  FIRST_VALUE(vd.diagnosis) OVER (
    PARTITION BY vd.patient_id 
    ORDER BY vd.visit_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
  ) AS first_diagnosis,
  
  LAST_VALUE(vd.diagnosis) OVER (
    PARTITION BY vd.patient_id 
    ORDER BY vd.visit_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
  ) AS latest_diagnosis

FROM visit_details vd
LEFT JOIN enhanced_prescriptions ep ON 
  vd.visit_id = ep.associated_visit_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m07:06:24.912923 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:09ecb053-892b-40f5-b96d-ad12df401c22&page=queryresults
[0m07:06:24.920348 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f3a3fe5c-71b5-45b5-8f40-9cdb656ff207&page=queryresults
[0m07:06:25.052588 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:09ecb053-892b-40f5-b96d-ad12df401c22&page=queryresults
[0m07:06:25.075561 [debug] [Thread-2 (]: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Correlated subqueries that reference other tables are not supported unless they can be de-correlated, such as by transforming them into an efficient JOIN.
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m07:06:25.077672 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7012687612e0>]}
[0m07:06:25.080162 [error] [Thread-2 (]: 12 of 13 ERROR creating sql table model hospital_analytics.patient_journey ..... [[31mERROR[0m in 1.20s]
[0m07:06:25.083201 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:06:25.085211 [debug] [Thread-7 (]: Marking all children of 'model.hospital_analytics.patient_journey' to be skipped because of status 'error'.  Reason: Database Error in model patient_journey (models/marts/patient_journey.sql)
  Correlated subqueries that reference other tables are not supported unless they can be de-correlated, such as by transforming them into an efficient JOIN.
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql.
[0m07:06:27.364100 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14477b3b-e1ed-4808-b777-f2fe372b4613', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701268763aa0>]}
[0m07:06:27.366626 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 3.48s]
[0m07:06:27.373541 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:06:27.395355 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:06:27.401684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:06:27.403402 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:06:27.405481 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:06:27.406846 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m07:06:27.407844 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:06:27.410028 [info ] [MainThread]: 
[0m07:06:27.411606 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 16.05 seconds (16.05s).
[0m07:06:27.431334 [debug] [MainThread]: Command end result
[0m07:06:27.537380 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:06:27.547231 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:06:27.572760 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m07:06:27.574243 [info ] [MainThread]: 
[0m07:06:27.575936 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m07:06:27.577351 [info ] [MainThread]: 
[0m07:06:27.578765 [error] [MainThread]:   Database Error in model patient_journey (models/marts/patient_journey.sql)
  Correlated subqueries that reference other tables are not supported unless they can be de-correlated, such as by transforming them into an efficient JOIN.
  compiled code at target/run/hospital_analytics/models/marts/patient_journey.sql
[0m07:06:27.580567 [info ] [MainThread]: 
[0m07:06:27.582297 [info ] [MainThread]: Done. PASS=12 WARN=0 ERROR=1 SKIP=0 TOTAL=13
[0m07:06:27.586565 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 22.614391, "process_in_blocks": "0", "process_kernel_time": 1.834771, "process_mem_max_rss": "214212", "process_out_blocks": "3800", "process_user_time": 13.538044}
[0m07:06:27.588752 [debug] [MainThread]: Command `dbt run` failed at 07:06:27.588320 after 22.62 seconds
[0m07:06:27.590319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70128bafe5a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701269a19d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70126979a900>]}
[0m07:06:27.592087 [debug] [MainThread]: Flushing usage events
[0m07:06:29.323493 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:17:11.543783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbbb76870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbbb48a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbb60f500>]}


============================== 07:17:11.553476 | 7556c440-2389-4147-81ed-2f39946278eb ==============================
[0m07:17:11.553476 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:17:11.555824 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt clean', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:17:11.931717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7556c440-2389-4147-81ed-2f39946278eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbbde1f70>]}
[0m07:17:12.010207 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.76092815, "process_in_blocks": "168", "process_kernel_time": 0.67695, "process_mem_max_rss": "87756", "process_out_blocks": "8", "process_user_time": 4.780587}
[0m07:17:12.012634 [debug] [MainThread]: Command `dbt clean` succeeded at 07:17:12.012072 after 0.76 seconds
[0m07:17:12.014200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbbd7bb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbb60f500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecdbb73d370>]}
[0m07:17:12.015810 [debug] [MainThread]: Flushing usage events
[0m07:17:13.493061 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:17:22.480605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257ba72f200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257bcde8980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257ba72c800>]}


============================== 07:17:22.491097 | 28e0a646-8bad-4fbc-806c-413d5c14e0a2 ==============================
[0m07:17:22.491097 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:17:22.493045 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:17:25.377437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725796596420>]}
[0m07:17:25.578183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725796aa5910>]}
[0m07:17:25.580260 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m07:17:26.268680 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m07:17:26.271210 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:17:26.272732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257960ff170>]}
[0m07:17:31.363596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725795c412e0>]}
[0m07:17:31.643537 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:17:31.652582 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:17:31.705160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257955ed520>]}
[0m07:17:31.706907 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m07:17:31.708425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72579559a570>]}
[0m07:17:31.719999 [info ] [MainThread]: 
[0m07:17:31.721680 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:17:31.722930 [info ] [MainThread]: 
[0m07:17:31.724732 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:17:31.740320 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:17:31.742241 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:31.745206 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:17:31.757539 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:17:31.845514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:31.852537 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:33.332766 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m07:17:33.334398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:33.417712 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m07:17:33.423700 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m07:17:33.426397 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:33.428333 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:34.019794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725795598680>]}
[0m07:17:34.021903 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:17:34.036402 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:17:34.039689 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:17:34.038435 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:17:34.043434 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:17:34.051121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:17:34.041595 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:17:34.053560 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:17:34.057080 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:17:34.055073 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:17:34.061781 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:17:34.064672 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:17:34.102635 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:17:34.098267 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:17:34.100025 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:17:34.086107 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:17:34.116797 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:17:34.109105 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:17:34.104093 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:17:34.134618 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:17:34.152960 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:17:34.165115 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:17:34.179946 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:17:34.209637 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:17:34.235059 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:17:34.420578 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:17:34.515689 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:17:34.613664 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:17:34.617694 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:17:34.627284 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m07:17:34.629970 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:17:34.625407 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m07:17:34.631835 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m07:17:34.634454 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:17:34.732073 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:17:35.260436 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:17:35.262745 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m07:17:35.363149 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b502ac84-7d4b-4850-9c86-f6524c207c50&page=queryresults
[0m07:17:35.390085 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:da5b4934-4dee-423a-9dd0-4b1df01b2551&page=queryresults
[0m07:17:35.420932 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d920e78d-8706-4f66-ad11-25245bf2dba4&page=queryresults
[0m07:17:35.540145 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:36fc3a52-de85-4253-86db-e24b8b929bc6&page=queryresults
[0m07:17:35.960157 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257960fee70>]}
[0m07:17:35.962888 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.87s]
[0m07:17:35.971080 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257951a1970>]}
[0m07:17:35.969232 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:17:35.972930 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72579615c140>]}
[0m07:17:35.984996 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.91s]
[0m07:17:35.989295 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:17:35.981652 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.90s]
[0m07:17:35.996550 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:17:35.999670 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:17:36.003030 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:17:36.005726 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m07:17:36.007405 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:17:36.018760 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m07:17:36.022811 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:17:36.025651 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m07:17:36.028428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m07:17:36.035742 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m07:17:36.033278 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:17:36.031328 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m07:17:36.061990 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:17:36.064193 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m07:17:36.066128 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m07:17:36.182477 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m07:17:36.185209 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:17:36.197478 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m07:17:36.200047 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:17:36.202748 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m07:17:36.209511 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m07:17:36.211027 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:17:36.215242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m07:17:36.219885 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m07:17:36.233437 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:17:36.237124 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m07:17:36.252576 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:17:36.684779 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:17:36.690196 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:17:36.803503 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:17:36.808287 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:17:37.063854 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725794011f70>]}
[0m07:17:37.066720 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 2.96s]
[0m07:17:37.069821 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:17:37.390032 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0e21536f-28c9-4342-9da9-b567f8501542&page=queryresults
[0m07:17:37.536298 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:84b6b6df-5598-4c81-8c47-8133c5addf73&page=queryresults
[0m07:17:39.353663 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72579400f8f0>]}
[0m07:17:39.356761 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 3.35s]
[0m07:17:39.359557 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:17:39.775816 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257941f2c00>]}
[0m07:17:39.778592 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 3.56s]
[0m07:17:39.781128 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m07:17:39.792131 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:17:39.793612 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:17:39.797083 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:17:39.799209 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:17:39.802278 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m07:17:39.805086 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m07:17:39.806690 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:17:39.808590 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:17:39.832359 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:17:39.841003 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:17:39.848299 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:17:39.854038 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:17:39.857758 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:17:39.865658 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:17:40.432396 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:17:40.435109 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:17:40.471588 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:17:40.473796 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:17:40.710528 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:07747244-2c9f-4362-88c7-8e4208846003&page=queryresults
[0m07:17:40.751351 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:058b57e3-0ade-4fd6-8289-05d41248f1e0&page=queryresults
[0m07:17:42.193490 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725794045dc0>]}
[0m07:17:42.201417 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (234.0 rows, 12.4 KiB processed)[0m in 2.39s]
[0m07:17:42.204713 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:17:42.209821 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:17:42.212032 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m07:17:42.213651 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:17:42.215608 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m07:17:42.220615 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:17:42.218843 [info ] [Thread-2 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m07:17:42.228822 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m07:17:42.230319 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:17:42.252565 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:17:42.254650 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:17:42.259314 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:17:42.281389 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:17:42.283038 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:17:42.380967 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:17:42.590072 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725794046bd0>]}
[0m07:17:42.593978 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (230.0 rows, 12.1 KiB processed)[0m in 2.78s]
[0m07:17:42.599723 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:17:42.603599 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:17:42.606507 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m07:17:42.609757 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m07:17:42.612559 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:17:42.624125 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:17:42.638127 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:17:42.646702 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:17:42.885439 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m07:17:42.888052 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m07:17:42.895734 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m07:17:42.903234 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m07:17:43.091661 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m07:17:43.095440 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m07:17:43.129628 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e0f67990-f6d3-410e-912e-6d0f52e72289&page=queryresults
[0m07:17:43.172758 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:3864d616-3d54-4ccb-91bf-25ce1cd596d0&page=queryresults
[0m07:17:43.350213 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:699d9ddf-be4b-495c-b766-70062883d001&page=queryresults
[0m07:17:45.066962 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72579415c1a0>]}
[0m07:17:45.069657 [info ] [Thread-2 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 12.5 KiB processed)[0m in 2.84s]
[0m07:17:45.072844 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:17:45.092071 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72579400c110>]}
[0m07:17:45.096980 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (239.0 rows, 20.1 KiB processed)[0m in 2.88s]
[0m07:17:45.101044 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:17:45.104594 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m07:17:45.108261 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:17:45.106416 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m07:17:45.113871 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m07:17:45.116554 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m07:17:45.119493 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m07:17:45.121514 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:17:45.126037 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:17:45.153338 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:17:45.163820 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257945b7d70>]}
[0m07:17:45.160266 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:17:45.168512 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 8.7 KiB processed)[0m in 2.55s]
[0m07:17:45.172342 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:17:45.176699 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:17:45.189362 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:17:45.191378 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:17:45.197957 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:17:45.740618 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m07:17:45.743459 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m07:17:45.753569 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m07:17:45.757837 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m07:17:45.975309 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8a3fe049-49c6-48ca-a175-7177cb629242&page=queryresults
[0m07:17:45.987583 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2724c5f1-8e57-4d33-878c-e36ff41f9044&page=queryresults
[0m07:17:47.415903 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725794027620>]}
[0m07:17:47.418140 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 14.1 KiB processed)[0m in 2.30s]
[0m07:17:47.421014 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:17:47.688163 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e0a646-8bad-4fbc-806c-413d5c14e0a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257945b7d70>]}
[0m07:17:47.690555 [info ] [Thread-3 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (258.0 rows, 35.8 KiB processed)[0m in 2.57s]
[0m07:17:47.694459 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:17:47.706369 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:17:47.712822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:17:47.714244 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:17:47.715565 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:17:47.716946 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m07:17:47.718407 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:17:47.719932 [info ] [MainThread]: 
[0m07:17:47.721175 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 16.00 seconds (16.00s).
[0m07:17:47.734570 [debug] [MainThread]: Command end result
[0m07:17:47.825682 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:17:47.831598 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:17:47.852982 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m07:17:47.855096 [info ] [MainThread]: 
[0m07:17:47.856463 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:17:47.858074 [info ] [MainThread]: 
[0m07:17:47.859805 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m07:17:47.863812 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.657093, "process_in_blocks": "8", "process_kernel_time": 1.94441, "process_mem_max_rss": "216332", "process_out_blocks": "3776", "process_user_time": 16.651567}
[0m07:17:47.866130 [debug] [MainThread]: Command `dbt run` succeeded at 07:17:47.865554 after 25.66 seconds
[0m07:17:47.867354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257ba33d160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725795f12990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7257ba04f410>]}
[0m07:17:47.868593 [debug] [MainThread]: Flushing usage events
[0m07:17:49.282910 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:18:07.397729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74903b436720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74903b04dd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74903b844320>]}


============================== 07:18:07.408159 | bf8cc96b-5531-4aa4-adcc-bae0edeba141 ==============================
[0m07:18:07.408159 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:18:07.410356 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs generate', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:18:10.224347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bf8cc96b-5531-4aa4-adcc-bae0edeba141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x749016eedbb0>]}
[0m07:18:10.422458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bf8cc96b-5531-4aa4-adcc-bae0edeba141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7490176b6930>]}
[0m07:18:10.424652 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m07:18:11.158074 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m07:18:11.576715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:18:11.578020 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:18:11.735743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bf8cc96b-5531-4aa4-adcc-bae0edeba141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x749017e8c530>]}
[0m07:18:11.790493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bf8cc96b-5531-4aa4-adcc-bae0edeba141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7490169eb3e0>]}
[0m07:18:11.792461 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m07:18:11.793920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf8cc96b-5531-4aa4-adcc-bae0edeba141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x749016aa3140>]}
[0m07:18:11.802266 [info ] [MainThread]: 
[0m07:18:11.804052 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:18:11.805554 [info ] [MainThread]: 
[0m07:18:11.807667 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:18:11.822647 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m07:18:11.824678 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:11.840067 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m07:18:11.919972 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:11.939973 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m07:18:11.941688 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:12.470314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf8cc96b-5531-4aa4-adcc-bae0edeba141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74903cb48530>]}
[0m07:18:12.472407 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:18:12.492497 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:18:12.494744 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:18:12.496442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m07:18:12.503846 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:18:12.499838 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:18:12.501599 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:18:12.498104 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:18:12.516906 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:18:12.518823 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:18:12.520721 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:18:12.536360 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:18:12.541388 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:18:12.555073 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:18:12.556771 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:18:12.570652 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:18:12.574257 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:18:12.583410 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:18:12.597056 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:12.598305 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:18:12.600186 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:12.602529 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:18:12.609219 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:18:12.615988 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:18:12.618375 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:18:12.620253 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:18:12.626249 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:18:12.628560 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m07:18:12.634424 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:18:12.636189 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m07:18:12.638486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_parsing_issues)
[0m07:18:12.641224 [debug] [Thread-4 (]: Began running node model.hospital_analytics.medicines
[0m07:18:12.643674 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m07:18:12.664810 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m07:18:12.653280 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:18:12.662093 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.medicines)
[0m07:18:12.659405 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m07:18:12.690377 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m07:18:12.724351 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m07:18:12.700549 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.medicines
[0m07:18:12.696510 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m07:18:12.731062 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m07:18:12.734306 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m07:18:12.758835 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:18:12.769251 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:12.779116 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:12.782700 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:18:12.788942 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.medicines
[0m07:18:12.792889 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m07:18:12.806343 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:18:12.803346 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:18:12.798997 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m07:18:12.809326 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m07:18:12.822770 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:18:12.814503 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m07:18:12.821028 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.medicines
[0m07:18:12.812315 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:18:12.850638 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:18:12.862742 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m07:18:12.864434 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:18:12.868363 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m07:18:12.884078 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m07:18:12.885997 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m07:18:12.887864 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:18:12.895592 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:12.891264 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:18:12.893981 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:18:12.889353 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:18:12.901803 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:18:12.924533 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m07:18:12.926353 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m07:18:12.936908 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:18:12.946498 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m07:18:12.942336 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:18:12.948219 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:18:12.940351 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m07:18:12.950216 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:18:12.983853 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:18:12.986080 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:18:13.003507 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:18:13.005633 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m07:18:13.016422 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:18:13.018564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:13.020815 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:18:13.023073 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:18:13.025212 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:18:13.034728 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:13.032123 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:18:13.036809 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:18:13.038539 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.visits_enhanced)
[0m07:18:13.040760 [debug] [Thread-1 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m07:18:13.047543 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:18:13.059364 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m07:18:13.055468 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:18:13.057512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m07:18:13.053774 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:18:13.061261 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m07:18:13.069681 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m07:18:13.082052 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:18:13.084068 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m07:18:13.118700 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m07:18:13.127227 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m07:18:13.131029 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m07:18:13.132630 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m07:18:13.134334 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:18:13.137087 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:13.141236 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:13.144416 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:18:13.152624 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m07:18:13.166953 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:18:13.175929 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m07:18:13.181461 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:18:13.183130 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now model.hospital_analytics.billing_enhanced)
[0m07:18:13.184450 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:18:13.194059 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now model.hospital_analytics.doctor_performance)
[0m07:18:13.189028 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:18:13.191325 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:18:13.185755 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:18:13.196590 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:18:13.199626 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m07:18:13.201722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m07:18:13.232134 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:18:13.233903 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:18:13.238389 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:18:13.240443 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:18:13.244270 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:18:13.278643 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:18:13.257033 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:18:13.265390 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:18:13.277061 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m07:18:13.285780 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:18:13.291413 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:18:13.287919 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:13.293633 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:18:13.295415 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m07:18:13.313401 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:18:13.306086 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:18:13.308692 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:18:13.304263 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:18:13.326973 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:13.329645 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m07:18:13.332120 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:18:13.359384 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:18:13.369556 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:18:13.364685 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:18:13.367533 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m07:18:13.354772 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:18:13.371946 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_journey)
[0m07:18:13.373721 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:18:13.375667 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:18:13.378376 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:18:13.380230 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:18:13.398096 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:18:13.399500 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m07:18:13.428193 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:18:13.425069 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m07:18:13.668484 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:18:13.675461 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:18:13.679878 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:18:13.682041 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:18:13.684215 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:18:13.686580 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:18:13.695301 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:18:13.706414 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:18:13.709555 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:18:13.711556 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:13.718377 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:18:13.723567 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:18:13.725043 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m07:18:13.726175 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m07:18:13.727143 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:18:13.728465 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:18:13.743290 [debug] [MainThread]: Command end result
[0m07:18:14.039401 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:18:14.048656 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:18:14.073706 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m07:18:14.089302 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m07:18:14.090573 [info ] [MainThread]: Building catalog
[0m07:18:14.117180 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m07:18:14.138360 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m07:18:14.154433 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m07:18:14.190778 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m07:18:14.313119 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:18:14.317003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:14.323972 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:18:14.326751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:14.430363 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:18:14.436216 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:14.426504 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:18:14.629685 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:15.220686 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:3d5932db-55d4-4cb7-b7ab-aa62caa81716&page=queryresults
[0m07:18:15.236819 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5174ca8f-5e75-49a6-b17c-1b672c40441d&page=queryresults
[0m07:18:15.239513 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4e1df678-52c2-411f-a479-54e21fbe785f&page=queryresults
[0m07:18:15.244271 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b10ed50b-a31f-4d45-8722-c58da4154047&page=queryresults
[0m07:18:18.060687 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:18:18.111536 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m07:18:18.184251 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:18:18.189135 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:18:18.190146 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m07:18:18.194159 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 11.080038, "process_in_blocks": "136", "process_kernel_time": 1.807471, "process_mem_max_rss": "208992", "process_out_blocks": "6144", "process_user_time": 10.881514}
[0m07:18:18.196394 [debug] [MainThread]: Command `dbt docs generate` succeeded at 07:18:18.195914 after 11.08 seconds
[0m07:18:18.197686 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m07:18:18.199078 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m07:18:18.200452 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m07:18:18.201465 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m07:18:18.202646 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m07:18:18.203832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74903b5b8ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7490168df230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74901692ba10>]}
[0m07:18:18.205166 [debug] [MainThread]: Flushing usage events
[0m07:18:20.236988 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:20:27.516521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc1477d5010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc147818a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc1477d58e0>]}


============================== 07:20:27.527354 | b2b78295-c85c-4821-87ee-c72045b2a852 ==============================
[0m07:20:27.527354 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:20:27.529432 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt clean', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:20:27.880599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2b78295-c85c-4821-87ee-c72045b2a852', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc147d2dee0>]}
[0m07:20:27.928115 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.6900794, "process_in_blocks": "0", "process_kernel_time": 0.68285, "process_mem_max_rss": "87800", "process_out_blocks": "16", "process_user_time": 4.558324}
[0m07:20:27.930425 [debug] [MainThread]: Command `dbt clean` succeeded at 07:20:27.929973 after 0.69 seconds
[0m07:20:27.932086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc147931c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc148f8cc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc147193110>]}
[0m07:20:27.933459 [debug] [MainThread]: Flushing usage events
[0m07:20:29.392145 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:20:38.692846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a674a32f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a679a3650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a674a35c0>]}


============================== 07:20:38.703820 | 0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc ==============================
[0m07:20:38.703820 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:20:38.705944 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:20:41.636221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a68c6b7d0>]}
[0m07:20:41.842608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a67650cb0>]}
[0m07:20:41.844795 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m07:20:42.569020 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m07:20:42.571388 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:20:42.572900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a43122c60>]}
[0m07:20:47.483611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a42bc1e20>]}
[0m07:20:47.764310 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:20:47.773612 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:20:47.819251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a427b63f0>]}
[0m07:20:47.820754 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m07:20:47.821944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a42aaa600>]}
[0m07:20:47.829017 [info ] [MainThread]: 
[0m07:20:47.830250 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:20:47.831456 [info ] [MainThread]: 
[0m07:20:47.833191 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:20:47.848815 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:20:47.850610 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:20:47.872620 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:20:47.978112 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:20:47.985734 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m07:20:48.068771 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:20:49.380295 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m07:20:49.381729 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:20:49.383909 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m07:20:49.486422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m07:20:49.489990 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:20:49.494481 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:20:50.080731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a42adf260>]}
[0m07:20:50.082564 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:20:50.101299 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:20:50.104192 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:20:50.107546 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:20:50.109345 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:20:50.112762 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:20:50.117203 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:20:50.115353 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:20:50.133822 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:20:50.131309 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:20:50.128128 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:20:50.122786 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:20:50.135491 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:20:50.172266 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:20:50.174079 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:20:50.176522 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:20:50.188918 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:20:50.191282 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:20:50.210538 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:20:50.196733 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:20:50.207264 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:20:50.194461 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:20:50.300385 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:20:50.311675 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:20:50.406514 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:20:50.468690 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:20:50.625077 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:20:50.637713 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:20:50.639836 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:20:50.645658 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m07:20:50.647838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:20:50.731141 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m07:20:50.736745 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m07:20:50.739121 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:20:50.741586 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:20:51.314415 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:20:51.317315 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m07:20:51.418652 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a2745a4c-06a5-4271-95c4-e508ecbc82f3&page=queryresults
[0m07:20:51.432722 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4502a7e6-2dc0-4715-8ecc-1b62f44de533&page=queryresults
[0m07:20:51.505194 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2afe4737-eda8-47a2-9c97-39a0a142e7b4&page=queryresults
[0m07:20:51.560643 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7412388d-83af-4b89-a111-60d3719289e6&page=queryresults
[0m07:20:51.914126 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a430b8620>]}
[0m07:20:51.917619 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a41f58140>]}
[0m07:20:51.916595 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.77s]
[0m07:20:51.922255 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a42b8b4a0>]}
[0m07:20:51.920310 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m07:20:51.925370 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:20:51.928447 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m07:20:51.931027 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:20:51.935180 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:20:51.943829 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m07:20:51.941958 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_problems
[0m07:20:51.939270 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m07:20:51.945617 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:20:51.948020 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_problems)
[0m07:20:51.951616 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m07:20:51.955993 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_problems
[0m07:20:51.953547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m07:20:51.957382 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m07:20:51.975721 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m07:20:51.977661 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m07:20:51.987800 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m07:20:51.990170 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:20:52.001240 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:20:52.003722 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:20:52.010974 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m07:20:52.027756 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m07:20:52.031399 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_problems
[0m07:20:52.034742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:20:52.036583 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:20:52.124517 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:20:52.126695 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.medicines)
[0m07:20:52.128155 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:20:52.140537 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:20:52.143999 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:20:52.151180 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:20:52.572960 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:20:52.574849 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:20:52.595277 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:20:52.597541 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:20:53.253061 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7d487938-c62e-4ce6-9b13-d52139b4a2a7&page=queryresults
[0m07:20:53.266277 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:298033fa-a5c8-410c-988c-3fdedfe51582&page=queryresults
[0m07:20:53.285900 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a41f18980>]}
[0m07:20:53.289182 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (4.0 rows, 257.0 Bytes processed)[0m in 3.12s]
[0m07:20:53.293775 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:20:54.715722 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a41f44740>]}
[0m07:20:54.717776 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (19.0 rows, 1.3 KiB processed)[0m in 2.76s]
[0m07:20:54.719604 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m07:20:54.721595 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:20:54.723427 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:20:54.726827 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.visits_enhanced)
[0m07:20:54.728828 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:20:54.740786 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:20:54.743011 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:20:54.749752 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:20:55.042556 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a40f36690>]}
[0m07:20:55.045515 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (5.0 rows, 282.0 Bytes processed)[0m in 2.92s]
[0m07:20:55.048390 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:20:55.053699 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:20:55.055704 [info ] [Thread-1 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:20:55.057838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m07:20:55.061840 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:20:55.081884 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:20:55.085239 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:20:55.095177 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:20:55.274173 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:20:55.276622 [debug] [Thread-3 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:20:55.501627 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:96834f46-0631-4202-ade2-55e5767e4948&page=queryresults
[0m07:20:55.562779 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:20:55.565406 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:20:55.770752 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:96026e6a-adf6-45b5-b93c-c987a37086b8&page=queryresults
[0m07:20:57.236350 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a40f4f9e0>]}
[0m07:20:57.239275 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (3.6k rows, 171.2 KiB processed)[0m in 2.51s]
[0m07:20:57.241611 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:20:57.246097 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:20:57.247442 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:20:57.249612 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m07:20:57.254539 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m07:20:57.256675 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:20:57.252097 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m07:20:57.269825 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:20:57.272312 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m07:20:57.275223 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:20:57.276667 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:20:57.289723 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:20:57.302070 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:20:57.299464 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:20:57.308939 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:20:57.677617 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a40f47ce0>]}
[0m07:20:57.680111 [info ] [Thread-1 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (3.6k rows, 173.6 KiB processed)[0m in 2.62s]
[0m07:20:57.682462 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:20:57.685476 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:20:57.691204 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m07:20:57.694932 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m07:20:57.696458 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:20:57.707109 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:20:57.710371 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:20:57.717534 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:20:57.939973 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m07:20:57.942563 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m07:20:57.949573 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m07:20:57.953053 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m07:20:58.233001 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9a1452de-c5a0-47f3-87df-83af04446bba&page=queryresults
[0m07:20:58.244161 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m07:20:58.246444 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m07:20:58.288241 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e7be0313-5a3d-4f7b-9ede-fe7216a0444b&page=queryresults
[0m07:20:58.555562 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d5cd28fd-1348-4158-b257-5da98fc1569f&page=queryresults
[0m07:21:00.093134 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a413fa1e0>]}
[0m07:21:00.095184 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (5.1k rows, 293.6 KiB processed)[0m in 2.84s]
[0m07:21:00.098158 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:21:00.104328 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m07:21:00.109969 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:21:00.106280 [info ] [Thread-1 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m07:21:00.113028 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m07:21:00.115399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m07:21:00.117067 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m07:21:00.119102 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:21:00.120626 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:21:00.146407 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:21:00.161375 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:21:00.165595 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a423d22a0>]}
[0m07:21:00.173426 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:21:00.171454 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (9.0 rows, 193.2 KiB processed)[0m in 2.89s]
[0m07:21:00.184945 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:21:00.187528 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:21:00.189789 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:21:00.204440 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:21:00.742731 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m07:21:00.745377 [debug] [Thread-1 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m07:21:00.754686 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m07:21:00.758211 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m07:21:00.916434 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a41344f20>]}
[0m07:21:00.918645 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (4.0 rows, 130.9 KiB processed)[0m in 3.22s]
[0m07:21:00.921175 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:21:00.957619 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2e51f919-f988-45fc-bab6-2d308587c5f5&page=queryresults
[0m07:21:00.976261 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5cc87e55-2ba2-48c0-86ab-c6b9e3e3554d&page=queryresults
[0m07:21:02.647612 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a40f2ad20>]}
[0m07:21:02.650074 [info ] [Thread-1 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (10.4k rows, 603.6 KiB processed)[0m in 2.53s]
[0m07:21:02.653053 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:21:05.025651 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0526af30-d7b2-4cd9-85a8-9d6e3f57d9fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a40f7a060>]}
[0m07:21:05.028292 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (19.0 rows, 240.7 KiB processed)[0m in 4.91s]
[0m07:21:05.030822 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:21:05.042421 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:21:05.048734 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:21:05.050242 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:21:05.051322 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:21:05.053144 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:21:05.054177 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m07:21:05.055512 [info ] [MainThread]: 
[0m07:21:05.057369 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 17.22 seconds (17.22s).
[0m07:21:05.069986 [debug] [MainThread]: Command end result
[0m07:21:05.158601 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m07:21:05.164753 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m07:21:05.185646 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m07:21:05.187235 [info ] [MainThread]: 
[0m07:21:05.189154 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:21:05.191166 [info ] [MainThread]: 
[0m07:21:05.192464 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m07:21:05.197289 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 26.797184, "process_in_blocks": "0", "process_kernel_time": 1.830642, "process_mem_max_rss": "216960", "process_out_blocks": "3776", "process_user_time": 16.63224}
[0m07:21:05.200580 [debug] [MainThread]: Command `dbt run` succeeded at 07:21:05.200163 after 26.80 seconds
[0m07:21:05.202226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a67c0bd70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a42bc1730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x712a42c775c0>]}
[0m07:21:05.204451 [debug] [MainThread]: Flushing usage events
[0m07:21:06.586714 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:14:27.093495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7236775476b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723676ce0530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723676ce19d0>]}


============================== 09:14:27.118668 | 8eda8163-b904-44df-b780-414d499cdbb9 ==============================
[0m09:14:27.118668 [info ] [MainThread]: Running with dbt=1.9.0
[0m09:14:27.121361 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt clean', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:14:27.531306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8eda8163-b904-44df-b780-414d499cdbb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7236775476b0>]}
[0m09:14:27.658111 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.85422057, "process_in_blocks": "2288", "process_kernel_time": 0.69014, "process_mem_max_rss": "88036", "process_out_blocks": "64", "process_user_time": 4.65769}
[0m09:14:27.659612 [debug] [MainThread]: Command `dbt clean` succeeded at 09:14:27.659300 after 0.86 seconds
[0m09:14:27.660742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723676a4da30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72367701e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72367701eae0>]}
[0m09:14:27.662225 [debug] [MainThread]: Flushing usage events
[0m09:14:29.107148 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:14:40.184846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cba37324ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cba3647edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cba36550830>]}


============================== 09:14:40.195189 | 58717f99-0a69-43c7-9473-65a0b4b8fada ==============================
[0m09:14:40.195189 [info ] [MainThread]: Running with dbt=1.9.0
[0m09:14:40.197615 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:14:40.215762 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m09:14:40.218205 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!
[0m09:14:40.221797 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.33753565, "process_in_blocks": "0", "process_kernel_time": 0.680492, "process_mem_max_rss": "85816", "process_out_blocks": "8", "process_user_time": 4.395776}
[0m09:14:40.223469 [debug] [MainThread]: Command `dbt run` failed at 09:14:40.223110 after 0.34 seconds
[0m09:14:40.224711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cba35eec380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cba36207800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cba36241ee0>]}
[0m09:14:40.226230 [debug] [MainThread]: Flushing usage events
[0m09:14:41.639743 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:43:39.351152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97b27a9ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97b2470980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97b2a971a0>]}


============================== 09:43:39.360289 | 532a46b4-3055-4e16-a145-6c2b2058b5fc ==============================
[0m09:43:39.360289 [info ] [MainThread]: Running with dbt=1.9.0
[0m09:43:39.362062 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:43:39.397746 [info ] [MainThread]: dbt version: 1.9.0
[0m09:43:39.399011 [info ] [MainThread]: python version: 3.12.4
[0m09:43:39.400076 [info ] [MainThread]: python path: /usr/local/bin/python
[0m09:43:39.401418 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m09:43:42.029705 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m09:43:42.031335 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m09:43:42.032538 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m09:43:42.034162 [info ] [MainThread]: adapter type: bigquery
[0m09:43:42.035293 [info ] [MainThread]: adapter version: 1.9.1
[0m09:43:42.353663 [info ] [MainThread]: Configuration:
[0m09:43:42.355428 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m09:43:42.356686 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m09:43:42.358651 [info ] [MainThread]: Required dependencies:
[0m09:43:42.360008 [debug] [MainThread]: Executing "git --help"
[0m09:43:42.419211 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m09:43:42.421052 [debug] [MainThread]: STDERR: "b''"
[0m09:43:42.422399 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m09:43:42.423902 [info ] [MainThread]: Connection:
[0m09:43:42.425739 [info ] [MainThread]:   method: service-account
[0m09:43:42.426804 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m09:43:42.428118 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m09:43:42.429381 [info ] [MainThread]:   schema: hospital
[0m09:43:42.430739 [info ] [MainThread]:   location: asia-southeast2
[0m09:43:42.432145 [info ] [MainThread]:   priority: interactive
[0m09:43:42.433470 [info ] [MainThread]:   maximum_bytes_billed: None
[0m09:43:42.434809 [info ] [MainThread]:   impersonate_service_account: None
[0m09:43:42.436038 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m09:43:42.437055 [info ] [MainThread]:   job_retries: 1
[0m09:43:42.438172 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m09:43:42.439202 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m09:43:42.440582 [info ] [MainThread]:   timeout_seconds: 300
[0m09:43:42.441521 [info ] [MainThread]:   client_id: None
[0m09:43:42.443346 [info ] [MainThread]:   token_uri: None
[0m09:43:42.444656 [info ] [MainThread]:   dataproc_region: None
[0m09:43:42.446205 [info ] [MainThread]:   dataproc_cluster_name: None
[0m09:43:42.447633 [info ] [MainThread]:   gcs_bucket: None
[0m09:43:42.449037 [info ] [MainThread]:   dataproc_batch: None
[0m09:43:42.451558 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m09:43:43.141285 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m09:43:43.142270 [debug] [MainThread]: On debug: select 1 as id
[0m09:43:43.143020 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:43:43.823329 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:92bf7a82-0c5f-4a7e-92f9-340689db8f27&page=queryresults
[0m09:43:44.280985 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m09:43:44.282961 [info ] [MainThread]: [32mAll checks passed![0m
[0m09:43:44.286029 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.244247, "process_in_blocks": "2400", "process_kernel_time": 1.539849, "process_mem_max_rss": "202144", "process_out_blocks": "48", "process_user_time": 8.01675}
[0m09:43:44.287628 [debug] [MainThread]: Command `dbt debug` succeeded at 09:43:44.287318 after 5.25 seconds
[0m09:43:44.288760 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m09:43:44.290478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97b22cb110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b978ec746b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b97b2698860>]}
[0m09:43:44.291613 [debug] [MainThread]: Flushing usage events
[0m09:43:45.861458 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:43:56.647807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5220237740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52208b3b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c521feaa480>]}


============================== 09:43:56.657188 | c467e22d-b74d-4037-a648-d7922fe68c7a ==============================
[0m09:43:56.657188 [info ] [MainThread]: Running with dbt=1.9.0
[0m09:43:56.659182 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:43:59.408830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52204dd160>]}
[0m09:43:59.602575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fbddca40>]}
[0m09:43:59.605505 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m09:44:00.302354 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m09:44:00.305065 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m09:44:00.306581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fbcc1610>]}
[0m09:44:05.025650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fb308680>]}
[0m09:44:05.278313 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m09:44:05.286460 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m09:44:05.363247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fb386360>]}
[0m09:44:05.365645 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m09:44:05.367084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fbcc0f50>]}
[0m09:44:05.374809 [info ] [MainThread]: 
[0m09:44:05.376276 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m09:44:05.378193 [info ] [MainThread]: 
[0m09:44:05.380235 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m09:44:05.397186 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m09:44:05.400017 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:44:05.488623 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m09:44:05.494302 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m09:44:05.497543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:44:05.503416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:44:07.388363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m09:44:07.390037 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:44:07.473596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m09:44:07.475181 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:44:07.481343 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m09:44:07.482820 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:44:08.013970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fb3867b0>]}
[0m09:44:08.015590 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:44:08.029430 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m09:44:08.032681 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m09:44:08.036815 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m09:44:08.041531 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m09:44:08.031423 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m09:44:08.050035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m09:44:08.051535 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m09:44:08.035604 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m09:44:08.067233 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m09:44:08.069210 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m09:44:08.089755 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m09:44:08.043771 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m09:44:08.047560 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m09:44:08.111785 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m09:44:08.114764 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m09:44:08.123548 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m09:44:08.119696 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m09:44:08.121831 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m09:44:08.117356 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m09:44:08.184331 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m09:44:08.143528 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m09:44:08.255836 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m09:44:08.257521 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m09:44:08.330378 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m09:44:08.413146 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m09:44:08.403163 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m09:44:08.424654 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m09:44:08.429186 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m09:44:08.433641 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m09:44:08.434719 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:44:08.521468 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m09:44:08.523233 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:44:08.623590 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m09:44:08.629118 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m09:44:09.223316 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m09:44:09.225434 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m09:44:09.376836 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:59b99139-434e-47b0-9258-f2b2a6ed7014&page=queryresults
[0m09:44:09.401131 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1f5e7170-a391-4c2f-b6a8-5801aa52e481&page=queryresults
[0m09:44:09.455735 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c3a3d5e6-030f-496e-8bcc-b416be7b39dc&page=queryresults
[0m09:44:09.537706 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:917b005b-e461-48bb-9b74-9f705d7697f8&page=queryresults
[0m09:44:09.899208 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fbd1c4a0>]}
[0m09:44:09.902090 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m09:44:09.904579 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m09:44:09.907288 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fbc69ca0>]}
[0m09:44:09.912666 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m09:44:09.915445 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m09:44:09.927190 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m09:44:09.924696 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m09:44:09.919644 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fb312de0>]}
[0m09:44:09.930098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m09:44:09.933373 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.85s]
[0m09:44:09.936057 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m09:44:09.937974 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m09:44:09.948412 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m09:44:09.950460 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m09:44:09.966789 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:44:10.053625 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m09:44:10.056399 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m09:44:10.057500 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_problems
[0m09:44:10.059808 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_problems)
[0m09:44:10.061336 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_problems
[0m09:44:10.058310 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m09:44:10.075148 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m09:44:10.080006 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m09:44:10.078247 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m09:44:10.086991 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:44:10.085320 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m09:44:10.092595 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m09:44:10.095587 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_problems
[0m09:44:10.093994 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m09:44:10.098205 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.patients)
[0m09:44:10.099565 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m09:44:10.110190 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m09:44:10.112429 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m09:44:10.119290 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m09:44:10.470901 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m09:44:10.472917 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m09:44:10.569334 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m09:44:10.573825 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m09:44:11.071983 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fb77deb0>]}
[0m09:44:11.074176 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 624.0 Bytes processed)[0m in 2.95s]
[0m09:44:11.077006 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m09:44:11.140144 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:37f7af98-9408-4ae4-a0be-541dd5d7ab4b&page=queryresults
[0m09:44:11.273099 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b0cd8926-29f2-450d-963d-d5f8ddee2061&page=queryresults
[0m09:44:12.697419 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9ff1220>]}
[0m09:44:12.700102 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 813.0 Bytes processed)[0m in 2.77s]
[0m09:44:12.702404 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m09:44:12.740846 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51faf90830>]}
[0m09:44:12.743201 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.64s]
[0m09:44:12.746151 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m09:44:12.749441 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m09:44:12.751285 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m09:44:12.753143 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.prescriptions_enhanced)
[0m09:44:12.754816 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m09:44:12.757056 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m09:44:12.759741 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m09:44:12.774208 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m09:44:12.777658 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m09:44:12.781076 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m09:44:12.794156 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m09:44:12.797501 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m09:44:12.805272 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:44:12.807401 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m09:44:12.906296 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m09:44:13.372223 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m09:44:13.377505 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m09:44:13.380439 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m09:44:13.386221 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m09:44:13.623575 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:ef764db0-b5b5-45e8-b7e7-23ce0352f018&page=queryresults
[0m09:44:13.648097 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d5308003-c4b4-4d5a-b88c-e245dbc84f05&page=queryresults
[0m09:44:15.239360 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9ff0fe0>]}
[0m09:44:15.241918 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (70.0 rows, 8.4 KiB processed)[0m in 2.49s]
[0m09:44:15.244970 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m09:44:15.452011 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9b23fb0>]}
[0m09:44:15.454554 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (65.0 rows, 8.7 KiB processed)[0m in 2.68s]
[0m09:44:15.456653 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m09:44:15.459252 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m09:44:15.461719 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m09:44:15.465461 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m09:44:15.463635 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m09:44:15.468404 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m09:44:15.472846 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m09:44:15.476658 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m09:44:15.475099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m09:44:15.470892 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m09:44:15.483571 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m09:44:15.485296 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m09:44:15.502101 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m09:44:15.500454 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m09:44:15.490413 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m09:44:15.511524 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m09:44:15.516503 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m09:44:15.518020 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m09:44:15.519229 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m09:44:15.526342 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:44:15.533263 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:44:15.538516 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m09:44:16.073659 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m09:44:16.077072 [debug] [Thread-1 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m09:44:16.153073 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m09:44:16.156635 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m09:44:16.172735 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m09:44:16.175812 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m09:44:16.364678 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:58198774-7b56-4014-999b-cd5b30375855&page=queryresults
[0m09:44:16.436090 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d38ac124-88cf-48cf-922b-56799a09cb2d&page=queryresults
[0m09:44:16.460545 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cd23b429-8be3-4951-97a3-71e1976d8761&page=queryresults
[0m09:44:18.083752 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9b2f9e0>]}
[0m09:44:18.086006 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (65.0 rows, 10.6 KiB processed)[0m in 2.61s]
[0m09:44:18.089036 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m09:44:18.097948 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m09:44:18.101221 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m09:44:18.110854 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m09:44:18.118684 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m09:44:18.115148 [info ] [Thread-3 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m09:44:18.141713 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m09:44:18.136361 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m09:44:18.138646 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9ffc5f0>]}
[0m09:44:18.130068 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9ffeb70>]}
[0m09:44:18.143701 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m09:44:18.159524 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m09:44:18.162489 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (8.0 rows, 4.2 KiB processed)[0m in 2.65s]
[0m09:44:18.165889 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 4.6 KiB processed)[0m in 2.65s]
[0m09:44:18.186568 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m09:44:18.178774 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m09:44:18.183701 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m09:44:18.181214 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m09:44:18.194853 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m09:44:18.201222 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m09:44:18.296827 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m09:44:19.161226 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m09:44:19.163300 [debug] [Thread-3 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m09:44:19.251402 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m09:44:19.253577 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m09:44:19.403291 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:42aafdbf-6e40-49c2-a50f-11b77b9ee550&page=queryresults
[0m09:44:19.486437 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:11c8664f-26cc-4c76-9f0c-1f0b54f66574&page=queryresults
[0m09:44:21.133587 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9b115b0>]}
[0m09:44:21.134966 [info ] [Thread-3 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 9.9 KiB processed)[0m in 2.99s]
[0m09:44:21.137107 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m09:44:21.210804 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c467e22d-b74d-4037-a648-d7922fe68c7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51f9b12c00>]}
[0m09:44:21.212931 [info ] [Thread-4 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (74.0 rows, 17.2 KiB processed)[0m in 3.09s]
[0m09:44:21.216206 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m09:44:21.222580 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:44:21.227902 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:44:21.230208 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m09:44:21.231732 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m09:44:21.233015 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m09:44:21.234250 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m09:44:21.236001 [info ] [MainThread]: 
[0m09:44:21.237109 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.86 seconds (15.86s).
[0m09:44:21.249229 [debug] [MainThread]: Command end result
[0m09:44:21.339602 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m09:44:21.346946 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m09:44:21.370294 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m09:44:21.371843 [info ] [MainThread]: 
[0m09:44:21.373098 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:44:21.376049 [info ] [MainThread]: 
[0m09:44:21.377059 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m09:44:21.381948 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.019358, "process_in_blocks": "1728", "process_kernel_time": 1.89674, "process_mem_max_rss": "218880", "process_out_blocks": "3904", "process_user_time": 16.104668}
[0m09:44:21.383342 [debug] [MainThread]: Command `dbt run` succeeded at 09:44:21.383052 after 25.02 seconds
[0m09:44:21.384585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c522052f8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c521fd460c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c51fafd6fc0>]}
[0m09:44:21.386129 [debug] [MainThread]: Flushing usage events
[0m09:44:22.799774 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:13:14.992152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dfd78b3500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dfd5ddc8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dfd6416db0>]}


============================== 07:13:15.029711 | 48196b73-0692-4e3a-8e05-7aa81155aaab ==============================
[0m07:13:15.029711 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:13:15.031894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:13:15.139755 [info ] [MainThread]: dbt version: 1.9.0
[0m07:13:15.141438 [info ] [MainThread]: python version: 3.12.4
[0m07:13:15.143252 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:13:15.144439 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m07:13:15.164855 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m07:13:15.166844 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:13:15.168584 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:13:15.170220 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:13:15.501533 [info ] [MainThread]: Configuration:
[0m07:13:15.503290 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m07:13:15.504938 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:13:15.506068 [info ] [MainThread]: Required dependencies:
[0m07:13:15.507377 [debug] [MainThread]: Executing "git --help"
[0m07:13:15.586979 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:13:15.589471 [debug] [MainThread]: STDERR: "b''"
[0m07:13:15.590961 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:13:15.592629 [info ] [MainThread]: Connection test skipped since no profile was found
[0m07:13:15.594151 [info ] [MainThread]: [31m1 check failed:[0m
[0m07:13:15.595264 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!


[0m07:13:15.603464 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.90293455, "process_in_blocks": "2072", "process_kernel_time": 0.678154, "process_mem_max_rss": "88452", "process_out_blocks": "64", "process_user_time": 4.542339}
[0m07:13:15.605607 [debug] [MainThread]: Command `dbt debug` failed at 07:13:15.605210 after 0.91 seconds
[0m07:13:15.607128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dfd62c3560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dfd5a81040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dfd5a82330>]}
[0m07:13:15.608477 [debug] [MainThread]: Flushing usage events
[0m07:13:17.041270 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:15:19.742505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fb847db7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fb837fef30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fb84e9b800>]}


============================== 07:15:19.753049 | 4c9c4e55-feab-4492-8681-de4448254eea ==============================
[0m07:15:19.753049 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:15:19.755943 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:15:19.785469 [info ] [MainThread]: dbt version: 1.9.0
[0m07:15:19.788018 [info ] [MainThread]: python version: 3.12.4
[0m07:15:19.790447 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:15:19.792418 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m07:15:19.813298 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m07:15:19.815477 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:15:19.817099 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:15:19.818384 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:15:20.137827 [info ] [MainThread]: Configuration:
[0m07:15:20.139630 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m07:15:20.140978 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:15:20.142543 [info ] [MainThread]: Required dependencies:
[0m07:15:20.143865 [debug] [MainThread]: Executing "git --help"
[0m07:15:20.153564 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:15:20.155432 [debug] [MainThread]: STDERR: "b''"
[0m07:15:20.156402 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:15:20.157814 [info ] [MainThread]: Connection test skipped since no profile was found
[0m07:15:20.159125 [info ] [MainThread]: [31m1 check failed:[0m
[0m07:15:20.160481 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!


[0m07:15:20.165136 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.7078349, "process_in_blocks": "0", "process_kernel_time": 0.728719, "process_mem_max_rss": "87848", "process_out_blocks": "24", "process_user_time": 4.507264}
[0m07:15:20.167189 [debug] [MainThread]: Command `dbt debug` failed at 07:15:20.166488 after 0.71 seconds
[0m07:15:20.168419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fb834db020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fb82b4d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fb8318d4f0>]}
[0m07:15:20.169689 [debug] [MainThread]: Flushing usage events
[0m07:15:21.585695 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:19:52.512061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0789aa0080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0787cb9a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f07880a8bc0>]}


============================== 07:19:52.543939 | eb181063-0bc7-431b-9361-ac27315e24d0 ==============================
[0m07:19:52.543939 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:19:52.551087 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:19:52.695939 [info ] [MainThread]: dbt version: 1.9.0
[0m07:19:52.702517 [info ] [MainThread]: python version: 3.12.4
[0m07:19:52.708855 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:19:52.710138 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m07:19:52.786565 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m07:19:52.794489 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:19:52.795932 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:19:52.803972 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:19:53.755778 [info ] [MainThread]: Configuration:
[0m07:19:53.757218 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m07:19:53.764177 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:19:53.769241 [info ] [MainThread]: Required dependencies:
[0m07:19:53.773452 [debug] [MainThread]: Executing "git --help"
[0m07:19:53.804857 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:19:53.810660 [debug] [MainThread]: STDERR: "b''"
[0m07:19:53.814332 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:19:53.822189 [info ] [MainThread]: Connection test skipped since no profile was found
[0m07:19:53.823846 [info ] [MainThread]: [31m1 check failed:[0m
[0m07:19:53.830911 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!


[0m07:19:53.850426 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 1.6276336, "process_in_blocks": "0", "process_kernel_time": 0.821992, "process_mem_max_rss": "88320", "process_out_blocks": "24", "process_user_time": 5.260526}
[0m07:19:53.858215 [debug] [MainThread]: Command `dbt debug` failed at 07:19:53.857786 after 1.64 seconds
[0m07:19:53.865474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0788407830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0787b18e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0789833ad0>]}
[0m07:19:53.873883 [debug] [MainThread]: Flushing usage events
[0m07:19:55.454010 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:23:05.542869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb522b6f4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb522cf7920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb523b79730>]}


============================== 07:23:05.553418 | dceb434f-9580-4620-9d64-fa167f22a01e ==============================
[0m07:23:05.553418 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:23:05.556484 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt init', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:23:05.597249 [info ] [MainThread]: Setting up your profile.
[0m07:23:14.216433 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": true, "command_wall_clock_time": 8.951016, "process_in_blocks": "40", "process_kernel_time": 0.649582, "process_mem_max_rss": "85804", "process_out_blocks": "8", "process_user_time": 4.036192}
[0m07:23:14.218191 [debug] [MainThread]: Command `dbt init` succeeded at 07:23:14.217854 after 8.95 seconds
[0m07:23:14.219247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb5223fd100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb522128290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb524000290>]}
[0m07:23:14.220586 [debug] [MainThread]: Flushing usage events
[0m07:23:15.721439 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:23:36.379302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77535c976870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77535c1dd640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77535acfe840>]}


============================== 07:23:36.391425 | b1c577bb-c323-43bc-8105-a1f35faf971a ==============================
[0m07:23:36.391425 [info ] [MainThread]: Running with dbt=1.9.0
[0m07:23:36.393177 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:23:36.425030 [info ] [MainThread]: dbt version: 1.9.0
[0m07:23:36.426485 [info ] [MainThread]: python version: 3.12.4
[0m07:23:36.427926 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:23:36.429680 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m07:23:36.451830 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.bigquery'
[0m07:23:36.453534 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:23:36.454753 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:23:36.455751 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:23:36.769001 [info ] [MainThread]: Configuration:
[0m07:23:36.770466 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m07:23:36.772457 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:23:36.773936 [info ] [MainThread]: Required dependencies:
[0m07:23:36.775339 [debug] [MainThread]: Executing "git --help"
[0m07:23:36.784261 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:23:36.785979 [debug] [MainThread]: STDERR: "b''"
[0m07:23:36.787272 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:23:36.788998 [info ] [MainThread]: Connection test skipped since no profile was found
[0m07:23:36.790434 [info ] [MainThread]: [31m1 check failed:[0m
[0m07:23:36.792037 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "hospital_analytics", target "dev" invalid: Runtime Error
    Could not find adapter type bigquery!


[0m07:23:36.795953 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.68849766, "process_in_blocks": "0", "process_kernel_time": 0.715163, "process_mem_max_rss": "88324", "process_out_blocks": "16", "process_user_time": 4.433613}
[0m07:23:36.797856 [debug] [MainThread]: Command `dbt debug` failed at 07:23:36.797163 after 0.69 seconds
[0m07:23:36.799483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77535c563920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77535acbb020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77535a6ae900>]}
[0m07:23:36.801449 [debug] [MainThread]: Flushing usage events
[0m07:23:38.211677 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:22:26.650123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2bf162e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2bf156ee70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2bf162c8f0>]}


============================== 08:22:26.661372 | 334aab31-63d3-439b-8d70-503c120511e5 ==============================
[0m08:22:26.661372 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:22:26.663710 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:22:26.698449 [info ] [MainThread]: dbt version: 1.9.0
[0m08:22:26.699603 [info ] [MainThread]: python version: 3.12.4
[0m08:22:26.700856 [info ] [MainThread]: python path: /usr/local/bin/python
[0m08:22:26.702484 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m08:22:29.209455 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m08:22:29.211239 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m08:22:29.212897 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m08:22:29.214070 [info ] [MainThread]: adapter type: bigquery
[0m08:22:29.215535 [info ] [MainThread]: adapter version: 1.9.1
[0m08:22:29.524855 [info ] [MainThread]: Configuration:
[0m08:22:29.526505 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:22:29.528242 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:22:29.529546 [info ] [MainThread]: Required dependencies:
[0m08:22:29.530456 [debug] [MainThread]: Executing "git --help"
[0m08:22:29.541383 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m08:22:29.543471 [debug] [MainThread]: STDERR: "b''"
[0m08:22:29.544625 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m08:22:29.546052 [info ] [MainThread]: Connection:
[0m08:22:29.547354 [info ] [MainThread]:   method: service-account
[0m08:22:29.548884 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m08:22:29.550000 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m08:22:29.551405 [info ] [MainThread]:   schema: hospital
[0m08:22:29.552910 [info ] [MainThread]:   location: asia-southeast2
[0m08:22:29.554249 [info ] [MainThread]:   priority: interactive
[0m08:22:29.555603 [info ] [MainThread]:   maximum_bytes_billed: None
[0m08:22:29.557289 [info ] [MainThread]:   impersonate_service_account: None
[0m08:22:29.558989 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m08:22:29.561230 [info ] [MainThread]:   job_retries: 1
[0m08:22:29.563973 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m08:22:29.565313 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m08:22:29.566606 [info ] [MainThread]:   timeout_seconds: 300
[0m08:22:29.568179 [info ] [MainThread]:   client_id: None
[0m08:22:29.569410 [info ] [MainThread]:   token_uri: None
[0m08:22:29.571275 [info ] [MainThread]:   dataproc_region: None
[0m08:22:29.575527 [info ] [MainThread]:   dataproc_cluster_name: None
[0m08:22:29.576909 [info ] [MainThread]:   gcs_bucket: None
[0m08:22:29.578691 [info ] [MainThread]:   dataproc_batch: None
[0m08:22:29.580492 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:22:30.297476 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m08:22:30.299086 [debug] [MainThread]: On debug: select 1 as id
[0m08:22:30.300519 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:22:31.068555 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:43716289-5c02-4cc6-a8d3-dce4eb33a33e&page=queryresults
[0m08:22:31.753036 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:22:31.773650 [info ] [MainThread]: [32mAll checks passed![0m
[0m08:22:31.788161 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.4286227, "process_in_blocks": "2824", "process_kernel_time": 1.509931, "process_mem_max_rss": "202712", "process_out_blocks": "48", "process_user_time": 7.981925}
[0m08:22:31.805295 [debug] [MainThread]: Command `dbt debug` succeeded at 08:22:31.796020 after 5.44 seconds
[0m08:22:31.806801 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:22:31.819650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2bf1c0e4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2bf10a96d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c2bf30bc650>]}
[0m08:22:31.828185 [debug] [MainThread]: Flushing usage events
[0m08:22:33.421340 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:22:46.266311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69039ed370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69039eefc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69039eede0>]}


============================== 08:22:46.275199 | 93f9b625-68f3-4714-b42b-40fc8b26caef ==============================
[0m08:22:46.275199 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:22:46.277085 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:22:49.172246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6905267950>]}
[0m08:22:49.358981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f690351fa40>]}
[0m08:22:49.361035 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:22:50.049558 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m08:22:50.648521 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:22:50.650033 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:22:50.785121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df7aca10>]}
[0m08:22:51.060614 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:22:51.069051 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:22:51.163535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df358ef0>]}
[0m08:22:51.165235 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m08:22:51.167188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df5b0470>]}
[0m08:22:51.174113 [info ] [MainThread]: 
[0m08:22:51.175571 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:22:51.176980 [info ] [MainThread]: 
[0m08:22:51.178709 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:22:51.194416 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:22:51.195946 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:22:51.198981 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:22:51.283049 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:22:51.375099 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m08:22:51.376879 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:22:52.659816 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m08:22:52.661426 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:22:52.663995 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m08:22:52.666147 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:22:52.746932 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m08:22:52.751806 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:22:53.303025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df142360>]}
[0m08:22:53.304958 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:22:53.319590 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m08:22:53.320969 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m08:22:53.327349 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m08:22:53.329861 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m08:22:53.325048 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m08:22:53.332295 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m08:22:53.335216 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m08:22:53.337832 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m08:22:53.341362 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m08:22:53.343155 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m08:22:53.344970 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m08:22:53.346795 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m08:22:53.348450 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m08:22:53.350181 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m08:22:53.351675 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m08:22:53.353389 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m08:22:53.392549 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m08:22:53.403393 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m08:22:53.413146 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m08:22:53.417371 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m08:22:53.431183 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m08:22:53.461176 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m08:22:53.468665 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m08:22:53.476243 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m08:22:53.580488 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m08:22:53.663392 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m08:22:53.668922 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m08:22:53.671587 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m08:22:53.759562 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m08:22:53.763936 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m08:22:53.765946 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:22:53.767691 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m08:22:53.853796 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:22:53.769451 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:22:54.612605 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m08:22:54.620100 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m08:22:54.778955 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:02ab9e49-0286-4b53-9b5b-69512a21239a&page=queryresults
[0m08:22:54.816904 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d4c4a56d-1af5-44ef-abc7-2f76b3599416&page=queryresults
[0m08:22:55.897613 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:65855719-6362-48e0-bb83-a45d73be2ca6&page=queryresults
[0m08:22:56.034657 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c9278e90-3952-40a2-9fc1-11946650a31a&page=queryresults
[0m08:22:57.213864 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df6c4a70>]}
[0m08:22:57.236107 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68de7db4a0>]}
[0m08:22:57.223065 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 3.79s]
[0m08:22:57.278510 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df521700>]}
[0m08:22:57.267976 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m08:22:57.243325 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 3.83s]
[0m08:22:57.289623 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 3.86s]
[0m08:22:57.308611 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m08:22:57.312667 [debug] [Thread-2 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m08:22:57.315261 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m08:22:57.317334 [debug] [Thread-1 (]: Began running node model.hospital_analytics.date_problems
[0m08:22:57.325016 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.date_parsing_issues)
[0m08:22:57.327385 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m08:22:57.329783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.date_problems)
[0m08:22:57.338954 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m08:22:57.358217 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.date_problems
[0m08:22:57.346208 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m08:22:57.443234 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m08:22:57.452619 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m08:22:57.496764 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m08:22:57.562697 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m08:22:57.604128 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m08:22:57.547984 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m08:22:57.647013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:22:57.574647 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:22:57.730441 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.date_problems
[0m08:22:57.760322 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m08:22:57.771322 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m08:22:57.780982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.medicines)
[0m08:22:57.782576 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m08:22:57.816328 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m08:22:57.879597 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:22:57.921062 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc9a8a70>]}
[0m08:22:58.014796 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m08:22:58.031246 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m08:22:58.052808 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 624.0 Bytes processed)[0m in 4.57s]
[0m08:22:58.057690 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m08:22:58.068211 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:22:59.096400 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m08:22:59.101561 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m08:22:59.104080 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m08:22:59.108880 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m08:22:59.778059 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:73d54794-11b7-4ca6-8249-d5760994d018&page=queryresults
[0m08:22:59.854354 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f2698d66-ffa8-40a5-a46b-04d83d3dab32&page=queryresults
[0m08:23:01.263500 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc9ada90>]}
[0m08:23:01.265918 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 3.82s]
[0m08:23:01.270074 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m08:23:01.273232 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m08:23:01.274778 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m08:23:01.275981 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now model.hospital_analytics.visits_enhanced)
[0m08:23:01.278143 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m08:23:01.292909 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m08:23:01.300907 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m08:23:01.310583 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:23:01.515238 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc9ac740>]}
[0m08:23:01.517367 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 813.0 Bytes processed)[0m in 3.74s]
[0m08:23:01.520283 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m08:23:01.523047 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m08:23:01.524919 [info ] [Thread-3 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m08:23:01.527623 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m08:23:01.529117 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m08:23:01.542128 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m08:23:01.545463 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m08:23:01.554933 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:23:01.862262 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m08:23:01.868945 [debug] [Thread-2 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m08:23:02.032473 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m08:23:02.035143 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m08:23:02.093861 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:66e50590-c1ad-4722-9992-e394f16c227b&page=queryresults
[0m08:23:02.299244 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:dfd61449-1360-44e6-82a9-d4494e9dc28c&page=queryresults
[0m08:23:03.813243 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc9292b0>]}
[0m08:23:03.815300 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (5.5k rows, 262.4 KiB processed)[0m in 2.54s]
[0m08:23:03.817614 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m08:23:03.820699 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m08:23:03.822523 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m08:23:03.825303 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m08:23:03.828373 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m08:23:03.830687 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m08:23:03.832631 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m08:23:03.834429 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m08:23:03.835909 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m08:23:03.846585 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m08:23:03.858591 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m08:23:03.862629 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m08:23:03.877957 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:23:03.880411 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m08:23:03.973782 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:23:04.324567 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc9c8800>]}
[0m08:23:04.327108 [info ] [Thread-3 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (5.5k rows, 266.6 KiB processed)[0m in 2.80s]
[0m08:23:04.329652 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m08:23:04.332311 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m08:23:04.334451 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m08:23:04.336502 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m08:23:04.339616 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m08:23:04.351687 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m08:23:04.354121 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m08:23:04.363387 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:23:04.458932 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m08:23:04.462040 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m08:23:04.466583 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m08:23:04.471584 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m08:23:04.720153 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0d3b15bc-ddbe-457d-9522-b20d9ccdd394&page=queryresults
[0m08:23:04.725554 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:68cc1eff-73e7-4680-9cbc-907bf1a8c4e7&page=queryresults
[0m08:23:04.850245 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m08:23:04.853472 [debug] [Thread-2 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m08:23:05.089832 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6616f702-0ae3-4811-9209-0f67bff914de&page=queryresults
[0m08:23:06.485800 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc9f2510>]}
[0m08:23:06.488072 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (10.4k rows, 535.0 KiB processed)[0m in 2.66s]
[0m08:23:06.490581 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m08:23:06.493253 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m08:23:06.495370 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m08:23:06.497858 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m08:23:06.499710 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m08:23:06.501676 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m08:23:06.503909 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m08:23:06.505922 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m08:23:06.521815 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m08:23:06.531002 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m08:23:06.539401 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m08:23:06.542375 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m08:23:06.550585 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:23:06.640021 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m08:23:06.647030 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:23:07.091261 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m08:23:07.096439 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m08:23:07.110697 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m08:23:07.113218 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m08:23:07.321133 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:523eefdf-e0fe-4ae9-8acd-26ee6c91bf36&page=queryresults
[0m08:23:07.400440 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e94d6adc-80ff-4e1c-9a62-cc09d9826172&page=queryresults
[0m08:23:07.903193 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc80cbf0>]}
[0m08:23:07.905126 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (8.0 rows, 353.2 KiB processed)[0m in 4.07s]
[0m08:23:07.908074 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m08:23:09.683928 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc842f00>]}
[0m08:23:09.686590 [info ] [Thread-3 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (178.5k rows, 1.3 MiB processed)[0m in 3.18s]
[0m08:23:09.689088 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m08:23:10.183377 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc82dee0>]}
[0m08:23:10.186658 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 343.1 KiB processed)[0m in 5.85s]
[0m08:23:10.189206 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m08:23:47.313432 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93f9b625-68f3-4714-b42b-40fc8b26caef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68dc800830>]}
[0m08:23:47.316401 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 626.8 KiB processed)[0m in 40.81s]
[0m08:23:47.318541 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m08:23:47.325484 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:23:47.330884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:23:47.332462 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m08:23:47.333913 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m08:23:47.335492 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m08:23:47.337187 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m08:23:47.338523 [info ] [MainThread]: 
[0m08:23:47.340645 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 56.16 seconds (56.16s).
[0m08:23:47.352363 [debug] [MainThread]: Command end result
[0m08:23:47.439002 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:23:47.446197 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:23:47.471601 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:23:47.473233 [info ] [MainThread]: 
[0m08:23:47.475295 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:23:47.477281 [info ] [MainThread]: 
[0m08:23:47.479072 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m08:23:47.483022 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 61.502026, "process_in_blocks": "3456", "process_kernel_time": 2.330506, "process_mem_max_rss": "212712", "process_out_blocks": "2808", "process_user_time": 14.626332}
[0m08:23:47.485021 [debug] [MainThread]: Command `dbt run` succeeded at 08:23:47.484564 after 61.50 seconds
[0m08:23:47.486461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69034d19d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69034fdd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68df11d6a0>]}
[0m08:23:47.488525 [debug] [MainThread]: Flushing usage events
[0m08:23:48.917002 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:42:48.300430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce6635010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce69550a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce6636570>]}


============================== 08:42:48.312133 | a4c40dea-7ba5-42f5-9a2a-841d61d88513 ==============================
[0m08:42:48.312133 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:42:48.314016 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:42:51.154897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4c40dea-7ba5-42f5-9a2a-841d61d88513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce60e87a0>]}
[0m08:42:51.367680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4c40dea-7ba5-42f5-9a2a-841d61d88513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce77b6630>]}
[0m08:42:51.370218 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:42:52.049393 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m08:42:52.457260 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:42:52.458543 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:42:52.603179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4c40dea-7ba5-42f5-9a2a-841d61d88513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1cc5d7d280>]}
[0m08:42:52.663864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4c40dea-7ba5-42f5-9a2a-841d61d88513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1cc570ff80>]}
[0m08:42:52.665743 [info ] [MainThread]: Found 15 models, 9 data tests, 6 sources, 487 macros
[0m08:42:52.667852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4c40dea-7ba5-42f5-9a2a-841d61d88513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1cc5c3d790>]}
[0m08:42:52.676216 [info ] [MainThread]: 
[0m08:42:52.678262 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:42:52.679874 [info ] [MainThread]: 
[0m08:42:52.681908 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:42:52.697420 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m08:42:52.699999 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m08:42:52.701519 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:52.704108 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m08:42:52.705376 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:52.795883 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:53.357125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4c40dea-7ba5-42f5-9a2a-841d61d88513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1cc570c890>]}
[0m08:42:53.358942 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:42:53.374329 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m08:42:53.376247 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m08:42:53.378201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m08:42:53.379242 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m08:42:53.381276 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m08:42:53.382828 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m08:42:53.384862 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m08:42:53.386323 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m08:42:53.413616 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m08:42:53.389753 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m08:42:53.388362 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m08:42:53.418609 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m08:42:53.433436 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m08:42:53.441867 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m08:42:53.443704 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m08:42:53.447024 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m08:42:53.459710 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m08:42:53.461485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:53.463000 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m08:42:53.466102 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m08:42:53.467912 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m08:42:53.474395 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m08:42:53.476192 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:42:53.477931 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m08:42:53.479438 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:42:53.483544 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m08:42:53.491434 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m08:42:53.501478 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m08:42:53.506792 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m08:42:53.508649 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m08:42:53.513197 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m08:42:53.523202 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m08:42:53.525186 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:42:53.527249 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:42:53.530169 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m08:42:53.532176 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m08:42:53.533945 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:42:53.535829 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m08:42:53.537464 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:42:53.539483 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:53.541543 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m08:42:53.542900 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:42:53.582527 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m08:42:53.588931 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m08:42:53.590409 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:42:53.599599 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:42:53.607658 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m08:42:53.609926 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:42:53.624584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m08:42:53.626806 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m08:42:53.629199 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:42:53.631255 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:42:53.643347 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:42:53.639666 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:42:53.642190 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:42:53.633095 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:42:53.649608 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:42:53.651830 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m08:42:53.653661 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:42:53.669694 [debug] [Thread-4 (]: Began running node model.hospital_analytics.date_problems
[0m08:42:53.675119 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m08:42:53.687600 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:42:53.676933 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.date_parsing_issues)
[0m08:42:53.685684 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.date_problems)
[0m08:42:53.693055 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.date_problems
[0m08:42:53.688990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:53.691310 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m08:42:53.683141 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:42:53.703275 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.date_problems"
[0m08:42:53.712150 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:42:53.725333 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m08:42:53.727526 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m08:42:53.731384 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:42:53.735264 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:42:53.737017 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.patients)
[0m08:42:53.744411 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.date_problems
[0m08:42:53.749621 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m08:42:53.751223 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m08:42:53.762246 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m08:42:53.764856 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m08:42:53.766400 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:42:53.772148 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m08:42:53.776156 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m08:42:53.777516 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m08:42:53.782449 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_problems, now model.hospital_analytics.visits_enhanced)
[0m08:42:53.780667 [debug] [Thread-3 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:42:53.779136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now model.hospital_analytics.prescriptions_enhanced)
[0m08:42:53.783927 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m08:42:53.790247 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:42:53.792940 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m08:42:53.794828 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m08:42:53.804262 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m08:42:53.806546 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m08:42:53.807888 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:42:53.818687 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m08:42:53.820215 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:42:53.835050 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m08:42:53.850516 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m08:42:53.853096 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m08:42:53.862156 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:42:53.867764 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m08:42:53.870027 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:53.871569 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:42:53.879022 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m08:42:53.881634 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:42:53.888143 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m08:42:53.890032 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:42:53.893515 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:42:53.895142 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m08:42:53.912674 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.billing_enhanced)
[0m08:42:53.897140 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m08:42:53.911096 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:42:53.903525 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:42:53.914246 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m08:42:53.916015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m08:42:53.917888 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:42:53.920038 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:42:53.931409 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m08:42:53.933431 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m08:42:53.935307 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m08:42:53.937013 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m08:42:53.945468 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:42:53.949554 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m08:42:53.952304 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m08:42:53.954120 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:42:53.967164 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m08:42:53.969437 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:42:53.971720 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m08:42:53.983092 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m08:42:53.990628 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m08:42:53.992268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:53.993871 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:42:53.995966 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:42:53.997880 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:42:54.003414 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m08:42:54.012579 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m08:42:54.005916 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:42:54.010319 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m08:42:54.008256 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:42:54.014058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.doctor_performance)
[0m08:42:54.016399 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:42:54.022324 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:42:54.028358 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:42:54.030237 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m08:42:54.043304 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m08:42:54.045381 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m08:42:54.047550 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m08:42:54.065770 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m08:42:54.067647 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:42:54.070224 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_journey)
[0m08:42:54.072094 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c, now model.hospital_analytics.patient_spending_analysis)
[0m08:42:54.074679 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m08:42:54.076529 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:42:54.078291 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m08:42:54.079878 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m08:42:54.081340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:42:54.086922 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:42:54.308090 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m08:42:54.314308 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m08:42:54.321095 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m08:42:54.324823 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m08:42:54.327827 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:42:54.336117 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m08:42:54.339519 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m08:42:54.341023 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:42:54.347299 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m08:42:54.354387 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:42:54.355514 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m08:42:54.356968 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m08:42:54.357896 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m08:42:54.358594 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m08:42:54.372831 [debug] [MainThread]: Command end result
[0m08:42:54.659313 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:42:54.669219 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:42:54.693247 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:42:54.714487 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m08:42:54.715408 [info ] [MainThread]: Building catalog
[0m08:42:54.737585 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:42:54.740464 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:42:54.756059 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:42:54.811508 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:42:54.853934 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:42:54.858224 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:42:54.868565 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:42:54.872924 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:42:54.876241 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:54.884222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:54.885825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:54.890041 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:42:55.763290 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:88bac2e8-c20c-4bc8-ba84-162d65495fdc&page=queryresults
[0m08:42:55.780537 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:79d50469-1ad8-421f-9742-14a4365d2e4f&page=queryresults
[0m08:42:55.801392 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:9497fda0-49c7-43d6-94c1-541a6d362eea&page=queryresults
[0m08:42:55.805890 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0142fb7b-a870-4eac-9c64-2283e58e713c&page=queryresults
[0m08:43:00.293418 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:43:00.340874 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m08:43:00.413189 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:43:00.418194 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:43:00.419858 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m08:43:00.425340 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 12.410287, "process_in_blocks": "3408", "process_kernel_time": 2.111055, "process_mem_max_rss": "210280", "process_out_blocks": "6152", "process_user_time": 12.714442}
[0m08:43:00.427358 [debug] [MainThread]: Command `dbt docs generate` succeeded at 08:43:00.426983 after 12.41 seconds
[0m08:43:00.429182 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m08:43:00.430604 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:43:00.432094 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:43:00.433390 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:43:00.434662 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:43:00.436159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce7a105f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1cc4d85250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1ce6056720>]}
[0m08:43:00.437617 [debug] [MainThread]: Flushing usage events
[0m08:43:01.856679 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:44:35.643961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f8579f3f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f857ea1df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f857c2d520>]}


============================== 08:44:35.654565 | 68ee315e-c12b-4d27-b4d6-3faee687cf3a ==============================
[0m08:44:35.654565 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:44:35.656479 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:44:38.502012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '68ee315e-c12b-4d27-b4d6-3faee687cf3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f85790bc80>]}
[0m08:44:38.696590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '68ee315e-c12b-4d27-b4d6-3faee687cf3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f833903ef0>]}
[0m08:45:19.584024 [error] [MainThread]: Encountered an error:

[0m08:45:19.603851 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m08:45:19.608273 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 44.251522, "process_in_blocks": "264", "process_kernel_time": 1.189374, "process_mem_max_rss": "199464", "process_out_blocks": "3536", "process_user_time": 7.551029}
[0m08:45:19.610393 [debug] [MainThread]: Command `dbt docs serve` failed at 08:45:19.610046 after 44.25 seconds
[0m08:45:19.611487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f833800a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f859530680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f8339edbb0>]}
[0m08:45:19.612841 [debug] [MainThread]: Flushing usage events
[0m08:45:21.072911 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:45:55.722500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89cd13d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89cd0a5520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89ceb4d760>]}


============================== 08:45:55.732470 | 6f0d3688-2ab6-42b0-8334-09a83ab64ec0 ==============================
[0m08:45:55.732470 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:45:55.734495 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0.0', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:46:01.228197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f0d3688-2ab6-42b0-8334-09a83ab64ec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89ccf01af0>]}
[0m08:46:01.623136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f0d3688-2ab6-42b0-8334-09a83ab64ec0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89cd728f20>]}
[0m08:46:01.660260 [error] [MainThread]: Encountered an error:
[Errno -2] Name or service not known
[0m08:46:01.667359 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socketserver.py", line 457, in __init__
    self.server_bind()
  File "/usr/local/lib/python3.12/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
socket.gaierror: [Errno -2] Name or service not known

[0m08:46:01.673287 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 6.2160444, "process_in_blocks": "0", "process_kernel_time": 1.49803, "process_mem_max_rss": "197944", "process_out_blocks": "3368", "process_user_time": 9.992574}
[0m08:46:01.676705 [debug] [MainThread]: Command `dbt docs serve` failed at 08:46:01.676300 after 6.22 seconds
[0m08:46:01.678788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89ccf00bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89ad19b4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89acbc9550>]}
[0m08:46:01.681358 [debug] [MainThread]: Flushing usage events
[0m08:46:03.099047 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:48:10.497452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3be0eeab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3be0db84d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3bdf49dac0>]}


============================== 08:48:10.508182 | 5bb989e1-70c8-4af2-a605-159ad6affe86 ==============================
[0m08:48:10.508182 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:48:10.510413 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'send_anonymous_usage_stats': 'True'}
[0m08:48:13.386930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5bb989e1-70c8-4af2-a605-159ad6affe86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3bc2557c50>]}
[0m08:48:13.582356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5bb989e1-70c8-4af2-a605-159ad6affe86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3bbb3f45f0>]}
[0m08:52:38.378663 [error] [MainThread]: Encountered an error:

[0m08:52:38.386574 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m08:52:38.391685 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 268.16278, "process_in_blocks": "0", "process_kernel_time": 1.193197, "process_mem_max_rss": "198056", "process_out_blocks": "3368", "process_user_time": 7.505989}
[0m08:52:38.394009 [debug] [MainThread]: Command `dbt docs serve` failed at 08:52:38.393525 after 268.17 seconds
[0m08:52:38.396151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3bdf215d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3bbafdfce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3bbb1606b0>]}
[0m08:52:38.398993 [debug] [MainThread]: Flushing usage events
[0m08:52:39.880638 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:52:53.908242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38d82f19a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38d8ae9070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38d8048bc0>]}


============================== 08:52:53.919258 | 8861f12e-8360-45e1-87be-0a4cf174f06e ==============================
[0m08:52:53.919258 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:52:53.921529 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:52:56.828220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8861f12e-8360-45e1-87be-0a4cf174f06e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38d8dc63c0>]}
[0m08:52:57.029061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8861f12e-8360-45e1-87be-0a4cf174f06e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3eb92e0>]}
[0m08:52:57.031552 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m08:52:57.743410 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m08:52:58.170846 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
[0m08:52:58.172962 [debug] [MainThread]: Partial parsing: deleted file: hospital_analytics://models/staging/date_problems.sql
[0m08:52:58.470837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8861f12e-8360-45e1-87be-0a4cf174f06e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3ee0950>]}
[0m08:52:58.523918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8861f12e-8360-45e1-87be-0a4cf174f06e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3a334d0>]}
[0m08:52:58.525675 [info ] [MainThread]: Found 14 models, 9 data tests, 6 sources, 487 macros
[0m08:52:58.527549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8861f12e-8360-45e1-87be-0a4cf174f06e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3e514c0>]}
[0m08:52:58.535227 [info ] [MainThread]: 
[0m08:52:58.536911 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:52:58.538462 [info ] [MainThread]: 
[0m08:52:58.540697 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:52:58.555992 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m08:52:58.559400 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m08:52:58.567510 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m08:52:58.570474 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:52:58.578893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:52:58.584654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:52:59.378299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8861f12e-8360-45e1-87be-0a4cf174f06e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3e2bbf0>]}
[0m08:52:59.379991 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:52:59.395485 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m08:52:59.396749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m08:52:59.398225 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m08:52:59.400027 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m08:52:59.401893 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m08:52:59.403574 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m08:52:59.405446 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m08:52:59.407475 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m08:52:59.429218 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m08:52:59.431246 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m08:52:59.439992 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m08:52:59.443711 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m08:52:59.444980 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m08:52:59.454676 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m08:52:59.464026 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m08:52:59.467401 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m08:52:59.476414 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m08:52:59.480852 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:59.482210 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m08:52:59.483400 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m08:52:59.487074 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:52:59.488200 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m08:52:59.495783 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m08:52:59.497550 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:52:59.500263 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m08:52:59.508821 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m08:52:59.514607 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m08:52:59.517369 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m08:52:59.523465 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m08:52:59.527547 [debug] [Thread-3 (]: Began running node model.hospital_analytics.date_parsing_issues
[0m08:52:59.528859 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m08:52:59.535833 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m08:52:59.531112 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m08:52:59.533199 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.date_parsing_issues)
[0m08:52:59.543029 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:52:59.549438 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m08:52:59.551505 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m08:52:59.553216 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.date_parsing_issues
[0m08:52:59.554789 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m08:52:59.557200 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m08:52:59.558635 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m08:52:59.566553 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.date_parsing_issues"
[0m08:52:59.568241 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:52:59.578799 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m08:52:59.580663 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:59.604117 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:52:59.629612 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m08:52:59.631905 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m08:52:59.638233 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m08:52:59.644472 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.date_parsing_issues
[0m08:52:59.646876 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:52:59.649633 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:52:59.651616 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:52:59.653311 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:52:59.660069 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m08:52:59.661658 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m08:52:59.663447 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:52:59.665131 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.date_parsing_issues, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m08:52:59.666665 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:52:59.667962 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:52:59.676106 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m08:52:59.677598 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:52:59.679245 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m08:52:59.686831 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m08:52:59.692658 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m08:52:59.703230 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:52:59.705796 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m08:52:59.707636 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m08:52:59.716355 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:52:59.730987 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m08:52:59.732807 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:52:59.728993 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m08:52:59.735277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:59.744158 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:52:59.750306 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m08:52:59.758264 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m08:52:59.761017 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:52:59.767212 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m08:52:59.768990 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m08:52:59.770229 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m08:52:59.771087 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:52:59.773318 [debug] [Thread-1 (]: Began running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:52:59.775144 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.visits_enhanced)
[0m08:52:59.777108 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:52:59.779126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now test.hospital_analytics.accepted_values_patients_age___0.01f3e42914)
[0m08:52:59.785013 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m08:52:59.786547 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m08:52:59.795110 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m08:52:59.797072 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:52:59.799012 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:52:59.825856 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_date_of_birth.ff12953711)
[0m08:52:59.839082 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m08:52:59.840558 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:52:59.843771 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.accepted_values_patients_age___0.01f3e42914"
[0m08:52:59.858711 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_date_of_birth.ff12953711"
[0m08:52:59.861179 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m08:52:59.863003 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:52:59.869375 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m08:52:59.871906 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:52:59.873542 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:52:59.880088 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_date_of_birth.ff12953711
[0m08:52:59.881929 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:52:59.884476 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:59.886592 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m08:52:59.888366 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.billing_enhanced)
[0m08:52:59.889550 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m08:52:59.900346 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m08:52:59.902701 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m08:52:59.904394 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m08:52:59.911622 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:52:59.913123 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m08:52:59.910193 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.accepted_values_patients_age___0.01f3e42914
[0m08:52:59.915544 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m08:52:59.917454 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_date_of_birth.ff12953711, now model.hospital_analytics.monthly_visit_stats)
[0m08:52:59.923224 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m08:52:59.925329 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:52:59.927131 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m08:52:59.929022 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m08:52:59.930584 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:52:59.932593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.accepted_values_patients_age___0.01f3e42914, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m08:53:00.133666 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m08:53:00.135861 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m08:53:00.144231 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m08:53:00.146449 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:53:00.148015 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:53:00.150408 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m08:53:00.162213 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m08:53:00.170108 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m08:53:00.171141 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:53:00.175607 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m08:53:00.177660 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:53:00.180216 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:53:00.198324 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:53:00.187891 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m08:53:00.196841 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m08:53:00.190701 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:53:00.204420 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m08:53:00.206674 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:53:00.208324 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m08:53:00.210525 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m08:53:00.212596 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m08:53:00.214559 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m08:53:00.216536 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now model.hospital_analytics.patient_journey)
[0m08:53:00.218641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m08:53:00.224221 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m08:53:00.226067 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:53:00.228362 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m08:53:00.230113 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m08:53:00.244555 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m08:53:00.267429 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m08:53:00.263397 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m08:53:00.271303 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:53:00.272622 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m08:53:00.274117 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m08:53:00.275673 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m08:53:00.277876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:53:00.279634 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m08:53:00.288606 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m08:53:00.295640 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m08:53:00.301545 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m08:53:00.309183 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:53:00.310440 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m08:53:00.311351 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m08:53:00.312479 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m08:53:00.314152 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m08:53:00.326306 [debug] [MainThread]: Command end result
[0m08:53:00.612024 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:53:00.620896 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:53:00.645798 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m08:53:00.657988 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m08:53:00.659906 [info ] [MainThread]: Building catalog
[0m08:53:00.681667 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:53:00.690106 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:53:00.707954 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:53:00.717034 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m08:53:00.835326 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:53:00.851289 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:53:00.868040 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:53:00.873552 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:53:00.877313 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:53:00.883200 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m08:53:00.888036 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:53:01.074086 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:53:01.786948 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:61530e77-127f-49bd-aa20-c50a04471fb4&page=queryresults
[0m08:53:01.828834 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:75224b96-922e-4cff-ad7f-01c7bfced21e&page=queryresults
[0m08:53:01.953386 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b679dff4-7406-48ac-b491-ce985383dc0f&page=queryresults
[0m08:53:01.959257 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:7bc58781-c99f-4a20-b149-3ea1d99041ec&page=queryresults
[0m08:53:03.376430 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:53:03.429151 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m08:53:03.509763 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m08:53:03.515613 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m08:53:03.516883 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m08:53:03.521397 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.882348, "process_in_blocks": "0", "process_kernel_time": 1.727005, "process_mem_max_rss": "210784", "process_out_blocks": "7216", "process_user_time": 11.451341}
[0m08:53:03.523669 [debug] [MainThread]: Command `dbt docs generate` succeeded at 08:53:03.523293 after 9.89 seconds
[0m08:53:03.524915 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m08:53:03.526220 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:53:03.527448 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:53:03.528620 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:53:03.529613 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m08:53:03.531479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38d9145160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3c66ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b38b3c14710>]}
[0m08:53:03.533556 [debug] [MainThread]: Flushing usage events
[0m08:53:04.951131 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:53:18.723354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a378f77e2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a378e09fd40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a378dfb9fa0>]}


============================== 08:53:18.734575 | 1f97575b-739b-4cdd-a830-6c8f1ee44627 ==============================
[0m08:53:18.734575 [info ] [MainThread]: Running with dbt=1.9.0
[0m08:53:18.736507 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:53:21.624559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f97575b-739b-4cdd-a830-6c8f1ee44627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a378f4aa5a0>]}
[0m08:53:21.823409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f97575b-739b-4cdd-a830-6c8f1ee44627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a378f6d8410>]}
[0m09:36:55.543898 [error] [MainThread]: Encountered an error:

[0m09:36:55.551824 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m09:36:55.556967 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 2617.1267, "process_in_blocks": "0", "process_kernel_time": 1.329017, "process_mem_max_rss": "197876", "process_out_blocks": "3368", "process_user_time": 8.042792}
[0m09:36:55.559259 [debug] [MainThread]: Command `dbt docs serve` failed at 09:36:55.558894 after 2617.13 seconds
[0m09:36:55.560955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a378d9852e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a376e4d35f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a376ddb9100>]}
[0m09:36:55.563081 [debug] [MainThread]: Flushing usage events
[0m09:36:56.994124 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:04:00.579443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdf375f0d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdf379ea310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdf379ea210>]}


============================== 10:04:00.590512 | 04acde64-1f15-4f53-884d-b4c283f2b19d ==============================
[0m10:04:00.590512 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:04:00.592638 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:04:00.625223 [info ] [MainThread]: dbt version: 1.9.0
[0m10:04:00.626589 [info ] [MainThread]: python version: 3.11.2
[0m10:04:00.628022 [info ] [MainThread]: python path: /usr/local/bin/python
[0m10:04:00.629380 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m10:04:02.967610 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m10:04:02.969090 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m10:04:02.970185 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m10:04:02.971774 [info ] [MainThread]: adapter type: bigquery
[0m10:04:02.973216 [info ] [MainThread]: adapter version: 1.9.0
[0m10:04:03.280290 [info ] [MainThread]: Configuration:
[0m10:04:03.282254 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:04:03.283621 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:04:03.285386 [info ] [MainThread]: Required dependencies:
[0m10:04:03.286958 [debug] [MainThread]: Executing "git --help"
[0m10:04:03.301143 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:04:03.302694 [debug] [MainThread]: STDERR: "b''"
[0m10:04:03.303699 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:04:03.305304 [info ] [MainThread]: Connection:
[0m10:04:03.307053 [info ] [MainThread]:   method: service-account
[0m10:04:03.308752 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m10:04:03.310195 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m10:04:03.311406 [info ] [MainThread]:   schema: hospital
[0m10:04:03.313075 [info ] [MainThread]:   location: asia-southeast2
[0m10:04:03.314702 [info ] [MainThread]:   priority: interactive
[0m10:04:03.316161 [info ] [MainThread]:   maximum_bytes_billed: None
[0m10:04:03.317580 [info ] [MainThread]:   impersonate_service_account: None
[0m10:04:03.319000 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m10:04:03.319767 [info ] [MainThread]:   job_retries: 1
[0m10:04:03.321181 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m10:04:03.322293 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m10:04:03.323164 [info ] [MainThread]:   timeout_seconds: 300
[0m10:04:03.324555 [info ] [MainThread]:   client_id: None
[0m10:04:03.326503 [info ] [MainThread]:   token_uri: None
[0m10:04:03.329275 [info ] [MainThread]:   dataproc_region: None
[0m10:04:03.331904 [info ] [MainThread]:   dataproc_cluster_name: None
[0m10:04:03.333513 [info ] [MainThread]:   gcs_bucket: None
[0m10:04:03.334527 [info ] [MainThread]:   dataproc_batch: None
[0m10:04:03.336167 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:04:04.011412 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m10:04:04.012645 [debug] [MainThread]: On debug: select 1 as id
[0m10:04:04.013707 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:04:04.807181 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c21b139b-633f-4e86-b9f9-0579f0fa6c6d&page=queryresults
[0m10:04:05.626662 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:04:05.633282 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:04:05.640547 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.232599, "process_in_blocks": "40", "process_kernel_time": 1.678335, "process_mem_max_rss": "203700", "process_out_blocks": "48", "process_user_time": 7.614995}
[0m10:04:05.647881 [debug] [MainThread]: Command `dbt debug` succeeded at 10:04:05.647320 after 5.24 seconds
[0m10:04:05.649042 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:04:05.655322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdf136cafd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdf13761b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdf225a3350>]}
[0m10:04:05.663271 [debug] [MainThread]: Flushing usage events
[0m10:04:07.168769 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:04:03.376706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766460144650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766460123ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766460123dd0>]}


============================== 12:04:03.385982 | 63a71bd2-5d7a-48be-b41b-10e4bffe2e2d ==============================
[0m12:04:03.385982 [info ] [MainThread]: Running with dbt=1.9.0
[0m12:04:03.387566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:04:05.999603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766440a0fdd0>]}
[0m12:04:06.181214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7664403fb7d0>]}
[0m12:04:06.183672 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m12:04:06.851037 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m12:04:07.292105 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 2 files changed.
[0m12:04:07.294616 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/schema.yml
[0m12:04:07.295557 [debug] [MainThread]: Partial parsing: deleted file: hospital_analytics://models/staging/refined/date_parsing_issues.sql
[0m12:04:07.297033 [debug] [MainThread]: Partial parsing: updated file: dbt_bigquery://macros/materializations/incremental.sql
[0m12:04:08.876227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643bdfb7d0>]}
[0m12:04:09.137822 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m12:04:09.145844 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m12:04:09.215173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643b944850>]}
[0m12:04:09.216938 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m12:04:09.218037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643bd9ad10>]}
[0m12:04:09.226577 [info ] [MainThread]: 
[0m12:04:09.228274 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:04:09.230203 [info ] [MainThread]: 
[0m12:04:09.232170 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:04:09.246981 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m12:04:09.250409 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m12:04:09.252382 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:04:09.255564 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m12:04:09.257252 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:04:09.336328 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:04:10.785688 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m12:04:10.787044 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:04:10.790364 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m12:04:10.791979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:04:10.952500 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m12:04:10.954567 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:04:11.516418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766461617410>]}
[0m12:04:11.518033 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:04:11.532628 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m12:04:11.534398 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m12:04:11.536131 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m12:04:11.539603 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m12:04:11.546897 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m12:04:11.542981 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m12:04:11.544702 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m12:04:11.541184 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m12:04:11.560860 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m12:04:11.573443 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m12:04:11.579434 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m12:04:11.582347 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m12:04:11.585608 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m12:04:11.587998 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m12:04:11.590659 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m12:04:11.604772 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m12:04:11.592138 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m12:04:11.594380 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m12:04:11.615364 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m12:04:11.632247 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m12:04:11.627106 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m12:04:11.648835 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m12:04:11.680460 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m12:04:11.776317 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m12:04:11.837637 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:04:11.840580 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m12:04:11.835555 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m12:04:11.924331 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m12:04:11.929398 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m12:04:11.930986 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:04:12.010212 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m12:04:12.016542 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:04:12.018394 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m12:04:12.020255 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:04:12.546952 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m12:04:12.549283 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m12:04:12.738787 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a0582f4d-df64-4828-9e46-03a2275bae26&page=queryresults
[0m12:04:12.940624 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:83ba07f9-0f83-4494-9bce-0e3c3fb66152&page=queryresults
[0m12:04:13.316143 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643b5efa10>]}
[0m12:04:13.318089 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a5a8610>]}
[0m12:04:13.320458 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.72s]
[0m12:04:13.323403 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m12:04:13.326168 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m12:04:13.328107 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m12:04:13.332704 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m12:04:13.335305 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m12:04:13.337678 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m12:04:13.339011 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m12:04:13.348340 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m12:04:13.350877 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m12:04:13.359175 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:04:13.890133 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:838ac599-a8b8-4757-8bf7-8bef8eb818ff&page=queryresults
[0m12:04:13.919842 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m12:04:13.922692 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m12:04:14.005515 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:3b466ed1-2653-4591-bb80-432f40957342&page=queryresults
[0m12:04:14.158951 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643bef2c10>]}
[0m12:04:14.161059 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.59s]
[0m12:04:14.164102 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m12:04:14.167500 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m12:04:14.170288 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m12:04:14.172017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m12:04:14.174092 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m12:04:14.187873 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m12:04:14.191153 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m12:04:14.198513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:04:14.630517 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0f3c851c-f236-4741-a9a6-c9c178504bd9&page=queryresults
[0m12:04:14.662007 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m12:04:14.664415 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m12:04:15.410817 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a95389b5-48c4-478f-a4b2-3cac8d9601a8&page=queryresults
[0m12:04:15.564531 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643b5f0790>]}
[0m12:04:15.566590 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 624.0 Bytes processed)[0m in 3.98s]
[0m12:04:15.568591 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m12:04:16.243952 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643b5fded0>]}
[0m12:04:16.245560 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 813.0 Bytes processed)[0m in 2.91s]
[0m12:04:16.247825 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m12:04:16.934331 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a59ea50>]}
[0m12:04:16.935865 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.76s]
[0m12:04:16.938256 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m12:04:16.941427 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m12:04:16.943002 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m12:04:16.944987 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.prescriptions_enhanced)
[0m12:04:16.946576 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m12:04:16.948195 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m12:04:16.950378 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m12:04:16.961600 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m12:04:16.971584 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m12:04:16.979586 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m12:04:16.993456 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m12:04:16.997249 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m12:04:16.999158 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m12:04:17.018680 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:04:17.029113 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:04:17.600703 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m12:04:17.604666 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m12:04:17.614030 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m12:04:17.616996 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m12:04:17.905177 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:af3bfce7-70fb-4c63-a3dd-a527b268704b&page=queryresults
[0m12:04:17.911415 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:37052119-21c0-4a3f-ae0b-fc8eee46d3c9&page=queryresults
[0m12:04:19.651599 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a525850>]}
[0m12:04:19.653217 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (5.5k rows, 262.4 KiB processed)[0m in 2.69s]
[0m12:04:19.655620 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m12:04:19.658363 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m12:04:19.659490 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m12:04:19.661502 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m12:04:19.664432 [info ] [Thread-3 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m12:04:19.666075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m12:04:19.669389 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m12:04:19.671330 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m12:04:19.673278 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m12:04:19.693505 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m12:04:19.697150 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m12:04:19.704407 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m12:04:19.713258 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m12:04:19.722693 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:04:19.721275 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:04:19.805331 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643b5bdf10>]}
[0m12:04:19.810305 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (5.5k rows, 266.6 KiB processed)[0m in 2.86s]
[0m12:04:19.893129 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m12:04:19.896529 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m12:04:19.897849 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m12:04:19.899232 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m12:04:19.904016 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m12:04:19.915368 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m12:04:19.917684 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m12:04:19.926384 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m12:04:19.930633 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m12:04:19.932607 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:04:20.199600 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m12:04:20.202102 [debug] [Thread-3 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m12:04:20.303608 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m12:04:20.306870 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m12:04:20.509866 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:139fb249-e363-4259-9497-5f30776cc8e8&page=queryresults
[0m12:04:20.609332 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:81ee1eaa-3213-42ec-b1b7-a0e36b34024a&page=queryresults
[0m12:04:20.639311 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8122526b-02c5-4efa-bf6e-e57b128b6b7b&page=queryresults
[0m12:04:22.302832 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a196750>]}
[0m12:04:22.304324 [info ] [Thread-3 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (8.0 rows, 353.2 KiB processed)[0m in 2.63s]
[0m12:04:22.306022 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m12:04:22.402820 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a196550>]}
[0m12:04:22.404497 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (10.4k rows, 535.0 KiB processed)[0m in 2.74s]
[0m12:04:22.406128 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m12:04:22.408248 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m12:04:22.410480 [info ] [Thread-2 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m12:04:22.409247 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m12:04:22.411507 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m12:04:22.413082 [info ] [Thread-3 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m12:04:22.415870 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m12:04:22.417905 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m12:04:22.428351 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m12:04:22.446031 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m12:04:22.467533 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m12:04:22.471502 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m12:04:22.481006 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:04:22.568141 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m12:04:22.574612 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:04:23.049568 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m12:04:23.054181 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m12:04:23.055370 [debug] [Thread-3 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m12:04:23.057858 [debug] [Thread-2 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m12:04:23.309621 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:647d327e-c961-420f-aa93-b35ce497a4d1&page=queryresults
[0m12:04:23.329551 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d4dacc67-f896-4886-8920-c6db862477fe&page=queryresults
[0m12:04:25.862893 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a57e590>]}
[0m12:04:25.864027 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 343.1 KiB processed)[0m in 5.96s]
[0m12:04:25.866354 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m12:04:26.225931 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a59e0d0>]}
[0m12:04:26.227078 [info ] [Thread-2 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (178.5k rows, 1.3 MiB processed)[0m in 3.81s]
[0m12:04:26.228609 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m12:05:21.624694 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63a71bd2-5d7a-48be-b41b-10e4bffe2e2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76643a171550>]}
[0m12:05:21.627183 [info ] [Thread-3 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 626.8 KiB processed)[0m in 59.21s]
[0m12:05:21.629696 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m12:05:21.638323 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:05:21.644930 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:05:21.645967 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m12:05:21.647218 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m12:05:21.648126 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m12:05:21.648875 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m12:05:21.651116 [info ] [MainThread]: 
[0m12:05:21.653410 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 1 minutes and 12.42 seconds (72.42s).
[0m12:05:21.664272 [debug] [MainThread]: Command end result
[0m12:05:21.749023 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m12:05:21.755087 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m12:05:21.770841 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m12:05:21.771862 [info ] [MainThread]: 
[0m12:05:21.773132 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:05:21.775456 [info ] [MainThread]: 
[0m12:05:21.776399 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m12:05:21.780660 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 78.57545, "process_in_blocks": "1256", "process_kernel_time": 1.95374, "process_mem_max_rss": "218076", "process_out_blocks": "3880", "process_user_time": 12.909751}
[0m12:05:21.783117 [debug] [MainThread]: Command `dbt run` succeeded at 12:05:21.781915 after 78.58 seconds
[0m12:05:21.784452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76645ffab850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766463aad4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x766463aac6d0>]}
[0m12:05:21.785905 [debug] [MainThread]: Flushing usage events
[0m12:05:23.232163 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:08:05.572885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7317276e1a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731727bf4a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7317276e1b50>]}


============================== 12:08:05.582032 | 85adcf3e-637b-4fba-ac08-10ee40add60e ==============================
[0m12:08:05.582032 [info ] [MainThread]: Running with dbt=1.9.0
[0m12:08:05.584103 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:08:08.032092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85adcf3e-637b-4fba-ac08-10ee40add60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731703867590>]}
[0m12:08:08.198352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85adcf3e-637b-4fba-ac08-10ee40add60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731729961ed0>]}
[0m12:08:08.200144 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m12:08:08.875017 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m12:08:09.257231 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:08:09.258527 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:08:09.389892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85adcf3e-637b-4fba-ac08-10ee40add60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7317035181d0>]}
[0m12:08:09.627500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85adcf3e-637b-4fba-ac08-10ee40add60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73170ffdd750>]}
[0m12:08:09.630455 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m12:08:09.632536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85adcf3e-637b-4fba-ac08-10ee40add60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7317297fda50>]}
[0m12:08:09.639985 [info ] [MainThread]: 
[0m12:08:09.641222 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:08:09.642204 [info ] [MainThread]: 
[0m12:08:09.644115 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:08:09.658488 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m12:08:09.660204 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:09.662749 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m12:08:09.664641 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:09.684494 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m12:08:09.842884 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:10.300676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85adcf3e-637b-4fba-ac08-10ee40add60e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731703cf4390>]}
[0m12:08:10.302089 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:08:10.316288 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m12:08:10.318241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m12:08:10.321135 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m12:08:10.333346 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m12:08:10.341116 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m12:08:10.344677 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m12:08:10.343175 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m12:08:10.359372 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m12:08:10.366947 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m12:08:10.368617 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m12:08:10.375348 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m12:08:10.377207 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m12:08:10.380012 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m12:08:10.381296 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m12:08:10.383447 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m12:08:10.392173 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m12:08:10.394599 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m12:08:10.396216 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:08:10.405507 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m12:08:10.407193 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:08:10.409840 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m12:08:10.415896 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m12:08:10.418357 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m12:08:10.424278 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m12:08:10.425824 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:08:10.428177 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m12:08:10.429381 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:08:10.435888 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m12:08:10.438136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m12:08:10.445071 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m12:08:10.446871 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m12:08:10.448816 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m12:08:10.451977 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m12:08:10.453207 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m12:08:10.462985 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m12:08:10.464112 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m12:08:10.465290 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m12:08:10.466536 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m12:08:10.483053 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m12:08:10.470090 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m12:08:10.468546 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m12:08:10.520341 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m12:08:10.490185 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m12:08:10.518280 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m12:08:10.516009 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:08:10.532767 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m12:08:10.535841 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m12:08:10.538199 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:08:10.543940 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m12:08:10.545768 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m12:08:10.554493 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:08:10.552967 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m12:08:10.547460 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m12:08:10.557098 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m12:08:10.567804 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m12:08:10.558157 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m12:08:10.570486 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:08:10.565533 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m12:08:10.568915 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m12:08:10.563468 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m12:08:10.572031 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m12:08:10.576660 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m12:08:10.587168 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m12:08:10.598409 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m12:08:10.609984 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m12:08:10.611557 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m12:08:10.613187 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.visits_enhanced)
[0m12:08:10.621093 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m12:08:10.615577 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m12:08:10.619308 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m12:08:10.635123 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:08:10.617634 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now test.hospital_analytics.not_null_patients_age.8fed007e09)
[0m12:08:10.641684 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m12:08:10.630783 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m12:08:10.640477 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m12:08:10.633300 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:08:10.653856 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_age.8fed007e09"
[0m12:08:10.655395 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m12:08:10.667946 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.not_null_patients_full_name.7bac40f23c)
[0m12:08:10.662408 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m12:08:10.664152 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m12:08:10.656987 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m12:08:10.669228 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m12:08:10.670423 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m12:08:10.672039 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:08:10.674468 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:08:10.684330 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9)
[0m12:08:10.688907 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_full_name.7bac40f23c"
[0m12:08:10.694494 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m12:08:10.699517 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m12:08:10.700869 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m12:08:10.703740 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m12:08:10.704832 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m12:08:10.706315 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m12:08:10.720851 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_age.8fed007e09, now test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a)
[0m12:08:10.726323 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m12:08:10.723536 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:08:10.725116 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.prescriptions_enhanced)
[0m12:08:10.722234 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9"
[0m12:08:10.741609 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a"
[0m12:08:10.747753 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m12:08:10.749322 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m12:08:10.751131 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m12:08:10.768564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:08:10.754328 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m12:08:10.767185 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m12:08:10.752891 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m12:08:10.775176 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m12:08:10.776816 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_full_name.7bac40f23c, now model.hospital_analytics.billing_enhanced)
[0m12:08:10.778574 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:08:10.780919 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m12:08:10.790899 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:08:10.782996 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m12:08:10.789333 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m12:08:10.784001 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m12:08:10.796170 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m12:08:10.798233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9, now model.hospital_analytics.monthly_visit_stats)
[0m12:08:10.800165 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m12:08:10.811704 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m12:08:10.813549 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m12:08:10.815175 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m12:08:10.817208 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m12:08:10.819493 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m12:08:10.821070 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m12:08:10.835230 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:08:10.832543 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m12:08:10.833994 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m12:08:10.831430 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m12:08:10.846813 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m12:08:10.851605 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m12:08:10.864526 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m12:08:10.867810 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m12:08:10.869298 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m12:08:10.871237 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m12:08:10.873986 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:08:10.875062 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m12:08:10.877567 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m12:08:10.879926 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:08:10.885396 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m12:08:10.887293 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:08:10.888483 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m12:08:10.893935 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m12:08:10.917142 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m12:08:10.902079 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m12:08:10.914526 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m12:08:10.895562 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m12:08:10.919041 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_journey)
[0m12:08:10.921150 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m12:08:10.923126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.doctor_performance)
[0m12:08:10.924909 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m12:08:10.926202 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m12:08:10.927877 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c, now model.hospital_analytics.patient_spending_analysis)
[0m12:08:10.948434 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m12:08:10.928875 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m12:08:10.947334 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:08:10.944490 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m12:08:10.966905 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m12:08:10.971520 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m12:08:10.975849 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m12:08:10.978710 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m12:08:10.980422 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m12:08:10.983661 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:08:10.985633 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:08:10.987290 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m12:08:10.992363 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m12:08:10.997676 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m12:08:10.999239 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:08:11.005611 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m12:08:11.014998 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:08:11.015918 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m12:08:11.017001 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m12:08:11.017842 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m12:08:11.019311 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m12:08:11.034973 [debug] [MainThread]: Command end result
[0m12:08:11.322537 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m12:08:11.331889 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m12:08:11.357693 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m12:08:11.367445 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m12:08:11.368353 [info ] [MainThread]: Building catalog
[0m12:08:11.391484 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m12:08:11.401052 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m12:08:11.439316 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m12:08:11.450659 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m12:08:11.572906 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m12:08:11.583664 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:11.581482 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m12:08:11.562844 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m12:08:11.609485 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:11.613496 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m12:08:11.701046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:11.860865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:08:12.377340 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:719b7005-89e0-4592-98a0-7370307a8f8e&page=queryresults
[0m12:08:12.395143 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c90fb895-d529-4723-b395-0b87a5d01f97&page=queryresults
[0m12:08:12.397405 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:3a2b5663-c595-44ad-a856-cf3cb82e58e2&page=queryresults
[0m12:08:12.406119 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c5240b16-1c88-4578-8efe-dec07d1e51b1&page=queryresults
[0m12:08:13.969182 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:08:14.016920 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m12:08:14.090924 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m12:08:14.095628 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m12:08:14.096944 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m12:08:14.100587 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 8.698044, "process_in_blocks": "0", "process_kernel_time": 1.822257, "process_mem_max_rss": "211852", "process_out_blocks": "6136", "process_user_time": 10.431132}
[0m12:08:14.102873 [debug] [MainThread]: Command `dbt docs generate` succeeded at 12:08:14.102457 after 8.70 seconds
[0m12:08:14.104286 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m12:08:14.105587 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m12:08:14.107403 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m12:08:14.108792 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m12:08:14.110536 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m12:08:14.112463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731727bf4a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x731729590510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7317277347d0>]}
[0m12:08:14.114391 [debug] [MainThread]: Flushing usage events
[0m12:08:15.646444 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:09:16.727081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41a8df8550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41a8df8ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41a8df9750>]}


============================== 12:09:16.736436 | 78180396-d80c-460d-8638-90b6f226f506 ==============================
[0m12:09:16.736436 [info ] [MainThread]: Running with dbt=1.9.0
[0m12:09:16.738558 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'send_anonymous_usage_stats': 'True'}
[0m12:09:19.288144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '78180396-d80c-460d-8638-90b6f226f506', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41a8df1850>]}
[0m12:09:19.501317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '78180396-d80c-460d-8638-90b6f226f506', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41ab044d50>]}
[0m12:28:38.246202 [error] [MainThread]: Encountered an error:

[0m12:28:38.255108 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.11/socketserver.py", line 233, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m12:28:38.259902 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 1161.7087, "process_in_blocks": "32", "process_kernel_time": 1.416545, "process_mem_max_rss": "199988", "process_out_blocks": "3544", "process_user_time": 7.435321}
[0m12:28:38.262481 [debug] [MainThread]: Command `dbt docs serve` failed at 12:28:38.261846 after 1161.71 seconds
[0m12:28:38.264006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41ac741510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a41a8e48950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4189553f90>]}
[0m12:28:38.266197 [debug] [MainThread]: Flushing usage events
[0m12:28:39.780964 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:07:31.970078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c66bf4fb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c66bf4fb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c66bf3a250>]}


============================== 10:07:31.981375 | a5eea7d9-481d-4ced-b98a-b12556899a86 ==============================
[0m10:07:31.981375 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:07:31.983629 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:07:32.060794 [info ] [MainThread]: dbt version: 1.9.0
[0m10:07:32.062816 [info ] [MainThread]: python version: 3.11.2
[0m10:07:32.064645 [info ] [MainThread]: python path: /usr/local/bin/python
[0m10:07:32.065961 [info ] [MainThread]: os info: Linux-6.8.0-55-generic-x86_64-with-glibc2.31
[0m10:07:34.254704 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m10:07:34.256328 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m10:07:34.257803 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m10:07:34.258977 [info ] [MainThread]: adapter type: bigquery
[0m10:07:34.260650 [info ] [MainThread]: adapter version: 1.9.0
[0m10:07:34.548936 [info ] [MainThread]: Configuration:
[0m10:07:34.550311 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:07:34.551275 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:07:34.552910 [info ] [MainThread]: Required dependencies:
[0m10:07:34.554072 [debug] [MainThread]: Executing "git --help"
[0m10:07:34.612847 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:07:34.614713 [debug] [MainThread]: STDERR: "b''"
[0m10:07:34.616058 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:07:34.617138 [info ] [MainThread]: Connection:
[0m10:07:34.618578 [info ] [MainThread]:   method: service-account
[0m10:07:34.620209 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m10:07:34.621586 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m10:07:34.622970 [info ] [MainThread]:   schema: hospital
[0m10:07:34.624171 [info ] [MainThread]:   location: asia-southeast2
[0m10:07:34.625443 [info ] [MainThread]:   priority: interactive
[0m10:07:34.626757 [info ] [MainThread]:   maximum_bytes_billed: None
[0m10:07:34.627570 [info ] [MainThread]:   impersonate_service_account: None
[0m10:07:34.628767 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m10:07:34.629846 [info ] [MainThread]:   job_retries: 1
[0m10:07:34.631461 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m10:07:34.633147 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m10:07:34.634071 [info ] [MainThread]:   timeout_seconds: 300
[0m10:07:34.635685 [info ] [MainThread]:   client_id: None
[0m10:07:34.636808 [info ] [MainThread]:   token_uri: None
[0m10:07:34.638566 [info ] [MainThread]:   dataproc_region: None
[0m10:07:34.639810 [info ] [MainThread]:   dataproc_cluster_name: None
[0m10:07:34.640700 [info ] [MainThread]:   gcs_bucket: None
[0m10:07:34.641829 [info ] [MainThread]:   dataproc_batch: None
[0m10:07:34.643492 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:07:35.274547 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m10:07:35.275746 [debug] [MainThread]: On debug: select 1 as id
[0m10:07:35.276799 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:07:36.166410 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:796f5feb-f7da-47f2-9800-d35ed7c8f8bd&page=queryresults
[0m10:07:36.635555 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:07:36.637111 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:07:36.644063 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 4.829758, "process_in_blocks": "4664", "process_kernel_time": 2.136781, "process_mem_max_rss": "201652", "process_out_blocks": "40", "process_user_time": 9.447241}
[0m10:07:36.646031 [debug] [MainThread]: Command `dbt debug` succeeded at 10:07:36.645611 after 4.83 seconds
[0m10:07:36.646689 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:07:36.647593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c66bf52410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c647f28590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c66bf007d0>]}
[0m10:07:36.649203 [debug] [MainThread]: Flushing usage events
[0m10:07:38.161577 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:07:49.328423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f6788c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f6777490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f6777cd0>]}


============================== 10:07:49.337767 | c603745c-f69f-4f8d-acb1-1863b5b7b116 ==============================
[0m10:07:49.337767 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:07:49.339834 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:07:50.880142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c603745c-f69f-4f8d-acb1-1863b5b7b116', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f6683910>]}
[0m10:07:51.154238 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 1.9646702, "process_in_blocks": "296", "process_kernel_time": 0.961685, "process_mem_max_rss": "89892", "process_out_blocks": "8", "process_user_time": 4.968906}
[0m10:07:51.165421 [debug] [MainThread]: Command `dbt clean` succeeded at 10:07:51.164958 after 1.98 seconds
[0m10:07:51.175255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f6777fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f6777bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb1f9f74bd0>]}
[0m10:07:51.183294 [debug] [MainThread]: Flushing usage events
[0m10:07:52.917777 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:09:06.002008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad920eb7f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad920f1bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad9212be310>]}


============================== 10:09:06.011831 | 14c39a32-e7d3-4c0c-90ac-85a5d89841ea ==============================
[0m10:09:06.011831 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:09:06.013733 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:09:08.443227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad901022ad0>]}
[0m10:09:08.613226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad92313e450>]}
[0m10:09:08.615678 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:09:09.291315 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m10:09:09.293518 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:09:09.294229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad90117f790>]}
[0m10:09:14.066041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad90098a350>]}
[0m10:09:14.330363 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:09:14.341316 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:09:14.438180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad900ced1d0>]}
[0m10:09:14.439990 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m10:09:14.441494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad900531950>]}
[0m10:09:14.449061 [info ] [MainThread]: 
[0m10:09:14.451270 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:09:14.452783 [info ] [MainThread]: 
[0m10:09:14.455034 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:09:14.471397 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:09:14.473120 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:09:14.558762 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:09:14.564383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:09:14.567332 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:09:14.661988 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:09:16.128673 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m10:09:16.130113 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:16.206948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m10:09:16.208536 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:16.216621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m10:09:16.295498 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:16.779673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad900eb6b90>]}
[0m10:09:16.782948 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:09:16.798312 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m10:09:16.800362 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m10:09:16.802550 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m10:09:16.804397 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m10:09:16.806448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m10:09:16.808286 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m10:09:16.810798 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m10:09:16.814514 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m10:09:16.813465 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m10:09:16.816604 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m10:09:16.818722 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m10:09:16.852394 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m10:09:16.839425 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m10:09:16.864753 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m10:09:16.850552 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m10:09:16.863285 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m10:09:16.848446 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m10:09:16.877507 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m10:09:16.883742 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m10:09:16.888626 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m10:09:16.891284 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m10:09:16.893277 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m10:09:16.917979 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m10:09:17.105306 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m10:09:17.188996 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m10:09:17.198050 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m10:09:17.206569 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m10:09:17.216134 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m10:09:17.231286 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:09:17.234205 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m10:09:17.236237 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:17.238154 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:09:17.240118 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:09:17.401693 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:09:17.999203 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m10:09:18.001216 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m10:09:18.061732 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:550d9896-db37-4700-ac27-7281a3cf7351&page=queryresults
[0m10:09:18.352314 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b808d26b-f8c5-4cbd-a37b-e723423ac95a&page=queryresults
[0m10:09:18.474421 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:edee3d1e-7fdf-48a9-ab00-f7c4ba878ed1&page=queryresults
[0m10:09:18.481782 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e3e9ffdb-a613-42ed-ba66-8db8117a72f6&page=queryresults
[0m10:09:18.582330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad900548bd0>]}
[0m10:09:18.584641 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.77s]
[0m10:09:18.587346 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m10:09:18.592386 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m10:09:18.594776 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m10:09:18.596794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m10:09:18.603296 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m10:09:18.615559 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m10:09:18.617734 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m10:09:18.627082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:18.768929 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad9000548d0>]}
[0m10:09:18.771430 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m10:09:18.774478 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m10:09:18.779110 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m10:09:18.780508 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m10:09:18.782489 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m10:09:18.783778 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m10:09:18.795356 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m10:09:18.797636 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m10:09:18.807022 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:09:18.899511 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad9000514d0>]}
[0m10:09:18.903571 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.06s]
[0m10:09:18.906333 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m10:09:19.122670 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m10:09:19.125424 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m10:09:19.283180 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m10:09:19.285674 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m10:09:20.011630 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad900e20e10>]}
[0m10:09:20.013734 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 623.0 Bytes processed)[0m in 3.16s]
[0m10:09:20.017058 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m10:09:20.222018 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b78ffd99-8538-4ef6-89bc-1783802b4803&page=queryresults
[0m10:09:21.003238 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4a250373-d61a-4f85-b5da-cc85f630415d&page=queryresults
[0m10:09:21.986293 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad90005a0d0>]}
[0m10:09:21.987973 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.8 KiB processed)[0m in 3.20s]
[0m10:09:21.990793 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m10:09:22.003668 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m10:09:22.009114 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m10:09:22.015913 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.visits_enhanced)
[0m10:09:22.021587 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m10:09:22.060814 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m10:09:22.074932 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m10:09:22.097237 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:09:22.795380 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad90007ab50>]}
[0m10:09:22.797431 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 862.0 Bytes processed)[0m in 4.20s]
[0m10:09:22.804076 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m10:09:22.831853 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m10:09:22.856180 [debug] [Thread-3 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m10:09:22.867495 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m10:09:22.869596 [info ] [Thread-2 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m10:09:22.895399 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m10:09:22.896992 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m10:09:22.942285 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:09:22.949976 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m10:09:22.973690 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:09:23.151827 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e4ccd5ce-9cbe-4f11-9c75-c64fca93d5d4&page=queryresults
[0m10:09:23.577330 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:09:23.579144 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m10:09:24.129698 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:91171367-c87a-40e0-9142-b56475516f32&page=queryresults
[0m10:09:25.021080 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad90004c710>]}
[0m10:09:25.023463 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (200.0 rows, 16.2 KiB processed)[0m in 3.00s]
[0m10:09:25.051668 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m10:09:25.085179 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m10:09:25.103249 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m10:09:25.117669 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m10:09:25.120914 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m10:09:25.152341 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m10:09:25.164550 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m10:09:25.177841 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m10:09:25.191123 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m10:09:25.294509 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m10:09:25.304571 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m10:09:25.301474 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m10:09:25.325569 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m10:09:25.328414 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:09:25.395840 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:25.680399 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad8fb3eb3d0>]}
[0m10:09:25.682728 [info ] [Thread-2 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (200.0 rows, 14.5 KiB processed)[0m in 2.80s]
[0m10:09:25.687316 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m10:09:25.691121 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m10:09:25.693198 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m10:09:25.694970 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m10:09:25.697004 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m10:09:25.712148 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m10:09:25.714303 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m10:09:25.725010 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:09:25.918479 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m10:09:25.920887 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m10:09:25.933815 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m10:09:25.936372 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m10:09:26.173713 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m10:09:26.177645 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m10:09:26.191534 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0feea193-0784-4e71-ba60-2348466ff8ea&page=queryresults
[0m10:09:26.197375 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:30e04cee-4c38-4b9a-bdec-9e541c316da0&page=queryresults
[0m10:09:26.431269 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:23732828-40f7-43d9-94b0-9ce253ffe8b1&page=queryresults
[0m10:09:27.745544 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad8fb3bbb50>]}
[0m10:09:27.751725 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (208.0 rows, 24.7 KiB processed)[0m in 2.59s]
[0m10:09:27.754899 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m10:09:27.760505 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m10:09:27.762113 [info ] [Thread-2 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m10:09:27.766555 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m10:09:27.768782 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m10:09:27.770837 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m10:09:27.773216 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m10:09:27.775083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m10:09:27.784023 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m10:09:27.792612 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m10:09:27.807401 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m10:09:27.806510 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m10:09:27.818086 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:09:27.820074 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m10:09:27.914946 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:28.239011 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad8fb77ad10>]}
[0m10:09:28.241814 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (12.0 rows, 12.9 KiB processed)[0m in 3.11s]
[0m10:09:28.247095 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m10:09:28.312209 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad8fb779d50>]}
[0m10:09:28.314152 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 12.9 KiB processed)[0m in 2.62s]
[0m10:09:28.317144 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m10:09:28.565487 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m10:09:28.569368 [debug] [Thread-2 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m10:09:28.573751 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m10:09:28.578636 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m10:09:29.072335 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:057ecc22-0195-4e5d-b690-40e70a5ec901&page=queryresults
[0m10:09:29.911789 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f2ed130f-558e-4b3f-b88d-fe0e1c8fc33b&page=queryresults
[0m10:09:30.797738 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad8fb7ff110>]}
[0m10:09:30.800063 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 21.5 KiB processed)[0m in 3.02s]
[0m10:09:30.802282 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m10:09:31.638591 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14c39a32-e7d3-4c0c-90ac-85a5d89841ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad900185950>]}
[0m10:09:31.640987 [info ] [Thread-2 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (295.0 rows, 45.4 KiB processed)[0m in 3.87s]
[0m10:09:31.643109 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m10:09:31.651006 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:09:31.656378 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:09:31.659761 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m10:09:31.661021 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m10:09:31.662682 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m10:09:31.663738 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m10:09:31.665122 [info ] [MainThread]: 
[0m10:09:31.666521 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 17.21 seconds (17.21s).
[0m10:09:31.676428 [debug] [MainThread]: Command end result
[0m10:09:31.766181 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:09:31.780482 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:09:31.799160 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:09:31.800406 [info ] [MainThread]: 
[0m10:09:31.801859 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:09:31.803082 [info ] [MainThread]: 
[0m10:09:31.804456 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m10:09:31.807759 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.975685, "process_in_blocks": "2808", "process_kernel_time": 2.423629, "process_mem_max_rss": "218000", "process_out_blocks": "3872", "process_user_time": 17.498743}
[0m10:09:31.809632 [debug] [MainThread]: Command `dbt run` succeeded at 10:09:31.809303 after 25.98 seconds
[0m10:09:31.811160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad920f1c910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad9246e0b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad92483c6d0>]}
[0m10:09:31.812337 [debug] [MainThread]: Flushing usage events
[0m10:09:33.281682 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:09:56.698975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7599859685d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759985968190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759985969a90>]}


============================== 10:09:56.707921 | abeaff5d-d2be-4690-9a54-2cd6db9266ed ==============================
[0m10:09:56.707921 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:09:56.709204 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:09:59.278445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'abeaff5d-d2be-4690-9a54-2cd6db9266ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759965c8e3d0>]}
[0m10:09:59.464476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'abeaff5d-d2be-4690-9a54-2cd6db9266ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759987be6850>]}
[0m10:09:59.466351 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:10:00.127403 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m10:10:00.521054 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:10:00.522356 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:10:00.664728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'abeaff5d-d2be-4690-9a54-2cd6db9266ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759965ad6890>]}
[0m10:10:00.921201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'abeaff5d-d2be-4690-9a54-2cd6db9266ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7599713b2fd0>]}
[0m10:10:00.922986 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m10:10:00.925147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'abeaff5d-d2be-4690-9a54-2cd6db9266ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759965b80c50>]}
[0m10:10:00.932828 [info ] [MainThread]: 
[0m10:10:00.933936 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:10:00.935836 [info ] [MainThread]: 
[0m10:10:00.938189 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:10:00.953160 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m10:10:00.954583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:00.957003 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m10:10:00.966781 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m10:10:01.049559 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:01.052603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:01.612105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'abeaff5d-d2be-4690-9a54-2cd6db9266ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759965b3ae90>]}
[0m10:10:01.613627 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:10:01.629406 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m10:10:01.631561 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m10:10:01.633535 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m10:10:01.635183 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m10:10:01.636508 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m10:10:01.638398 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m10:10:01.639529 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m10:10:01.653075 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m10:10:01.660646 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m10:10:01.671196 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m10:10:01.673480 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m10:10:01.675415 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m10:10:01.685436 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m10:10:01.688188 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m10:10:01.689855 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m10:10:01.709186 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m10:10:01.714047 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m10:10:01.715596 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m10:10:01.717113 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:10:01.720306 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m10:10:01.722337 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:10:01.725830 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:10:01.728662 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m10:10:01.735853 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m10:10:01.746397 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:10:01.748840 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m10:10:01.763459 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m10:10:01.765391 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m10:10:01.774184 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m10:10:01.775582 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m10:10:01.777113 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m10:10:01.778568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m10:10:01.780428 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m10:10:01.782531 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m10:10:01.784421 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m10:10:01.786128 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m10:10:01.787765 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m10:10:01.789286 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m10:10:01.790835 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m10:10:01.799993 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m10:10:01.801782 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m10:10:01.878998 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m10:10:01.884267 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m10:10:01.891627 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m10:10:01.899201 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m10:10:01.902140 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m10:10:01.904680 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:10:01.906470 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m10:10:01.908312 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m10:10:01.910043 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:10:01.912274 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:10:01.917769 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m10:10:01.919358 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:10:01.924754 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m10:10:01.930168 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m10:10:01.931743 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m10:10:01.937361 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m10:10:01.939082 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m10:10:01.942291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m10:10:01.945248 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.patients)
[0m10:10:01.946834 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m10:10:01.948453 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m10:10:01.978272 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m10:10:01.981287 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m10:10:01.983809 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m10:10:01.985339 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:10:01.991130 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m10:10:01.994005 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m10:10:01.995411 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:10:02.001336 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m10:10:02.003444 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m10:10:02.004791 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m10:10:02.006442 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m10:10:02.008346 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.prescriptions_enhanced)
[0m10:10:02.009489 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m10:10:02.011273 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.visits_enhanced)
[0m10:10:02.012959 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.not_null_patients_age.8fed007e09)
[0m10:10:02.014660 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m10:10:02.016438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_full_name.7bac40f23c)
[0m10:10:02.018023 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m10:10:02.019772 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m10:10:02.038170 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:10:02.039739 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m10:10:02.059045 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m10:10:02.065296 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_age.8fed007e09"
[0m10:10:02.073685 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m10:10:02.086775 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:10:02.084038 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m10:10:02.081468 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_full_name.7bac40f23c"
[0m10:10:02.093121 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m10:10:02.094829 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:10:02.097396 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m10:10:02.099750 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m10:10:02.101245 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m10:10:02.104012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:10:02.110073 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m10:10:02.111577 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9)
[0m10:10:02.113117 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:10:02.119494 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m10:10:02.122157 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m10:10:02.124283 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m10:10:02.130480 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m10:10:02.132926 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_age.8fed007e09, now test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a)
[0m10:10:02.151248 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m10:10:02.157802 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9"
[0m10:10:02.165453 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m10:10:02.168073 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m10:10:02.177767 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a"
[0m10:10:02.179459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_full_name.7bac40f23c, now model.hospital_analytics.billing_enhanced)
[0m10:10:02.180579 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m10:10:02.182174 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:10:02.184137 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m10:10:02.185718 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m10:10:02.187578 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m10:10:02.194127 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m10:10:02.195705 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:10:02.207335 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m10:10:02.208954 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m10:10:02.210348 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m10:10:02.216734 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m10:10:02.230950 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9, now model.hospital_analytics.monthly_visit_stats)
[0m10:10:02.228967 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m10:10:02.233429 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m10:10:02.235011 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m10:10:02.237212 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m10:10:02.239485 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m10:10:02.251503 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m10:10:02.249677 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m10:10:02.241613 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:10:02.262238 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m10:10:02.264923 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:10:02.271239 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m10:10:02.277204 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m10:10:02.279423 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m10:10:02.286502 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m10:10:02.288317 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m10:10:02.289640 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m10:10:02.292406 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:10:02.294200 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m10:10:02.306557 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m10:10:02.296442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m10:10:02.304483 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m10:10:02.298327 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:10:02.307786 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m10:10:02.309317 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m10:10:02.311155 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m10:10:02.316707 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m10:10:02.334827 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m10:10:02.341976 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_journey)
[0m10:10:02.344740 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m10:10:02.346707 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m10:10:02.349625 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m10:10:02.351176 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m10:10:02.352796 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m10:10:02.371995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:10:02.354485 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m10:10:02.370092 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m10:10:02.356249 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:10:02.379013 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m10:10:02.391121 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m10:10:02.388934 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m10:10:02.380697 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m10:10:02.392494 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:10:02.406264 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m10:10:02.413680 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m10:10:02.415331 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m10:10:02.417009 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:10:02.423379 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m10:10:02.431376 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:10:02.432680 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m10:10:02.433789 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m10:10:02.436119 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m10:10:02.437165 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m10:10:02.452791 [debug] [MainThread]: Command end result
[0m10:10:02.763439 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:10:02.772862 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:10:02.797144 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:10:02.816460 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m10:10:02.817559 [info ] [MainThread]: Building catalog
[0m10:10:02.839408 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m10:10:02.853603 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m10:10:02.882271 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m10:10:02.903759 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m10:10:03.013326 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:10:03.017288 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:03.123605 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:10:03.128181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:03.131374 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:10:03.142640 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:10:03.224406 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:03.231439 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:03.813474 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e95150f6-4dca-4fc9-818b-67a6f34d1936&page=queryresults
[0m10:10:03.865968 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bddcff9c-3276-4ea4-af73-3cea2e31a70f&page=queryresults
[0m10:10:03.875641 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8aaae35a-a4c3-45c4-9284-b4f8fed680a0&page=queryresults
[0m10:10:04.154716 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d63a3362-f8e9-4b8a-bd6d-82ba4081a0ac&page=queryresults
[0m10:10:05.393282 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:10:05.449319 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m10:10:05.529023 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:10:05.533978 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:10:05.535498 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m10:10:05.539434 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 8.982221, "process_in_blocks": "3416", "process_kernel_time": 1.885969, "process_mem_max_rss": "210040", "process_out_blocks": "6144", "process_user_time": 10.168441}
[0m10:10:05.541506 [debug] [MainThread]: Command `dbt docs generate` succeeded at 10:10:05.541148 after 8.98 seconds
[0m10:10:05.546504 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m10:10:05.547952 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m10:10:05.549111 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m10:10:05.550358 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m10:10:05.551545 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m10:10:05.552768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759985d52150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7599859d79d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x759985d60110>]}
[0m10:10:05.554678 [debug] [MainThread]: Flushing usage events
[0m10:10:07.043232 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:10:28.517600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c595b7b8ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c595c493e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c595b808950>]}


============================== 10:10:28.526832 | 4d7eb585-f04e-4c54-bc1e-1387cd11730b ==============================
[0m10:10:28.526832 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:10:28.530468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:10:31.952955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d7eb585-f04e-4c54-bc1e-1387cd11730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5937f8bad0>]}
[0m10:10:32.649765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d7eb585-f04e-4c54-bc1e-1387cd11730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c595da067d0>]}
[0m10:29:10.486366 [error] [MainThread]: Encountered an error:

[0m10:29:10.582492 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 235, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 264, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 311, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/main.py", line 301, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.11/socketserver.py", line 233, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m10:29:10.588598 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 1122.2258, "process_in_blocks": "504", "process_kernel_time": 1.655636, "process_mem_max_rss": "198408", "process_out_blocks": "3544", "process_user_time": 8.165654}
[0m10:29:10.591259 [debug] [MainThread]: Command `dbt docs serve` failed at 10:29:10.590762 after 1122.23 seconds
[0m10:29:10.592691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c595f101650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c595b7ab490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5937e3bf90>]}
[0m10:29:10.594013 [debug] [MainThread]: Flushing usage events
[0m10:29:12.254867 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:30:04.671634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8200f7990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c82015bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8204fde90>]}


============================== 10:30:04.682927 | eaea14e2-c5d6-44ee-8163-3c965a53f295 ==============================
[0m10:30:04.682927 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:30:04.685504 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:30:07.565461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c80045fb50>]}
[0m10:30:07.758798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c822376690>]}
[0m10:30:07.761144 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:30:08.423281 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m10:30:08.830211 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:30:08.831687 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:30:08.980830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c800406d50>]}
[0m10:30:09.470557 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:30:09.478100 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:30:09.523101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7fbf1cb50>]}
[0m10:30:09.524630 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m10:30:09.525670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8002bd290>]}
[0m10:30:09.533077 [info ] [MainThread]: 
[0m10:30:09.534705 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:30:09.536146 [info ] [MainThread]: 
[0m10:30:09.537969 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:30:09.553764 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:30:09.555266 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:30:09.558123 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:30:09.559527 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:30:09.724942 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:30:09.727452 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:30:10.762817 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m10:30:10.764544 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m10:30:10.765767 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:30:10.767660 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m10:30:10.769378 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:30:10.839865 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:30:11.289541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8093ca550>]}
[0m10:30:11.290944 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:30:11.302953 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m10:30:11.304669 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m10:30:11.306252 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m10:30:11.307582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m10:30:11.309333 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m10:30:11.311087 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m10:30:11.313178 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m10:30:11.314755 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m10:30:11.316571 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m10:30:11.319926 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m10:30:11.318313 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m10:30:11.333959 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m10:30:11.349479 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m10:30:11.350596 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m10:30:11.352374 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m10:30:11.353661 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m10:30:11.362562 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m10:30:11.364169 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m10:30:11.371737 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m10:30:11.376229 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m10:30:11.394577 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m10:30:11.396634 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m10:30:11.421181 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m10:30:11.513441 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m10:30:11.598938 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m10:30:11.610987 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:30:11.614999 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m10:30:11.629648 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m10:30:11.631096 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m10:30:11.711233 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:30:11.793447 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m10:30:11.797030 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:30:11.798715 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:30:11.801240 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:30:12.246408 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m10:30:12.249047 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m10:30:12.326268 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d70b6b39-b98f-4bb6-9781-7c79403d8e2b&page=queryresults
[0m10:30:12.352007 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:219d2c36-37b6-44cc-99b1-2ffd563413b6&page=queryresults
[0m10:30:12.357578 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6188828d-f351-4345-915c-c4259ef73147&page=queryresults
[0m10:30:12.524677 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2a7a6856-1a98-426c-946a-9cb184b14613&page=queryresults
[0m10:30:12.826147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c800146010>]}
[0m10:30:12.828576 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7fbe52b50>]}
[0m10:30:12.830297 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.51s]
[0m10:30:12.833252 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c80041cb10>]}
[0m10:30:12.835744 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.49s]
[0m10:30:12.837636 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m10:30:12.839576 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.51s]
[0m10:30:12.843035 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m10:30:12.847249 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m10:30:12.850037 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m10:30:12.854729 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m10:30:12.856269 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m10:30:12.859807 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m10:30:12.861999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m10:30:12.864019 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m10:30:12.866115 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m10:30:12.867708 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m10:30:12.879693 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m10:30:12.895109 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m10:30:12.897652 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m10:30:12.904507 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m10:30:12.909210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:30:12.916960 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:30:13.321550 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m10:30:13.324433 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m10:30:13.355067 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m10:30:13.357539 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m10:30:13.955978 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7fbd63310>]}
[0m10:30:13.958341 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 623.0 Bytes processed)[0m in 2.60s]
[0m10:30:13.961025 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m10:30:13.963255 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:220ecb56-05ae-4851-86e6-d408a0db913f&page=queryresults
[0m10:30:15.076633 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0e5cfcad-eb72-4915-8260-95981b9ac9c4&page=queryresults
[0m10:30:15.394981 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7f9fa6110>]}
[0m10:30:15.396639 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 862.0 Bytes processed)[0m in 2.53s]
[0m10:30:15.398936 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m10:30:16.636566 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7fbd90f10>]}
[0m10:30:16.647363 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.8 KiB processed)[0m in 3.77s]
[0m10:30:16.654101 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m10:30:16.687813 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m10:30:16.704076 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m10:30:16.705449 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m10:30:16.724249 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m10:30:16.725526 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m10:30:16.691596 [info ] [Thread-2 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m10:30:16.842985 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.prescriptions_enhanced)
[0m10:30:16.844513 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m10:30:17.019771 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m10:30:17.040155 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:30:17.047339 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m10:30:17.077683 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m10:30:17.107968 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:30:17.119916 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:30:18.551504 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m10:30:18.567215 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m10:30:18.632138 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:30:18.634519 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m10:30:18.857327 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:337a514b-1cb4-4120-b6ac-e72a656deb77&page=queryresults
[0m10:30:18.922195 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e661d205-a068-49d0-9ffc-84772009a3b7&page=queryresults
[0m10:30:20.492366 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7f956f0d0>]}
[0m10:30:20.494714 [info ] [Thread-2 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (200.0 rows, 14.5 KiB processed)[0m in 3.70s]
[0m10:30:20.497458 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m10:30:20.687702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7f956e690>]}
[0m10:30:20.689357 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (200.0 rows, 16.2 KiB processed)[0m in 3.96s]
[0m10:30:20.691075 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m10:30:20.694985 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m10:30:20.700478 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m10:30:20.709001 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m10:30:20.696761 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m10:30:20.706370 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m10:30:20.712392 [info ] [Thread-2 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m10:30:20.730506 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m10:30:20.732804 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m10:30:20.736243 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m10:30:20.738290 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m10:30:20.740968 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m10:30:20.743195 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m10:30:20.770245 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m10:30:20.791289 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m10:30:20.802843 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m10:30:20.806465 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m10:30:20.808480 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m10:30:20.823369 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m10:30:20.827655 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:30:20.830814 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:30:20.840083 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:30:21.353576 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m10:30:21.356847 [debug] [Thread-1 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m10:30:21.368701 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m10:30:21.370939 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m10:30:21.378238 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m10:30:21.381438 [debug] [Thread-2 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m10:30:21.569064 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b3536889-2a5c-43ed-91f4-50fc401b5b13&page=queryresults
[0m10:30:21.579124 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:22641a8a-7bf8-4a67-b51d-9624f7c195bb&page=queryresults
[0m10:30:21.602365 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:36ce7bdf-5bb2-466b-a0b2-e7dd9a3674c2&page=queryresults
[0m10:30:23.211156 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7f9fd2990>]}
[0m10:30:23.213222 [info ] [Thread-2 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (12.0 rows, 12.9 KiB processed)[0m in 2.47s]
[0m10:30:23.215662 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m10:30:23.229758 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c80010c890>]}
[0m10:30:23.232304 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 12.9 KiB processed)[0m in 2.50s]
[0m10:30:23.234401 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m10:30:23.260474 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8000fc710>]}
[0m10:30:23.262988 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (208.0 rows, 24.7 KiB processed)[0m in 2.54s]
[0m10:30:23.265086 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m10:30:23.268322 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m10:30:23.270136 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m10:30:23.272616 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m10:30:23.274968 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m10:30:23.277677 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m10:30:23.280511 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m10:30:23.282600 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m10:30:23.284406 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m10:30:23.310726 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m10:30:23.312489 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m10:30:23.315352 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m10:30:23.316685 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m10:30:23.324594 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:30:23.339197 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:30:23.795807 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m10:30:23.802650 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m10:30:23.807410 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m10:30:23.809672 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m10:30:24.028633 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:445180da-eafd-42d4-b046-7b40f8f334a3&page=queryresults
[0m10:30:24.091454 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c5c3151b-71ba-4971-96ed-a83c2262939d&page=queryresults
[0m10:30:25.691759 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8000ffb10>]}
[0m10:30:25.693563 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 21.5 KiB processed)[0m in 2.41s]
[0m10:30:25.695927 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m10:30:25.787784 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaea14e2-c5d6-44ee-8163-3c965a53f295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7f9fc3510>]}
[0m10:30:25.789860 [info ] [Thread-4 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (295.0 rows, 45.4 KiB processed)[0m in 2.51s]
[0m10:30:25.791279 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m10:30:25.798046 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:30:25.802298 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:30:25.804117 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m10:30:25.805186 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m10:30:25.806200 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m10:30:25.807034 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m10:30:25.808401 [info ] [MainThread]: 
[0m10:30:25.809561 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 16.27 seconds (16.27s).
[0m10:30:25.820406 [debug] [MainThread]: Command end result
[0m10:30:25.910116 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:30:25.917570 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:30:25.937820 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:30:25.939704 [info ] [MainThread]: 
[0m10:30:25.942350 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:30:25.943758 [info ] [MainThread]: 
[0m10:30:25.946030 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m10:30:25.949798 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 21.452316, "process_in_blocks": "0", "process_kernel_time": 2.058851, "process_mem_max_rss": "211140", "process_out_blocks": "2656", "process_user_time": 12.527443}
[0m10:30:25.952418 [debug] [MainThread]: Command `dbt run` succeeded at 10:30:25.951833 after 21.46 seconds
[0m10:30:25.954290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c82015c990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8238f8ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c8204fde90>]}
[0m10:30:25.956444 [debug] [MainThread]: Flushing usage events
[0m10:30:27.358325 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:33:52.939235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215fb2e5150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215fb2e4410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215fb2e4110>]}


============================== 10:33:52.949655 | 4ba3276e-a800-4f0c-bf45-59dc8c33d074 ==============================
[0m10:33:52.949655 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:33:52.952148 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:33:55.595602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d761aa50>]}
[0m10:33:55.751370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d757ff10>]}
[0m10:33:55.753263 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:33:56.380436 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m10:33:56.769374 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:56.770510 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:56.902281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d72a0290>]}
[0m10:33:57.364808 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:33:57.373625 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:33:57.422526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d7057d90>]}
[0m10:33:57.424856 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m10:33:57.426713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d7c01510>]}
[0m10:33:57.437575 [info ] [MainThread]: 
[0m10:33:57.440353 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:33:57.444629 [info ] [MainThread]: 
[0m10:33:57.447066 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:33:57.465223 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:33:57.466745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:57.469296 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:33:57.472613 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:33:57.557197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:57.561219 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:58.723268 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m10:33:58.724710 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:58.727134 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m10:33:58.728532 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:58.884159 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m10:33:58.885816 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:59.376305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d7c01510>]}
[0m10:33:59.378502 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:33:59.394171 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m10:33:59.397001 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m10:33:59.398730 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m10:33:59.401087 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m10:33:59.408017 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m10:33:59.412998 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m10:33:59.432095 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m10:33:59.433564 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m10:33:59.435358 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m10:33:59.448067 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m10:33:59.449707 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m10:33:59.453001 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m10:33:59.451285 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m10:33:59.456502 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m10:33:59.458066 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m10:33:59.460404 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m10:33:59.470709 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m10:33:59.472350 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m10:33:59.500418 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m10:33:59.554487 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m10:33:59.594295 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m10:33:59.603027 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m10:33:59.604837 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m10:33:59.668224 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m10:33:59.682304 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m10:33:59.684649 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m10:33:59.690766 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m10:33:59.700610 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:33:59.704260 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m10:33:59.743112 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price  # Pastikan numeric
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m10:33:59.751226 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:59.744759 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:33:59.748964 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:33:59.747225 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:34:00.534110 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m10:34:00.538339 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m10:34:00.556711 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:316c18d5-ab84-4bcf-8fa1-2ec54d57073c&page=queryresults
[0m10:34:00.569009 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0d96cc22-b724-4fb7-b377-46faaaea37af&page=queryresults
[0m10:34:00.571296 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c1aeee1c-5f58-43a5-961a-f8e2075c4df4&page=queryresults
[0m10:34:00.747184 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:25165ee5-09e4-47a5-9ee3-bd3a35d06b3e&page=queryresults
[0m10:34:01.076034 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d70bfbd0>]}
[0m10:34:01.078759 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.64s]
[0m10:34:01.082766 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m10:34:01.086225 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d7255350>]}
[0m10:34:01.091160 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d4964710>]}
[0m10:34:01.089477 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.69s]
[0m10:34:01.096027 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.63s]
[0m10:34:01.098585 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m10:34:01.103000 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m10:34:01.104632 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m10:34:01.110623 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m10:34:01.112736 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m10:34:01.114602 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m10:34:01.116911 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m10:34:01.119394 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m10:34:01.121042 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m10:34:01.123232 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m10:34:01.146480 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m10:34:01.148302 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m10:34:01.152440 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m10:34:01.153817 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m10:34:01.160763 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:34:01.169045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:34:01.713624 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m10:34:01.717744 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m10:34:01.731106 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m10:34:01.735273 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m10:34:02.339432 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:85028a73-8153-443d-bcd7-6c5708f5cda2&page=queryresults
[0m10:34:02.355808 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:6bbcf5ed-9833-4c3c-aff6-9961b7e36ef2&page=queryresults
[0m10:34:02.473187 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d711f650>]}
[0m10:34:02.476652 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 623.0 Bytes processed)[0m in 3.01s]
[0m10:34:02.479407 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m10:34:03.770744 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d7280e90>]}
[0m10:34:03.777464 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 862.0 Bytes processed)[0m in 2.65s]
[0m10:34:03.781850 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m10:34:03.826550 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d49ad610>]}
[0m10:34:03.828813 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.8 KiB processed)[0m in 2.71s]
[0m10:34:03.831190 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m10:34:03.836586 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m10:34:03.839220 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m10:34:03.841562 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m10:34:03.844358 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m10:34:03.846467 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.prescriptions_enhanced)
[0m10:34:03.848170 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m10:34:03.849735 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m10:34:03.851605 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m10:34:03.890017 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m10:34:03.891230 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:34:03.896438 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m10:34:03.905231 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:34:03.990559 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m10:34:03.999173 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:34:04.439298 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:34:04.443786 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m10:34:04.452142 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m10:34:04.455251 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m10:34:04.678503 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:caab3b13-11b0-4887-acd3-3a55b69b37f9&page=queryresults
[0m10:34:04.939315 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a543bcac-4ce8-4401-9056-ef6898400fad&page=queryresults
[0m10:34:06.093540 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d481c0d0>]}
[0m10:34:06.097400 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (200.0 rows, 16.2 KiB processed)[0m in 2.25s]
[0m10:34:06.100673 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m10:34:06.104222 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m10:34:06.115419 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m10:34:06.119571 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m10:34:06.106198 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m10:34:06.123447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m10:34:06.128466 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m10:34:06.126738 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m10:34:06.139615 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m10:34:06.144525 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m10:34:06.141238 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m10:34:06.161909 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:34:06.167201 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m10:34:06.170115 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m10:34:06.269346 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:34:06.500701 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d482bb90>]}
[0m10:34:06.502912 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (200.0 rows, 14.5 KiB processed)[0m in 2.65s]
[0m10:34:06.505662 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m10:34:06.514607 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m10:34:06.516358 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m10:34:06.517761 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m10:34:06.520970 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m10:34:06.545555 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m10:34:06.549401 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m10:34:06.557650 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:34:06.793852 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m10:34:06.801183 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m10:34:06.811792 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m10:34:06.814852 [debug] [Thread-1 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m10:34:07.178226 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:57b75932-dc1c-4497-952b-9d3f4abbe55b&page=queryresults
[0m10:34:07.193841 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m10:34:07.198542 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:c42c777c-60b0-43ff-80b4-b6a75d3a2415&page=queryresults
[0m10:34:07.205028 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m10:34:07.441834 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f8c7e35e-a7d1-4a7e-b54b-be1578d0961d&page=queryresults
[0m10:34:08.743740 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d675c250>]}
[0m10:34:08.779822 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (208.0 rows, 24.7 KiB processed)[0m in 2.60s]
[0m10:34:08.833712 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m10:34:08.845737 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m10:34:08.856312 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m10:34:08.868486 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m10:34:08.898974 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m10:34:08.910457 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m10:34:08.953800 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m10:34:08.877958 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m10:34:08.990348 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m10:34:09.227209 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d483c690>]}
[0m10:34:09.255397 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (12.0 rows, 12.9 KiB processed)[0m in 3.10s]
[0m10:34:09.261210 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m10:34:09.366163 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m10:34:09.442727 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m10:34:09.466439 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m10:34:09.417488 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m10:34:09.551996 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:34:09.629520 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d48b84d0>]}
[0m10:34:09.644826 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 12.9 KiB processed)[0m in 3.11s]
[0m10:34:09.683705 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m10:34:09.665131 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:34:10.568207 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m10:34:10.577659 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m10:34:10.605364 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m10:34:10.617705 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m10:34:10.894310 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:4747fc26-420a-4cb2-8389-2f7667ff1819&page=queryresults
[0m10:34:10.934952 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:cf63ffbf-904f-48d8-a4ad-9d722a39cbd0&page=queryresults
[0m10:34:12.702536 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d4892ed0>]}
[0m10:34:12.710119 [info ] [Thread-3 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (295.0 rows, 45.4 KiB processed)[0m in 3.84s]
[0m10:34:12.711402 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m10:34:12.747036 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ba3276e-a800-4f0c-bf45-59dc8c33d074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215d4877b50>]}
[0m10:34:12.753986 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 21.5 KiB processed)[0m in 3.84s]
[0m10:34:12.761668 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m10:34:12.786802 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:34:12.805653 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:34:12.807126 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m10:34:12.814454 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m10:34:12.819782 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m10:34:12.820332 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m10:34:12.821190 [info ] [MainThread]: 
[0m10:34:12.835910 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 15.37 seconds (15.37s).
[0m10:34:12.879005 [debug] [MainThread]: Command end result
[0m10:34:13.073646 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:34:13.080360 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:34:13.101645 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:34:13.103025 [info ] [MainThread]: 
[0m10:34:13.106276 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:34:13.108183 [info ] [MainThread]: 
[0m10:34:13.109638 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m10:34:13.116542 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 20.3623, "process_in_blocks": "0", "process_kernel_time": 2.194085, "process_mem_max_rss": "211152", "process_out_blocks": "2656", "process_user_time": 11.513329}
[0m10:34:13.117988 [debug] [MainThread]: Command `dbt run` succeeded at 10:34:13.117615 after 20.36 seconds
[0m10:34:13.119202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215fb6de310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215fead8b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7215fec5c7d0>]}
[0m10:34:13.120951 [debug] [MainThread]: Flushing usage events
[0m10:34:14.581095 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:53:44.874619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1960fa7cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1960fa7f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1960fa7d10>]}


============================== 14:53:44.876802 | 645b0303-f758-4b3f-b6d9-e4d7bf1cb04e ==============================
[0m14:53:44.876802 [info ] [MainThread]: Running with dbt=1.9.0
[0m14:53:44.877657 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:53:44.884264 [info ] [MainThread]: dbt version: 1.9.0
[0m14:53:44.885414 [info ] [MainThread]: python version: 3.11.2
[0m14:53:44.887183 [info ] [MainThread]: python path: /usr/local/bin/python
[0m14:53:44.887378 [info ] [MainThread]: os info: Linux-6.11.0-21-generic-x86_64-with-glibc2.31
[0m14:53:46.088119 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m14:53:46.088624 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m14:53:46.088944 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m14:53:46.089777 [info ] [MainThread]: adapter type: bigquery
[0m14:53:46.090137 [info ] [MainThread]: adapter version: 1.9.0
[0m14:53:46.279148 [info ] [MainThread]: Configuration:
[0m14:53:46.279790 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m14:53:46.280160 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m14:53:46.280700 [info ] [MainThread]: Required dependencies:
[0m14:53:46.281089 [debug] [MainThread]: Executing "git --help"
[0m14:53:46.287912 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m14:53:46.288301 [debug] [MainThread]: STDERR: "b''"
[0m14:53:46.288486 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m14:53:46.288823 [info ] [MainThread]: Connection:
[0m14:53:46.289010 [info ] [MainThread]:   method: service-account
[0m14:53:46.289259 [info ] [MainThread]:   database: <project-id>
[0m14:53:46.289610 [info ] [MainThread]:   execution_project: <project-id>
[0m14:53:46.289944 [info ] [MainThread]:   schema: hospital
[0m14:53:46.290072 [info ] [MainThread]:   location: <region>
[0m14:53:46.290247 [info ] [MainThread]:   priority: interactive
[0m14:53:46.292410 [info ] [MainThread]:   maximum_bytes_billed: None
[0m14:53:46.293586 [info ] [MainThread]:   impersonate_service_account: None
[0m14:53:46.293773 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m14:53:46.293912 [info ] [MainThread]:   job_retries: 1
[0m14:53:46.294037 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m14:53:46.294158 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m14:53:46.294272 [info ] [MainThread]:   timeout_seconds: 300
[0m14:53:46.294384 [info ] [MainThread]:   client_id: None
[0m14:53:46.296230 [info ] [MainThread]:   token_uri: None
[0m14:53:46.297950 [info ] [MainThread]:   dataproc_region: None
[0m14:53:46.298129 [info ] [MainThread]:   dataproc_cluster_name: None
[0m14:53:46.298253 [info ] [MainThread]:   gcs_bucket: None
[0m14:53:46.298365 [info ] [MainThread]:   dataproc_batch: None
[0m14:53:46.298609 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m14:53:46.458093 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m14:53:46.458377 [debug] [MainThread]: On debug: select 1 as id
[0m14:53:46.461897 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:53:46.919928 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=<project-id>&j=bq:<region>:7c3a5dd5-ca95-47bc-82ef-4c04ec2cb7c3&page=queryresults
[0m14:53:46.921100 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m14:53:46.921406 [info ] [MainThread]: [31m1 check failed:[0m
[0m14:53:46.922085 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  ProjectId must be non-empty

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m14:53:46.923077 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 2.1178484, "process_in_blocks": "0", "process_kernel_time": 0.908572, "process_mem_max_rss": "198956", "process_out_blocks": "48", "process_user_time": 2.828041}
[0m14:53:46.925197 [debug] [MainThread]: Command `dbt debug` failed at 14:53:46.925094 after 2.12 seconds
[0m14:53:46.925451 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m14:53:46.925671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e196102b7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e196102b650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e196492d350>]}
[0m14:53:46.925909 [debug] [MainThread]: Flushing usage events
[0m14:53:48.168426 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:45.686028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9358787d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9358787e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9358787a90>]}


============================== 15:02:45.690685 | a2a0c900-119e-4b67-8264-aaa36de7784e ==============================
[0m15:02:45.690685 [info ] [MainThread]: Running with dbt=1.9.0
[0m15:02:45.691463 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m15:02:45.698765 [info ] [MainThread]: dbt version: 1.9.0
[0m15:02:45.699192 [info ] [MainThread]: python version: 3.11.2
[0m15:02:45.699589 [info ] [MainThread]: python path: /usr/local/bin/python
[0m15:02:45.699861 [info ] [MainThread]: os info: Linux-6.11.0-21-generic-x86_64-with-glibc2.31
[0m15:02:46.755674 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m15:02:46.761796 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m15:02:46.762221 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m15:02:46.762401 [info ] [MainThread]: adapter type: bigquery
[0m15:02:46.762530 [info ] [MainThread]: adapter version: 1.9.0
[0m15:02:46.909167 [info ] [MainThread]: Configuration:
[0m15:02:46.910535 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m15:02:46.911537 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m15:02:46.911827 [info ] [MainThread]: Required dependencies:
[0m15:02:46.912100 [debug] [MainThread]: Executing "git --help"
[0m15:02:46.915446 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m15:02:46.915806 [debug] [MainThread]: STDERR: "b''"
[0m15:02:46.915974 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m15:02:46.916847 [info ] [MainThread]: Connection:
[0m15:02:46.917054 [info ] [MainThread]:   method: service-account
[0m15:02:46.917190 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m15:02:46.917311 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m15:02:46.917425 [info ] [MainThread]:   schema: hospital
[0m15:02:46.917535 [info ] [MainThread]:   location: asia-southeast2
[0m15:02:46.917644 [info ] [MainThread]:   priority: interactive
[0m15:02:46.918103 [info ] [MainThread]:   maximum_bytes_billed: None
[0m15:02:46.918247 [info ] [MainThread]:   impersonate_service_account: None
[0m15:02:46.918370 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m15:02:46.919255 [info ] [MainThread]:   job_retries: 1
[0m15:02:46.919971 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m15:02:46.920378 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m15:02:46.921944 [info ] [MainThread]:   timeout_seconds: 300
[0m15:02:46.922458 [info ] [MainThread]:   client_id: None
[0m15:02:46.923143 [info ] [MainThread]:   token_uri: None
[0m15:02:46.923307 [info ] [MainThread]:   dataproc_region: None
[0m15:02:46.923679 [info ] [MainThread]:   dataproc_cluster_name: None
[0m15:02:46.923902 [info ] [MainThread]:   gcs_bucket: None
[0m15:02:46.924326 [info ] [MainThread]:   dataproc_batch: None
[0m15:02:46.925639 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m15:02:46.993832 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m15:02:46.994305 [debug] [MainThread]: On debug: select 1 as id
[0m15:02:46.994568 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:47.928160 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8b81f30e-a282-4476-b495-930e23d44572&page=queryresults
[0m15:02:48.260072 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m15:02:48.269420 [info ] [MainThread]: [32mAll checks passed![0m
[0m15:02:48.278594 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 2.6503255, "process_in_blocks": "0", "process_kernel_time": 0.691407, "process_mem_max_rss": "203276", "process_out_blocks": "32", "process_user_time": 2.673092}
[0m15:02:48.279147 [debug] [MainThread]: Command `dbt debug` succeeded at 15:02:48.279036 after 2.65 seconds
[0m15:02:48.284925 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m15:02:48.285342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d935861d4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d935bf88c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9339e1ab50>]}
[0m15:02:48.293399 [debug] [MainThread]: Flushing usage events
[0m15:02:49.669830 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:02:51.997115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d67042cbc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d67042cb2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d67042cbc10>]}


============================== 15:02:51.999064 | cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f ==============================
[0m15:02:51.999064 [info ] [MainThread]: Running with dbt=1.9.0
[0m15:02:51.999465 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:02:53.401729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66e6ec9110>]}
[0m15:02:53.477290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6706586810>]}
[0m15:02:53.478594 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m15:02:53.681547 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m15:02:53.793215 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:02:53.799867 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/sources.yml
[0m15:02:53.800838 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/base/_hospital_medicines.sql
[0m15:02:54.209044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d67043cea50>]}
[0m15:02:54.285660 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m15:02:54.287690 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m15:02:54.335222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66e468ed10>]}
[0m15:02:54.336249 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m15:02:54.336778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d67042df3d0>]}
[0m15:02:54.339853 [info ] [MainThread]: 
[0m15:02:54.341368 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:02:54.341652 [info ] [MainThread]: 
[0m15:02:54.342055 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:02:54.347628 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m15:02:54.348041 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:54.381497 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m15:02:54.384831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:54.386643 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m15:02:54.426389 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:02:55.778445 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m15:02:55.779478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:55.809818 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m15:02:55.815604 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:55.816278 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m15:02:55.816751 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:02:56.452973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6705467150>]}
[0m15:02:56.453542 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:02:56.488019 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m15:02:56.488484 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m15:02:56.488901 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m15:02:56.490028 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m15:02:56.489456 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m15:02:56.491566 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m15:02:56.490819 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m15:02:56.543085 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m15:02:56.544642 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m15:02:56.546019 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m15:02:56.541719 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m15:02:56.559006 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m15:02:56.540510 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m15:02:56.536418 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m15:02:56.565507 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m15:02:56.566773 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m15:02:56.567948 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m15:02:56.572618 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m15:02:56.575497 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m15:02:56.625158 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m15:02:56.627628 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m15:02:56.631652 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m15:02:56.638608 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m15:02:56.648080 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m15:02:56.759477 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:02:56.828703 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m15:02:56.835810 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m15:02:56.840700 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m15:02:56.842252 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m15:02:56.843481 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:02:56.844589 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m15:02:56.845901 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:02:56.846476 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m15:02:56.880302 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:02:57.517795 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m15:02:57.518662 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m15:02:57.956893 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:781f6728-2deb-4177-8655-c85e46abd0cd&page=queryresults
[0m15:02:57.972281 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:1634911a-a798-452d-90fe-18383e1dd3e5&page=queryresults
[0m15:02:58.474881 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66e42dca10>]}
[0m15:02:58.475467 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.94s]
[0m15:02:58.477076 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m15:02:58.490531 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:729ca204-880a-45d9-9e48-ec8af931a44e&page=queryresults
[0m15:02:58.504453 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m15:02:58.505130 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m15:02:58.505946 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m15:02:58.506186 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m15:02:58.508842 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m15:02:58.509410 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m15:02:58.511607 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:02:58.931419 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66def4d690>]}
[0m15:02:58.932058 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.39s]
[0m15:02:58.932675 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m15:02:59.116231 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:bae576d5-f084-461e-8754-93b706bee800&page=queryresults
[0m15:02:59.831386 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m15:02:59.837304 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m15:02:59.870669 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd677150>]}
[0m15:02:59.871442 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 3.33s]
[0m15:02:59.872173 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m15:02:59.876568 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m15:02:59.877224 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m15:02:59.877854 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m15:02:59.878086 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m15:02:59.882456 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m15:02:59.882968 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m15:02:59.885073 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:00.456720 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66def4c890>]}
[0m15:03:00.457696 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 637.0 Bytes processed)[0m in 3.91s]
[0m15:03:00.458220 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m15:03:00.834276 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:d87da34d-5368-4e05-82fc-66abef5c5871&page=queryresults
[0m15:03:01.245543 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m15:03:01.246663 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m15:03:02.603513 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd653310>]}
[0m15:03:02.604586 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 4.10s]
[0m15:03:02.605095 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m15:03:02.606390 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m15:03:02.606759 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m15:03:02.621970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.visits_enhanced)
[0m15:03:02.624837 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m15:03:02.645916 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m15:03:02.647046 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m15:03:02.649798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:02.732612 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:5c0dde77-d6c4-4e33-b5b9-99902720ec5f&page=queryresults
[0m15:03:03.307139 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m15:03:03.308056 [debug] [Thread-1 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m15:03:03.476244 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd653110>]}
[0m15:03:03.476853 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (10.0 rows, 563.0 Bytes processed)[0m in 3.60s]
[0m15:03:03.478205 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m15:03:03.498695 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m15:03:03.499251 [info ] [Thread-2 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m15:03:03.499595 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m15:03:03.504966 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m15:03:03.512237 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m15:03:03.513073 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m15:03:03.516220 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:03.567029 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:537b1181-e355-48a5-bd2e-9df7070953ac&page=queryresults
[0m15:03:04.107155 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m15:03:04.108076 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m15:03:04.317516 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:a21868eb-21f0-4f4b-9718-19dcc03f13ec&page=queryresults
[0m15:03:05.526018 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dc2d5990>]}
[0m15:03:05.529824 [info ] [Thread-1 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (500.0 rows, 30.4 KiB processed)[0m in 2.91s]
[0m15:03:05.537183 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m15:03:05.555628 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m15:03:05.556253 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m15:03:05.556937 [info ] [Thread-3 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m15:03:05.557662 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m15:03:05.559050 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m15:03:05.563580 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m15:03:05.566214 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m15:03:05.566708 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m15:03:05.608850 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:05.560965 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m15:03:05.649550 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m15:03:05.655598 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m15:03:05.673894 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m15:03:05.688821 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:05.909562 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd65ccd0>]}
[0m15:03:05.910840 [info ] [Thread-2 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (300.0 rows, 19.0 KiB processed)[0m in 2.41s]
[0m15:03:05.911591 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m15:03:05.915812 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m15:03:05.916310 [info ] [Thread-1 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m15:03:05.917441 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m15:03:05.917748 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m15:03:05.923928 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m15:03:05.925221 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.doctor_performance
[0m15:03:05.934593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:06.149180 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m15:03:06.150084 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m15:03:06.232088 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m15:03:06.239203 [debug] [Thread-3 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m15:03:06.424159 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m15:03:06.424935 [debug] [Thread-1 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m15:03:06.492823 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:2874ed2a-aa79-445c-81d6-b21f7d969e86&page=queryresults
[0m15:03:06.897454 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:df7cb719-a9e8-4bc1-a266-477d3a33a914&page=queryresults
[0m15:03:07.537053 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:972c81d1-b94b-4033-b66f-7b746b75d569&page=queryresults
[0m15:03:08.233052 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd67da50>]}
[0m15:03:08.233682 [info ] [Thread-3 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (519.0 rows, 54.3 KiB processed)[0m in 2.67s]
[0m15:03:08.234041 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m15:03:08.245279 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m15:03:08.246298 [info ] [Thread-2 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m15:03:08.248246 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m15:03:08.252867 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m15:03:08.268465 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m15:03:08.270163 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m15:03:08.269428 [info ] [Thread-3 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m15:03:08.273338 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m15:03:08.273767 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m15:03:08.274025 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m15:03:08.278264 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m15:03:08.282759 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m15:03:08.285000 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:08.281527 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:08.687073 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dc118810>]}
[0m15:03:08.687692 [info ] [Thread-1 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 24.0 KiB processed)[0m in 2.77s]
[0m15:03:08.688251 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m15:03:08.784722 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m15:03:08.785868 [debug] [Thread-3 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m15:03:08.872916 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m15:03:08.878171 [debug] [Thread-2 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m15:03:08.999367 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd6c64d0>]}
[0m15:03:09.001089 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (13.0 rows, 32.2 KiB processed)[0m in 3.44s]
[0m15:03:09.004234 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m15:03:09.257282 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:680c560e-de09-404f-9b8f-950e7a2dec25&page=queryresults
[0m15:03:10.497840 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:8d6e5a58-1445-41f6-bfdc-8e3265fa4e1e&page=queryresults
[0m15:03:11.899749 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dd6c5010>]}
[0m15:03:11.900863 [info ] [Thread-3 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 39.9 KiB processed)[0m in 3.63s]
[0m15:03:11.901741 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m15:03:12.293616 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc6ebd9b-cd15-4fa6-b180-19a2e0cb327f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d66dc20b0d0>]}
[0m15:03:12.294586 [info ] [Thread-2 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (677.0 rows, 89.7 KiB processed)[0m in 4.05s]
[0m15:03:12.296015 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m15:03:12.357542 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:03:12.360134 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:03:12.360577 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m15:03:12.360857 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m15:03:12.361102 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m15:03:12.361352 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m15:03:12.362071 [info ] [MainThread]: 
[0m15:03:12.362401 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 18.02 seconds (18.02s).
[0m15:03:12.364553 [debug] [MainThread]: Command end result
[0m15:03:12.415265 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m15:03:12.417874 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m15:03:12.423345 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m15:03:12.423929 [info ] [MainThread]: 
[0m15:03:12.424932 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:03:12.426787 [info ] [MainThread]: 
[0m15:03:12.427605 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m15:03:12.432848 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 20.468285, "process_in_blocks": "0", "process_kernel_time": 1.592049, "process_mem_max_rss": "216076", "process_out_blocks": "3872", "process_user_time": 4.589234}
[0m15:03:12.433613 [debug] [MainThread]: Command `dbt run` succeeded at 15:03:12.433446 after 20.47 seconds
[0m15:03:12.434022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6704353a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6707b08c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d6707c8ca10>]}
[0m15:03:12.434416 [debug] [MainThread]: Flushing usage events
[0m15:03:13.832644 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:03:16.412033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e9fb4bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e9fb48950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e9fb48510>]}


============================== 15:03:16.415091 | 07fb38bb-9a95-43ec-80e1-79f48fb10543 ==============================
[0m15:03:16.415091 [info ] [MainThread]: Running with dbt=1.9.0
[0m15:03:16.415671 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:03:17.562936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07fb38bb-9a95-43ec-80e1-79f48fb10543', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e7bfd8350>]}
[0m15:03:17.634110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07fb38bb-9a95-43ec-80e1-79f48fb10543', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e7bfaf550>]}
[0m15:03:17.635432 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m15:03:17.769593 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m15:03:17.900721 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:03:17.901447 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:03:17.947574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07fb38bb-9a95-43ec-80e1-79f48fb10543', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e7bbe4790>]}
[0m15:03:18.077944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07fb38bb-9a95-43ec-80e1-79f48fb10543', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782ea03d0850>]}
[0m15:03:18.078492 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m15:03:18.078717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07fb38bb-9a95-43ec-80e1-79f48fb10543', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e7bbb3b50>]}
[0m15:03:18.082823 [info ] [MainThread]: 
[0m15:03:18.083985 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:03:18.084906 [info ] [MainThread]: 
[0m15:03:18.085586 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:03:18.093142 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_analytics'
[0m15:03:18.093728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:18.123731 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_intermediate'
[0m15:03:18.126134 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:18.165109 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id_hospital_staging'
[0m15:03:18.165618 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:18.730135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07fb38bb-9a95-43ec-80e1-79f48fb10543', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782e7beb6990>]}
[0m15:03:18.732186 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:03:18.776699 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m15:03:18.778384 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m15:03:18.778909 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m15:03:18.785855 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m15:03:18.804791 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m15:03:18.805615 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m15:03:18.809511 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m15:03:18.815470 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m15:03:18.816085 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m15:03:18.817665 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m15:03:18.818395 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m15:03:18.818846 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m15:03:18.819779 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m15:03:18.820995 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m15:03:18.823249 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m15:03:18.828204 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:18.828791 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m15:03:18.829642 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:18.833904 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m15:03:18.838962 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m15:03:18.843199 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m15:03:18.846613 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m15:03:18.848089 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m15:03:18.850690 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m15:03:18.851361 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m15:03:18.852407 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m15:03:18.852883 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:03:18.856904 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:18.857838 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m15:03:18.861567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m15:03:18.862691 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m15:03:18.864378 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m15:03:18.860680 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m15:03:18.858253 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m15:03:18.869414 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m15:03:18.909697 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m15:03:18.917551 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:18.924249 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m15:03:18.921768 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m15:03:18.922163 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m15:03:18.931664 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m15:03:18.918853 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m15:03:18.931077 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m15:03:18.934075 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m15:03:18.930462 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m15:03:18.933586 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m15:03:18.931982 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m15:03:18.960650 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m15:03:18.940260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m15:03:18.955826 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:18.945445 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m15:03:18.961108 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m15:03:18.963987 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m15:03:18.964600 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m15:03:18.974546 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:18.970161 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m15:03:18.969260 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m15:03:18.978908 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m15:03:18.977674 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m15:03:18.978306 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m15:03:18.979526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:18.976004 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m15:03:18.980802 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m15:03:18.984235 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m15:03:18.986473 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m15:03:18.987015 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:18.987930 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.prescriptions_enhanced)
[0m15:03:18.996067 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m15:03:18.996916 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m15:03:18.998957 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m15:03:19.038937 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m15:03:19.056647 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m15:03:19.050783 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m15:03:19.052769 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m15:03:19.047385 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now model.hospital_analytics.visits_enhanced)
[0m15:03:19.058969 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now test.hospital_analytics.not_null_patients_age.8fed007e09)
[0m15:03:19.059561 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m15:03:19.067492 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:19.060349 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:19.066648 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m15:03:19.061125 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m15:03:19.074324 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m15:03:19.088780 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m15:03:19.160749 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m15:03:19.161630 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m15:03:19.165900 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_patients_full_name.7bac40f23c)
[0m15:03:19.164583 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m15:03:19.163897 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_age.8fed007e09"
[0m15:03:19.166701 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m15:03:19.167098 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m15:03:19.167684 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9)
[0m15:03:19.175264 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m15:03:19.168498 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m15:03:19.174582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:19.173605 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_full_name.7bac40f23c"
[0m15:03:19.183129 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9"
[0m15:03:19.184334 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:19.186436 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m15:03:19.189290 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m15:03:19.188802 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m15:03:19.189676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a)
[0m15:03:19.187250 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m15:03:19.196195 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m15:03:19.197691 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:19.198511 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m15:03:19.198949 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:19.202415 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m15:03:19.202930 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m15:03:19.212026 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a"
[0m15:03:19.213723 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m15:03:19.214520 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_age.8fed007e09, now model.hospital_analytics.billing_enhanced)
[0m15:03:19.217602 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m15:03:19.214989 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m15:03:19.215435 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m15:03:19.214133 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m15:03:19.221910 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m15:03:19.223718 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_full_name.7bac40f23c, now model.hospital_analytics.monthly_visit_stats)
[0m15:03:19.224712 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9, now model.hospital_analytics.doctor_performance)
[0m15:03:19.224144 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:19.226049 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m15:03:19.227640 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m15:03:19.227049 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m15:03:19.240006 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:19.233894 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m15:03:19.243296 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m15:03:19.237811 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m15:03:19.242017 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m15:03:19.243718 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:19.229564 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m15:03:19.244545 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m15:03:19.245065 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m15:03:19.263563 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m15:03:19.264598 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m15:03:19.256943 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m15:03:19.265520 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:19.266769 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m15:03:19.267248 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m15:03:19.268142 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m15:03:19.285929 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m15:03:19.268904 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m15:03:19.310014 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m15:03:19.338572 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m15:03:19.342080 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m15:03:19.350985 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m15:03:19.366172 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m15:03:19.366771 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:19.368669 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m15:03:19.365127 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m15:03:19.373002 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m15:03:19.372075 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m15:03:19.373542 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now model.hospital_analytics.patient_spending_analysis)
[0m15:03:19.375109 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m15:03:19.373926 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m15:03:19.374614 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:03:19.371090 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m15:03:19.378889 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m15:03:19.379326 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:03:19.380842 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m15:03:19.381225 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297, now model.hospital_analytics.patient_journey)
[0m15:03:19.382940 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m15:03:19.383222 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m15:03:19.385337 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m15:03:19.386151 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:03:19.394340 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m15:03:19.399590 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m15:03:19.401289 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m15:03:19.401834 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:03:19.403582 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m15:03:19.407941 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:03:19.408443 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m15:03:19.408660 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b' was properly closed.
[0m15:03:19.408802 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m15:03:19.408930 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m15:03:19.410827 [debug] [MainThread]: Command end result
[0m15:03:19.553262 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m15:03:19.555757 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m15:03:19.563431 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m15:03:19.565852 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m15:03:19.574580 [info ] [MainThread]: Building catalog
[0m15:03:19.581029 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m15:03:19.590024 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m15:03:19.668651 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m15:03:19.676365 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_staging`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m15:03:19.677887 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m15:03:19.719943 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:19.686453 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:19.716920 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_analytics`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m15:03:19.713769 [debug] [ThreadPool]: Acquiring new bigquery connection 'de-zoomcamp-2025--id.information_schema'
[0m15:03:19.800986 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:19.803594 [debug] [ThreadPool]: On de-zoomcamp-2025--id.information_schema: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "de-zoomcamp-2025--id.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.__TABLES__ tables
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `de-zoomcamp-2025--id`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m15:03:19.898576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:03:20.446323 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0fc3962a-7969-4d78-855b-2662c946b5fd&page=queryresults
[0m15:03:20.763928 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:0108c56c-0c6d-4fb0-880a-a8210052118a&page=queryresults
[0m15:03:21.639472 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:f4595707-4d94-4a29-ab56-6e9238274964&page=queryresults
[0m15:03:21.654693 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:98b82279-4575-4881-aac7-bfab2cc739ba&page=queryresults
[0m15:03:26.347954 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:03:26.388709 [debug] [MainThread]: Wrote artifact CatalogArtifact to /usr/app/dbt/target/catalog.json
[0m15:03:26.405095 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m15:03:26.406611 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m15:03:26.406833 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m15:03:26.408264 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 10.100864, "process_in_blocks": "0", "process_kernel_time": 1.160705, "process_mem_max_rss": "211360", "process_out_blocks": "6128", "process_user_time": 4.035814}
[0m15:03:26.408653 [debug] [MainThread]: Command `dbt docs generate` succeeded at 15:03:26.408582 after 10.10 seconds
[0m15:03:26.408851 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m15:03:26.409015 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m15:03:26.409143 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m15:03:26.409258 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m15:03:26.409408 [debug] [MainThread]: Connection 'de-zoomcamp-2025--id.information_schema' was properly closed.
[0m15:03:26.409573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782ea0a97650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782ea3639590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782ea3639310>]}
[0m15:03:26.409790 [debug] [MainThread]: Flushing usage events
[0m15:03:27.540852 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:03:29.849860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9329104650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9329104750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9329104a90>]}


============================== 15:03:29.851867 | 7948e891-a6a7-43ef-b801-e113dbbee3fa ==============================
[0m15:03:29.851867 [info ] [MainThread]: Running with dbt=1.9.0
[0m15:03:29.852322 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:03:30.884002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7948e891-a6a7-43ef-b801-e113dbbee3fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c930944f810>]}
[0m15:03:30.926981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7948e891-a6a7-43ef-b801-e113dbbee3fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c932b3ad090>]}
[0m10:58:58.746759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798cca0972d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798cca4981d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798cca097250>]}


============================== 10:58:58.749189 | 53ff9cb6-4e90-43a4-9c1a-d9ad1266cfd3 ==============================
[0m10:58:58.749189 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:58:58.749534 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m10:58:58.756884 [info ] [MainThread]: dbt version: 1.9.0
[0m10:58:58.758028 [info ] [MainThread]: python version: 3.11.2
[0m10:58:58.758696 [info ] [MainThread]: python path: /usr/local/bin/python
[0m10:58:58.759239 [info ] [MainThread]: os info: Linux-6.11.0-21-generic-x86_64-with-glibc2.31
[0m10:58:59.355677 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m10:58:59.356652 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m10:58:59.356886 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m10:58:59.357042 [info ] [MainThread]: adapter type: bigquery
[0m10:58:59.357261 [info ] [MainThread]: adapter version: 1.9.0
[0m10:58:59.446492 [info ] [MainThread]: Configuration:
[0m10:58:59.447234 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:58:59.447720 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:58:59.447973 [info ] [MainThread]: Required dependencies:
[0m10:58:59.448247 [debug] [MainThread]: Executing "git --help"
[0m10:58:59.450983 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:58:59.451320 [debug] [MainThread]: STDERR: "b''"
[0m10:58:59.451504 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:58:59.451914 [info ] [MainThread]: Connection:
[0m10:58:59.452138 [info ] [MainThread]:   method: service-account
[0m10:58:59.452374 [info ] [MainThread]:   database: de-zoomcamp-2025--id
[0m10:58:59.452712 [info ] [MainThread]:   execution_project: de-zoomcamp-2025--id
[0m10:58:59.452886 [info ] [MainThread]:   schema: hospital
[0m10:58:59.453013 [info ] [MainThread]:   location: asia-southeast2
[0m10:58:59.453133 [info ] [MainThread]:   priority: interactive
[0m10:58:59.453252 [info ] [MainThread]:   maximum_bytes_billed: None
[0m10:58:59.453374 [info ] [MainThread]:   impersonate_service_account: None
[0m10:58:59.453490 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m10:58:59.453607 [info ] [MainThread]:   job_retries: 1
[0m10:58:59.453723 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m10:58:59.454081 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m10:58:59.454708 [info ] [MainThread]:   timeout_seconds: 300
[0m10:58:59.454968 [info ] [MainThread]:   client_id: None
[0m10:58:59.455127 [info ] [MainThread]:   token_uri: None
[0m10:58:59.455263 [info ] [MainThread]:   dataproc_region: None
[0m10:58:59.455392 [info ] [MainThread]:   dataproc_cluster_name: None
[0m10:58:59.455518 [info ] [MainThread]:   gcs_bucket: None
[0m10:58:59.455642 [info ] [MainThread]:   dataproc_batch: None
[0m10:58:59.455907 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:58:59.537291 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m10:58:59.537575 [debug] [MainThread]: On debug: select 1 as id
[0m10:58:59.537753 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:59:00.219330 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:adbb0fcc-cfc4-4824-9ede-c6177564017c&page=queryresults
[0m10:59:00.628921 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:59:00.629837 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:59:00.631221 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.9197943, "process_in_blocks": "0", "process_kernel_time": 0.520885, "process_mem_max_rss": "203004", "process_out_blocks": "24", "process_user_time": 2.445232}
[0m10:59:00.631585 [debug] [MainThread]: Command `dbt debug` succeeded at 10:59:00.631513 after 1.92 seconds
[0m10:59:00.631779 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:59:00.631973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798ca63e3f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798cca554490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798ccd894ad0>]}
[0m10:59:00.632196 [debug] [MainThread]: Flushing usage events
[0m10:59:02.264777 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:59:06.486992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73964d61bb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73964d61bcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73964d61bd50>]}


============================== 10:59:06.489295 | 6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4 ==============================
[0m10:59:06.489295 [info ] [MainThread]: Running with dbt=1.9.0
[0m10:59:06.489794 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:59:07.155409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73962993c9d0>]}
[0m10:59:07.196129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73964f89e210>]}
[0m10:59:07.196607 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m10:59:07.273474 [debug] [MainThread]: checksum: c99e828bba267739642b5a3ce85f17518764ea526e0e6c4fdc649171c1a66bff, vars: {}, profile: , target: , version: 1.9.0
[0m10:59:07.367026 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:59:07.367313 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:59:07.398158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739629f61090>]}
[0m10:59:07.518537 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:59:07.520818 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:59:07.531829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396297eb310>]}
[0m10:59:07.532363 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m10:59:07.532739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739629822490>]}
[0m10:59:07.534490 [info ] [MainThread]: 
[0m10:59:07.534886 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:59:07.535343 [info ] [MainThread]: 
[0m10:59:07.535699 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:59:07.539422 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:59:07.539914 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:07.565464 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:59:07.573793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:07.572485 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_de-zoomcamp-2025--id'
[0m10:59:07.603038 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:10.694013 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_analytics)
[0m10:59:10.694418 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:10.719373 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_staging)
[0m10:59:10.721828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id, now list_de-zoomcamp-2025--id_hospital_intermediate)
[0m10:59:10.722637 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:10.723223 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:11.281455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73962986f510>]}
[0m10:59:11.281833 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:59:11.287416 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m10:59:11.287797 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m10:59:11.289253 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m10:59:11.293581 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m10:59:11.288906 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m10:59:11.300161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m10:59:11.294135 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m10:59:11.294895 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m10:59:11.303170 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m10:59:11.300529 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m10:59:11.301032 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m10:59:11.292665 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m10:59:11.303390 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m10:59:11.315498 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m10:59:11.319971 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m10:59:11.320854 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_de-zoomcamp-2025--id_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m10:59:11.323386 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m10:59:11.327936 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m10:59:11.343357 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m10:59:11.346090 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m10:59:11.347178 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m10:59:11.349284 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m10:59:11.353405 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m10:59:11.387279 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:59:11.412441 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m10:59:11.414227 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m10:59:11.416334 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m10:59:11.416972 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `de-zoomcamp-2025--id`.`hospital`.`medicines`;


[0m10:59:11.418420 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `de-zoomcamp-2025--id`.`hospital`.`visits`;


[0m10:59:11.422283 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m10:59:11.423100 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:59:11.423734 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:59:11.447538 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `de-zoomcamp-2025--id`.`hospital`.`patients`;


[0m10:59:11.448466 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:59:11.839973 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m10:59:11.840989 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `de-zoomcamp-2025--id`.`hospital`.`doctors`
    );
  
[0m10:59:12.010012 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:b6be7b96-419c-4de1-b153-66f6124d9d67&page=queryresults
[0m10:59:12.018238 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:62a20e35-cfe1-438d-91e9-c0be946e3823&page=queryresults
[0m10:59:12.115984 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:e194da5a-4481-45cf-b27e-2908c46d8623&page=queryresults
[0m10:59:12.120961 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:318fbc1a-2cb6-4b54-b29a-a335e20ef859&page=queryresults
[0m10:59:12.294062 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396280fcdd0>]}
[0m10:59:12.295045 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.97s]
[0m10:59:12.295648 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m10:59:12.296678 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m10:59:12.297032 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m10:59:12.297382 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m10:59:12.302413 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m10:59:12.303137 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396282dae90>]}
[0m10:59:12.314621 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m10:59:12.315699 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m10:59:12.318799 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m10:59:12.325032 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m10:59:12.329991 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:59:12.364979 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m10:59:12.366925 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m10:59:12.368856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m10:59:12.369227 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m10:59:12.371942 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m10:59:12.372632 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m10:59:12.368232 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73962993cd50>]}
[0m10:59:12.374718 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.07s]
[0m10:59:12.374315 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:59:12.375704 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m10:59:12.639316 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m10:59:12.640657 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m10:59:12.728515 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m10:59:12.729341 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m10:59:13.281911 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:329373a9-7487-4c82-b34c-d802a2771050&page=queryresults
[0m10:59:13.288362 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:adbaecd5-5a75-4464-9d90-e2f15cfbf9b2&page=queryresults
[0m10:59:13.589868 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739629a93fd0>]}
[0m10:59:13.594252 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 615.0 Bytes processed)[0m in 2.29s]
[0m10:59:13.594896 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m10:59:14.666648 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739621660c90>]}
[0m10:59:14.671728 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (10.0 rows, 546.0 Bytes processed)[0m in 2.30s]
[0m10:59:14.676849 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396282c5d10>]}
[0m10:59:14.683721 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m10:59:14.685358 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.38s]
[0m10:59:14.686540 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m10:59:14.694795 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m10:59:14.695466 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m10:59:14.698391 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.prescriptions_enhanced)
[0m10:59:14.704943 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m10:59:14.709378 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:59:14.710478 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m10:59:14.711159 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m10:59:14.713244 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m10:59:14.713697 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m10:59:14.717970 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m10:59:14.718514 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m10:59:14.724756 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:59:14.760291 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m10:59:14.763281 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:59:15.121375 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m10:59:15.122462 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `de-zoomcamp-2025--id`.`hospital`.`prescriptions` pr
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m10:59:15.139697 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m10:59:15.140473 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `de-zoomcamp-2025--id`.`hospital`.`visits` v
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m10:59:15.397244 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:10e787ee-bdaa-4f03-8741-07b3eb2b41d3&page=queryresults
[0m10:59:15.437096 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:08ba574c-0649-46b1-9802-1abb5481ea93&page=queryresults
[0m10:59:17.078862 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396216b33d0>]}
[0m10:59:17.079328 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (200.0 rows, 16.1 KiB processed)[0m in 2.37s]
[0m10:59:17.079648 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m10:59:17.081217 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m10:59:17.081698 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m10:59:17.082254 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m10:59:17.082976 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m10:59:17.084043 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m10:59:17.084501 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m10:59:17.085183 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m10:59:17.085613 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m10:59:17.091459 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m10:59:17.096267 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m10:59:17.098521 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m10:59:17.163507 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m10:59:17.175513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:59:17.202037 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73962169cf10>]}
[0m10:59:17.203104 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:59:17.203931 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (100.0 rows, 9.6 KiB processed)[0m in 2.50s]
[0m10:59:17.236328 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m10:59:17.239224 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m10:59:17.239707 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m10:59:17.240354 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m10:59:17.240588 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m10:59:17.243872 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m10:59:17.244445 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m10:59:17.246410 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:59:17.510230 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m10:59:17.510835 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `de-zoomcamp-2025--id`.`hospital`.`billing_payments` b
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m10:59:17.527976 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m10:59:17.528622 [debug] [Thread-1 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m10:59:17.580438 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m10:59:17.581253 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`doctors` d
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m10:59:17.720442 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:00ca012f-f416-48ea-984d-59c0501b7918&page=queryresults
[0m10:59:17.737070 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:64281164-1324-48b8-938f-862e4ddd4581&page=queryresults
[0m10:59:17.803415 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:33e54e5a-bb29-4d13-9cb0-5236e8fa8474&page=queryresults
[0m10:59:19.124359 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396217c6110>]}
[0m10:59:19.126362 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (100.0 rows, 19.9 KiB processed)[0m in 2.04s]
[0m10:59:19.127356 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m10:59:19.131240 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m10:59:19.132119 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m10:59:19.133358 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m10:59:19.134210 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m10:59:19.134903 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m10:59:19.135782 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m10:59:19.136300 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m10:59:19.140180 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m10:59:19.142898 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m10:59:19.155949 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m10:59:19.161320 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m10:59:19.167872 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:59:19.198567 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m10:59:19.201740 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:59:19.408091 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396282a5f10>]}
[0m10:59:19.409316 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 9.4 KiB processed)[0m in 2.17s]
[0m10:59:19.410312 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m10:59:19.431107 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396216e0b10>]}
[0m10:59:19.431648 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (12.0 rows, 12.9 KiB processed)[0m in 2.35s]
[0m10:59:19.432436 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m10:59:19.509134 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m10:59:19.515855 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients` p
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m10:59:19.551540 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m10:59:19.552594 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.9.0", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `de-zoomcamp-2025--id`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `de-zoomcamp-2025--id`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `de-zoomcamp-2025--id`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m10:59:19.718409 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:457b5c51-3195-49be-99b3-2ba85f6f2cc9&page=queryresults
[0m10:59:19.736848 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=de-zoomcamp-2025--id&j=bq:asia-southeast2:afffb3ab-647c-4633-9755-8585f04b6eb1&page=queryresults
[0m10:59:21.367836 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7396216e2190>]}
[0m10:59:21.368393 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 14.7 KiB processed)[0m in 2.23s]
[0m10:59:21.368803 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m10:59:21.382696 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b471250-1b9c-4cd4-85d2-f1a6ce0eb0b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739629413b50>]}
[0m10:59:21.384259 [info ] [Thread-3 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (219.0 rows, 33.5 KiB processed)[0m in 2.25s]
[0m10:59:21.398125 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m10:59:21.426949 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:59:21.428487 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:59:21.428750 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m10:59:21.428900 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m10:59:21.429493 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m10:59:21.429925 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m10:59:21.431608 [info ] [MainThread]: 
[0m10:59:21.431958 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 13.90 seconds (13.90s).
[0m10:59:21.438313 [debug] [MainThread]: Command end result
[0m10:59:21.461057 [debug] [MainThread]: Wrote artifact WritableManifest to /usr/app/dbt/target/manifest.json
[0m10:59:21.468878 [debug] [MainThread]: Wrote artifact SemanticManifest to /usr/app/dbt/target/semantic_manifest.json
[0m10:59:21.484193 [debug] [MainThread]: Wrote artifact RunExecutionResult to /usr/app/dbt/target/run_results.json
[0m10:59:21.484852 [info ] [MainThread]: 
[0m10:59:21.485278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:59:21.486178 [info ] [MainThread]: 
[0m10:59:21.488388 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m10:59:21.489553 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.038925, "process_in_blocks": "8", "process_kernel_time": 0.814711, "process_mem_max_rss": "212676", "process_out_blocks": "2664", "process_user_time": 3.381256}
[0m10:59:21.490222 [debug] [MainThread]: Command `dbt run` succeeded at 10:59:21.490117 after 15.04 seconds
[0m10:59:21.490668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73964d6a3750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73964d6a32d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x739650e1cb50>]}
[0m10:59:21.490912 [debug] [MainThread]: Flushing usage events
[0m10:59:22.846574 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:16:22.406103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7151497281d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71514976f050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715149728490>]}


============================== 01:16:22.435064 | 7d2da8ba-cbd6-4247-a821-6ebc50ebbe37 ==============================
[0m01:16:22.435064 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:16:22.438796 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:16:22.454461 [info ] [MainThread]: dbt version: 1.8.9
[0m01:16:22.455663 [info ] [MainThread]: python version: 3.11.2
[0m01:16:22.457446 [info ] [MainThread]: python path: /usr/local/bin/python
[0m01:16:22.458512 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m01:16:23.085237 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m01:16:23.085647 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m01:16:23.086128 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m01:16:23.086464 [info ] [MainThread]: adapter type: bigquery
[0m01:16:23.086698 [info ] [MainThread]: adapter version: 1.9.0
[0m01:16:23.159250 [info ] [MainThread]: Configuration:
[0m01:16:23.159803 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m01:16:23.160997 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m01:16:23.161636 [info ] [MainThread]: Required dependencies:
[0m01:16:23.161889 [debug] [MainThread]: Executing "git --help"
[0m01:16:23.165057 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m01:16:23.165343 [debug] [MainThread]: STDERR: "b''"
[0m01:16:23.165495 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m01:16:23.165737 [info ] [MainThread]: Connection:
[0m01:16:23.165981 [info ] [MainThread]:   method: service-account
[0m01:16:23.166543 [info ] [MainThread]:   database: dataeng-2025-gar
[0m01:16:23.166735 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m01:16:23.166862 [info ] [MainThread]:   schema: hospital
[0m01:16:23.167054 [info ] [MainThread]:   location: asia-southeast2
[0m01:16:23.167240 [info ] [MainThread]:   priority: interactive
[0m01:16:23.167518 [info ] [MainThread]:   maximum_bytes_billed: None
[0m01:16:23.167745 [info ] [MainThread]:   impersonate_service_account: None
[0m01:16:23.168130 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m01:16:23.168894 [info ] [MainThread]:   job_retries: 1
[0m01:16:23.169122 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m01:16:23.169351 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m01:16:23.169632 [info ] [MainThread]:   timeout_seconds: 300
[0m01:16:23.169776 [info ] [MainThread]:   client_id: None
[0m01:16:23.170144 [info ] [MainThread]:   token_uri: None
[0m01:16:23.170876 [info ] [MainThread]:   dataproc_region: None
[0m01:16:23.171005 [info ] [MainThread]:   dataproc_cluster_name: None
[0m01:16:23.171178 [info ] [MainThread]:   gcs_bucket: None
[0m01:16:23.171368 [info ] [MainThread]:   dataproc_batch: None
[0m01:16:23.171727 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:16:23.246664 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m01:16:23.247034 [debug] [MainThread]: On debug: select 1 as id
[0m01:16:23.247216 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:16:24.067715 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:526a3606-62f6-423e-bf99-97a33589a8bf&page=queryresults
[0m01:16:24.329758 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m01:16:24.331551 [info ] [MainThread]: [32mAll checks passed![0m
[0m01:16:24.332711 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.9629015, "process_in_blocks": "0", "process_kernel_time": 0.4713, "process_mem_max_rss": "201660", "process_out_blocks": "16", "process_user_time": 1.960768}
[0m01:16:24.333515 [debug] [MainThread]: Command `dbt debug` succeeded at 01:16:24.333086 after 1.96 seconds
[0m01:16:24.333749 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m01:16:24.333955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715149775910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715149ac0990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71514cf78c10>]}
[0m01:16:24.334153 [debug] [MainThread]: Flushing usage events
[0m01:16:31.361523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e119de8c1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e119de8c110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e119de8e4d0>]}


============================== 01:16:31.363384 | c3872844-0175-451d-b6cc-02036b782624 ==============================
[0m01:16:31.363384 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:16:31.364089 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt clean', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:16:31.429033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3872844-0175-451d-b6cc-02036b782624', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e119df08350>]}
[0m01:16:31.439989 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.108403616, "process_in_blocks": "0", "process_kernel_time": 0.146906, "process_mem_max_rss": "89212", "process_out_blocks": "8", "process_user_time": 0.859618}
[0m01:16:31.440471 [debug] [MainThread]: Command `dbt clean` succeeded at 01:16:31.440389 after 0.11 seconds
[0m01:16:31.440695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e119ded9d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e119ded9990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e11a170ccd0>]}
[0m01:16:31.440936 [debug] [MainThread]: Flushing usage events
[0m01:16:37.030878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a76c141b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a76c1401d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a76c1408d0>]}


============================== 01:16:37.033739 | e82a5260-eda7-45bc-b8ee-cfc4e5940ef5 ==============================
[0m01:16:37.033739 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:16:37.034128 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:16:37.622126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a74c592450>]}
[0m01:16:37.657808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a76dece5d0>]}
[0m01:16:37.658374 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:16:37.730109 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m01:16:37.730787 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:16:37.731247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a74c34c1d0>]}
[0m01:16:38.441760 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m01:16:38.442183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a74c1761d0>]}
[0m01:16:38.665113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a74c177f50>]}
[0m01:16:38.735970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746b53d50>]}
[0m01:16:38.736326 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m01:16:38.736752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746cc3810>]}
[0m01:16:38.738707 [info ] [MainThread]: 
[0m01:16:38.739148 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:16:38.743183 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:16:38.744968 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:16:38.749172 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:16:38.750434 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:16:38.751443 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:16:38.785867 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:16:39.670934 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m01:16:39.671288 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:16:39.671848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m01:16:39.672114 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:16:39.695993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m01:16:39.696706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:16:40.066106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746dedbd0>]}
[0m01:16:40.066490 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:16:40.067805 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:16:40.068020 [info ] [MainThread]: 
[0m01:16:40.073688 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:16:40.075357 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:16:40.076569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m01:16:40.076975 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:16:40.087981 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:16:40.111940 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:16:40.112889 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:16:40.113940 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:16:40.115064 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:16:40.114788 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m01:16:40.115486 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:16:40.116821 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:16:40.131058 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m01:16:40.138081 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:16:40.123111 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:16:40.136869 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:16:40.127084 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:16:40.141885 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:16:40.156923 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:16:40.167806 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:16:40.170380 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:16:40.172962 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:16:40.173825 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:16:40.174763 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m01:16:40.175468 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:16:40.175952 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:16:40.177860 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:16:40.178376 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:16:40.180156 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:16:40.186692 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:16:40.211531 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m01:16:40.212065 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m01:16:40.236695 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:16:40.237221 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:16:40.587459 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:16:40.588209 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m01:16:40.698249 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:922fd433-2fab-47f7-b797-0c81d4eba1a8&page=queryresults
[0m01:16:40.706492 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:93d66f0f-c79a-4607-b825-198b539028c3&page=queryresults
[0m01:16:40.712363 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e338d958-80b9-49df-9b98-f25c7cb53906&page=queryresults
[0m01:16:40.841767 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:08e09388-0500-4fc0-be5b-9619f618c4d7&page=queryresults
[0m01:16:40.905273 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746b9dd10>]}
[0m01:16:40.905902 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.83s]
[0m01:16:40.906674 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:16:40.909845 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746b69810>]}
[0m01:16:40.910822 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m01:16:40.910321 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.80s]
[0m01:16:40.911307 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:16:40.912242 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:16:40.912910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m01:16:40.913543 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m01:16:40.915849 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:16:40.916603 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m01:16:40.918992 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:16:40.956450 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:16:40.957362 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:16:40.958027 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m01:16:40.958501 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:16:40.960970 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:16:40.962782 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:08e09388-0500-4fc0-be5b-9619f618c4d7&page=queryresults
[0m01:16:40.963880 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:16:40.966239 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:16:41.000483 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a747fb5910>]}
[0m01:16:41.001038 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.87s]
[0m01:16:41.003410 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:16:41.016397 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: name at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m01:16:41.016728 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a7441ff0d0>]}
[0m01:16:41.017083 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 0.88s]
[0m01:16:41.020260 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:16:41.301765 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:16:41.302778 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m01:16:41.315908 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:16:41.316367 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:16:42.029707 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f89781c0-af00-41a9-a139-4056811e4986&page=queryresults
[0m01:16:42.266939 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5c5d1eac-3451-40d3-8bdc-e55dd8033f2e&page=queryresults
[0m01:16:43.471652 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746bb6650>]}
[0m01:16:43.474084 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.51s]
[0m01:16:43.480699 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:16:43.495577 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:16:43.495927 [info ] [Thread-3 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m01:16:43.497221 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:16:43.498846 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:16:43.499271 [info ] [Thread-2 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m01:16:43.499849 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:16:43.500270 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:16:43.500930 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m01:16:43.501232 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:16:43.657387 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82a5260-eda7-45bc-b8ee-cfc4e5940ef5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746bb1450>]}
[0m01:16:43.657836 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.74s]
[0m01:16:43.658336 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m01:16:43.659584 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:16:43.659990 [info ] [Thread-3 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m01:16:43.661594 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:16:43.663430 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:16:43.663832 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m01:16:43.664116 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:16:43.664816 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m01:16:43.665586 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m01:16:43.672159 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:16:43.671195 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:16:43.666283 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m01:16:43.684911 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:16:43.711323 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:16:43.720202 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:16:43.720621 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m01:16:43.720785 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m01:16:43.720910 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m01:16:43.721063 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m01:16:43.721437 [info ] [MainThread]: 
[0m01:16:43.721728 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 4.98 seconds (4.98s).
[0m01:16:43.722819 [debug] [MainThread]: Command end result
[0m01:16:43.748463 [info ] [MainThread]: 
[0m01:16:43.749122 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:16:43.749683 [info ] [MainThread]: 
[0m01:16:43.749889 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: name at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m01:16:43.750127 [info ] [MainThread]: 
[0m01:16:43.750563 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m01:16:43.751257 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 6.752267, "process_in_blocks": "160", "process_kernel_time": 0.599813, "process_mem_max_rss": "215344", "process_out_blocks": "3520", "process_user_time": 3.46371}
[0m01:16:43.751682 [debug] [MainThread]: Command `dbt run` failed at 01:16:43.751617 after 6.75 seconds
[0m01:16:43.751893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a76fae11d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a76fae1190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a746edfe90>]}
[0m01:16:43.752096 [debug] [MainThread]: Flushing usage events
[0m01:18:41.586486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796fc3614050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796fc365e910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796fc365e9d0>]}


============================== 01:18:41.588517 | 30384869-4a06-4f86-a909-90db1cf6fefd ==============================
[0m01:18:41.588517 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:18:41.589418 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m01:18:41.594478 [info ] [MainThread]: dbt version: 1.8.9
[0m01:18:41.594976 [info ] [MainThread]: python version: 3.11.2
[0m01:18:41.595280 [info ] [MainThread]: python path: /usr/local/bin/python
[0m01:18:41.595561 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m01:18:42.147313 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m01:18:42.147848 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m01:18:42.148024 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m01:18:42.148253 [info ] [MainThread]: adapter type: bigquery
[0m01:18:42.148430 [info ] [MainThread]: adapter version: 1.9.0
[0m01:18:42.204646 [info ] [MainThread]: Configuration:
[0m01:18:42.205079 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m01:18:42.205325 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m01:18:42.205472 [info ] [MainThread]: Required dependencies:
[0m01:18:42.205615 [debug] [MainThread]: Executing "git --help"
[0m01:18:42.208554 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m01:18:42.208878 [debug] [MainThread]: STDERR: "b''"
[0m01:18:42.210951 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m01:18:42.213470 [info ] [MainThread]: Connection:
[0m01:18:42.213869 [info ] [MainThread]:   method: service-account
[0m01:18:42.214015 [info ] [MainThread]:   database: dataeng-2025-gar
[0m01:18:42.214135 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m01:18:42.214258 [info ] [MainThread]:   schema: hospital
[0m01:18:42.214469 [info ] [MainThread]:   location: asia-southeast2
[0m01:18:42.214602 [info ] [MainThread]:   priority: interactive
[0m01:18:42.216245 [info ] [MainThread]:   maximum_bytes_billed: None
[0m01:18:42.216417 [info ] [MainThread]:   impersonate_service_account: None
[0m01:18:42.216630 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m01:18:42.216932 [info ] [MainThread]:   job_retries: 1
[0m01:18:42.217699 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m01:18:42.218395 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m01:18:42.218853 [info ] [MainThread]:   timeout_seconds: 300
[0m01:18:42.219287 [info ] [MainThread]:   client_id: None
[0m01:18:42.219661 [info ] [MainThread]:   token_uri: None
[0m01:18:42.220513 [info ] [MainThread]:   dataproc_region: None
[0m01:18:42.220777 [info ] [MainThread]:   dataproc_cluster_name: None
[0m01:18:42.221498 [info ] [MainThread]:   gcs_bucket: None
[0m01:18:42.221785 [info ] [MainThread]:   dataproc_batch: None
[0m01:18:42.222091 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:18:42.358886 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m01:18:42.359182 [debug] [MainThread]: On debug: select 1 as id
[0m01:18:42.359365 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:18:42.829715 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:4a17db8b-66bc-4345-b4b3-7dd8fe2ee805&page=queryresults
[0m01:18:43.070562 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m01:18:43.070908 [info ] [MainThread]: [32mAll checks passed![0m
[0m01:18:43.071656 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.5216829, "process_in_blocks": "0", "process_kernel_time": 0.352451, "process_mem_max_rss": "201532", "process_out_blocks": "24", "process_user_time": 2.008563}
[0m01:18:43.072134 [debug] [MainThread]: Command `dbt debug` succeeded at 01:18:43.072053 after 1.52 seconds
[0m01:18:43.072331 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m01:18:43.072523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796fc7129750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796f9f66ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796fc6e58c50>]}
[0m01:18:43.072726 [debug] [MainThread]: Flushing usage events
[0m01:18:48.333219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6ffbb0250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6ffbb0050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6ffbb0850>]}


============================== 01:18:48.336767 | 13ff8aea-1496-4343-97ca-51a877b154cb ==============================
[0m01:18:48.336767 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:18:48.337539 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:18:48.419072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '13ff8aea-1496-4343-97ca-51a877b154cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6ffc26190>]}
[0m01:18:48.426709 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m01:18:48.427676 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m01:18:48.428182 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.12531444, "process_in_blocks": "0", "process_kernel_time": 0.107163, "process_mem_max_rss": "89640", "process_out_blocks": "16", "process_user_time": 0.84885}
[0m01:18:48.428614 [debug] [MainThread]: Command `dbt deps` succeeded at 01:18:48.428525 after 0.13 seconds
[0m01:18:48.428832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e703430cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e70358d290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e70358c950>]}
[0m01:18:48.429032 [debug] [MainThread]: Flushing usage events
[0m01:18:54.631744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d57ed20550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d57ed23850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d57ed207d0>]}


============================== 01:18:54.633786 | 87ae025e-f4c5-44db-86a6-7756d3753ce7 ==============================
[0m01:18:54.633786 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:18:54.634077 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:18:54.699860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '87ae025e-f4c5-44db-86a6-7756d3753ce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d57ed7f890>]}
[0m01:18:54.706536 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.10652363, "process_in_blocks": "0", "process_kernel_time": 0.100514, "process_mem_max_rss": "89656", "process_out_blocks": "8", "process_user_time": 0.842149}
[0m01:18:54.706872 [debug] [MainThread]: Command `dbt clean` succeeded at 01:18:54.706791 after 0.11 seconds
[0m01:18:54.707080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d58256cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d5826f12d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d5826f1290>]}
[0m01:18:54.707465 [debug] [MainThread]: Flushing usage events
[0m01:19:01.609826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a6421cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a67b47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a6b2bc10>]}


============================== 01:19:01.611832 | a3eeafe3-b1a6-4dd0-97b6-014103020877 ==============================
[0m01:19:01.611832 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:19:01.612253 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m01:19:02.232229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78278278add0>]}
[0m01:19:02.267439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a81b9cd0>]}
[0m01:19:02.267883 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:19:02.338807 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m01:19:02.339653 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:19:02.341147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78278272d590>]}
[0m01:19:03.064382 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m01:19:03.065192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827811c0f10>]}
[0m01:19:03.285468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782781288f10>]}
[0m01:19:03.351706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827810a5e90>]}
[0m01:19:03.352169 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m01:19:03.352615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827811229d0>]}
[0m01:19:03.356636 [info ] [MainThread]: 
[0m01:19:03.357190 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:19:03.360838 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:19:03.361188 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:03.361980 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:19:03.379299 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:19:03.373219 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:03.424547 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:19:04.220452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m01:19:04.220985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m01:19:04.221532 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:04.222057 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m01:19:04.222398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:04.222971 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:19:04.873394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782782437e90>]}
[0m01:19:04.873984 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:19:04.875816 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:19:04.876423 [info ] [MainThread]: 
[0m01:19:04.879986 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:19:04.880428 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:19:04.881351 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:19:04.881908 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:19:04.885232 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:19:04.885750 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:19:04.889037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m01:19:04.892542 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:19:04.898896 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m01:19:04.907616 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:19:04.918298 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:19:04.902860 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:19:04.931877 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:19:04.955242 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:19:04.963318 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:19:04.970966 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:19:04.977283 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:19:05.016135 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:19:04.998059 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:19:05.015249 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:19:05.005465 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:19:05.037758 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:19:05.042593 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:19:05.044909 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:19:05.046677 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:19:05.047613 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:19:05.048484 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m01:19:05.056292 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:19:05.056893 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m01:19:05.059400 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:19:05.060032 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:05.083703 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:19:05.086441 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m01:19:05.155277 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:19:05.493306 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:19:05.493868 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m01:19:05.577185 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5f76d252-39d2-461a-b4b9-7b85e76b342d&page=queryresults
[0m01:19:05.588480 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:8ce78214-473a-4588-8f7a-6aa3c60dcd29&page=queryresults
[0m01:19:05.643276 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:13c5d02c-b440-4d41-99a8-c8e41f699b43&page=queryresults
[0m01:19:05.767365 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78278055b210>]}
[0m01:19:05.767809 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.88s]
[0m01:19:05.769394 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:19:05.770252 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m01:19:05.770547 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:19:05.770809 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m01:19:05.770992 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m01:19:05.773490 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:19:05.773910 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m01:19:05.778256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:19:05.878308 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782780f5d750>]}
[0m01:19:05.879230 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m01:19:05.880265 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:19:05.895659 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782780eaea50>]}
[0m01:19:05.896216 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m01:19:05.897304 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:19:05.907306 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m01:19:05.910291 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:19:05.923708 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m01:19:05.923989 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m01:19:05.937057 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:19:05.938203 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m01:19:05.953381 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:19:06.210887 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:19:06.213482 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:19:06.350301 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:19:06.352117 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m01:19:06.864747 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:80b14797-cdf5-42dd-839e-c4482b14e855&page=queryresults
[0m01:19:06.879588 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:52665a83-f9bd-4721-8e0a-0e2b43a2d23c&page=queryresults
[0m01:19:06.962675 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:52665a83-f9bd-4721-8e0a-0e2b43a2d23c&page=queryresults
[0m01:19:06.969038 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: name at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m01:19:06.969479 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782780f44c10>]}
[0m01:19:06.969895 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 2.01s]
[0m01:19:06.970227 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:19:07.199307 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:2f5c015e-9322-4c4a-8661-e2960b4e73b6&page=queryresults
[0m01:19:08.285064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782781070ad0>]}
[0m01:19:08.285695 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.51s]
[0m01:19:08.286756 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m01:19:08.597634 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3eeafe3-b1a6-4dd0-97b6-014103020877', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x782780f710d0>]}
[0m01:19:08.598126 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.67s]
[0m01:19:08.598482 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m01:19:08.599908 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:19:08.600363 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:19:08.600754 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m01:19:08.602172 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:19:08.601776 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m01:19:08.606914 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:19:08.607636 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:19:08.608369 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m01:19:08.608813 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:19:08.609112 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:19:08.609964 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m01:19:08.609729 [info ] [Thread-3 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m01:19:08.610742 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:19:08.611103 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:19:08.611436 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m01:19:08.608015 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:19:08.612058 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:19:08.610192 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m01:19:08.620360 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:19:08.613734 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m01:19:08.620805 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:19:08.674412 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:19:08.676517 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:19:08.679978 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m01:19:08.680262 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m01:19:08.680418 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m01:19:08.680755 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m01:19:08.681041 [info ] [MainThread]: 
[0m01:19:08.681411 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 5.32 seconds (5.32s).
[0m01:19:08.682790 [debug] [MainThread]: Command end result
[0m01:19:08.729301 [info ] [MainThread]: 
[0m01:19:08.729873 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:19:08.730141 [info ] [MainThread]: 
[0m01:19:08.730385 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: name at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m01:19:08.730677 [info ] [MainThread]: 
[0m01:19:08.730902 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m01:19:08.731874 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.155789, "process_in_blocks": "0", "process_kernel_time": 0.610944, "process_mem_max_rss": "215912", "process_out_blocks": "3520", "process_user_time": 3.726211}
[0m01:19:08.732172 [debug] [MainThread]: Command `dbt run` failed at 01:19:08.732112 after 7.16 seconds
[0m01:19:08.732510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a9dd13d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a9dd1390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7827a9dd0a90>]}
[0m01:19:08.732739 [debug] [MainThread]: Flushing usage events
[0m01:25:10.486782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf5196b8990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf5196f6f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf5196b82d0>]}


============================== 01:25:10.489209 | e2b4cc58-de72-4429-b412-3a62ebb1dbe7 ==============================
[0m01:25:10.489209 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:25:10.489713 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:25:11.125616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f59ec5d0>]}
[0m01:25:11.162119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf51b47a350>]}
[0m01:25:11.162615 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:25:11.238189 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m01:25:11.324645 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:25:11.325141 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/doctors.sql
[0m01:25:11.575903 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m01:25:11.576575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f5484f10>]}
[0m01:25:11.702180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f4548790>]}
[0m01:25:11.776072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f45ceed0>]}
[0m01:25:11.776751 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m01:25:11.777008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f573f310>]}
[0m01:25:11.778841 [info ] [MainThread]: 
[0m01:25:11.779621 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:25:11.782943 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:25:11.783576 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:25:11.784905 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:25:11.787969 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:11.788742 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:11.789150 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:25:12.803889 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m01:25:12.805823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:25:12.843598 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m01:25:12.844054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:25:12.869212 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m01:25:12.869725 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:25:14.742504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f4586650>]}
[0m01:25:14.742922 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:25:14.744178 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:25:14.744522 [info ] [MainThread]: 
[0m01:25:14.754159 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:25:14.756241 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:25:14.754910 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:25:14.759764 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:25:14.755825 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:25:14.767888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m01:25:14.758005 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:25:14.757681 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:25:14.769650 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:25:14.765508 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m01:25:14.791449 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:25:14.771442 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:25:14.770261 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:25:14.801886 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:25:14.805978 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:25:14.806969 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:25:14.807680 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:25:14.811100 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:25:14.811626 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:25:14.812483 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:25:14.812913 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:25:14.842428 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:25:14.845601 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:25:14.846561 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:25:14.849019 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:25:14.850822 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m01:25:14.851507 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:25:14.855553 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:25:14.864166 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:25:14.865591 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m01:25:14.905526 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:25:14.907245 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:25:14.963339 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m01:25:14.965170 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:25:15.702985 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:50aa9559-8dfe-4074-a171-a018d3c321d8&page=queryresults
[0m01:25:16.058544 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:25:16.060130 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m01:25:16.174609 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:6df1a90e-2b92-43c3-be09-11fc2023e377&page=queryresults
[0m01:25:16.210783 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f4311c10>]}
[0m01:25:16.211311 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.45s]
[0m01:25:16.212512 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:25:16.213233 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:25:16.213700 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:25:16.214247 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m01:25:16.214669 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:25:16.222060 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:25:16.222937 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:25:16.228096 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:25:16.282917 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f57aeb03-145a-43ef-bd45-e2a2dfda5f57&page=queryresults
[0m01:25:16.422777 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9aedfad9-dfbd-4626-9225-1f46fedf0d1f&page=queryresults
[0m01:25:16.448688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f59a9610>]}
[0m01:25:16.450690 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.68s]
[0m01:25:16.451319 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:25:16.454619 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m01:25:16.454969 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:25:16.455612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m01:25:16.457130 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m01:25:16.460542 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:25:16.461257 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m01:25:16.466178 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:25:16.540068 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f45d1d90>]}
[0m01:25:16.541047 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.77s]
[0m01:25:16.541913 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:25:16.794093 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:25:16.794959 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m01:25:17.465877 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5c099225-b201-4d9f-a593-67d9f2cbbfd6&page=queryresults
[0m01:25:17.740564 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f4334f10>]}
[0m01:25:17.741035 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 620.0 Bytes processed)[0m in 2.93s]
[0m01:25:17.741705 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:25:17.881900 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:25:17.882540 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:25:18.570218 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:7c24cdf2-00bc-479c-967e-c11cccadf8e2&page=queryresults
[0m01:25:18.967106 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed752f10>]}
[0m01:25:18.968498 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.75s]
[0m01:25:18.968996 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:25:18.970742 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:25:18.971399 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m01:25:18.972393 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.visits_enhanced)
[0m01:25:18.972791 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m01:25:18.978409 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m01:25:18.978972 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m01:25:18.980810 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:25:19.389431 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m01:25:19.390323 [debug] [Thread-3 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `dataeng-2025-gar`.`hospital`.`visits` v
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m01:25:19.601231 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ddc24cde-3f35-422f-aea1-e634fefc1faf&page=queryresults
[0m01:25:19.997702 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4f4300a50>]}
[0m01:25:19.998626 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 3.54s]
[0m01:25:19.999123 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m01:25:20.000536 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:25:20.000876 [info ] [Thread-2 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m01:25:20.001327 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m01:25:20.001709 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m01:25:20.010563 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m01:25:20.010979 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m01:25:20.014566 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:25:20.404402 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m01:25:20.404899 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `dataeng-2025-gar`.`hospital`.`prescriptions` pr
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m01:25:20.634127 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:3cb29cd1-4841-4bca-833c-6c902351daee&page=queryresults
[0m01:25:21.293663 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed7937d0>]}
[0m01:25:21.294156 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (774.0 rows, 43.1 KiB processed)[0m in 2.32s]
[0m01:25:21.295012 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:25:21.296891 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:25:21.297190 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:25:21.297903 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m01:25:21.300296 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m01:25:21.299052 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m01:25:21.300661 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m01:25:21.301074 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m01:25:21.307425 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m01:25:21.306078 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m01:25:21.311327 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m01:25:21.312642 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m01:25:21.316043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:25:21.353733 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m01:25:21.357561 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:25:21.676350 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m01:25:21.678565 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `dataeng-2025-gar`.`hospital`.`billing_payments` b
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m01:25:21.683564 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m01:25:21.684271 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m01:25:21.922048 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9776545b-f214-4133-aee8-bf518913bc7a&page=queryresults
[0m01:25:21.990663 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:745d5006-361c-44fa-85d9-b84003077055&page=queryresults
[0m01:25:22.015703 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed792390>]}
[0m01:25:22.016174 [info ] [Thread-2 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (746.0 rows, 40.4 KiB processed)[0m in 2.01s]
[0m01:25:22.017072 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:25:22.018450 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:25:22.018835 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m01:25:22.019499 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m01:25:22.019768 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m01:25:22.024270 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m01:25:22.024663 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m01:25:22.029911 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:25:22.401753 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m01:25:22.403096 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `dataeng-2025-gar`.`hospital_staging`.`doctors` d
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m01:25:22.643131 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:8b7a3ee5-305f-40ea-a1a9-c3a8f1956a0d&page=queryresults
[0m01:25:23.317972 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed507610>]}
[0m01:25:23.318611 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (11.0 rows, 49.8 KiB processed)[0m in 2.02s]
[0m01:25:23.319736 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:25:23.403932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed6dc450>]}
[0m01:25:23.404711 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (833.0 rows, 79.9 KiB processed)[0m in 2.10s]
[0m01:25:23.405199 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:25:23.407573 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m01:25:23.407996 [info ] [Thread-2 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m01:25:23.408355 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m01:25:23.408776 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m01:25:23.412426 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m01:25:23.412941 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:25:23.413879 [info ] [Thread-4 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m01:25:23.414571 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_spending_analysis)
[0m01:25:23.420979 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m01:25:23.421884 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m01:25:23.457404 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m01:25:23.455435 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:25:23.483223 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m01:25:23.486590 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:25:23.794397 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m01:25:23.796901 [debug] [Thread-2 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `dataeng-2025-gar`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m01:25:23.801769 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m01:25:23.802309 [debug] [Thread-4 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `dataeng-2025-gar`.`hospital_staging`.`patients` p
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m01:25:24.015221 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:bd3a0792-e20d-4bf4-a703-f1c0503df62c&page=queryresults
[0m01:25:24.021207 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:93f3d72b-edb1-475e-b396-7ff56a8fc374&page=queryresults
[0m01:25:24.303695 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed72f3d0>]}
[0m01:25:24.304254 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 47.9 KiB processed)[0m in 2.28s]
[0m01:25:24.305161 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:25:25.715316 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed7db1d0>]}
[0m01:25:25.716116 [info ] [Thread-4 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 71.4 KiB processed)[0m in 2.30s]
[0m01:25:25.716978 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:25:26.256859 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2b4cc58-de72-4429-b412-3a62ebb1dbe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf4ed6c6190>]}
[0m01:25:26.257821 [info ] [Thread-2 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (1.7k rows, 161.8 KiB processed)[0m in 2.85s]
[0m01:25:26.258395 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:25:26.261546 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:25:26.262752 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:25:26.262985 [debug] [MainThread]: Connection 'model.hospital_analytics.billing_enhanced' was properly closed.
[0m01:25:26.263122 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m01:25:26.263238 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m01:25:26.263480 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m01:25:26.263732 [info ] [MainThread]: 
[0m01:25:26.263907 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 14.48 seconds (14.48s).
[0m01:25:26.265655 [debug] [MainThread]: Command end result
[0m01:25:26.304098 [info ] [MainThread]: 
[0m01:25:26.304882 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:25:26.305658 [info ] [MainThread]: 
[0m01:25:26.305991 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m01:25:26.306884 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.85408, "process_in_blocks": "0", "process_kernel_time": 0.692484, "process_mem_max_rss": "214972", "process_out_blocks": "3728", "process_user_time": 3.585194}
[0m01:25:26.307241 [debug] [MainThread]: Command `dbt run` succeeded at 01:25:26.307134 after 15.85 seconds
[0m01:25:26.307465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf519a50890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf51cf08c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf51d08c950>]}
[0m01:25:26.307660 [debug] [MainThread]: Flushing usage events
[0m01:28:27.190037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0eb408ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0eb409190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0eb408a90>]}


============================== 01:28:27.192193 | 984e84b2-7d48-414f-bf54-85fc8e30c5b5 ==============================
[0m01:28:27.192193 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:28:27.192624 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:28:27.813636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '984e84b2-7d48-414f-bf54-85fc8e30c5b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0cdfd6b90>]}
[0m01:28:27.853050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '984e84b2-7d48-414f-bf54-85fc8e30c5b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0ed1c2750>]}
[0m01:28:27.853628 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:28:27.919930 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m01:28:27.999706 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:28:27.999978 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:28:28.031745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '984e84b2-7d48-414f-bf54-85fc8e30c5b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0c7556910>]}
[0m01:28:28.041625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '984e84b2-7d48-414f-bf54-85fc8e30c5b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0c7485790>]}
[0m01:28:28.042046 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m01:28:28.042348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '984e84b2-7d48-414f-bf54-85fc8e30c5b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0c7308590>]}
[0m01:28:28.044880 [info ] [MainThread]: 
[0m01:28:28.045488 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:28:28.049959 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_analytics'
[0m01:28:28.050291 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:28.075916 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_staging'
[0m01:28:28.078521 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:28.178904 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_intermediate'
[0m01:28:28.179624 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:28.506468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '984e84b2-7d48-414f-bf54-85fc8e30c5b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0c7bf6310>]}
[0m01:28:28.506789 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:28:28.507840 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:28:28.508076 [info ] [MainThread]: 
[0m01:28:28.512065 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:28:28.512518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m01:28:28.512932 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:28:28.513302 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:28:28.519833 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:28:28.526812 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m01:28:28.531767 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:28:28.542343 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:28:28.545877 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:28:28.546486 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:28:28.547515 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:28:28.547864 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:28:28.550696 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:28:28.551437 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:28:28.551704 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:28:28.554001 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:28:28.556697 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:28:28.557496 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:28:28.557991 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:28:28.560308 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:28:28.560876 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:28:28.562024 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:28:28.562560 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:28:28.564020 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:28:28.564860 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:28:28.565211 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m01:28:28.565665 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:28:28.567285 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:28:28.567977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m01:28:28.569694 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:28:28.570164 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m01:28:28.570844 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:28:28.571193 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m01:28:28.571576 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:28:28.572001 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.patients)
[0m01:28:28.572517 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m01:28:28.574808 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:28:28.575447 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m01:28:28.575979 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m01:28:28.576236 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:28:28.576734 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:28:28.576965 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m01:28:28.579286 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:28:28.586817 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m01:28:28.592501 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m01:28:28.592951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:28:28.593924 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m01:28:28.594544 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:28:28.594881 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:28:28.596345 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m01:28:28.596768 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:28:28.597054 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:28:28.597535 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:28:28.597992 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:28:28.599660 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m01:28:28.600396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m01:28:28.601736 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:28:28.602210 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:28:28.603317 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:28:28.604074 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:28:28.604583 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:28:28.605024 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m01:28:28.605463 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:28:28.608226 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m01:28:28.608749 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m01:28:28.609147 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:28:28.609493 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.visits_enhanced)
[0m01:28:28.609917 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m01:28:28.610242 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:28:28.614796 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m01:28:28.615182 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m01:28:28.617866 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m01:28:28.618252 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:28:28.620810 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m01:28:28.621213 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:28:28.622815 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:28:28.623648 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:28:28.623884 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m01:28:28.624191 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m01:28:28.624847 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:28:28.626285 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:28:28.626622 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:28:28.626998 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:28:28.627572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.not_null_patients_age.8fed007e09)
[0m01:28:28.628031 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:28:28.629240 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:28:28.630511 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:28:28.630941 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:28:28.631460 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_full_name.7bac40f23c)
[0m01:28:28.631775 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:28:28.632192 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:28:28.635376 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_age.8fed007e09"
[0m01:28:28.636106 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:28:28.636626 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9)
[0m01:28:28.640817 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:28:28.637034 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a)
[0m01:28:28.640275 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:28:28.639919 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_full_name.7bac40f23c"
[0m01:28:28.643400 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9"
[0m01:28:28.643787 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:28:28.644123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:28:28.644814 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:28:28.647884 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a"
[0m01:28:28.648234 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:28:28.649692 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:28:28.650066 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:28:28.650530 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:28:28.650853 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:28:28.651255 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:28:28.652689 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:28:28.653007 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:28:28.654325 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:28:28.654711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_age.8fed007e09, now model.hospital_analytics.billing_enhanced)
[0m01:28:28.655123 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:28:28.656360 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:28:28.657042 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:28:28.657412 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m01:28:28.657998 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_full_name.7bac40f23c, now model.hospital_analytics.doctor_performance)
[0m01:28:28.658473 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:28:28.658825 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9, now model.hospital_analytics.monthly_visit_stats)
[0m01:28:28.661220 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m01:28:28.661660 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m01:28:28.662121 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m01:28:28.662483 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m01:28:28.666087 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m01:28:28.666351 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m01:28:28.666698 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:28:28.668805 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m01:28:28.669607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:28:28.672100 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m01:28:28.672436 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m01:28:28.674120 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:28:28.674419 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m01:28:28.674872 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:28:28.675248 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:28:28.675601 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:28:28.675960 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:28:28.676622 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:28:28.678049 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:28:28.678415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m01:28:28.679568 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:28:28.681152 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:28:28.681669 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:28:28.682006 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:28:28.682494 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m01:28:28.682891 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:28:28.683517 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m01:28:28.686105 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m01:28:28.686519 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.patient_journey)
[0m01:28:28.686896 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m01:28:28.687535 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:28:28.687978 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:28:28.688624 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m01:28:28.688957 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m01:28:28.691804 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m01:28:28.692281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:28:28.695220 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m01:28:28.697626 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m01:28:28.699071 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:28:28.699528 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:28:28.700628 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m01:28:28.701213 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:28:28.701501 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m01:28:28.701912 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:28:28.703241 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:28:28.703617 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:28:28.704884 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:28:28.706727 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:28:28.719941 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:28:28.721179 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m01:28:28.721397 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m01:28:28.721530 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m01:28:28.723405 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m01:28:28.728053 [debug] [MainThread]: Command end result
[0m01:28:28.795804 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m01:28:28.796202 [info ] [MainThread]: Building catalog
[0m01:28:28.803010 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:28:28.830235 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:28:28.840035 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:28:28.850036 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:28:28.850526 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_staging`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:28:28.853029 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_analytics`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:28:28.855312 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:28:28.858215 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_intermediate`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:28:28.861054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:28.862738 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:28.863109 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:28.865098 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:28:29.458618 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:93a69611-9999-4e5c-9b93-3ebe8c629926&page=queryresults
[0m01:28:29.546393 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1d9cdfeb-3d68-4b69-ada8-8693550925df&page=queryresults
[0m01:28:29.549116 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:41ed8629-2b40-40fc-ace7-d0f1c16182d0&page=queryresults
[0m01:28:29.555800 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:24e5871e-8041-4be8-991e-6fb2ce00c0bf&page=queryresults
[0m01:28:30.774855 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:28:30.801236 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m01:28:30.802613 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 3.646098, "process_in_blocks": "0", "process_kernel_time": 0.471949, "process_mem_max_rss": "209564", "process_out_blocks": "5720", "process_user_time": 2.768954}
[0m01:28:30.803060 [debug] [MainThread]: Command `dbt docs generate` succeeded at 01:28:30.802989 after 3.65 seconds
[0m01:28:30.803244 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m01:28:30.803397 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:28:30.803517 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:28:30.803758 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:28:30.803926 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:28:30.804089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0d3f0e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0eede5310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76f0eede49d0>]}
[0m01:28:30.804280 [debug] [MainThread]: Flushing usage events
[0m01:28:35.634611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5e0a9290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5e0aa590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5e0a8ad0>]}


============================== 01:28:35.636827 | 05ce65fd-a051-4f71-b90e-da98a653b20b ==============================
[0m01:28:35.636827 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:28:35.637449 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:28:36.265808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05ce65fd-a051-4f71-b90e-da98a653b20b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5e0a62d0>]}
[0m01:28:36.300846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05ce65fd-a051-4f71-b90e-da98a653b20b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5fe3dfd0>]}
[0m01:30:03.233171 [error] [MainThread]: Encountered an error:

[0m01:30:03.234464 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.11/socketserver.py", line 233, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m01:30:03.235091 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 87.63228, "process_in_blocks": "0", "process_kernel_time": 0.33515, "process_mem_max_rss": "196448", "process_out_blocks": "2968", "process_user_time": 1.998284}
[0m01:30:03.235589 [debug] [MainThread]: Command `dbt docs serve` failed at 01:30:03.235478 after 87.63 seconds
[0m01:30:03.235885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e61a59490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5e43cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732e5e43ced0>]}
[0m01:30:03.236159 [debug] [MainThread]: Flushing usage events
[0m01:30:10.201606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1de104e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1de146c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1de107410>]}


============================== 01:30:10.204951 | d76ac084-08ea-4831-a47b-c48167fea6fc ==============================
[0m01:30:10.204951 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:30:10.205502 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt clean', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:30:10.281798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd76ac084-08ea-4831-a47b-c48167fea6fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1de0fe350>]}
[0m01:30:10.288680 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.121254966, "process_in_blocks": "0", "process_kernel_time": 0.142501, "process_mem_max_rss": "89764", "process_out_blocks": "8", "process_user_time": 1.367487}
[0m01:30:10.289137 [debug] [MainThread]: Command `dbt clean` succeeded at 01:30:10.288952 after 0.12 seconds
[0m01:30:10.289381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1e1984cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1e1ae1390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75c1e1ae1110>]}
[0m01:30:10.289582 [debug] [MainThread]: Flushing usage events
[0m01:30:17.101096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750daaa69510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750daaa69e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750daaa68490>]}


============================== 01:30:17.103297 | 1e3b4b5b-7fe2-434c-b567-29d99b744ed2 ==============================
[0m01:30:17.103297 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:30:17.103731 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m01:30:17.725222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d86c10e50>]}
[0m01:30:17.765853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dac801a10>]}
[0m01:30:17.767087 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:30:17.847521 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m01:30:17.848338 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:30:17.848797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d86befe10>]}
[0m01:30:18.566160 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m01:30:18.566693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d86da0550>]}
[0m01:30:18.773537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d86981710>]}
[0m01:30:18.836885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d8550be10>]}
[0m01:30:18.837216 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m01:30:18.837522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d8564ed50>]}
[0m01:30:18.841977 [info ] [MainThread]: 
[0m01:30:18.842653 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:30:18.846109 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:30:18.846582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:18.847147 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:30:18.889917 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m01:30:18.892476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:18.890948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:19.743352 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now create_dataeng-2025-gar_hospital_staging)
[0m01:30:19.743799 [debug] [ThreadPool]: Creating schema "database: "dataeng-2025-gar"
schema: "hospital_staging"
"
[0m01:30:19.750546 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now create_dataeng-2025-gar_hospital_intermediate)
[0m01:30:19.750901 [debug] [ThreadPool]: Creating schema "database: "dataeng-2025-gar"
schema: "hospital_intermediate"
"
[0m01:30:19.755265 [debug] [ThreadPool]: On create_dataeng-2025-gar_hospital_intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "create_dataeng-2025-gar_hospital_intermediate"} */
create schema if not exists `dataeng-2025-gar`.`hospital_intermediate`
  
[0m01:30:19.755560 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:19.757680 [debug] [ThreadPool]: On create_dataeng-2025-gar_hospital_staging: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "create_dataeng-2025-gar_hospital_staging"} */
create schema if not exists `dataeng-2025-gar`.`hospital_staging`
  
[0m01:30:19.758055 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:19.783861 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now create_dataeng-2025-gar_hospital_analytics)
[0m01:30:19.784541 [debug] [ThreadPool]: Creating schema "database: "dataeng-2025-gar"
schema: "hospital_analytics"
"
[0m01:30:19.809786 [debug] [ThreadPool]: On create_dataeng-2025-gar_hospital_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "create_dataeng-2025-gar_hospital_analytics"} */
create schema if not exists `dataeng-2025-gar`.`hospital_analytics`
  
[0m01:30:19.810446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:20.244496 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5ad0c0eb-4e8c-463c-a929-eed104237989&page=queryresults
[0m01:30:20.356996 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:a07ac8e1-4a76-4b55-9434-05d70faf1296&page=queryresults
[0m01:30:20.395067 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5b0fed40-b4d6-4f8e-b9d2-1a1445bc5a25&page=queryresults
[0m01:30:25.991972 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_dataeng-2025-gar_hospital_intermediate, now list_dataeng-2025-gar_hospital_staging)
[0m01:30:25.992615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:25.993173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_dataeng-2025-gar_hospital_analytics, now list_dataeng-2025-gar_hospital_intermediate)
[0m01:30:25.993465 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:26.036443 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_dataeng-2025-gar_hospital_staging, now list_dataeng-2025-gar_hospital_analytics)
[0m01:30:26.042515 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:30:26.890884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d8577c2d0>]}
[0m01:30:26.891288 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:30:26.892753 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:30:26.893808 [info ] [MainThread]: 
[0m01:30:26.901607 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:30:26.902223 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m01:30:26.902817 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:30:26.903689 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m01:30:26.904080 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:30:26.905190 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m01:30:26.905959 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:30:26.904805 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m01:30:26.909208 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m01:30:26.939638 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:30:26.930531 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m01:30:26.938741 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:30:26.943046 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:30:26.912928 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m01:30:26.940590 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:30:26.939978 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:30:26.957766 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m01:30:26.981785 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:30:26.985333 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m01:30:26.988184 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:30:26.988722 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m01:30:26.990023 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:30:26.992554 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:30:26.993837 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:30:26.996312 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m01:30:27.000449 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m01:30:27.000942 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m01:30:27.003498 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m01:30:27.004363 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m01:30:27.005035 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:27.005806 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:27.025067 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m01:30:27.026718 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m01:30:27.079708 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:27.103901 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m01:30:27.105802 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:30:27.507105 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:3b951aff-801b-4a3b-b3fe-a17073e63f01&page=queryresults
[0m01:30:27.509416 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:54e15977-26ab-42c9-aba0-e50b0a6d51d8&page=queryresults
[0m01:30:27.526715 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:8c569cc3-bf95-4c05-95e8-4cc5bbe7c2d4&page=queryresults
[0m01:30:27.549395 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:43a053e1-456b-4a4a-901a-0d473df6e875&page=queryresults
[0m01:30:27.734202 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d84245c50>]}
[0m01:30:27.734947 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.80s]
[0m01:30:27.736929 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:30:27.740520 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:30:27.741722 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m01:30:27.742512 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m01:30:27.741157 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d85519990>]}
[0m01:30:27.742867 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:30:27.744010 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.84s]
[0m01:30:27.747080 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:30:27.749486 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:30:27.752162 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:30:27.765119 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m01:30:27.766560 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m01:30:27.766959 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:27.767319 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m01:30:27.767835 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m01:30:27.768420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m01:30:27.768687 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m01:30:27.771084 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:30:27.802233 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m01:30:27.806478 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m01:30:27.807952 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m01:30:27.808714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:27.847743 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d84194dd0>]}
[0m01:30:27.848768 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m01:30:27.849310 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:30:28.709060 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e8e311d4-32b6-49e0-a744-75ef2f844079&page=queryresults
[0m01:30:28.710878 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:cd4af315-a9f2-43ba-bda7-f397702759c4&page=queryresults
[0m01:30:28.938956 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d8581f0d0>]}
[0m01:30:28.939452 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 620.0 Bytes processed)[0m in 1.98s]
[0m01:30:28.940457 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m01:30:30.073103 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d5d754c10>]}
[0m01:30:30.073566 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.30s]
[0m01:30:30.073928 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m01:30:30.096270 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d8416d650>]}
[0m01:30:30.096858 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.35s]
[0m01:30:30.097220 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:30:30.098807 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:30:30.099251 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m01:30:30.099808 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:30:30.100240 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.prescriptions_enhanced)
[0m01:30:30.101345 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m01:30:30.104511 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m01:30:30.100980 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m01:30:30.105488 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m01:30:30.106019 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m01:30:30.108371 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m01:30:30.109525 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m01:30:30.113739 [debug] [Thread-3 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `dataeng-2025-gar`.`hospital`.`prescriptions` pr
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m01:30:30.117711 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m01:30:30.121643 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:30.154624 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m01:30:30.157313 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m01:30:30.158715 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `dataeng-2025-gar`.`hospital`.`visits` v
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m01:30:30.159015 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:30:30.637633 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:25425bbc-4059-4b40-8968-743b3c70d375&page=queryresults
[0m01:30:30.688620 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:008d8521-6758-45af-b45e-c4d78165ae14&page=queryresults
[0m01:30:32.034271 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d5d74fa90>]}
[0m01:30:32.035603 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (774.0 rows, 43.1 KiB processed)[0m in 1.93s]
[0m01:30:32.037853 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:30:32.043930 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:30:32.044256 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m01:30:32.046228 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m01:30:32.046466 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m01:30:32.053107 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:30:32.054481 [info ] [Thread-1 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m01:30:32.055079 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.monthly_visit_stats)
[0m01:30:32.055512 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m01:30:32.057766 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m01:30:32.052647 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m01:30:32.065411 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m01:30:32.072269 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d5d72b510>]}
[0m01:30:32.078874 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (746.0 rows, 40.4 KiB processed)[0m in 1.97s]
[0m01:30:32.079644 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:30:32.077919 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m01:30:32.081119 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m01:30:32.081776 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:30:32.084401 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m01:30:32.087174 [debug] [Thread-1 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m01:30:32.086778 [info ] [Thread-4 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m01:30:32.088048 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `dataeng-2025-gar`.`hospital`.`billing_payments` b
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m01:30:32.094882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:32.099210 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m01:30:32.103872 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:32.149695 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m01:30:32.193965 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m01:30:32.194797 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctor_performance
[0m01:30:32.196640 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m01:30:32.197171 [debug] [Thread-4 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `dataeng-2025-gar`.`hospital_staging`.`doctors` d
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m01:30:32.197439 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:30:32.935559 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:4e32ab61-133c-492e-a13f-f04af737b41d&page=queryresults
[0m01:30:32.939175 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:529f9d16-210c-44f1-90f5-e5c982f5f421&page=queryresults
[0m01:30:33.068728 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:45a1f6ca-1eee-4c04-a4f5-e06630d8961a&page=queryresults
[0m01:30:34.443114 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d5d7c6f50>]}
[0m01:30:34.443610 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (833.0 rows, 79.9 KiB processed)[0m in 2.40s]
[0m01:30:34.443945 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:30:34.445613 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m01:30:34.446735 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:30:34.447977 [info ] [Thread-3 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m01:30:34.448841 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m01:30:34.448446 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m01:30:34.449556 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_journey
[0m01:30:34.450090 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m01:30:34.459210 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m01:30:34.480407 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m01:30:34.485277 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_journey
[0m01:30:34.490477 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m01:30:34.494460 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m01:30:34.502247 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m01:30:34.516009 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m01:30:34.518270 [debug] [Thread-3 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `dataeng-2025-gar`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m01:30:34.519530 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:34.547424 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `dataeng-2025-gar`.`hospital_staging`.`patients` p
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m01:30:34.548038 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:34.613215 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d8552ab90>]}
[0m01:30:34.614983 [info ] [Thread-1 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (11.0 rows, 49.8 KiB processed)[0m in 2.56s]
[0m01:30:34.615692 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:30:34.621097 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d5d7b6b90>]}
[0m01:30:34.621697 [info ] [Thread-4 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 47.9 KiB processed)[0m in 2.52s]
[0m01:30:34.622120 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:30:34.989932 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ae2846e9-c5d4-4570-93f8-45cc549ebcda&page=queryresults
[0m01:30:35.301237 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:62852d2e-77aa-4ba2-84a3-18074adc536d&page=queryresults
[0m01:30:36.675069 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d840bc5d0>]}
[0m01:30:36.675808 [info ] [Thread-3 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (1.7k rows, 161.8 KiB processed)[0m in 2.23s]
[0m01:30:36.677685 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:30:36.953269 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e3b4b5b-7fe2-434c-b567-29d99b744ed2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750d840bd050>]}
[0m01:30:36.953916 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 71.4 KiB processed)[0m in 2.50s]
[0m01:30:36.957085 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:30:36.961941 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:30:36.963392 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:30:36.966053 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m01:30:36.966750 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m01:30:36.967570 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m01:30:36.967718 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m01:30:36.967960 [info ] [MainThread]: 
[0m01:30:36.972043 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 18.13 seconds (18.13s).
[0m01:30:36.978508 [debug] [MainThread]: Command end result
[0m01:30:37.022221 [info ] [MainThread]: 
[0m01:30:37.022841 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:30:37.023988 [info ] [MainThread]: 
[0m01:30:37.024319 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m01:30:37.026000 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 19.958942, "process_in_blocks": "0", "process_kernel_time": 0.722034, "process_mem_max_rss": "216328", "process_out_blocks": "3728", "process_user_time": 4.066581}
[0m01:30:37.026448 [debug] [MainThread]: Command `dbt run` succeeded at 01:30:37.026352 after 19.96 seconds
[0m01:30:37.026716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dae294e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dae4193d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dae418a90>]}
[0m01:30:37.027206 [debug] [MainThread]: Flushing usage events
[0m01:30:43.764347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f802ea110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f802e9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f802e8a10>]}


============================== 01:30:43.767428 | 2c6d1100-6546-412a-a1d4-265584669ca1 ==============================
[0m01:30:43.767428 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:30:43.769468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:30:44.709516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c6d1100-6546-412a-a1d4-265584669ca1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f802e1e90>]}
[0m01:30:44.758948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c6d1100-6546-412a-a1d4-265584669ca1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f8207ee10>]}
[0m01:30:44.759470 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:30:44.869368 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m01:30:45.048405 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:30:45.048851 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:30:45.129350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c6d1100-6546-412a-a1d4-265584669ca1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f60b84f10>]}
[0m01:30:45.147543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c6d1100-6546-412a-a1d4-265584669ca1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f604055d0>]}
[0m01:30:45.147991 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m01:30:45.148820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c6d1100-6546-412a-a1d4-265584669ca1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f6045ff10>]}
[0m01:30:45.150972 [info ] [MainThread]: 
[0m01:30:45.151601 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:30:45.156205 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_intermediate'
[0m01:30:45.156721 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:45.305847 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_analytics'
[0m01:30:45.308895 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_staging'
[0m01:30:45.312812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:45.313625 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:45.689656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c6d1100-6546-412a-a1d4-265584669ca1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f818e1dd0>]}
[0m01:30:45.689984 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:30:45.692475 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:30:45.694007 [info ] [MainThread]: 
[0m01:30:45.705886 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m01:30:45.706608 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m01:30:45.707058 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m01:30:45.715619 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m01:30:45.716621 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m01:30:45.717127 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.720314 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m01:30:45.720955 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_patients
[0m01:30:45.722095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics._hospital_patients)
[0m01:30:45.735159 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_visits
[0m01:30:45.765922 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m01:30:45.747848 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctors
[0m01:30:45.766508 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m01:30:45.767218 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics.doctors)
[0m01:30:45.741659 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m01:30:45.773543 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m01:30:45.774911 [debug] [Thread-4 (]: Began running node model.hospital_analytics.medicines
[0m01:30:45.775759 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctors
[0m01:30:45.778772 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m01:30:45.779839 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.medicines'
[0m01:30:45.782776 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m01:30:45.783754 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_visits
[0m01:30:45.784235 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_patients
[0m01:30:45.784718 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.medicines
[0m01:30:45.785454 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:45.785764 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctors
[0m01:30:45.786262 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.788703 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m01:30:45.790677 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_visits
[0m01:30:45.791180 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:45.792847 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_patients
[0m01:30:45.795141 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctors
[0m01:30:45.795469 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.medicines
[0m01:30:45.796408 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:30:45.798012 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.medicines
[0m01:30:45.798956 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m01:30:45.799281 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m01:30:45.799643 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m01:30:45.801863 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m01:30:45.802750 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:30:45.803773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m01:30:45.804098 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:30:45.816742 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m01:30:45.818604 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:30:45.819525 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m01:30:45.819968 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:30:45.820563 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m01:30:45.820835 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:30:45.821295 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:45.821695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.822254 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:30:45.823287 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m01:30:45.826237 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m01:30:45.827722 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m01:30:45.834743 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m01:30:45.835938 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:30:45.838654 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:30:45.841772 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:30:45.842213 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m01:30:45.846572 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m01:30:45.847373 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m01:30:45.849714 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:45.850488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m01:30:45.850946 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:30:45.851289 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:30:45.852983 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m01:30:45.853744 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m01:30:45.861347 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:30:45.863475 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m01:30:45.864115 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m01:30:45.869683 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m01:30:45.873676 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m01:30:45.874538 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:30:45.875102 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.visits_enhanced)
[0m01:30:45.877559 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m01:30:45.876695 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m01:30:45.877182 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:45.876287 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:30:45.880961 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m01:30:45.881616 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.883885 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m01:30:45.884512 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.not_null_patients_age.8fed007e09)
[0m01:30:45.887183 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m01:30:45.887723 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:30:45.888076 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m01:30:45.888699 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:30:45.889139 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:30:45.889560 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_full_name.7bac40f23c)
[0m01:30:45.889960 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:45.893207 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_age.8fed007e09"
[0m01:30:45.893746 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9)
[0m01:30:45.894214 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:30:45.897385 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m01:30:45.898477 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:30:45.898938 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:30:45.903143 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_full_name.7bac40f23c"
[0m01:30:45.904362 [debug] [Thread-3 (]: Began running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:30:45.905554 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:30:45.910495 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9"
[0m01:30:45.911079 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a)
[0m01:30:45.916080 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:30:45.912218 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:30:45.915205 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m01:30:45.911492 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:30:45.924075 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:45.921060 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a"
[0m01:30:45.923656 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m01:30:45.923253 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.927285 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m01:30:45.929983 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_age.8fed007e09, now model.hospital_analytics.billing_enhanced)
[0m01:30:45.931880 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:30:45.935009 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m01:30:45.935860 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m01:30:45.936637 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m01:30:45.937320 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:45.939442 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m01:30:45.939891 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_full_name.7bac40f23c, now model.hospital_analytics.doctor_performance)
[0m01:30:45.942731 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m01:30:45.947410 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m01:30:45.947918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9, now model.hospital_analytics.monthly_visit_stats)
[0m01:30:45.949034 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m01:30:45.950218 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:30:45.952087 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m01:30:45.952441 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m01:30:45.960100 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m01:30:45.960843 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m01:30:45.963366 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m01:30:45.964888 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:30:45.965539 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:30:45.966274 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m01:30:45.966708 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.doctor_performance
[0m01:30:45.973619 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m01:30:45.974105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:45.976307 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m01:30:45.977682 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:45.979541 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:30:45.981373 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m01:30:45.981917 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:30:45.984315 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m01:30:45.989052 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m01:30:45.985060 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m01:30:45.988620 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:45.987049 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:30:45.989444 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctor_performance, now model.hospital_analytics.patient_journey)
[0m01:30:45.989829 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:30:45.990431 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m01:30:45.991959 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m01:30:45.992633 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m01:30:45.996258 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m01:30:45.996836 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:30:45.998463 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m01:30:46.002788 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m01:30:46.006211 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m01:30:46.006714 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:30:46.007117 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_spending_analysis)
[0m01:30:46.007733 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m01:30:46.008168 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:30:46.008576 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:30:46.008945 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m01:30:46.009633 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:30:46.010580 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:30:46.013396 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m01:30:46.016817 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m01:30:46.018403 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m01:30:46.019740 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m01:30:46.020776 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m01:30:46.022150 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:30:46.024921 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m01:30:46.027874 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:30:46.028131 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m01:30:46.028287 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m01:30:46.028415 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m01:30:46.028531 [debug] [MainThread]: Connection 'test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c' was properly closed.
[0m01:30:46.030137 [debug] [MainThread]: Command end result
[0m01:30:46.108655 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m01:30:46.108904 [info ] [MainThread]: Building catalog
[0m01:30:46.114788 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:30:46.132758 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:30:46.133802 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:30:46.134847 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:30:46.137288 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_analytics`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:30:46.138195 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m01:30:46.138728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:46.143627 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_staging`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:30:46.147168 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:46.150606 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_intermediate`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m01:30:46.189658 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:46.239700 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:46.845984 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ecfa6e99-161e-4d15-a406-26cfe9b497a5&page=queryresults
[0m01:30:46.855997 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:a585cab5-2280-46f3-9e13-7746bf988aa1&page=queryresults
[0m01:30:47.130576 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9dcadf8b-7750-487f-87af-2c91f0efc192&page=queryresults
[0m01:30:47.156171 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5e0ccade-2c56-469b-be89-58ed460d2b1c&page=queryresults
[0m01:30:48.494605 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:30:48.525001 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m01:30:48.526128 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 4.8153505, "process_in_blocks": "0", "process_kernel_time": 0.622482, "process_mem_max_rss": "209388", "process_out_blocks": "5728", "process_user_time": 3.444205}
[0m01:30:48.526529 [debug] [MainThread]: Command `dbt docs generate` succeeded at 01:30:48.526458 after 4.82 seconds
[0m01:30:48.526724 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m01:30:48.527407 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:30:48.527744 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:30:48.527882 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:30:48.528672 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m01:30:48.528878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f60494b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f60746650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728f83c99390>]}
[0m01:30:48.532201 [debug] [MainThread]: Flushing usage events
[0m01:30:53.739109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf73549250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf73549390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf7354b650>]}


============================== 01:30:53.741216 | 812dc29b-3996-41a3-a06d-2fc94c4a60f3 ==============================
[0m01:30:53.741216 [info ] [MainThread]: Running with dbt=1.8.9
[0m01:30:53.742044 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:30:54.361876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '812dc29b-3996-41a3-a06d-2fc94c4a60f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf4f784b90>]}
[0m01:30:54.404344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '812dc29b-3996-41a3-a06d-2fc94c4a60f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf752de910>]}
[0m01:33:56.840038 [error] [MainThread]: Encountered an error:

[0m01:33:56.842395 [error] [MainThread]: Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.11/socketserver.py", line 233, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m01:33:56.844168 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_success": false, "command_wall_clock_time": 183.13905, "process_in_blocks": "0", "process_kernel_time": 0.375053, "process_mem_max_rss": "196036", "process_out_blocks": "2976", "process_user_time": 2.102274}
[0m01:33:56.844826 [debug] [MainThread]: Command `dbt docs serve` failed at 01:33:56.844716 after 183.14 seconds
[0m01:33:56.845199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf73548a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf76ef95d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ecf738dd550>]}
[0m01:33:56.845460 [debug] [MainThread]: Flushing usage events
[0m07:14:39.373962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b46a004210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b46a3987d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b46a004710>]}


============================== 07:14:39.391630 | 7a6443ef-7841-4edd-bef4-8c4bcac0e27a ==============================
[0m07:14:39.391630 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:14:39.394737 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:14:39.562197 [info ] [MainThread]: dbt version: 1.8.9
[0m07:14:39.563084 [info ] [MainThread]: python version: 3.11.2
[0m07:14:39.563283 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:14:39.563435 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m07:14:41.570818 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:14:41.571685 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:14:41.571869 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:14:41.572004 [info ] [MainThread]: adapter type: bigquery
[0m07:14:41.572256 [info ] [MainThread]: adapter version: 1.9.0
[0m07:14:41.773103 [info ] [MainThread]: Configuration:
[0m07:14:41.773814 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:14:41.774615 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:14:41.774864 [info ] [MainThread]: Required dependencies:
[0m07:14:41.775247 [debug] [MainThread]: Executing "git --help"
[0m07:14:41.782661 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:14:41.783748 [debug] [MainThread]: STDERR: "b''"
[0m07:14:41.783939 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:14:41.784092 [info ] [MainThread]: Connection:
[0m07:14:41.793601 [info ] [MainThread]:   method: service-account
[0m07:14:41.799106 [info ] [MainThread]:   database: dataeng-2025-gar
[0m07:14:41.799297 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m07:14:41.799420 [info ] [MainThread]:   schema: hospital
[0m07:14:41.800777 [info ] [MainThread]:   location: asia-southeast2
[0m07:14:41.800979 [info ] [MainThread]:   priority: interactive
[0m07:14:41.801127 [info ] [MainThread]:   maximum_bytes_billed: None
[0m07:14:41.801244 [info ] [MainThread]:   impersonate_service_account: None
[0m07:14:41.802406 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m07:14:41.802616 [info ] [MainThread]:   job_retries: 1
[0m07:14:41.803755 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m07:14:41.803923 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m07:14:41.804064 [info ] [MainThread]:   timeout_seconds: 300
[0m07:14:41.804185 [info ] [MainThread]:   client_id: None
[0m07:14:41.805377 [info ] [MainThread]:   token_uri: None
[0m07:14:41.805554 [info ] [MainThread]:   dataproc_region: None
[0m07:14:41.813373 [info ] [MainThread]:   dataproc_cluster_name: None
[0m07:14:41.823037 [info ] [MainThread]:   gcs_bucket: None
[0m07:14:41.823406 [info ] [MainThread]:   dataproc_batch: None
[0m07:14:41.823684 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:14:42.143931 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m07:14:42.144242 [debug] [MainThread]: On debug: select 1 as id
[0m07:14:42.144587 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:14:42.670258 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:cba399b6-1b43-4c31-913b-7f4063e707ff&page=queryresults
[0m07:14:43.103737 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:14:43.104097 [info ] [MainThread]: [32mAll checks passed![0m
[0m07:14:43.118617 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 3.9054747, "process_in_blocks": "3200", "process_kernel_time": 1.675283, "process_mem_max_rss": "201044", "process_out_blocks": "24", "process_user_time": 4.543029}
[0m07:14:43.119071 [debug] [MainThread]: Command `dbt debug` succeeded at 07:14:43.118991 after 3.91 seconds
[0m07:14:43.120490 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:14:43.120720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b4460ce990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b46be77610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b46d830e10>]}
[0m07:14:43.123232 [debug] [MainThread]: Flushing usage events
[0m07:14:47.347342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a4834750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a4bccf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a4873950>]}


============================== 07:14:47.356121 | 8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e ==============================
[0m07:14:47.356121 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:14:47.358378 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:14:48.663048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762284b27d90>]}
[0m07:14:48.954382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a65f2cd0>]}
[0m07:14:48.955860 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:14:49.264449 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:14:50.097184 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:14:50.097485 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:14:50.297848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762284889350>]}
[0m07:14:50.580325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622851c9350>]}
[0m07:14:50.582476 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:14:50.582787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762285617f10>]}
[0m07:14:50.584410 [info ] [MainThread]: 
[0m07:14:50.584990 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:14:50.588713 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:14:50.589033 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:14:50.589757 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:14:50.615480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:14:50.618676 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:14:50.643567 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:14:51.566968 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:14:51.567653 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:14:51.588574 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:14:51.588958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:14:51.589825 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:14:51.671516 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:14:52.299851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76228494dd90>]}
[0m07:14:52.300482 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:14:52.301833 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:14:52.302185 [info ] [MainThread]: 
[0m07:14:52.340771 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:14:52.341235 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:14:52.346936 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:14:52.348830 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:14:52.363353 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:14:52.373821 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:14:52.374576 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:14:52.376505 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m07:14:52.377042 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:14:52.386221 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:14:52.420421 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:14:52.389415 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:14:52.438829 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:14:52.419102 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:14:52.470517 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:14:52.524268 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:14:52.477031 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:14:52.492101 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:14:52.579552 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:14:52.580812 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:14:52.598547 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:14:52.608696 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:14:52.610092 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:14:52.625881 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:14:52.628560 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:14:52.656609 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:14:52.657909 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:14:52.647632 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:14:52.652141 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:14:52.725991 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:14:52.734897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:14:52.744934 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:14:52.815333 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:14:52.994820 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:14:53.572249 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:14:53.580348 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:14:53.631426 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:d6ba4477-9e09-48d6-8cef-0799e739e20b&page=queryresults
[0m07:14:53.792174 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:cf2251a4-fea0-4edb-895c-f58b247caeb9&page=queryresults
[0m07:14:53.816098 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:88efd30f-b802-497e-816f-d9a3439730f3&page=queryresults
[0m07:14:53.927170 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5695b09c-c4a4-4073-b267-397920fc1f92&page=queryresults
[0m07:14:54.047530 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5695b09c-c4a4-4073-b267-397920fc1f92&page=queryresults
[0m07:14:54.569540 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:14:54.636905 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a48a95d0>]}
[0m07:14:54.637646 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 2.13s]
[0m07:14:54.638143 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:14:54.639682 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762284297e10>]}
[0m07:14:54.643192 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.26s]
[0m07:14:54.643681 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:14:54.641680 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622843b7650>]}
[0m07:14:54.657047 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.17s]
[0m07:14:54.657514 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:14:54.644761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76228d35bf50>]}
[0m07:14:54.671250 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m07:14:54.694287 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.30s]
[0m07:14:54.720360 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:14:54.715655 [info ] [Thread-4 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:14:54.727748 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.patients)
[0m07:14:54.728119 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m07:14:54.731782 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:14:54.732830 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m07:14:54.735889 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:14:54.906641 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:14:54.908245 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:14:54.928249 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m07:14:54.928590 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:14:54.942561 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:14:54.945146 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:14:54.955996 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:14:55.399782 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:14:55.411203 [debug] [Thread-4 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:14:55.498281 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:14:55.500235 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:14:56.057551 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:cbf98325-bb82-4da5-9286-ecc389cb2fb9&page=queryresults
[0m07:14:56.297830 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:863b9d18-a127-42d0-b69d-1c8655982ad5&page=queryresults
[0m07:14:57.635557 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622841faf90>]}
[0m07:14:57.637981 [info ] [Thread-4 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.91s]
[0m07:14:57.652904 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m07:14:57.679174 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f6c37f7-7e3f-4f5e-a3e0-97b6ce6f057e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x762284336810>]}
[0m07:14:57.684803 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.75s]
[0m07:14:57.685273 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:14:57.722816 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:14:57.725572 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:14:57.726059 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:14:57.726395 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:14:57.727749 [info ] [Thread-1 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:14:57.732688 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:14:57.789905 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:14:57.792489 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:14:57.791351 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:14:57.835514 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:14:57.824888 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:14:57.838223 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m07:14:57.834607 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:14:57.835947 [info ] [Thread-1 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:14:57.848396 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:14:57.838782 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:14:57.846824 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:14:57.848051 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:14:57.849007 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:14:57.868806 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:14:57.976436 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:14:57.991434 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:14:57.993079 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:14:57.993415 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:14:57.993602 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:14:57.993730 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m07:14:57.993849 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:14:57.994094 [info ] [MainThread]: 
[0m07:14:57.994847 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 7.41 seconds (7.41s).
[0m07:14:57.997657 [debug] [MainThread]: Command end result
[0m07:14:58.200955 [info ] [MainThread]: 
[0m07:14:58.210595 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:14:58.215102 [info ] [MainThread]: 
[0m07:14:58.215384 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:14:58.215555 [info ] [MainThread]: 
[0m07:14:58.215705 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:14:58.217275 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 10.924487, "process_in_blocks": "4144", "process_kernel_time": 2.224263, "process_mem_max_rss": "209972", "process_out_blocks": "2456", "process_user_time": 4.028027}
[0m07:14:58.224057 [debug] [MainThread]: Command `dbt run` failed at 07:14:58.223897 after 10.93 seconds
[0m07:14:58.225272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a8209390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a8209350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7622a8208a50>]}
[0m07:14:58.226462 [debug] [MainThread]: Flushing usage events
[0m07:17:38.756367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9f4076b8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9f407aac10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9f407abbd0>]}


============================== 07:17:38.780180 | 28910301-c5cc-43a1-ae3e-d5d1c7968af0 ==============================
[0m07:17:38.780180 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:17:38.782220 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:17:38.812612 [info ] [MainThread]: dbt version: 1.8.9
[0m07:17:38.812949 [info ] [MainThread]: python version: 3.11.2
[0m07:17:38.813300 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:17:38.813974 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m07:17:40.604375 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:17:40.606697 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:17:40.606910 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:17:40.607051 [info ] [MainThread]: adapter type: bigquery
[0m07:17:40.607170 [info ] [MainThread]: adapter version: 1.9.0
[0m07:17:40.819472 [info ] [MainThread]: Configuration:
[0m07:17:40.820000 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:17:40.820369 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:17:40.820528 [info ] [MainThread]: Required dependencies:
[0m07:17:40.820972 [debug] [MainThread]: Executing "git --help"
[0m07:17:40.823911 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:17:40.824526 [debug] [MainThread]: STDERR: "b''"
[0m07:17:40.824745 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:17:40.824977 [info ] [MainThread]: Connection:
[0m07:17:40.825156 [info ] [MainThread]:   method: service-account
[0m07:17:40.826078 [info ] [MainThread]:   database: dataeng-2025-gar
[0m07:17:40.826501 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m07:17:40.826745 [info ] [MainThread]:   schema: hospital
[0m07:17:40.826924 [info ] [MainThread]:   location: asia-southeast2
[0m07:17:40.827177 [info ] [MainThread]:   priority: interactive
[0m07:17:40.827563 [info ] [MainThread]:   maximum_bytes_billed: None
[0m07:17:40.827852 [info ] [MainThread]:   impersonate_service_account: None
[0m07:17:40.828106 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m07:17:40.828452 [info ] [MainThread]:   job_retries: 1
[0m07:17:40.828635 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m07:17:40.829134 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m07:17:40.829614 [info ] [MainThread]:   timeout_seconds: 300
[0m07:17:40.829980 [info ] [MainThread]:   client_id: None
[0m07:17:40.830205 [info ] [MainThread]:   token_uri: None
[0m07:17:40.830374 [info ] [MainThread]:   dataproc_region: None
[0m07:17:40.832218 [info ] [MainThread]:   dataproc_cluster_name: None
[0m07:17:40.832400 [info ] [MainThread]:   gcs_bucket: None
[0m07:17:40.835315 [info ] [MainThread]:   dataproc_batch: None
[0m07:17:40.842038 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:17:41.192541 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m07:17:41.193832 [debug] [MainThread]: On debug: select 1 as id
[0m07:17:41.194156 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:17:41.976958 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:d43c62ac-d9ab-40e5-af65-9d9cc7ab9c77&page=queryresults
[0m07:17:42.268088 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:17:42.270095 [info ] [MainThread]: [32mAll checks passed![0m
[0m07:17:42.270698 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 3.5588472, "process_in_blocks": "0", "process_kernel_time": 1.216486, "process_mem_max_rss": "201364", "process_out_blocks": "24", "process_user_time": 2.928414}
[0m07:17:42.272108 [debug] [MainThread]: Command `dbt debug` succeeded at 07:17:42.271999 after 3.56 seconds
[0m07:17:42.276114 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:17:42.276432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9f40796290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9f21086490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9f440b4b90>]}
[0m07:17:42.280827 [debug] [MainThread]: Flushing usage events
[0m07:17:47.902546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785510f644d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7855112fcf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785510fa3110>]}


============================== 07:17:47.905069 | dd2c4415-01b9-43d8-90f3-b4923935758b ==============================
[0m07:17:47.905069 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:17:47.905490 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:17:49.118445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f12afd90>]}
[0m07:17:49.244816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785512d263d0>]}
[0m07:17:49.251001 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:17:49.858789 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:17:50.341799 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:17:50.342119 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:17:50.498585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f0f31ed0>]}
[0m07:17:51.028246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f1169010>]}
[0m07:17:51.028788 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:17:51.029561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f126e050>]}
[0m07:17:51.040309 [info ] [MainThread]: 
[0m07:17:51.043952 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:17:51.063952 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:17:51.064802 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:51.092224 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:17:51.093018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:51.093908 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:17:51.095675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:51.973072 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:17:51.975806 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:52.000039 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:17:52.000942 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:17:52.002080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:52.002586 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:52.417899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f0ff23d0>]}
[0m07:17:52.418336 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:17:52.421673 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:17:52.422434 [info ] [MainThread]: 
[0m07:17:52.433687 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:17:52.434696 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:17:52.436097 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:17:52.435312 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:17:52.439031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m07:17:52.439257 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:17:52.446585 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:17:52.449655 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:17:52.437870 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:17:52.450616 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:17:52.451334 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:17:52.438474 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:17:52.447035 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:17:52.522088 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:17:52.524346 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:17:52.527827 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:17:52.526688 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:17:52.527279 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:17:52.551117 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:17:52.540789 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:17:52.556209 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:17:52.550225 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:17:52.627879 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:17:52.653799 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:17:52.819765 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:17:52.841659 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:17:52.851197 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:17:52.852667 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:17:53.018975 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:17:53.036164 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:17:53.020100 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:17:53.057502 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:17:53.216800 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:17:53.217168 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:17:53.714084 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5c21c3ce-e4b5-401c-9884-8ac653e6e446&page=queryresults
[0m07:17:53.820210 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:17:53.820992 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:17:53.850317 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c9841623-d779-472b-8725-13119c92bc73&page=queryresults
[0m07:17:53.926388 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:488ab06f-fa66-44d2-8437-adccd3c43f4c&page=queryresults
[0m07:17:54.033117 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f12b9bd0>]}
[0m07:17:54.033589 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.59s]
[0m07:17:54.034660 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:17:54.036403 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m07:17:54.037129 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:17:54.037702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m07:17:54.038082 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m07:17:54.041006 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:17:54.041477 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m07:17:54.043184 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:17:54.071030 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f129e750>]}
[0m07:17:54.071986 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.62s]
[0m07:17:54.072787 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:17:54.076182 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f5f80335-9417-42ca-ada6-d7f562d48a67&page=queryresults
[0m07:17:54.079629 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m07:17:54.080561 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:17:54.081837 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m07:17:54.082620 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m07:17:54.085199 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:17:54.086933 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m07:17:54.088720 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:17:54.142747 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f5f80335-9417-42ca-ada6-d7f562d48a67&page=queryresults
[0m07:17:54.163191 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f1231fd0>]}
[0m07:17:54.168974 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.64s]
[0m07:17:54.170722 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:17:54.174049 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:17:54.174567 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f0131990>]}
[0m07:17:54.174983 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 1.65s]
[0m07:17:54.175382 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:17:54.379970 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:17:54.380620 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:17:54.396012 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:17:54.396818 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:17:55.192342 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c79ae6e7-66bc-4eae-bb7f-952dea6c0a5f&page=queryresults
[0m07:17:55.193513 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f024ab1d-1c6c-4e73-a0d9-ad4ddb4dfe70&page=queryresults
[0m07:17:56.640768 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f0ef7990>]}
[0m07:17:56.649245 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.56s]
[0m07:17:56.651850 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m07:17:56.652235 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd2c4415-01b9-43d8-90f3-b4923935758b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7854f224f750>]}
[0m07:17:56.698022 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.61s]
[0m07:17:56.704469 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m07:17:56.713761 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:17:56.715301 [info ] [Thread-3 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:17:56.739457 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:17:56.778830 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:17:56.778084 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:17:56.812245 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:17:56.856857 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:17:56.857763 [info ] [Thread-1 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:17:56.858290 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:17:56.858944 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:17:56.859573 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:17:56.861791 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:17:56.865066 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:17:56.876805 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m07:17:56.878678 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:17:56.870069 [info ] [Thread-3 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:17:56.882998 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:17:56.877170 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:17:56.890369 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:17:56.878958 [info ] [Thread-4 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:17:56.893169 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:17:56.935764 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:17:56.937742 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:17:56.938053 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:17:56.940053 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:17:56.940251 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m07:17:56.940381 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:17:56.940940 [info ] [MainThread]: 
[0m07:17:56.944533 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 5.90 seconds (5.90s).
[0m07:17:56.958267 [debug] [MainThread]: Command end result
[0m07:17:57.060284 [info ] [MainThread]: 
[0m07:17:57.066549 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:17:57.068462 [info ] [MainThread]: 
[0m07:17:57.069535 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:17:57.069832 [info ] [MainThread]: 
[0m07:17:57.070022 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:17:57.070878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.203767, "process_in_blocks": "0", "process_kernel_time": 1.897158, "process_mem_max_rss": "209996", "process_out_blocks": "2456", "process_user_time": 5.263909}
[0m07:17:57.072050 [debug] [MainThread]: Command `dbt run` failed at 07:17:57.071675 after 9.20 seconds
[0m07:17:57.074058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785514aad850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785514939490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785514938a10>]}
[0m07:17:57.075105 [debug] [MainThread]: Flushing usage events
[0m07:20:35.078385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba543c19c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba544fee610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba543c5a910>]}


============================== 07:20:35.080839 | 86552aa8-7af8-41ed-9624-39427237d61c ==============================
[0m07:20:35.080839 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:20:35.085004 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:20:35.117773 [info ] [MainThread]: dbt version: 1.8.9
[0m07:20:35.119925 [info ] [MainThread]: python version: 3.11.2
[0m07:20:35.120126 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:20:35.122195 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m07:20:36.499627 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:20:36.512443 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:20:36.515562 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:20:36.518156 [info ] [MainThread]: adapter type: bigquery
[0m07:20:36.520910 [info ] [MainThread]: adapter version: 1.9.0
[0m07:20:36.776735 [info ] [MainThread]: Configuration:
[0m07:20:36.778739 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:20:36.778921 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:20:36.779054 [info ] [MainThread]: Required dependencies:
[0m07:20:36.779192 [debug] [MainThread]: Executing "git --help"
[0m07:20:36.799035 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:20:36.804198 [debug] [MainThread]: STDERR: "b''"
[0m07:20:36.804389 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:20:36.806735 [info ] [MainThread]: Connection:
[0m07:20:36.806935 [info ] [MainThread]:   method: service-account
[0m07:20:36.807065 [info ] [MainThread]:   database: dataeng-2025-gar
[0m07:20:36.807176 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m07:20:36.807281 [info ] [MainThread]:   schema: hospital
[0m07:20:36.808536 [info ] [MainThread]:   location: asia-southeast2
[0m07:20:36.808678 [info ] [MainThread]:   priority: interactive
[0m07:20:36.808797 [info ] [MainThread]:   maximum_bytes_billed: None
[0m07:20:36.812156 [info ] [MainThread]:   impersonate_service_account: None
[0m07:20:36.812352 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m07:20:36.814568 [info ] [MainThread]:   job_retries: 1
[0m07:20:36.817384 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m07:20:36.817541 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m07:20:36.817661 [info ] [MainThread]:   timeout_seconds: 300
[0m07:20:36.817772 [info ] [MainThread]:   client_id: None
[0m07:20:36.820904 [info ] [MainThread]:   token_uri: None
[0m07:20:36.821051 [info ] [MainThread]:   dataproc_region: None
[0m07:20:36.821167 [info ] [MainThread]:   dataproc_cluster_name: None
[0m07:20:36.821310 [info ] [MainThread]:   gcs_bucket: None
[0m07:20:36.821423 [info ] [MainThread]:   dataproc_batch: None
[0m07:20:36.821652 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:20:37.107265 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m07:20:37.107665 [debug] [MainThread]: On debug: select 1 as id
[0m07:20:37.107890 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:20:37.810531 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:51aeda63-7d57-4a0f-8635-f37bd0d47a73&page=queryresults
[0m07:20:38.298059 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:20:38.303892 [info ] [MainThread]: [32mAll checks passed![0m
[0m07:20:38.305498 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 3.2921693, "process_in_blocks": "0", "process_kernel_time": 1.47535, "process_mem_max_rss": "201576", "process_out_blocks": "24", "process_user_time": 3.281565}
[0m07:20:38.306955 [debug] [MainThread]: Command `dbt debug` succeeded at 07:20:38.306859 after 3.29 seconds
[0m07:20:38.307175 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:20:38.307384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba543d388d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba51fd303d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba54745cd50>]}
[0m07:20:38.309671 [debug] [MainThread]: Flushing usage events
[0m07:20:45.442068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0457577a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0457574990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0457576a50>]}


============================== 07:20:45.446969 | c51db29b-9491-410c-907c-f5932531d3b8 ==============================
[0m07:20:45.446969 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:20:45.449044 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m07:20:45.732059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c51db29b-9491-410c-907c-f5932531d3b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f04575c1290>]}
[0m07:20:46.009825 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.81928796, "process_in_blocks": "344", "process_kernel_time": 0.815975, "process_mem_max_rss": "89324", "process_out_blocks": "8", "process_user_time": 2.637061}
[0m07:20:46.013091 [debug] [MainThread]: Command `dbt clean` succeeded at 07:20:46.012170 after 0.82 seconds
[0m07:20:46.014232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f04575c3e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0457730a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f045adf4dd0>]}
[0m07:20:46.014562 [debug] [MainThread]: Flushing usage events
[0m07:20:50.918912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba57ef8050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba57f375d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba57ef9bd0>]}


============================== 07:20:50.949195 | fef19a00-2990-4d6a-8e3b-6dcf7728650a ==============================
[0m07:20:50.949195 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:20:50.950600 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:20:53.117548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba381df610>]}
[0m07:20:53.264297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba593c3dd0>]}
[0m07:20:53.266682 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:20:53.579019 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:20:53.590869 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:20:53.593796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba396f0e10>]}
[0m07:20:56.598364 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:20:56.601769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba33ece190>]}
[0m07:20:57.588876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba33d72e10>]}
[0m07:20:57.773117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba32961450>]}
[0m07:20:57.773605 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:20:57.773961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba33dc2a90>]}
[0m07:20:57.780124 [info ] [MainThread]: 
[0m07:20:57.781313 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:20:57.787582 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:20:57.788227 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:20:57.835130 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:20:57.838007 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:20:57.958301 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:20:57.990815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:20:59.069902 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:20:59.070348 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:20:59.175206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:20:59.175760 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:20:59.294005 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:20:59.295122 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:20:59.913551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba3825a0d0>]}
[0m07:20:59.914931 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:20:59.925088 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:20:59.928188 [info ] [MainThread]: 
[0m07:21:00.004943 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:21:00.005951 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:21:00.006687 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:21:00.007161 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:21:00.014817 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:21:00.025569 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:21:00.015583 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:21:00.085461 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:21:00.092595 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:21:00.098138 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:21:00.104341 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:21:00.116177 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:21:00.172262 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:21:00.163136 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:21:00.171173 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:21:00.150518 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:21:00.211350 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:21:00.220982 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:21:00.237990 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:21:00.313761 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:21:00.316329 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:21:00.332247 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:21:00.339127 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:21:00.339908 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:21:00.340734 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:21:00.343392 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:21:00.354877 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:21:00.360738 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:21:00.365267 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:21:00.368651 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:21:00.369133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:21:00.399235 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:21:00.399853 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:21:00.605302 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:21:01.374758 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:21:01.375288 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:21:01.425064 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:bab788bb-9dd4-4c26-a603-34b4c90e6da2&page=queryresults
[0m07:21:01.437708 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1c95564f-e147-4118-9ce4-de58d801e254&page=queryresults
[0m07:21:01.444200 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c4d4aa39-adfd-482c-94f9-c6de1d09f017&page=queryresults
[0m07:21:01.683338 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c0e09a80-5988-4828-b059-c580f818886e&page=queryresults
[0m07:21:01.774754 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c0e09a80-5988-4828-b059-c580f818886e&page=queryresults
[0m07:21:01.915468 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:21:01.926264 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7db9facbc150>]}
[0m07:21:01.946133 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 1.75s]
[0m07:21:01.932424 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba32cb3290>]}
[0m07:21:01.951010 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:21:01.988011 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba33d19c90>]}
[0m07:21:02.048369 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba328fc110>]}
[0m07:21:02.015481 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.89s]
[0m07:21:02.065021 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.95s]
[0m07:21:02.060594 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.76s]
[0m07:21:02.088878 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:21:02.080820 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:21:02.098829 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:21:02.151383 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m07:21:02.174838 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:21:02.161971 [info ] [Thread-4 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:21:02.197364 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.patients)
[0m07:21:02.201112 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m07:21:02.175283 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:21:02.226310 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m07:21:02.226609 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:21:02.230224 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:21:02.240979 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:21:02.268479 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:21:02.277307 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m07:21:02.291116 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:21:02.301704 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:21:03.003469 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:21:03.008246 [debug] [Thread-4 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:21:02.989479 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:21:03.015640 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:21:03.687294 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:2f28191e-7d7f-4d40-a43e-4d2d8fc46c9e&page=queryresults
[0m07:21:04.158710 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c8856beb-16a1-431e-acd4-bee8d7ad0f34&page=queryresults
[0m07:21:05.425176 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba329868d0>]}
[0m07:21:05.427212 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 3.20s]
[0m07:21:05.429513 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:21:05.641800 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fef19a00-2990-4d6a-8e3b-6dcf7728650a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba33d11210>]}
[0m07:21:05.642350 [info ] [Thread-4 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 3.44s]
[0m07:21:05.646745 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m07:21:05.678405 [debug] [Thread-3 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:21:05.683730 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:21:05.693169 [info ] [Thread-3 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:21:05.697919 [info ] [Thread-1 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:21:05.711186 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:21:05.712925 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:21:05.709612 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:21:05.713925 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:21:05.713300 [info ] [Thread-4 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:21:05.783427 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:21:05.787746 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:21:05.751434 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:21:05.822115 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:21:05.802579 [info ] [Thread-1 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:21:05.823797 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:21:05.848914 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_journey
[0m07:21:05.858318 [info ] [Thread-3 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:21:05.863653 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:21:05.864171 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:21:05.864444 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:21:05.884919 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:21:05.917320 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:21:05.926145 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:21:05.932432 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:21:05.937669 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m07:21:05.937889 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:21:05.938026 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:21:05.938283 [info ] [MainThread]: 
[0m07:21:05.945468 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 8.16 seconds (8.16s).
[0m07:21:05.971601 [debug] [MainThread]: Command end result
[0m07:21:06.073696 [info ] [MainThread]: 
[0m07:21:06.076544 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:21:06.076775 [info ] [MainThread]: 
[0m07:21:06.077823 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:21:06.079940 [info ] [MainThread]: 
[0m07:21:06.084438 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:21:06.085311 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.204475, "process_in_blocks": "0", "process_kernel_time": 2.906144, "process_mem_max_rss": "216176", "process_out_blocks": "3528", "process_user_time": 8.066146}
[0m07:21:06.085638 [debug] [MainThread]: Command `dbt run` failed at 07:21:06.085572 after 15.20 seconds
[0m07:21:06.085867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba5844ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba5b8993d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dba5b899290>]}
[0m07:21:06.086067 [debug] [MainThread]: Flushing usage events
[0m07:26:55.541646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df594834d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df594837810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df594834b50>]}


============================== 07:26:55.547466 | 85b5f386-46bb-4b7f-850c-cf34d2b8a952 ==============================
[0m07:26:55.547466 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:26:55.549970 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:26:55.561290 [info ] [MainThread]: dbt version: 1.8.9
[0m07:26:55.562959 [info ] [MainThread]: python version: 3.11.2
[0m07:26:55.563144 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:26:55.564363 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m07:26:57.823403 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:26:57.854869 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:26:57.857993 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:26:57.859209 [info ] [MainThread]: adapter type: bigquery
[0m07:26:57.861125 [info ] [MainThread]: adapter version: 1.9.0
[0m07:26:58.038157 [info ] [MainThread]: Configuration:
[0m07:26:58.038693 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:26:58.039149 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:26:58.039506 [info ] [MainThread]: Required dependencies:
[0m07:26:58.039927 [debug] [MainThread]: Executing "git --help"
[0m07:26:58.042849 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:26:58.043565 [debug] [MainThread]: STDERR: "b''"
[0m07:26:58.043738 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:26:58.043978 [info ] [MainThread]: Connection:
[0m07:26:58.044430 [info ] [MainThread]:   method: service-account
[0m07:26:58.044816 [info ] [MainThread]:   database: dataeng-2025-gar
[0m07:26:58.045148 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m07:26:58.045283 [info ] [MainThread]:   schema: hospital
[0m07:26:58.045573 [info ] [MainThread]:   location: asia-southeast2
[0m07:26:58.045754 [info ] [MainThread]:   priority: interactive
[0m07:26:58.045954 [info ] [MainThread]:   maximum_bytes_billed: None
[0m07:26:58.046139 [info ] [MainThread]:   impersonate_service_account: None
[0m07:26:58.046398 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m07:26:58.046589 [info ] [MainThread]:   job_retries: 1
[0m07:26:58.046935 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m07:26:58.047138 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m07:26:58.047320 [info ] [MainThread]:   timeout_seconds: 300
[0m07:26:58.047757 [info ] [MainThread]:   client_id: None
[0m07:26:58.047898 [info ] [MainThread]:   token_uri: None
[0m07:26:58.048099 [info ] [MainThread]:   dataproc_region: None
[0m07:26:58.048584 [info ] [MainThread]:   dataproc_cluster_name: None
[0m07:26:58.048714 [info ] [MainThread]:   gcs_bucket: None
[0m07:26:58.048824 [info ] [MainThread]:   dataproc_batch: None
[0m07:26:58.049350 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:26:58.271447 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m07:26:58.272830 [debug] [MainThread]: On debug: select 1 as id
[0m07:26:58.273132 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:26:58.855665 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9f1aa6be-3baa-4eaf-8ec3-c545cb6bac5f&page=queryresults
[0m07:26:59.183560 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:26:59.184232 [info ] [MainThread]: [32mAll checks passed![0m
[0m07:26:59.186033 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 3.8756576, "process_in_blocks": "0", "process_kernel_time": 1.548898, "process_mem_max_rss": "200832", "process_out_blocks": "24", "process_user_time": 4.505769}
[0m07:26:59.187800 [debug] [MainThread]: Command `dbt debug` succeeded at 07:26:59.187699 after 3.88 seconds
[0m07:26:59.188025 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:26:59.188248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df574932890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df598084c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df576ec6610>]}
[0m07:26:59.188615 [debug] [MainThread]: Flushing usage events
[0m07:27:04.703755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741026340ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741026383190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741026382c90>]}


============================== 07:27:04.708215 | 5a02238c-2825-4808-9b10-63609e0da8db ==============================
[0m07:27:04.708215 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:27:04.708740 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m07:27:04.895490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5a02238c-2825-4808-9b10-63609e0da8db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741026342050>]}
[0m07:27:04.921814 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.31965372, "process_in_blocks": "0", "process_kernel_time": 0.500666, "process_mem_max_rss": "89516", "process_out_blocks": "8", "process_user_time": 2.42359}
[0m07:27:04.924198 [debug] [MainThread]: Command `dbt clean` succeeded at 07:27:04.924116 after 0.32 seconds
[0m07:27:04.926250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741029b90c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741029d15390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x741029d15350>]}
[0m07:27:04.927336 [debug] [MainThread]: Flushing usage events
[0m07:27:09.635939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df5a6ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df5a4c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df5a5910>]}


============================== 07:27:09.641054 | 06f45f4e-0cb8-4503-afda-8b1242d02ea0 ==============================
[0m07:27:09.641054 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:27:09.642961 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:27:11.403615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df5a4f10>]}
[0m07:27:11.530747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90e1332790>]}
[0m07:27:11.531312 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:27:11.854776 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:27:11.860522 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:27:11.864557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90c37a9dd0>]}
[0m07:27:14.534852 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:27:14.535704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba324f10>]}
[0m07:27:15.287217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba23e750>]}
[0m07:27:15.469435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba384c90>]}
[0m07:27:15.472212 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:27:15.472489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba325fd0>]}
[0m07:27:15.482524 [info ] [MainThread]: 
[0m07:27:15.484130 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:27:15.507028 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:27:15.507329 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:27:15.586689 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:27:15.587179 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:27:15.685557 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:27:15.699857 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:27:16.882013 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:27:16.882704 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:27:16.939493 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:27:16.947641 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:27:17.093383 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:27:17.093708 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:27:17.785151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90bb838490>]}
[0m07:27:17.785588 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:27:17.786848 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:27:17.787245 [info ] [MainThread]: 
[0m07:27:17.873916 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:27:17.874404 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:27:17.886007 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:27:17.898216 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m07:27:17.898568 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:27:17.891042 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:27:17.927102 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m07:27:17.927455 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:27:17.931640 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:27:17.935857 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:27:17.937101 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m07:27:17.937332 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:27:17.955641 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:27:18.008740 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:27:18.019324 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:27:18.013320 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:27:18.115002 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:27:18.017926 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:27:18.009187 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:27:18.149150 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:27:18.308085 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:27:18.260580 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:27:18.422948 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:27:18.423543 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:27:18.424060 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:27:18.496241 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:27:18.678193 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:27:18.695884 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:27:18.703269 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:27:18.713063 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:27:18.709346 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:27:18.703916 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:27:18.801228 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:27:18.842807 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:27:19.484711 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:27:19.486172 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:27:19.553917 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:62f6138f-5632-4afb-8061-acf61c8b905e&page=queryresults
[0m07:27:19.576676 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ed8ca40b-e072-4eda-9591-59f5d396db99&page=queryresults
[0m07:27:19.607058 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:10bdd03e-f08a-470d-81ae-9db64f988719&page=queryresults
[0m07:27:19.792381 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:15f86ff7-1ce6-4cea-8de5-bc19346ee869&page=queryresults
[0m07:27:19.900333 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:15f86ff7-1ce6-4cea-8de5-bc19346ee869&page=queryresults
[0m07:27:19.933346 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:27:19.938387 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba0a2050>]}
[0m07:27:19.939186 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 1.79s]
[0m07:27:19.964581 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:27:20.119182 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba099610>]}
[0m07:27:20.124661 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 2.24s]
[0m07:27:20.144292 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90b82e8410>]}
[0m07:27:20.152308 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.22s]
[0m07:27:20.164632 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:27:20.126029 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:27:20.228283 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba27e2d0>]}
[0m07:27:20.231198 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 2.29s]
[0m07:27:20.238151 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:27:20.240299 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m07:27:20.242212 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:27:20.262152 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m07:27:20.262453 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m07:27:20.283394 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:27:20.297555 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m07:27:20.303010 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:27:20.432375 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:27:20.443241 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:27:20.443649 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m07:27:20.446104 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:27:20.463129 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:27:20.464439 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:27:20.473221 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:27:21.058524 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:27:21.062212 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:27:21.076877 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:27:21.077981 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:27:21.686847 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f0b62582-19ca-454b-8f06-14a56ea3ad16&page=queryresults
[0m07:27:21.708936 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:2be64f77-ef82-4eac-b3b8-5c23007c0c86&page=queryresults
[0m07:27:23.100645 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90b82cb890>]}
[0m07:27:23.102341 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.66s]
[0m07:27:23.106390 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:27:23.125827 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f45f4e-0cb8-4503-afda-8b1242d02ea0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90ba095110>]}
[0m07:27:23.126827 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.86s]
[0m07:27:23.127597 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m07:27:23.135325 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:27:23.136826 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:27:23.135780 [info ] [Thread-4 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:27:23.137162 [info ] [Thread-1 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:27:23.139258 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:27:23.140755 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:27:23.202369 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:27:23.217746 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:27:23.264259 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:27:23.220818 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:27:23.273256 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:27:23.262222 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:27:23.283912 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:27:23.268675 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:27:23.287056 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:27:23.312436 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m07:27:23.318969 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:27:23.313841 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:27:23.353678 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:27:23.319264 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:27:23.355149 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:27:23.371123 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:27:23.374832 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:27:23.375079 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:27:23.375213 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:27:23.376343 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:27:23.376541 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:27:23.376801 [info ] [MainThread]: 
[0m07:27:23.377987 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 7.89 seconds (7.89s).
[0m07:27:23.382002 [debug] [MainThread]: Command end result
[0m07:27:23.496481 [info ] [MainThread]: 
[0m07:27:23.507242 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:27:23.509331 [info ] [MainThread]: 
[0m07:27:23.513675 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:27:23.514038 [info ] [MainThread]: 
[0m07:27:23.514235 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:27:23.519911 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 14.005653, "process_in_blocks": "0", "process_kernel_time": 2.463232, "process_mem_max_rss": "215928", "process_out_blocks": "3528", "process_user_time": 8.563095}
[0m07:27:23.520399 [debug] [MainThread]: Command `dbt run` failed at 07:27:23.520305 after 14.01 seconds
[0m07:27:23.522694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df5e3290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df938890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c90df5a5b50>]}
[0m07:27:23.522985 [debug] [MainThread]: Flushing usage events
[0m07:29:04.833762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31e9c21c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31e9c5f950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31e9c20750>]}


============================== 07:29:04.837098 | 1a7cdacb-b4f9-4512-8428-3efea8edfc4a ==============================
[0m07:29:04.837098 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:29:04.838166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:29:05.495832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5f86d10>]}
[0m07:29:05.526551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31eb9e2050>]}
[0m07:29:05.527087 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:29:05.779903 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:29:05.856550 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:29:05.856845 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:29:05.891360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c659c110>]}
[0m07:29:06.085444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5e23590>]}
[0m07:29:06.085891 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:29:06.086144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5db7590>]}
[0m07:29:06.088047 [info ] [MainThread]: 
[0m07:29:06.089220 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:29:06.093793 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:29:06.094163 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:06.125904 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:29:06.126516 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:06.162798 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:29:06.163804 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:08.177181 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:29:08.177546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:08.178408 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:29:08.179022 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:29:08.202722 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:08.204917 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:08.580721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5db7150>]}
[0m07:29:08.581088 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:29:08.584050 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:29:08.584555 [info ] [MainThread]: 
[0m07:29:08.588739 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:29:08.589243 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:29:08.589926 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:29:08.590232 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:29:08.604209 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:29:08.607999 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:29:08.611989 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:29:08.630472 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:29:08.649172 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:29:08.636383 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:29:08.651721 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:29:08.660803 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:29:08.726151 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:29:08.728249 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:29:08.683227 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:29:08.737923 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:29:08.661713 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m07:29:08.791192 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:29:08.807302 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:29:08.811358 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:29:08.818079 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:29:08.822372 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:29:08.823514 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:29:08.824351 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:29:08.825483 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:29:08.827765 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:29:08.828052 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:29:08.828454 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:29:08.858402 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:29:08.860838 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:29:08.862947 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:29:08.863491 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:29:08.912597 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:29:08.913067 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:29:09.352422 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:29:09.353517 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:29:09.408707 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e2efe2c1-ee73-4048-bada-59a9b10467ef&page=queryresults
[0m07:29:09.418705 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1164e293-59ec-4d29-b303-22a5c290c5c8&page=queryresults
[0m07:29:09.438161 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:955e06a2-d9ce-460a-9196-d5d21c785303&page=queryresults
[0m07:29:09.636761 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c19ad8d6-4928-4ed5-8b12-668b785b1d32&page=queryresults
[0m07:29:09.639931 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5a7cc90>]}
[0m07:29:09.640641 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m07:29:09.642071 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:29:09.642860 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31ea8c9c50>]}
[0m07:29:09.643317 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m07:29:09.646853 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:29:09.647835 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m07:29:09.648286 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:29:09.649408 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m07:29:09.649776 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m07:29:09.666837 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5c863d0>]}
[0m07:29:09.670054 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.08s]
[0m07:29:09.672166 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:29:09.656572 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:29:09.675835 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m07:29:09.706048 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:29:09.836377 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m07:29:09.816363 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c19ad8d6-4928-4ed5-8b12-668b785b1d32&page=queryresults
[0m07:29:09.837877 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:29:09.860649 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m07:29:09.862217 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m07:29:09.867552 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:29:09.870695 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m07:29:09.875510 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:29:10.000598 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:29:10.005077 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5f8e590>]}
[0m07:29:10.008317 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 1.28s]
[0m07:29:10.014731 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:29:10.285690 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:29:10.286401 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:29:10.319848 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:29:10.321131 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:29:10.858488 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:700b1d36-5b72-4c88-942c-12436b6389e3&page=queryresults
[0m07:29:10.971925 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:4cdec476-4561-4422-89fd-e344e3997d71&page=queryresults
[0m07:29:12.378848 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5f65990>]}
[0m07:29:12.379775 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.52s]
[0m07:29:12.380502 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m07:29:12.533240 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a7cdacb-b4f9-4512-8428-3efea8edfc4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31c5aa5710>]}
[0m07:29:12.534136 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.88s]
[0m07:29:12.535482 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m07:29:12.539239 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:29:12.539898 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:29:12.541729 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:29:12.542676 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:29:12.543716 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:29:12.544519 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:29:12.545636 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:29:12.546061 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:29:12.546737 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:29:12.552117 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:29:12.557880 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:29:12.556808 [info ] [Thread-3 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:29:12.571612 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:29:12.558137 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:29:12.580391 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:29:12.584415 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:29:12.623157 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:29:12.609198 [info ] [Thread-4 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:29:12.630345 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:29:12.626133 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:29:12.631243 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:29:12.671316 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:29:12.676017 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:29:12.676311 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:29:12.676479 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:29:12.676873 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:29:12.677326 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:29:12.677591 [info ] [MainThread]: 
[0m07:29:12.679064 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 6.59 seconds (6.59s).
[0m07:29:12.687125 [debug] [MainThread]: Command end result
[0m07:29:12.794100 [info ] [MainThread]: 
[0m07:29:12.796893 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:29:12.797109 [info ] [MainThread]: 
[0m07:29:12.800055 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:29:12.800332 [info ] [MainThread]: 
[0m07:29:12.800506 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:29:12.805893 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.005841, "process_in_blocks": "0", "process_kernel_time": 1.217967, "process_mem_max_rss": "210268", "process_out_blocks": "2456", "process_user_time": 2.753574}
[0m07:29:12.807230 [debug] [MainThread]: Command `dbt run` failed at 07:29:12.807153 after 8.01 seconds
[0m07:29:12.809462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31ed5f52d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31ed5f5290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c31ebabf7d0>]}
[0m07:29:12.809694 [debug] [MainThread]: Flushing usage events
[0m07:29:54.753524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bb978e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bb979110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bb97a110>]}


============================== 07:29:54.755688 | 595755ed-dd7d-4056-8ea6-26a1fbf743f9 ==============================
[0m07:29:54.755688 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:29:54.755988 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:29:55.402924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c597cce590>]}
[0m07:29:55.443850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bd70de50>]}
[0m07:29:55.444685 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:29:55.517515 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:29:55.595494 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:29:55.595880 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:29:55.628061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5979b0690>]}
[0m07:29:55.777437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bd3c9a90>]}
[0m07:29:55.777915 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:29:55.778504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c59786f990>]}
[0m07:29:55.780611 [info ] [MainThread]: 
[0m07:29:55.781096 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:29:55.786148 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:29:55.786542 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:55.846109 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:29:55.848152 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:55.874889 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:29:55.876262 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:57.692015 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:29:57.692381 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:57.717565 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:29:57.717937 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:57.718768 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:29:57.749689 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:58.103568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5979c1ad0>]}
[0m07:29:58.104118 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:29:58.105845 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:29:58.106467 [info ] [MainThread]: 
[0m07:29:58.113189 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:29:58.114303 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:29:58.114907 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:29:58.115432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:29:58.115794 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:29:58.113811 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:29:58.116254 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:29:58.116893 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:29:58.119416 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:29:58.118036 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:29:58.186009 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:29:58.190270 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:29:58.196813 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:29:58.118707 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:29:58.158483 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:29:58.231046 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:29:58.226640 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:29:58.228106 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m07:29:58.227280 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:29:58.257422 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:29:58.257819 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:29:58.269186 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:29:58.272860 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:29:58.273508 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:29:58.275632 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:29:58.277500 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:29:58.284467 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:29:58.285372 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:29:58.286267 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:29:58.286516 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:29:58.286944 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:29:58.335940 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:29:58.370022 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:29:58.370544 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:29:58.679988 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:29:58.680676 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:29:58.795164 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:df1c710e-7acf-4a87-b419-13149291073b&page=queryresults
[0m07:29:58.802145 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:574ea9cd-47e5-453c-97e1-ef3b9e6ced20&page=queryresults
[0m07:29:58.808707 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5e135e17-5300-4022-8239-5957f8662a27&page=queryresults
[0m07:29:58.879710 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:53f6bbba-52f4-4ace-891e-79b2f8891253&page=queryresults
[0m07:29:59.012223 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:53f6bbba-52f4-4ace-891e-79b2f8891253&page=queryresults
[0m07:29:59.023055 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:29:59.039246 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5977b2390>]}
[0m07:29:59.043029 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 0.85s]
[0m07:29:59.043580 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:29:59.096005 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5977df790>]}
[0m07:29:59.097038 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bb9a4190>]}
[0m07:29:59.099862 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c59e536850>]}
[0m07:29:59.098697 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m07:29:59.101775 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:29:59.100652 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.87s]
[0m07:29:59.101117 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m07:29:59.103766 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:29:59.104492 [debug] [Thread-4 (]: Began running node model.hospital_analytics.medicines
[0m07:29:59.105799 [info ] [Thread-4 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:29:59.105076 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:29:59.106819 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.medicines)
[0m07:29:59.107617 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.medicines
[0m07:29:59.107254 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m07:29:59.113290 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:29:59.122713 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.medicines
[0m07:29:59.120011 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:29:59.139273 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m07:29:59.142461 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m07:29:59.155798 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:29:59.193676 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:29:59.196137 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m07:29:59.198581 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:29:59.521190 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:29:59.521990 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:29:59.581654 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:29:59.582568 [debug] [Thread-4 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:30:00.162550 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:866e02a6-53ab-41bd-a0b3-9b6c8d77f3c0&page=queryresults
[0m07:30:00.189864 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:db2d94af-7d7a-4662-bad0-cfbd122ce1ac&page=queryresults
[0m07:30:01.602987 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c597cdd910>]}
[0m07:30:01.604838 [info ] [Thread-4 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.50s]
[0m07:30:01.608010 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.medicines
[0m07:30:05.662641 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '595755ed-dd7d-4056-8ea6-26a1fbf743f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c597c4d890>]}
[0m07:30:05.663831 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 6.53s]
[0m07:30:05.664565 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m07:30:05.666749 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:30:05.669578 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:30:05.670094 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:30:05.670828 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:30:05.671991 [info ] [Thread-1 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:30:05.672260 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:30:05.674199 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:30:05.675055 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:30:05.676355 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:30:05.674492 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:30:05.678255 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:30:05.677558 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:30:05.689004 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:30:05.675561 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:30:05.699348 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:30:05.710080 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_journey
[0m07:30:05.711775 [info ] [Thread-1 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:30:05.712061 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:30:05.713674 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:30:05.713901 [info ] [Thread-1 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:30:05.714125 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:30:05.739246 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:30:05.741796 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:30:05.742379 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:30:05.742681 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:30:05.742826 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m07:30:05.743068 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:30:05.743772 [info ] [MainThread]: 
[0m07:30:05.744003 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 9.96 seconds (9.96s).
[0m07:30:05.746007 [debug] [MainThread]: Command end result
[0m07:30:05.833311 [info ] [MainThread]: 
[0m07:30:05.836611 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:30:05.837642 [info ] [MainThread]: 
[0m07:30:05.837903 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:30:05.838089 [info ] [MainThread]: 
[0m07:30:05.838248 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:30:05.839689 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 11.118959, "process_in_blocks": "0", "process_kernel_time": 0.616963, "process_mem_max_rss": "209992", "process_out_blocks": "2464", "process_user_time": 2.906895}
[0m07:30:05.841020 [debug] [MainThread]: Command `dbt run` failed at 07:30:05.840947 after 11.12 seconds
[0m07:30:05.841259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bf3294d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bf329250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5bf329390>]}
[0m07:30:05.842418 [debug] [MainThread]: Flushing usage events
[0m07:30:19.172030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1a80d5c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1a80d5d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1a80d40d0>]}


============================== 07:30:19.174588 | a3207758-fa40-48b0-86a2-6a5f5bc94c33 ==============================
[0m07:30:19.174588 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:30:19.174919 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt clean', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:30:19.251594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3207758-fa40-48b0-86a2-6a5f5bc94c33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1a7f65e50>]}
[0m07:30:19.258461 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.124830864, "process_in_blocks": "0", "process_kernel_time": 0.095741, "process_mem_max_rss": "89576", "process_out_blocks": "8", "process_user_time": 0.954931}
[0m07:30:19.259536 [debug] [MainThread]: Command `dbt clean` succeeded at 07:30:19.259445 after 0.13 seconds
[0m07:30:19.259761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1a80d5c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1a80d4210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee1ab918bd0>]}
[0m07:30:19.259965 [debug] [MainThread]: Flushing usage events
[0m07:30:29.557254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a0537e2ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a0537e1c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a0537e0410>]}


============================== 07:30:29.559910 | 922a394a-77b9-4323-b710-ffe22e5861cc ==============================
[0m07:30:29.559910 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:30:29.560349 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m07:30:30.200615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a05383f8d0>]}
[0m07:30:30.237218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a05559e990>]}
[0m07:30:30.237866 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:30:30.314633 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:30:30.315468 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:30:30.315896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02fa8cf50>]}
[0m07:30:31.055825 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:30:31.056401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a034113f50>]}
[0m07:30:31.268087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02e5cbc10>]}
[0m07:30:31.335111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02e1fbfd0>]}
[0m07:30:31.335472 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:30:31.335854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02e47b090>]}
[0m07:30:31.337633 [info ] [MainThread]: 
[0m07:30:31.338120 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:30:31.341682 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:30:31.342236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:31.342729 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:30:31.378396 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:31.402029 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:30:31.402885 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:32.191567 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:30:32.191936 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:32.192505 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:30:32.225161 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:30:32.226427 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:32.227122 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:32.582551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02f6f19d0>]}
[0m07:30:32.582968 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:30:32.584573 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:30:32.585402 [info ] [MainThread]: 
[0m07:30:32.589626 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:30:32.590156 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:30:32.590561 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:30:32.593128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:30:32.591468 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:30:32.592532 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:30:32.593407 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:30:32.597478 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:30:32.628832 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:30:32.603307 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:30:32.598787 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:30:32.657532 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:30:32.696397 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:30:32.715932 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:30:32.702562 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:30:32.705567 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:30:32.722842 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:30:32.720095 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:30:32.714811 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:30:32.717848 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:30:32.807754 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:30:32.831073 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:30:32.842931 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:30:32.844202 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:30:32.844963 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:30:32.845665 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:30:32.846108 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:30:32.848207 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:30:32.848987 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:30:32.848713 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:30:32.850867 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:30:32.880960 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:30:32.908282 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:30:32.910550 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:30:33.293995 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:30:33.294609 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:30:33.326205 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f3e63fd6-8514-48d0-9515-f2075658a74a&page=queryresults
[0m07:30:33.329980 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:97ad834f-dabe-4e6c-b850-b364dc50a27a&page=queryresults
[0m07:30:33.548584 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e35f6cc6-8249-4a56-b82f-e8913cbe06b8&page=queryresults
[0m07:30:33.619428 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02e2ad7d0>]}
[0m07:30:33.620427 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m07:30:33.620838 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:30:33.699338 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e35f6cc6-8249-4a56-b82f-e8913cbe06b8&page=queryresults
[0m07:30:33.703216 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:30:33.703612 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02e220290>]}
[0m07:30:33.704542 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 0.99s]
[0m07:30:33.704914 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:30:33.821157 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02f667c50>]}
[0m07:30:33.821782 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m07:30:33.822134 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:30:33.823469 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m07:30:33.823865 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:30:33.824266 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m07:30:33.824510 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m07:30:33.828067 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:30:33.828631 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m07:30:33.831607 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:30:34.252100 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:30:34.252571 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:30:34.461789 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:22f6ce10-5f19-41dd-80da-07b83aded111&page=queryresults
[0m07:30:34.637541 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719ffe6e5b50>]}
[0m07:30:34.638049 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 2.04s]
[0m07:30:34.638845 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:30:34.641546 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m07:30:34.642009 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:30:34.642602 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m07:30:34.643000 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m07:30:34.646391 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:30:34.646781 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m07:30:34.649705 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:30:34.849788 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:bb5dd866-6398-4d8d-9d4a-06a5d5ee8820&page=queryresults
[0m07:30:35.001571 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:30:35.002546 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:30:35.570892 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:8b8e9b89-d374-4c29-a7e6-8bd8fffc527e&page=queryresults
[0m07:30:36.231948 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719ffe56e090>]}
[0m07:30:36.232433 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.41s]
[0m07:30:36.232797 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m07:30:37.241775 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '922a394a-77b9-4323-b710-ffe22e5861cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a02e22d290>]}
[0m07:30:37.242250 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.60s]
[0m07:30:37.242587 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m07:30:37.243683 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:30:37.243995 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:30:37.244724 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:30:37.245434 [debug] [Thread-2 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:30:37.245842 [info ] [Thread-2 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:30:37.246619 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:30:37.247966 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:30:37.248294 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:30:37.248624 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:30:37.249047 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:30:37.249536 [info ] [Thread-3 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:30:37.249928 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:30:37.251635 [info ] [Thread-1 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:30:37.251891 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:30:37.250594 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:30:37.253401 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:30:37.253748 [info ] [Thread-4 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:30:37.254801 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:30:37.254461 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:30:37.259760 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:30:37.262166 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:30:37.305870 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:30:37.307709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:30:37.307966 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m07:30:37.308112 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:30:37.308229 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:30:37.308339 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:30:37.308573 [info ] [MainThread]: 
[0m07:30:37.308754 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 5.97 seconds (5.97s).
[0m07:30:37.309545 [debug] [MainThread]: Command end result
[0m07:30:37.356008 [info ] [MainThread]: 
[0m07:30:37.356705 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:30:37.356969 [info ] [MainThread]: 
[0m07:30:37.357193 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:30:37.357374 [info ] [MainThread]: 
[0m07:30:37.357538 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:30:37.358182 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.8333015, "process_in_blocks": "0", "process_kernel_time": 0.588126, "process_mem_max_rss": "216548", "process_out_blocks": "3520", "process_user_time": 3.729051}
[0m07:30:37.358698 [debug] [MainThread]: Command `dbt run` failed at 07:30:37.358627 after 7.83 seconds
[0m07:30:37.358936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a05732d7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a0571bd290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a0537dacd0>]}
[0m07:30:37.359495 [debug] [MainThread]: Flushing usage events
[0m07:34:06.112172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d0059ad0b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d0059b17b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d0059ad0090>]}


============================== 07:34:06.115245 | 515439f5-426d-4a90-b231-9dbca295fe0c ==============================
[0m07:34:06.115245 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:34:06.116238 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt clean', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:34:06.186149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '515439f5-426d-4a90-b231-9dbca295fe0c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d005995b890>]}
[0m07:34:06.194579 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.11658666, "process_in_blocks": "0", "process_kernel_time": 0.1181, "process_mem_max_rss": "89852", "process_out_blocks": "8", "process_user_time": 0.895592}
[0m07:34:06.194920 [debug] [MainThread]: Command `dbt clean` succeeded at 07:34:06.194854 after 0.12 seconds
[0m07:34:06.195153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d005d314bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d005d4711d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d005d471190>]}
[0m07:34:06.195555 [debug] [MainThread]: Flushing usage events
[0m07:34:20.794733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d52594d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d5258110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d5258710>]}


============================== 07:34:20.796988 | 6de3da4a-07fd-44dd-9010-5628499b5808 ==============================
[0m07:34:20.796988 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:34:20.797446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:34:21.484236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83b25e24d0>]}
[0m07:34:21.524958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d6fe6990>]}
[0m07:34:21.525476 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:34:21.605750 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:34:21.606633 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:34:21.607137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83b1598290>]}
[0m07:34:22.403886 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:34:22.404236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83b14225d0>]}
[0m07:34:22.666917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83b117d950>]}
[0m07:34:22.736686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393c6fe90>]}
[0m07:34:22.737052 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:34:22.737382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83b158a610>]}
[0m07:34:22.739265 [info ] [MainThread]: 
[0m07:34:22.740178 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:34:22.744503 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:34:22.745017 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:34:22.793222 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:34:22.793981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:34:22.820603 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:34:22.821258 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:34:23.739612 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:34:23.740585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:34:23.741216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:34:23.741657 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:34:23.742102 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:34:23.742512 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:34:24.125434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393f33610>]}
[0m07:34:24.125912 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:34:24.127225 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:34:24.127663 [info ] [MainThread]: 
[0m07:34:24.130742 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:34:24.131409 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:34:24.131929 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:34:24.132515 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:34:24.138949 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:34:24.144592 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:34:24.151061 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m07:34:24.151360 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:34:24.168162 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:34:24.170458 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:34:24.179850 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:34:24.191314 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:34:24.195025 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_visits)
[0m07:34:24.196181 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:34:24.199530 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:34:24.201330 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:34:24.203277 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:34:24.250148 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:34:24.368076 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:34:24.366885 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:34:24.305763 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:34:24.370615 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:34:24.371423 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:34:24.375768 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:34:24.374846 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:34:24.375388 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:34:24.372077 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:34:24.380737 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:34:24.378795 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:34:24.380368 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:34:24.379767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:34:24.407231 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:34:24.457882 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:34:24.470415 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:34:24.853806 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:34:24.854351 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:34:24.897407 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:66df69f4-c309-4b0f-ae22-370d2e948e10&page=queryresults
[0m07:34:24.914064 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:3ddfd2aa-cc0d-408e-b01d-34391cecc346&page=queryresults
[0m07:34:24.930969 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5e90d919-c771-4e19-8eab-81334ca2e36e&page=queryresults
[0m07:34:25.114813 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ac223341-f628-45f7-8a46-b625863b9177&page=queryresults
[0m07:34:25.119950 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393c7ca10>]}
[0m07:34:25.121299 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.97s]
[0m07:34:25.122114 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:34:25.124924 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m07:34:25.125585 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:34:25.126229 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m07:34:25.126455 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m07:34:25.129284 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:34:25.129694 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m07:34:25.131239 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:34:25.175784 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393c8c710>]}
[0m07:34:25.176418 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m07:34:25.177058 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:34:25.180759 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m07:34:25.181228 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:34:25.181799 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m07:34:25.182037 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m07:34:25.186332 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:34:25.186846 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m07:34:25.199905 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ac223341-f628-45f7-8a46-b625863b9177&page=queryresults
[0m07:34:25.237249 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:34:25.252138 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:34:25.259677 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393cf62d0>]}
[0m07:34:25.264954 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 0.89s]
[0m07:34:25.265381 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:34:25.374074 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393c9ef90>]}
[0m07:34:25.375557 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.18s]
[0m07:34:25.379969 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:34:25.681702 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:34:25.682899 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:34:25.732149 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:34:25.732862 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:34:26.316480 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1c4acc97-fc76-47a2-bf48-9283a04057af&page=queryresults
[0m07:34:26.347422 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:95de1bd5-3822-4a49-a66c-916cc0b11762&page=queryresults
[0m07:34:27.680158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f836ff84690>]}
[0m07:34:27.680680 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.50s]
[0m07:34:27.681048 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m07:34:27.760832 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6de3da4a-07fd-44dd-9010-5628499b5808', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8393dd4850>]}
[0m07:34:27.761489 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.63s]
[0m07:34:27.764681 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m07:34:27.766023 [debug] [Thread-4 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:34:27.766978 [info ] [Thread-4 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:34:27.767774 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:34:27.773158 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:34:27.775669 [info ] [Thread-3 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:34:27.776722 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:34:27.778532 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:34:27.779212 [debug] [Thread-1 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:34:27.778855 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:34:27.793673 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:34:27.779569 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:34:27.799282 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:34:27.808064 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:34:27.813389 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:34:27.819984 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:34:27.827301 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m07:34:27.828360 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:34:27.828618 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:34:27.844270 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:34:27.846292 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:34:27.847949 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:34:27.851503 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:34:27.853661 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:34:27.853919 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m07:34:27.854068 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:34:27.854213 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:34:27.854340 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:34:27.854611 [info ] [MainThread]: 
[0m07:34:27.857801 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 5.11 seconds (5.11s).
[0m07:34:27.868414 [debug] [MainThread]: Command end result
[0m07:34:27.947119 [info ] [MainThread]: 
[0m07:34:27.947868 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:34:27.948159 [info ] [MainThread]: 
[0m07:34:27.948688 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:34:27.948892 [info ] [MainThread]: 
[0m07:34:27.949161 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:34:27.950139 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.191458, "process_in_blocks": "0", "process_kernel_time": 0.769111, "process_mem_max_rss": "216180", "process_out_blocks": "3520", "process_user_time": 4.318662}
[0m07:34:27.950684 [debug] [MainThread]: Command `dbt run` failed at 07:34:27.950602 after 7.19 seconds
[0m07:34:27.950936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d8bf91d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d8bf9190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83d5259c50>]}
[0m07:34:27.951144 [debug] [MainThread]: Flushing usage events
[0m07:36:11.592641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb3391f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb3392350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb33901d0>]}


============================== 07:36:11.594741 | be83bcf6-a548-4937-9836-987b38068b51 ==============================
[0m07:36:11.594741 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:36:11.595743 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:36:12.253002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f6a9050>]}
[0m07:36:12.301562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb511e5d0>]}
[0m07:36:12.302069 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:36:12.375367 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:36:12.455097 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:36:12.455401 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:36:12.486662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f3d8590>]}
[0m07:36:12.621552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f118250>]}
[0m07:36:12.622128 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:36:12.622528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb3208ad0>]}
[0m07:36:12.624332 [info ] [MainThread]: 
[0m07:36:12.624957 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:36:12.628835 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:36:12.629419 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:12.630101 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:36:12.659288 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:36:12.659974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:12.660633 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:13.524147 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:36:13.524602 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:13.548433 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:36:13.550071 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:36:13.550753 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:13.551647 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:13.871024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f60fc90>]}
[0m07:36:13.871362 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:36:13.872372 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:36:13.872783 [info ] [MainThread]: 
[0m07:36:13.876208 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:36:13.876732 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:36:13.878344 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:36:13.879157 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:36:13.879826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m07:36:13.880309 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:36:13.880997 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:36:13.891257 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:36:13.885869 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:36:13.887572 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:36:13.909418 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:36:13.885308 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:36:13.909760 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:36:13.943074 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:36:13.946468 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:36:13.969689 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:36:13.949199 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:36:13.961864 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:36:13.991746 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:36:13.993117 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:36:14.021649 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:36:14.022824 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:36:14.023480 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:36:14.026982 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:36:14.030412 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:36:14.032888 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:36:14.034498 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:36:14.033468 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:36:14.043319 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:36:14.044201 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:14.071036 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:36:14.075141 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:36:14.141501 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:36:14.141866 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:36:14.415827 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:36:14.416434 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:36:14.528520 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:f0a69b8f-22c7-45fc-8a44-cfa85f7b5159&page=queryresults
[0m07:36:14.539542 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1a2dce0a-3a85-4cd3-8fef-b81ddd0469a1&page=queryresults
[0m07:36:14.556695 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:66aa1c60-7692-44de-9434-4dd3911f52d5&page=queryresults
[0m07:36:14.641145 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ffb64cc5-ca4d-4230-bdcf-7cac102f33ca&page=queryresults
[0m07:36:14.750135 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ffb64cc5-ca4d-4230-bdcf-7cac102f33ca&page=queryresults
[0m07:36:14.811854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f345650>]}
[0m07:36:14.813432 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.93s]
[0m07:36:14.818705 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f946a7c50>]}
[0m07:36:14.819583 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb34a30d0>]}
[0m07:36:14.820325 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:36:14.824187 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.94s]
[0m07:36:14.835941 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m07:36:14.845099 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:36:14.858358 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:36:14.874067 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:36:14.916307 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:36:14.917763 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m07:36:14.918339 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:36:14.897862 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patients
[0m07:36:14.952363 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:36:14.956020 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:36:14.958121 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.patients)
[0m07:36:14.958729 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.patients
[0m07:36:14.962936 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:36:14.963954 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.patients
[0m07:36:14.966875 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:36:14.994528 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:36:14.996993 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:36:15.029178 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:36:15.029816 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f77482890>]}
[0m07:36:15.031820 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 1.04s]
[0m07:36:15.032616 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:36:15.281514 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:36:15.282495 [debug] [Thread-3 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:36:15.300664 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:36:15.301576 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:36:15.900208 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:3d567955-4bea-4730-94c8-cf4288a3a515&page=queryresults
[0m07:36:15.918218 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:7518bf8b-1e84-42c0-8fbc-90f097012c14&page=queryresults
[0m07:36:17.302963 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f1d9590>]}
[0m07:36:17.303999 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.39s]
[0m07:36:17.304782 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:36:17.326889 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be83bcf6-a548-4937-9836-987b38068b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711f8f344610>]}
[0m07:36:17.327417 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.37s]
[0m07:36:17.329540 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patients
[0m07:36:17.331584 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:36:17.332516 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:36:17.332043 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:36:17.334090 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:36:17.335772 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:36:17.336373 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:36:17.342563 [debug] [Thread-3 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:36:17.343229 [debug] [Thread-2 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:36:17.344146 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:36:17.343442 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:36:17.349181 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:36:17.342986 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:36:17.349958 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:36:17.348764 [info ] [Thread-1 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:36:17.350441 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:36:17.367054 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:36:17.358790 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:36:17.368693 [info ] [Thread-2 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:36:17.370973 [info ] [Thread-4 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:36:17.377369 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:36:17.378377 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:36:17.395292 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:36:17.411604 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:36:17.411926 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:36:17.416769 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:36:17.417052 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:36:17.418906 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:36:17.419304 [info ] [MainThread]: 
[0m07:36:17.419540 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 4.79 seconds (4.79s).
[0m07:36:17.422212 [debug] [MainThread]: Command end result
[0m07:36:17.506892 [info ] [MainThread]: 
[0m07:36:17.507756 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:36:17.508209 [info ] [MainThread]: 
[0m07:36:17.508671 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:36:17.509292 [info ] [MainThread]: 
[0m07:36:17.509648 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:36:17.510946 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.954676, "process_in_blocks": "0", "process_kernel_time": 0.777941, "process_mem_max_rss": "209872", "process_out_blocks": "2456", "process_user_time": 3.046938}
[0m07:36:17.511398 [debug] [MainThread]: Command `dbt run` failed at 07:36:17.511311 after 5.96 seconds
[0m07:36:17.511906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb6d311d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb6d31190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711fb6d30890>]}
[0m07:36:17.512189 [debug] [MainThread]: Flushing usage events
[0m07:40:34.056965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a84771c43d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8477206c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a84771c4310>]}


============================== 07:40:34.062071 | 487806a3-edb0-4ab9-aa08-861bf4f646c4 ==============================
[0m07:40:34.062071 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:40:34.062586 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:40:34.068977 [info ] [MainThread]: dbt version: 1.8.9
[0m07:40:34.069835 [info ] [MainThread]: python version: 3.11.2
[0m07:40:34.070309 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:40:34.071651 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m07:40:34.791719 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:40:34.792520 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:40:34.792731 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:40:34.792871 [info ] [MainThread]: adapter type: bigquery
[0m07:40:34.793149 [info ] [MainThread]: adapter version: 1.9.0
[0m07:40:34.875031 [info ] [MainThread]: Configuration:
[0m07:40:34.875556 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:40:34.876863 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:40:34.877276 [info ] [MainThread]: Required dependencies:
[0m07:40:34.877623 [debug] [MainThread]: Executing "git --help"
[0m07:40:34.881779 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:40:34.882098 [debug] [MainThread]: STDERR: "b''"
[0m07:40:34.882265 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:40:34.882652 [info ] [MainThread]: Connection:
[0m07:40:34.883423 [info ] [MainThread]:   method: service-account
[0m07:40:34.883818 [info ] [MainThread]:   database: dataeng-2025-gar
[0m07:40:34.884041 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m07:40:34.884296 [info ] [MainThread]:   schema: hospital
[0m07:40:34.884690 [info ] [MainThread]:   location: asia-southeast2
[0m07:40:34.884843 [info ] [MainThread]:   priority: interactive
[0m07:40:34.884973 [info ] [MainThread]:   maximum_bytes_billed: None
[0m07:40:34.885095 [info ] [MainThread]:   impersonate_service_account: None
[0m07:40:34.885211 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m07:40:34.885326 [info ] [MainThread]:   job_retries: 1
[0m07:40:34.885436 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m07:40:34.885917 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m07:40:34.886215 [info ] [MainThread]:   timeout_seconds: 300
[0m07:40:34.886739 [info ] [MainThread]:   client_id: None
[0m07:40:34.886885 [info ] [MainThread]:   token_uri: None
[0m07:40:34.887005 [info ] [MainThread]:   dataproc_region: None
[0m07:40:34.887202 [info ] [MainThread]:   dataproc_cluster_name: None
[0m07:40:34.887327 [info ] [MainThread]:   gcs_bucket: None
[0m07:40:34.887437 [info ] [MainThread]:   dataproc_batch: None
[0m07:40:34.887672 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:40:34.983749 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m07:40:34.984024 [debug] [MainThread]: On debug: select 1 as id
[0m07:40:34.984325 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:40:35.459744 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:fac086e3-42c6-4349-9e06-08494173650a&page=queryresults
[0m07:40:35.705246 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:40:35.705639 [info ] [MainThread]: [32mAll checks passed![0m
[0m07:40:35.707960 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.7517068, "process_in_blocks": "0", "process_kernel_time": 0.444723, "process_mem_max_rss": "201576", "process_out_blocks": "16", "process_user_time": 2.432128}
[0m07:40:35.708518 [debug] [MainThread]: Command `dbt debug` succeeded at 07:40:35.708428 after 1.75 seconds
[0m07:40:35.708844 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:40:35.709075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8477380ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a84539c2490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a847aa44cd0>]}
[0m07:40:35.709317 [debug] [MainThread]: Flushing usage events
[0m07:40:47.401379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29cd08d990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29cd0cffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29cd0cf810>]}


============================== 07:40:47.403867 | 2c8843ad-e783-4ea2-86bd-56fd46f4c4e2 ==============================
[0m07:40:47.403867 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:40:47.404495 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt clean', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:40:47.478721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c8843ad-e783-4ea2-86bd-56fd46f4c4e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29cd0d8710>]}
[0m07:40:47.485943 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.12008692, "process_in_blocks": "0", "process_kernel_time": 0.097523, "process_mem_max_rss": "89732", "process_out_blocks": "8", "process_user_time": 0.944311}
[0m07:40:47.486821 [debug] [MainThread]: Command `dbt clean` succeeded at 07:40:47.486733 after 0.12 seconds
[0m07:40:47.487076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29cd08c990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29d0bd57d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e29d08dcc10>]}
[0m07:40:47.487297 [debug] [MainThread]: Flushing usage events
[0m07:40:54.376794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be58a84290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be58e1cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be58a85b10>]}


============================== 07:40:54.379252 | a7a24d28-6130-4901-990a-b5f3aa46e94f ==============================
[0m07:40:54.379252 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:40:54.379635 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m07:40:55.161999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be38eca210>]}
[0m07:40:55.198385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be38c9a550>]}
[0m07:40:55.199044 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:40:55.270539 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:40:55.271269 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:40:55.272146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be38c74750>]}
[0m07:40:56.000478 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:40:56.002173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be38947d90>]}
[0m07:40:56.229641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be2b7860d0>]}
[0m07:40:56.298789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be380fd890>]}
[0m07:40:56.299146 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:40:56.299476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be2b649e50>]}
[0m07:40:56.301506 [info ] [MainThread]: 
[0m07:40:56.302015 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:40:56.305683 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:40:56.306631 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:40:56.344721 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:40:56.346599 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:40:56.374939 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:40:56.375339 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:40:57.159499 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:40:57.159869 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:40:57.183956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:40:57.184305 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:40:57.198374 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:40:57.244589 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:40:57.616504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be389db410>]}
[0m07:40:57.616885 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:40:57.618083 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:40:57.618308 [info ] [MainThread]: 
[0m07:40:57.621737 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:40:57.623451 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:40:57.625922 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:40:57.622562 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:40:57.626897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:40:57.627504 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:40:57.624061 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:40:57.626342 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:40:57.677994 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:40:57.693240 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:40:57.671193 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m07:40:57.688339 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:40:57.658390 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:40:57.709547 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:40:57.727299 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:40:57.721032 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:40:57.728941 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:40:57.819268 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:40:57.768493 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:40:57.758391 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:40:57.827216 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:40:57.852008 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:40:57.894996 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:40:57.902394 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:40:57.904701 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:40:57.906995 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:40:57.908421 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:40:57.909762 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:40:57.910233 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:40:57.910473 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:40:57.917983 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:40:57.920391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:40:57.920813 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:40:57.921063 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:40:58.346595 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:40:58.347139 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:40:58.441487 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:b157759a-9b63-4c07-bc1d-00cfd81344a6&page=queryresults
[0m07:40:58.446644 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:8086975d-890d-49df-acd3-294fe53380e8&page=queryresults
[0m07:40:58.455557 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1d6326fa-17b1-4f09-b953-58269a4a6611&page=queryresults
[0m07:40:58.564159 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:402e00a7-fcd8-45b2-be3d-c6d94d5d18db&page=queryresults
[0m07:40:58.631301 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:402e00a7-fcd8-45b2-be3d-c6d94d5d18db&page=queryresults
[0m07:40:58.640709 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:40:58.642023 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be3ae5b510>]}
[0m07:40:58.646003 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 0.82s]
[0m07:40:58.646361 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:40:58.694536 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be2b57c3d0>]}
[0m07:40:58.695139 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.02s]
[0m07:40:58.696058 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:40:58.697132 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patients
[0m07:40:58.697563 [info ] [Thread-4 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:40:58.698110 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.patients)
[0m07:40:58.698425 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patients
[0m07:40:58.701755 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:40:58.702644 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patients
[0m07:40:58.704831 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:40:58.779144 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be281adbd0>]}
[0m07:40:58.780123 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.10s]
[0m07:40:58.781938 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:40:58.782945 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be2b52eb10>]}
[0m07:40:58.783661 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.16s]
[0m07:40:58.784947 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:40:58.785671 [debug] [Thread-2 (]: Began running node model.hospital_analytics.medicines
[0m07:40:58.786426 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:40:58.786929 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.medicines)
[0m07:40:58.787215 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.medicines
[0m07:40:58.791142 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:40:58.791598 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.medicines
[0m07:40:58.793585 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:40:59.143176 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:40:59.144253 [debug] [Thread-4 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:40:59.214440 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:40:59.214959 [debug] [Thread-2 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:40:59.804623 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:05ead000-7829-4ecb-9c73-3cff03cfe760&page=queryresults
[0m07:40:59.894586 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5d4c3c97-a3aa-4ae5-a77d-fbcda7bcfc54&page=queryresults
[0m07:41:01.215932 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be2b56a0d0>]}
[0m07:41:01.216575 [info ] [Thread-4 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.52s]
[0m07:41:01.216942 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patients
[0m07:41:01.217883 [debug] [Thread-1 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:41:01.218222 [info ] [Thread-1 (]: 7 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:41:01.218644 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:41:01.220516 [debug] [Thread-4 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:41:01.221480 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:41:01.220988 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:41:01.221968 [info ] [Thread-3 (]: 9 of 13 SKIP relation hospital_analytics.monthly_visit_stats ................... [[33mSKIP[0m]
[0m07:41:01.222966 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:41:01.223561 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:41:01.536227 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a24d28-6130-4901-990a-b5f3aa46e94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be2b7ac950>]}
[0m07:41:01.536726 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.75s]
[0m07:41:01.537414 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.medicines
[0m07:41:01.538457 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:41:01.538761 [info ] [Thread-1 (]: 10 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............ [[33mSKIP[0m]
[0m07:41:01.539064 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:41:01.540088 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:41:01.540593 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m07:41:01.540955 [info ] [Thread-3 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:41:01.541411 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:41:01.542040 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:41:01.542573 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:41:01.549118 [info ] [Thread-1 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:41:01.545816 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:41:01.549777 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:41:01.584201 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:41:01.587151 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:41:01.587378 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_medicines' was properly closed.
[0m07:41:01.587513 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:41:01.587663 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_visits' was properly closed.
[0m07:41:01.587870 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:41:01.588547 [info ] [MainThread]: 
[0m07:41:01.589824 [info ] [MainThread]: Finished running 10 table models, 3 view models in 0 hours 0 minutes and 5.29 seconds (5.29s).
[0m07:41:01.593249 [debug] [MainThread]: Command end result
[0m07:41:01.658302 [info ] [MainThread]: 
[0m07:41:01.659488 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:41:01.660666 [info ] [MainThread]: 
[0m07:41:01.662474 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:41:01.663178 [info ] [MainThread]: 
[0m07:41:01.663620 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:41:01.665529 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.316477, "process_in_blocks": "0", "process_kernel_time": 0.746728, "process_mem_max_rss": "216008", "process_out_blocks": "3520", "process_user_time": 3.720306}
[0m07:41:01.665901 [debug] [MainThread]: Command `dbt run` failed at 07:41:01.665826 after 7.32 seconds
[0m07:41:01.666177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be58acc090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be5c4593d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77be5c459290>]}
[0m07:41:01.666381 [debug] [MainThread]: Flushing usage events
[0m07:41:56.000629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb9c7ae050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb9c7ac350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb9c7ac6d0>]}


============================== 07:41:56.002970 | 95e0643f-e745-42ae-910d-b56e5778f6c9 ==============================
[0m07:41:56.002970 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:41:56.003952 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m07:41:56.693949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c91ab10>]}
[0m07:41:56.731797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb9e53a290>]}
[0m07:41:56.732291 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:41:56.808665 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:41:56.906045 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:41:56.906338 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:41:56.950768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7f6d81d0>]}
[0m07:41:57.100590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c7eb550>]}
[0m07:41:57.100984 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:41:57.101313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c7fbd10>]}
[0m07:41:57.103584 [info ] [MainThread]: 
[0m07:41:57.104304 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:41:57.108429 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:41:57.108749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:41:57.149834 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:41:57.150490 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:41:57.151488 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:41:57.152196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:41:57.988597 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:41:57.988957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:41:58.014033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:41:58.014440 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:41:58.041638 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:41:58.042211 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:41:58.358113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c630d10>]}
[0m07:41:58.358595 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:41:58.360118 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:41:58.360454 [info ] [MainThread]: 
[0m07:41:58.367785 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:41:58.368814 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:41:58.369818 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:41:58.371151 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:41:58.368503 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:41:58.372677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:41:58.373529 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:41:58.372229 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:41:58.398063 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:41:58.403187 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:41:58.370318 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:41:58.403771 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:41:58.415610 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:41:58.369527 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:41:58.438941 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_patients)
[0m07:41:58.441209 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:41:58.501212 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:41:58.507315 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:41:58.510200 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:41:58.521318 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:41:58.542627 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:41:58.550217 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:41:58.552306 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:41:58.552893 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:41:58.553510 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:41:58.610669 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:41:58.619184 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:41:58.623788 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:41:58.626301 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:41:58.628974 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:41:58.629674 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:41:58.630414 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:41:58.632099 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:41:58.633579 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:41:58.977741 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:41:58.978839 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:41:59.128640 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:7e14788a-6e26-4b49-920e-0eb4dc925c92&page=queryresults
[0m07:41:59.131564 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:803230a3-c227-426c-a0ed-0ef953799552&page=queryresults
[0m07:41:59.133814 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5d837f28-becb-4dd3-b263-abd85ee0a6d3&page=queryresults
[0m07:41:59.268750 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:28a4f79e-1f6b-421f-bd1e-48b48444723c&page=queryresults
[0m07:41:59.333717 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c8b5950>]}
[0m07:41:59.335605 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c8fa710>]}
[0m07:41:59.336548 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.93s]
[0m07:41:59.337258 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m07:41:59.339654 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:41:59.340246 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:41:59.342164 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m07:41:59.342707 [info ] [Thread-3 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:41:59.343534 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m07:41:59.343764 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m07:41:59.349174 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:41:59.352812 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m07:41:59.363065 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:41:59.426207 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:28a4f79e-1f6b-421f-bd1e-48b48444723c&page=queryresults
[0m07:41:59.435747 [debug] [Thread-4 (]: Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:41:59.437121 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7cac2150>]}
[0m07:41:59.438141 [error] [Thread-4 (]: 4 of 13 ERROR creating sql table model hospital_staging.doctors ................ [[31mERROR[0m in 1.04s]
[0m07:41:59.453155 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:41:59.475262 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c7e9810>]}
[0m07:41:59.495311 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m07:41:59.498671 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:41:59.526852 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m07:41:59.533582 [info ] [Thread-1 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:41:59.536587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.patients)
[0m07:41:59.536869 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m07:41:59.557775 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:41:59.562769 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m07:41:59.570447 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:41:59.795476 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:41:59.796456 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:41:59.915614 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:41:59.916467 [debug] [Thread-1 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:42:00.448696 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:c295d4e2-7264-4391-b909-0bc8a5cbc99c&page=queryresults
[0m07:42:00.634700 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:df746bb4-f52c-4a66-829e-6fcada430c2e&page=queryresults
[0m07:42:02.146083 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c967c10>]}
[0m07:42:02.146588 [info ] [Thread-3 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.80s]
[0m07:42:02.147510 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m07:42:02.303067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e0643f-e745-42ae-910d-b56e5778f6c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb7c9192d0>]}
[0m07:42:02.304290 [info ] [Thread-1 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.77s]
[0m07:42:02.311222 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m07:42:02.323733 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:42:02.325776 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:42:02.326262 [info ] [Thread-2 (]: 7 of 13 SKIP relation hospital_intermediate.prescriptions_enhanced ............. [[33mSKIP[0m]
[0m07:42:02.327474 [info ] [Thread-4 (]: 8 of 13 SKIP relation hospital_intermediate.visits_enhanced .................... [[33mSKIP[0m]
[0m07:42:02.328850 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:42:02.329419 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:42:02.334609 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:42:02.336132 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:42:02.336584 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:42:02.335010 [info ] [Thread-1 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:42:02.361051 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:42:02.336412 [info ] [Thread-3 (]: 10 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:42:02.341071 [info ] [Thread-2 (]: 11 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:42:02.423397 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:42:02.440137 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:42:02.439549 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:42:02.440637 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:42:02.409482 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:42:02.441930 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:42:02.444216 [info ] [Thread-4 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:42:02.446894 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:42:02.471669 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:42:02.475080 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:42:02.475327 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:42:02.475471 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:42:02.478251 [debug] [MainThread]: Connection 'model.hospital_analytics._hospital_patients' was properly closed.
[0m07:42:02.479221 [debug] [MainThread]: Connection 'model.hospital_analytics.doctors' was properly closed.
[0m07:42:02.480382 [info ] [MainThread]: 
[0m07:42:02.481566 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 5.38 seconds (5.38s).
[0m07:42:02.483593 [debug] [MainThread]: Command end result
[0m07:42:02.541483 [info ] [MainThread]: 
[0m07:42:02.542241 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:42:02.542737 [info ] [MainThread]: 
[0m07:42:02.543105 [error] [MainThread]:   Database Error in model doctors (models/staging/refined/doctors.sql)
  Unrecognized name: doctor_name; Did you mean doctor_id? at [17:3]
  compiled code at target/run/hospital_analytics/models/staging/refined/doctors.sql
[0m07:42:02.543485 [info ] [MainThread]: 
[0m07:42:02.543847 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=7 TOTAL=13
[0m07:42:02.545085 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 6.579793, "process_in_blocks": "0", "process_kernel_time": 0.692925, "process_mem_max_rss": "209700", "process_out_blocks": "2440", "process_user_time": 3.170888}
[0m07:42:02.545420 [debug] [MainThread]: Command `dbt run` failed at 07:42:02.545350 after 6.58 seconds
[0m07:42:02.545666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb9c7eb150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eb9c7eaf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77eba014d050>]}
[0m07:42:02.545883 [debug] [MainThread]: Flushing usage events
[0m07:47:54.092519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a2c2b690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a2c6e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a2c6e810>]}


============================== 07:47:54.095001 | f183864f-d2ba-4cfa-8070-d2da90aef2e1 ==============================
[0m07:47:54.095001 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:47:54.095411 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:47:54.174623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f183864f-d2ba-4cfa-8070-d2da90aef2e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a2af5990>]}
[0m07:47:54.184013 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1263622, "process_in_blocks": "0", "process_kernel_time": 0.096362, "process_mem_max_rss": "89528", "process_out_blocks": "8", "process_user_time": 0.929894}
[0m07:47:54.184363 [debug] [MainThread]: Command `dbt clean` succeeded at 07:47:54.184294 after 0.13 seconds
[0m07:47:54.184576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a2c76cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a2c6f7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7588a646cbd0>]}
[0m07:47:54.184787 [debug] [MainThread]: Flushing usage events
[0m07:48:00.310246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed6878d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed6878d1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed6878c210>]}


============================== 07:48:00.312385 | 8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f ==============================
[0m07:48:00.312385 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:48:00.312888 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:48:01.043952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed491034d0>]}
[0m07:48:01.081703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed6a526390>]}
[0m07:48:01.082210 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:48:01.174945 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:48:01.176031 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:48:01.176363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed48aa4590>]}
[0m07:48:01.976017 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:48:01.976361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed48626790>]}
[0m07:48:02.205187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed436b0790>]}
[0m07:48:02.273769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed48691e50>]}
[0m07:48:02.274217 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:48:02.274547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed435fee90>]}
[0m07:48:02.276209 [info ] [MainThread]: 
[0m07:48:02.276636 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:48:02.281614 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:48:02.286715 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:02.335235 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:48:02.336211 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:02.337868 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:48:02.338740 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:03.480929 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:48:03.481306 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:03.506021 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:48:03.506590 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:03.531596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:48:03.532130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:03.848510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed48973890>]}
[0m07:48:03.848871 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:48:03.850096 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:48:03.850500 [info ] [MainThread]: 
[0m07:48:03.856489 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:48:03.857506 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:48:03.858981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_medicines)
[0m07:48:03.859209 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:48:03.876760 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:48:03.879192 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:48:03.910742 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:48:03.882373 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:48:03.919426 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:48:03.921241 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:48:03.920822 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:48:03.918514 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:48:03.928415 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:48:03.929605 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:48:03.931783 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_visits)
[0m07:48:03.932505 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:48:03.938279 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:48:03.939135 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:48:03.941305 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:48:03.955378 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:48:03.991165 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:48:04.017727 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:48:04.019383 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:48:04.022193 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:48:04.023453 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:48:04.024862 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:48:04.025633 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:48:04.026118 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:48:04.028132 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:48:04.035165 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:48:04.036047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:48:04.036846 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:48:04.037415 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:48:04.115481 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:48:04.442462 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:48:04.442998 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:48:04.508027 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5e84dabf-8eb0-4d59-bf29-bba1a15b46cf&page=queryresults
[0m07:48:04.519837 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:b0b0e873-1bb5-4633-9f3f-01e8599a4692&page=queryresults
[0m07:48:04.522796 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:303cbb33-2732-4fd5-94a7-02c3da15ef41&page=queryresults
[0m07:48:04.682974 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:7cb6b220-83a5-4bdc-8673-645611c3cfd3&page=queryresults
[0m07:48:04.715692 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed434704d0>]}
[0m07:48:04.716339 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.84s]
[0m07:48:04.716986 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:48:04.719563 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m07:48:04.721337 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:48:04.721932 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m07:48:04.723535 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m07:48:04.726417 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:48:04.726787 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m07:48:04.729444 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:48:04.777983 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed3b52fe90>]}
[0m07:48:04.781632 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed43598690>]}
[0m07:48:04.780772 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.85s]
[0m07:48:04.782289 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m07:48:04.783251 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:48:04.784152 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:48:04.785342 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m07:48:04.785740 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:48:04.786399 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m07:48:04.786678 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m07:48:04.790582 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:48:04.791082 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m07:48:04.792998 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:48:05.107331 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:48:05.107834 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:48:05.157628 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:48:05.158101 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:48:05.797366 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:361082e3-1e6e-412c-8bab-7b201e4ead7b&page=queryresults
[0m07:48:05.815533 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:0b83e9b1-641c-4024-b56d-ce56210a8fe3&page=queryresults
[0m07:48:06.101004 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed4343d850>]}
[0m07:48:06.101602 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 620.0 Bytes processed)[0m in 2.16s]
[0m07:48:06.102367 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:48:07.218108 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed3b56c7d0>]}
[0m07:48:07.219028 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.43s]
[0m07:48:07.219682 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m07:48:07.459187 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed486b2dd0>]}
[0m07:48:07.459678 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.74s]
[0m07:48:07.461178 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m07:48:07.462319 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:48:07.462821 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:48:07.463785 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:48:07.465949 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:48:07.466705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.prescriptions_enhanced)
[0m07:48:07.467518 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m07:48:07.467898 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:48:07.468750 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:48:07.474881 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:48:07.491087 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:48:07.516672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:48:07.518099 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:48:07.519053 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:48:07.524151 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:48:07.856307 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:48:07.857003 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `dataeng-2025-gar`.`hospital`.`visits` v
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:48:07.871023 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:48:07.871494 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `dataeng-2025-gar`.`hospital`.`prescriptions` pr
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:48:08.075593 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1a726b0b-2951-4ef1-b6a7-ae3287994cd0&page=queryresults
[0m07:48:08.115487 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:904e901e-2b4d-4073-8a40-8d6ab5c5d7c9&page=queryresults
[0m07:48:08.146863 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1a726b0b-2951-4ef1-b6a7-ae3287994cd0&page=queryresults
[0m07:48:08.152704 [debug] [Thread-4 (]: Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name doctor_name not found inside d at [27:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m07:48:08.153496 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed4019c050>]}
[0m07:48:08.154148 [error] [Thread-4 (]: 8 of 13 ERROR creating sql table model hospital_intermediate.visits_enhanced ... [[31mERROR[0m in 0.69s]
[0m07:48:08.154510 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:48:08.155941 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:48:08.156284 [info ] [Thread-2 (]: 9 of 13 SKIP relation hospital_intermediate.billing_enhanced ................... [[33mSKIP[0m]
[0m07:48:08.156764 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:48:08.157077 [debug] [Thread-2 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:48:08.157278 [info ] [Thread-2 (]: 10 of 13 SKIP relation hospital_analytics.monthly_visit_stats .................. [[33mSKIP[0m]
[0m07:48:08.157499 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:48:08.177585 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:904e901e-2b4d-4073-8a40-8d6ab5c5d7c9&page=queryresults
[0m07:48:08.195191 [debug] [Thread-1 (]: Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name doctor_name not found inside d at [24:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql
[0m07:48:08.197667 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e50ceb0-512c-48e6-b27e-c5f9f9cd8c2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed401afc10>]}
[0m07:48:08.198152 [error] [Thread-1 (]: 7 of 13 ERROR creating sql table model hospital_intermediate.prescriptions_enhanced  [[31mERROR[0m in 0.73s]
[0m07:48:08.198528 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:48:08.213946 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:48:08.237303 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m07:48:08.243274 [debug] [Thread-3 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:48:08.254924 [info ] [Thread-2 (]: 12 of 13 SKIP relation hospital_analytics.patient_journey ...................... [[33mSKIP[0m]
[0m07:48:08.215267 [info ] [Thread-4 (]: 11 of 13 SKIP relation hospital_analytics.doctor_performance ................... [[33mSKIP[0m]
[0m07:48:08.258405 [info ] [Thread-3 (]: 13 of 13 SKIP relation hospital_analytics.patient_spending_analysis ............ [[33mSKIP[0m]
[0m07:48:08.279526 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:48:08.280022 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:48:08.280656 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:48:08.324858 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:48:08.327331 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:48:08.327586 [debug] [MainThread]: Connection 'model.hospital_analytics.medicines' was properly closed.
[0m07:48:08.327732 [debug] [MainThread]: Connection 'model.hospital_analytics.patients' was properly closed.
[0m07:48:08.327855 [debug] [MainThread]: Connection 'model.hospital_analytics.prescriptions_enhanced' was properly closed.
[0m07:48:08.327973 [debug] [MainThread]: Connection 'model.hospital_analytics.visits_enhanced' was properly closed.
[0m07:48:08.328251 [info ] [MainThread]: 
[0m07:48:08.330013 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 6.05 seconds (6.05s).
[0m07:48:08.336822 [debug] [MainThread]: Command end result
[0m07:48:08.376310 [info ] [MainThread]: 
[0m07:48:08.382915 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:48:08.385453 [info ] [MainThread]: 
[0m07:48:08.391897 [error] [MainThread]:   Database Error in model visits_enhanced (models/intermediate/visits_enhanced.sql)
  Name doctor_name not found inside d at [27:5]
  compiled code at target/run/hospital_analytics/models/intermediate/visits_enhanced.sql
[0m07:48:08.392196 [info ] [MainThread]: 
[0m07:48:08.392409 [error] [MainThread]:   Database Error in model prescriptions_enhanced (models/intermediate/prescriptions_enhanced.sql)
  Name doctor_name not found inside d at [24:5]
  compiled code at target/run/hospital_analytics/models/intermediate/prescriptions_enhanced.sql
[0m07:48:08.397805 [info ] [MainThread]: 
[0m07:48:08.398138 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=2 SKIP=5 TOTAL=13
[0m07:48:08.399054 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.122676, "process_in_blocks": "0", "process_kernel_time": 0.750526, "process_mem_max_rss": "215964", "process_out_blocks": "3584", "process_user_time": 4.04244}
[0m07:48:08.399773 [debug] [MainThread]: Command `dbt run` failed at 07:48:08.399665 after 8.12 seconds
[0m07:48:08.400053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed687d5950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed6c13d3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ed6c13ca90>]}
[0m07:48:08.400273 [debug] [MainThread]: Flushing usage events
[0m07:48:54.404377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed287898dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed287956910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2878985d0>]}


============================== 07:48:54.406770 | 0c2b23c4-a2ab-4847-a7f6-6dfb9febc266 ==============================
[0m07:48:54.406770 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:48:54.407791 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:48:55.064670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed268c37750>]}
[0m07:48:55.102904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2896565d0>]}
[0m07:48:55.103596 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:48:55.195452 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:48:55.377754 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:48:55.378435 [debug] [MainThread]: Partial parsing: updated file: hospital_analytics://models/staging/refined/doctors.sql
[0m07:48:55.765252 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:48:55.766881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed263b48150>]}
[0m07:48:55.951607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2637d61d0>]}
[0m07:48:56.062627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed26262c250>]}
[0m07:48:56.063051 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:48:56.063531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2878b3cd0>]}
[0m07:48:56.065582 [info ] [MainThread]: 
[0m07:48:56.066459 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:48:56.070461 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:48:56.071799 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:56.127386 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:48:56.129154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:56.157350 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:48:56.157884 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:56.927047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:48:56.927423 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:56.928088 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:48:56.929182 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:48:56.963163 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:56.963812 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:57.305778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2878c22d0>]}
[0m07:48:57.306171 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:48:57.307233 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:48:57.307897 [info ] [MainThread]: 
[0m07:48:57.312097 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:48:57.312636 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:48:57.313443 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:48:57.314032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:48:57.314425 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:48:57.314871 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:48:57.320449 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:48:57.315294 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:48:57.318412 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:48:57.315911 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:48:57.322089 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:48:57.323545 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m07:48:57.327520 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:48:57.346456 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:48:57.353650 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:48:57.355295 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:48:57.359734 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:48:57.366255 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:48:57.373125 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:48:57.377449 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:48:57.377984 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:48:57.379024 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:48:57.406199 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:48:57.424978 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:48:57.433989 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:48:57.453672 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:48:57.456198 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:48:57.457667 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:48:57.485103 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:48:57.488555 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:48:57.489312 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:48:57.490411 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:48:57.523253 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:48:57.558158 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:48:57.864130 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:48:57.864927 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:48:57.984971 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:1426b6fa-b189-4399-a697-59c9454523cb&page=queryresults
[0m07:48:57.992478 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:a68db1d9-73e0-4fcf-a01e-0eae91ba81b0&page=queryresults
[0m07:48:58.012467 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:53eef0a4-6687-41ad-8365-2f3603f65991&page=queryresults
[0m07:48:58.096430 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:7425b458-d5f3-4bb2-a028-3fca0f26a10c&page=queryresults
[0m07:48:58.248638 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed263b48610>]}
[0m07:48:58.276640 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m07:48:58.291580 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:48:58.307527 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed26262d0d0>]}
[0m07:48:58.314106 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m07:48:58.336524 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:48:58.339246 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m07:48:58.356290 [info ] [Thread-2 (]: 5 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:48:58.373236 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m07:48:58.377224 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m07:48:58.402489 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:48:58.405600 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m07:48:58.429877 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:48:58.488997 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed262764d10>]}
[0m07:48:58.492407 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.17s]
[0m07:48:58.494516 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:48:58.497521 [debug] [Thread-3 (]: Began running node model.hospital_analytics.medicines
[0m07:48:58.498964 [info ] [Thread-3 (]: 6 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:48:58.499365 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.medicines)
[0m07:48:58.499588 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.medicines
[0m07:48:58.502723 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:48:58.503240 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.medicines
[0m07:48:58.507120 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:48:58.792219 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:48:58.793303 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:48:58.822072 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:48:58.822802 [debug] [Thread-3 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:48:59.467572 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:3bf955ef-a495-4e66-8479-ece23e6832ee&page=queryresults
[0m07:48:59.486453 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2602c1a90>]}
[0m07:48:59.490910 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:6d3f4931-e2a3-4627-911b-92cde5017352&page=queryresults
[0m07:48:59.492297 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 620.0 Bytes processed)[0m in 2.16s]
[0m07:48:59.495292 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:49:00.882510 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed260286f50>]}
[0m07:49:00.883130 [info ] [Thread-3 (]: 6 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.38s]
[0m07:49:00.884029 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.medicines
[0m07:49:01.134519 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2604f7f50>]}
[0m07:49:01.135004 [info ] [Thread-2 (]: 5 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.76s]
[0m07:49:01.136174 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m07:49:01.137289 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:49:01.137763 [info ] [Thread-1 (]: 7 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:49:01.138174 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:49:01.139512 [info ] [Thread-4 (]: 8 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:49:01.139906 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.visits_enhanced)
[0m07:49:01.138852 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.prescriptions_enhanced)
[0m07:49:01.140145 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:49:01.142647 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:49:01.148222 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:49:01.151736 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:49:01.151023 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:49:01.170888 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:49:01.171896 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:49:01.188407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:49:01.558642 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:49:01.560644 [debug] [Thread-4 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `dataeng-2025-gar`.`hospital`.`visits` v
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:49:01.569789 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:49:01.570510 [debug] [Thread-1 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `dataeng-2025-gar`.`hospital`.`prescriptions` pr
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:49:01.868256 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:2c8eac84-fe14-4aed-9e4f-c840754b441c&page=queryresults
[0m07:49:01.889216 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:67035a07-44c2-464a-b741-d74a7dd547a7&page=queryresults
[0m07:49:03.561727 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed26267d250>]}
[0m07:49:03.564736 [info ] [Thread-1 (]: 7 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (5.2k rows, 251.2 KiB processed)[0m in 2.42s]
[0m07:49:03.565201 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:49:03.880661 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed262625350>]}
[0m07:49:03.881226 [info ] [Thread-4 (]: 8 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (3.2k rows, 158.4 KiB processed)[0m in 2.74s]
[0m07:49:03.881952 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:49:03.883549 [debug] [Thread-2 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:49:03.884068 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:49:03.884650 [info ] [Thread-2 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m07:49:03.885636 [info ] [Thread-3 (]: 10 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m07:49:03.886861 [debug] [Thread-1 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:49:03.889219 [info ] [Thread-1 (]: 11 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m07:49:03.887795 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.billing_enhanced)
[0m07:49:03.888601 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.doctor_performance)
[0m07:49:03.889826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.monthly_visit_stats)
[0m07:49:03.890203 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:49:03.890759 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:49:03.891082 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:49:03.894149 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:49:03.927205 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:49:03.926115 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:49:03.918395 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:49:03.930317 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:49:03.938047 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:49:03.939627 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:49:03.942903 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:49:03.947421 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:49:04.337035 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m07:49:04.340371 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m07:49:04.341324 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `dataeng-2025-gar`.`hospital_staging`.`doctors` d
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m07:49:04.344045 [debug] [Thread-2 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `dataeng-2025-gar`.`hospital`.`billing_payments` b
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m07:49:04.359133 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m07:49:04.359958 [debug] [Thread-1 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m07:49:04.597633 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e74b4e75-616f-41e2-b25d-527939be776c&page=queryresults
[0m07:49:04.601389 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:3a08f38f-92bd-4ed0-86de-7cab8d6eb7b8&page=queryresults
[0m07:49:04.610873 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:45a8610f-d3d5-4b13-beab-e4e48998be94&page=queryresults
[0m07:49:06.331183 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed26018a090>]}
[0m07:49:06.332188 [info ] [Thread-2 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (9.2k rows, 385.2 KiB processed)[0m in 2.44s]
[0m07:49:06.333226 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:49:06.335875 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:49:06.336302 [info ] [Thread-4 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m07:49:06.337594 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.patient_journey)
[0m07:49:06.338076 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:49:06.336735 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:49:06.345856 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:49:06.348212 [info ] [Thread-2 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m07:49:06.362748 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:49:06.363659 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m07:49:06.366029 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:49:06.367753 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:49:06.444385 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:49:06.446228 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:49:06.448122 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:49:06.578729 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed26015a6d0>]}
[0m07:49:06.579479 [info ] [Thread-1 (]: 11 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (11.0 rows, 208.4 KiB processed)[0m in 2.69s]
[0m07:49:06.582468 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:49:06.808705 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m07:49:06.809405 [debug] [Thread-4 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `dataeng-2025-gar`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m07:49:06.817568 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m07:49:06.818284 [debug] [Thread-2 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `dataeng-2025-gar`.`hospital_staging`.`patients` p
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m07:49:07.027053 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:35c5bb6f-f03b-4466-8d3b-4f3aa64eeb0d&page=queryresults
[0m07:49:07.062528 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:aa0bfa40-67c5-4988-bbcc-d59e397e9132&page=queryresults
[0m07:49:08.990565 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed262681650>]}
[0m07:49:08.991254 [info ] [Thread-3 (]: 10 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 263.2 KiB processed)[0m in 5.10s]
[0m07:49:08.991857 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:49:09.222919 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed2602ba210>]}
[0m07:49:09.223819 [info ] [Thread-4 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (191.9k rows, 1.0 MiB processed)[0m in 2.89s]
[0m07:49:09.224874 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:49:29.168873 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c2b23c4-a2ab-4847-a7f6-6dfb9febc266', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed260269f10>]}
[0m07:49:29.169354 [info ] [Thread-2 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 527.5 KiB processed)[0m in 22.81s]
[0m07:49:29.170654 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:49:29.175545 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:49:29.177144 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:49:29.177725 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:49:29.177887 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:49:29.178009 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m07:49:29.178122 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:49:29.178355 [info ] [MainThread]: 
[0m07:49:29.184618 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 33.11 seconds (33.11s).
[0m07:49:29.193904 [debug] [MainThread]: Command end result
[0m07:49:29.240000 [info ] [MainThread]: 
[0m07:49:29.240723 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:49:29.241042 [info ] [MainThread]: 
[0m07:49:29.241672 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m07:49:29.242856 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 34.87285, "process_in_blocks": "0", "process_kernel_time": 0.869148, "process_mem_max_rss": "214272", "process_out_blocks": "3744", "process_user_time": 4.143996}
[0m07:49:29.243240 [debug] [MainThread]: Command `dbt run` succeeded at 07:49:29.243162 after 34.87 seconds
[0m07:49:29.243627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed28b118cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed28b275290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ed28b274950>]}
[0m07:49:29.243854 [debug] [MainThread]: Flushing usage events
[0m07:50:30.969453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df871760710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df8717a68d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df871af47d0>]}


============================== 07:50:30.983608 | a45084b2-e491-4dc6-aef8-56194bed6f02 ==============================
[0m07:50:30.983608 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:50:30.988226 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m07:50:31.010479 [info ] [MainThread]: dbt version: 1.8.9
[0m07:50:31.015952 [info ] [MainThread]: python version: 3.11.2
[0m07:50:31.016182 [info ] [MainThread]: python path: /usr/local/bin/python
[0m07:50:31.016320 [info ] [MainThread]: os info: Linux-6.11.0-24-generic-x86_64-with-glibc2.31
[0m07:50:32.839420 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m07:50:32.852327 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m07:50:32.852559 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/dbt_project.yml
[0m07:50:32.852708 [info ] [MainThread]: adapter type: bigquery
[0m07:50:32.852837 [info ] [MainThread]: adapter version: 1.9.0
[0m07:50:33.084911 [info ] [MainThread]: Configuration:
[0m07:50:33.093664 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m07:50:33.093918 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m07:50:33.094055 [info ] [MainThread]: Required dependencies:
[0m07:50:33.094217 [debug] [MainThread]: Executing "git --help"
[0m07:50:33.109380 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m07:50:33.109740 [debug] [MainThread]: STDERR: "b''"
[0m07:50:33.109980 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m07:50:33.110404 [info ] [MainThread]: Connection:
[0m07:50:33.110588 [info ] [MainThread]:   method: service-account
[0m07:50:33.110810 [info ] [MainThread]:   database: dataeng-2025-gar
[0m07:50:33.111026 [info ] [MainThread]:   execution_project: dataeng-2025-gar
[0m07:50:33.111237 [info ] [MainThread]:   schema: hospital
[0m07:50:33.111514 [info ] [MainThread]:   location: asia-southeast2
[0m07:50:33.111713 [info ] [MainThread]:   priority: interactive
[0m07:50:33.111893 [info ] [MainThread]:   maximum_bytes_billed: None
[0m07:50:33.112078 [info ] [MainThread]:   impersonate_service_account: None
[0m07:50:33.112524 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m07:50:33.112715 [info ] [MainThread]:   job_retries: 1
[0m07:50:33.112858 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m07:50:33.113034 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m07:50:33.113508 [info ] [MainThread]:   timeout_seconds: 300
[0m07:50:33.113725 [info ] [MainThread]:   client_id: None
[0m07:50:33.113852 [info ] [MainThread]:   token_uri: None
[0m07:50:33.114573 [info ] [MainThread]:   dataproc_region: None
[0m07:50:33.114761 [info ] [MainThread]:   dataproc_cluster_name: None
[0m07:50:33.114893 [info ] [MainThread]:   gcs_bucket: None
[0m07:50:33.115010 [info ] [MainThread]:   dataproc_batch: None
[0m07:50:33.116741 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:50:33.597019 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m07:50:33.598221 [debug] [MainThread]: On debug: select 1 as id
[0m07:50:33.604206 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:50:34.178344 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:917e9ef3-8ac7-4a03-8c1b-0377940d8f17&page=queryresults
[0m07:50:34.485130 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m07:50:34.485698 [info ] [MainThread]: [32mAll checks passed![0m
[0m07:50:34.487807 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 3.6396956, "process_in_blocks": "0", "process_kernel_time": 1.206311, "process_mem_max_rss": "201640", "process_out_blocks": "24", "process_user_time": 4.529409}
[0m07:50:34.488832 [debug] [MainThread]: Command `dbt debug` succeeded at 07:50:34.488675 after 3.64 seconds
[0m07:50:34.489089 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m07:50:34.489348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df8717a75d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df84d84f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df874f8ce10>]}
[0m07:50:34.489616 [debug] [MainThread]: Flushing usage events
[0m07:50:39.905414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd55b8750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd5603750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd594c7d0>]}


============================== 07:50:39.914465 | fec939e1-bade-4946-b9ce-66a17ef878ee ==============================
[0m07:50:39.914465 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:50:39.919529 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt clean', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:50:40.209264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fec939e1-bade-4946-b9ce-66a17ef878ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd55b2450>]}
[0m07:50:40.263052 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.49777934, "process_in_blocks": "0", "process_kernel_time": 0.6003, "process_mem_max_rss": "89396", "process_out_blocks": "8", "process_user_time": 2.350284}
[0m07:50:40.264831 [debug] [MainThread]: Command `dbt clean` succeeded at 07:50:40.263431 after 0.50 seconds
[0m07:50:40.265128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd5603c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd8de4e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79bfd8f68a50>]}
[0m07:50:40.266199 [debug] [MainThread]: Flushing usage events
[0m07:50:44.217118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a241dce090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a241e0b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a241e0b050>]}


============================== 07:50:44.231788 | 96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e ==============================
[0m07:50:44.231788 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:50:44.232538 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:50:45.523934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21f99f750>]}
[0m07:50:45.554452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a243b8a110>]}
[0m07:50:45.554972 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:50:45.753974 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:50:45.763635 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m07:50:45.763992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21df77e10>]}
[0m07:50:46.836927 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m07:50:46.837476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a241e50ad0>]}
[0m07:50:47.590949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21caea050>]}
[0m07:50:47.781208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21cb11810>]}
[0m07:50:47.784335 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:50:47.786303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21dcf0390>]}
[0m07:50:47.793139 [info ] [MainThread]: 
[0m07:50:47.798809 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:50:47.831949 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:50:47.833940 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:50:47.834463 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:47.846532 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar'
[0m07:50:47.847568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:47.850346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:49.000077 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_analytics)
[0m07:50:49.000438 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:50:49.018885 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_staging)
[0m07:50:49.131864 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:50:49.148753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar, now list_dataeng-2025-gar_hospital_intermediate)
[0m07:50:49.161255 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:50:49.785370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21e0797d0>]}
[0m07:50:49.786861 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:50:49.795943 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:50:49.806204 [info ] [MainThread]: 
[0m07:50:49.844045 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:50:49.844730 [info ] [Thread-1 (]: 1 of 13 START sql view model hospital_staging._hospital_medicines .............. [RUN]
[0m07:50:49.846695 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_medicines)
[0m07:50:49.853835 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:50:49.918754 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:50:49.920201 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:50:49.927523 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:50:49.925072 [info ] [Thread-2 (]: 2 of 13 START sql view model hospital_staging._hospital_patients ............... [RUN]
[0m07:50:49.926919 [info ] [Thread-4 (]: 4 of 13 START sql table model hospital_staging.doctors ......................... [RUN]
[0m07:50:49.995040 [info ] [Thread-3 (]: 3 of 13 START sql view model hospital_staging._hospital_visits ................. [RUN]
[0m07:50:50.035123 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:50:50.025812 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:50:50.018869 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_patients)
[0m07:50:50.047642 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:50:50.030293 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:50:50.044069 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:50:50.038080 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:50:50.067915 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:50:50.068538 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:50:50.080876 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:50:50.097376 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:50:50.129328 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:50:50.224538 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:50:50.248019 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:50:50.273625 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics._hospital_medicines"
[0m07:50:50.283001 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics._hospital_visits"
[0m07:50:50.316630 [debug] [Thread-1 (]: On model.hospital_analytics._hospital_medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_medicines"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
  OPTIONS()
  as 

SELECT 
  medicine_id,
  name,
  category,
  manufacturer,
  SAFE_CAST(price AS NUMERIC) AS price 
FROM `dataeng-2025-gar`.`hospital`.`medicines`;


[0m07:50:50.332596 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics._hospital_patients"
[0m07:50:50.350198 [debug] [Thread-3 (]: On model.hospital_analytics._hospital_visits: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_visits"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`
  OPTIONS()
  as 

SELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`;


[0m07:50:50.391137 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:50:50.362112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:50:50.399907 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:50:50.400364 [debug] [Thread-2 (]: On model.hospital_analytics._hospital_patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics._hospital_patients"} */


  create or replace view `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
  OPTIONS()
  as 

SELECT 
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,
  
  -- Age group calculation
  CASE
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM `dataeng-2025-gar`.`hospital`.`patients`;


[0m07:50:50.693874 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:50:51.307510 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.doctors"
[0m07:50:51.308396 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:d0e66a56-e397-444b-8259-7b292dfad917&page=queryresults
[0m07:50:51.323123 [debug] [Thread-4 (]: On model.hospital_analytics.doctors: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctors"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`doctors`
      
    
    

    OPTIONS()
    as (
      

SELECT
  doctor_id,
  name AS doctor_name,
  specialization,
  experience_years,
  contact_info,
  -- Add some derived fields
  CASE
    WHEN experience_years < 5 THEN 'Junior'
    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'
    ELSE 'Senior'
  END AS experience_level
FROM `dataeng-2025-gar`.`hospital`.`doctors`
    );
  
[0m07:50:51.345444 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:84d13345-7c6b-4fdc-81ba-5907f2f4a65c&page=queryresults
[0m07:50:51.367227 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9bb4ff50-9396-4e1f-bf9b-9d05f4be1ce6&page=queryresults
[0m07:50:51.620922 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:4a35f072-b088-4420-8fe3-fbff3bc5d1b0&page=queryresults
[0m07:50:51.652664 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a1f4f12610>]}
[0m07:50:51.653721 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21c898590>]}
[0m07:50:51.654191 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21cb10c10>]}
[0m07:50:51.654912 [info ] [Thread-1 (]: 1 of 13 OK created sql view model hospital_staging._hospital_medicines ......... [[32mCREATE VIEW (0 processed)[0m in 1.80s]
[0m07:50:51.670995 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:50:51.662796 [info ] [Thread-2 (]: 2 of 13 OK created sql view model hospital_staging._hospital_patients .......... [[32mCREATE VIEW (0 processed)[0m in 1.64s]
[0m07:50:51.675482 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:50:51.661749 [info ] [Thread-3 (]: 3 of 13 OK created sql view model hospital_staging._hospital_visits ............ [[32mCREATE VIEW (0 processed)[0m in 1.62s]
[0m07:50:51.739290 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:50:51.742250 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m07:50:51.742868 [info ] [Thread-1 (]: 5 of 13 START sql table model hospital_staging.medicines ....................... [RUN]
[0m07:50:51.743597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m07:50:51.743888 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m07:50:51.779773 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patients
[0m07:50:51.804106 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:50:51.783062 [info ] [Thread-2 (]: 6 of 13 START sql table model hospital_staging.patients ........................ [RUN]
[0m07:50:51.824342 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m07:50:51.833516 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:50:51.807193 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now model.hospital_analytics.patients)
[0m07:50:51.893531 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patients
[0m07:50:51.896929 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:50:51.897396 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patients
[0m07:50:51.899981 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:50:52.383456 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.medicines"
[0m07:50:52.385167 [debug] [Thread-1 (]: On model.hospital_analytics.medicines: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.medicines"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`medicines`
      
    
    

    OPTIONS()
    as (
      

SELECT
  medicine_id,
  name AS medicine_name,
  category,
  manufacturer,
  -- Perbaikan: Konversi ke numeric
  SAFE_CAST(price AS NUMERIC) AS price,
  -- Perbaikan price category dengan tipe data yang benar
  CASE
    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'
    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'
    ELSE 'High-cost'
  END AS price_category
FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`
    );
  
[0m07:50:52.429515 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patients"
[0m07:50:52.431550 [debug] [Thread-2 (]: On model.hospital_analytics.patients: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patients"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_staging`.`patients`
      
    
    

    OPTIONS()
    as (
      

WITH cleaned_patients AS (
  SELECT
    patient_id,
    full_name,
    date_of_birth,
    gender,
    blood_type,
    contact_info,
    insurance_id
  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`
)

SELECT
  patient_id,
  full_name,
  date_of_birth,
  gender,
  blood_type,
  contact_info,
  insurance_id,
  -- Hitung usia
  CASE
    WHEN date_of_birth IS NOT NULL 
    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)
    ELSE NULL
  END AS age,
  -- Kategori usia
  CASE
    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'
    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'
    ELSE 'Senior'
  END AS age_group
FROM cleaned_patients
    );
  
[0m07:50:53.012496 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:5887dd59-0816-4eca-88ec-a3de8dcd113c&page=queryresults
[0m07:50:53.110027 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:e0e968b6-d8f7-405f-a3be-de2fcf32a9af&page=queryresults
[0m07:50:53.356491 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21c8a4310>]}
[0m07:50:53.364553 [info ] [Thread-4 (]: 4 of 13 OK created sql table model hospital_staging.doctors .................... [[32mCREATE TABLE (10.0 rows, 620.0 Bytes processed)[0m in 3.33s]
[0m07:50:53.375138 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:50:54.535846 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21c8b7890>]}
[0m07:50:54.536372 [info ] [Thread-2 (]: 6 of 13 OK created sql table model hospital_staging.patients ................... [[32mCREATE TABLE (100.0 rows, 6.7 KiB processed)[0m in 2.73s]
[0m07:50:54.538119 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patients
[0m07:50:54.578142 [debug] [Thread-3 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:50:54.578609 [info ] [Thread-3 (]: 7 of 13 START sql table model hospital_intermediate.visits_enhanced ............ [RUN]
[0m07:50:54.580654 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now model.hospital_analytics.visits_enhanced)
[0m07:50:54.584332 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:50:54.589082 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:50:54.590042 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:50:54.596036 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:50:54.710996 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21c918150>]}
[0m07:50:54.714293 [info ] [Thread-1 (]: 5 of 13 OK created sql table model hospital_staging.medicines .................. [[32mCREATE TABLE (15.0 rows, 841.0 Bytes processed)[0m in 2.97s]
[0m07:50:54.716769 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m07:50:54.719514 [debug] [Thread-2 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:50:54.720209 [info ] [Thread-2 (]: 8 of 13 START sql table model hospital_intermediate.prescriptions_enhanced ..... [RUN]
[0m07:50:54.721174 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now model.hospital_analytics.prescriptions_enhanced)
[0m07:50:54.721419 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:50:54.729936 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:50:54.730712 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:50:54.734634 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:50:55.174540 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.visits_enhanced"
[0m07:50:55.177061 [debug] [Thread-3 (]: On model.hospital_analytics.visits_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.visits_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.total_cost,
  p.patient_id,
  p.full_name,
  p.age,
  p.age_group,
  p.gender,
  p.blood_type,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  -- Add some derived metrics
  CASE
    WHEN v.total_cost > 500 THEN 'High-cost visit'
    WHEN v.total_cost > 200 THEN 'Medium-cost visit'
    ELSE 'Low-cost visit'
  END AS cost_category,
  EXTRACT(MONTH FROM v.visit_date) AS visit_month,
  EXTRACT(YEAR FROM v.visit_date) AS visit_year
FROM `dataeng-2025-gar`.`hospital`.`visits` v
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id
    );
  
[0m07:50:55.242665 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:50:55.243206 [debug] [Thread-2 (]: On model.hospital_analytics.prescriptions_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.prescriptions_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  pr.prescription_id,
  pr.dosage,
  pr.duration,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  m.medicine_id,
  m.medicine_name,
  m.category AS medicine_category,
  m.price,
  m.price_category,
  -- Calculate estimated total cost
  CASE
    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price
    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price
    ELSE m.price
  END AS estimated_total_cost
FROM `dataeng-2025-gar`.`hospital`.`prescriptions` pr
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id
    );
  
[0m07:50:55.401272 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:fc0d7099-8601-4f29-8961-8d0fac0261f2&page=queryresults
[0m07:50:55.467141 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:652b2c49-9e82-4372-bd2b-7753e72dfc2a&page=queryresults
[0m07:50:56.828363 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a1f4c28f50>]}
[0m07:50:56.831780 [info ] [Thread-3 (]: 7 of 13 OK created sql table model hospital_intermediate.visits_enhanced ....... [[32mCREATE TABLE (3.2k rows, 158.4 KiB processed)[0m in 2.25s]
[0m07:50:56.833308 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:50:56.845061 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:50:56.846470 [info ] [Thread-1 (]: 9 of 13 START sql table model hospital_intermediate.billing_enhanced ........... [RUN]
[0m07:50:56.847798 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.billing_enhanced)
[0m07:50:56.848012 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:50:56.866431 [debug] [Thread-4 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:50:56.867954 [info ] [Thread-4 (]: 10 of 13 START sql table model hospital_analytics.monthly_visit_stats .......... [RUN]
[0m07:50:56.868303 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now model.hospital_analytics.monthly_visit_stats)
[0m07:50:56.875984 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:50:56.879097 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:50:56.883474 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:50:56.905071 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:50:56.928752 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:50:56.929231 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:50:56.937979 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:50:57.281399 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21c8e2c90>]}
[0m07:50:57.287429 [info ] [Thread-2 (]: 8 of 13 OK created sql table model hospital_intermediate.prescriptions_enhanced  [[32mCREATE TABLE (5.2k rows, 251.2 KiB processed)[0m in 2.56s]
[0m07:50:57.300368 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:50:57.309367 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:50:57.309826 [info ] [Thread-3 (]: 11 of 13 START sql table model hospital_analytics.doctor_performance ........... [RUN]
[0m07:50:57.310725 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now model.hospital_analytics.doctor_performance)
[0m07:50:57.310978 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:50:57.314842 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:50:57.317997 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:50:57.347856 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:50:57.496331 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.billing_enhanced"
[0m07:50:57.507261 [debug] [Thread-1 (]: On model.hospital_analytics.billing_enhanced: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.billing_enhanced"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced`
      
    
    

    OPTIONS()
    as (
      

SELECT
  b.billing_id,
  b.billing_date,
  b.total_amount,
  b.payment_status,
  v.visit_id,
  v.visit_date,
  v.diagnosis,
  v.doctor_name,
  v.specialization,
  p.patient_id,
  p.full_name,
  p.age_group,
  p.insurance_id,
  -- Add some derived fields
  EXTRACT(MONTH FROM b.billing_date) AS billing_month,
  EXTRACT(YEAR FROM b.billing_date) AS billing_year,
  CASE
    WHEN b.payment_status = 'Paid' THEN 1
    ELSE 0
  END AS is_paid,
  -- Days between visit and billing
  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill
FROM `dataeng-2025-gar`.`hospital`.`billing_payments` b
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id
LEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id
    );
  
[0m07:50:57.649348 [debug] [Thread-4 (]: Writing runtime sql for node "model.hospital_analytics.monthly_visit_stats"
[0m07:50:57.659114 [debug] [Thread-4 (]: On model.hospital_analytics.monthly_visit_stats: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.monthly_visit_stats"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`monthly_visit_stats`
      
    
    

    OPTIONS()
    as (
      

SELECT
  visit_year,
  visit_month,
  COUNT(DISTINCT visit_id) AS total_visits,
  COUNT(DISTINCT patient_id) AS unique_patients,
  COUNT(DISTINCT doctor_id) AS unique_doctors,
  SUM(total_cost) AS total_revenue,
  AVG(total_cost) AS avg_visit_cost,
  -- Calculate percentage of high-cost visits
  SAFE_DIVIDE(
    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),
    COUNT(*)
  ) * 100 AS pct_high_cost_visits
FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`
GROUP BY visit_year, visit_month
ORDER BY visit_year, visit_month
    );
  
[0m07:50:57.761686 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:7bbaec43-1677-434d-af25-91e8fbe9e51e&page=queryresults
[0m07:50:57.874159 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:a3d2d554-281a-4bea-a58d-2605a2c433e9&page=queryresults
[0m07:50:57.968862 [debug] [Thread-3 (]: Writing runtime sql for node "model.hospital_analytics.doctor_performance"
[0m07:50:57.974709 [debug] [Thread-3 (]: On model.hospital_analytics.doctor_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.doctor_performance"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`doctor_performance`
      
    
    

    OPTIONS()
    as (
      

SELECT
  d.doctor_id,
  d.doctor_name,
  d.specialization,
  d.experience_level,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  COUNT(DISTINCT v.patient_id) AS unique_patients,
  SUM(v.total_cost) AS total_revenue_generated,
  AVG(v.total_cost) AS avg_visit_cost,
  -- Prescription metrics
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_value
FROM `dataeng-2025-gar`.`hospital_staging`.`doctors` d
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id
GROUP BY 1, 2, 3, 4
ORDER BY total_revenue_generated DESC
    );
  
[0m07:50:58.225381 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:ab34c610-82e9-4a39-80ca-a3fd299dd0a2&page=queryresults
[0m07:50:59.211359 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a1f4b0bed0>]}
[0m07:50:59.211943 [info ] [Thread-1 (]: 9 of 13 OK created sql table model hospital_intermediate.billing_enhanced ...... [[32mCREATE TABLE (9.2k rows, 385.2 KiB processed)[0m in 2.36s]
[0m07:50:59.212643 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:50:59.213766 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_journey
[0m07:50:59.214188 [info ] [Thread-2 (]: 12 of 13 START sql table model hospital_analytics.patient_journey .............. [RUN]
[0m07:50:59.214577 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:50:59.216001 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.patient_journey)
[0m07:50:59.216595 [info ] [Thread-1 (]: 13 of 13 START sql table model hospital_analytics.patient_spending_analysis .... [RUN]
[0m07:50:59.217457 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:50:59.218015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now model.hospital_analytics.patient_spending_analysis)
[0m07:50:59.222340 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:50:59.221818 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:50:59.230020 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:50:59.232573 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:50:59.256196 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:50:59.385850 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:50:59.389531 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:50:59.759278 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21ca34590>]}
[0m07:50:59.768172 [info ] [Thread-4 (]: 10 of 13 OK created sql table model hospital_analytics.monthly_visit_stats ..... [[32mCREATE TABLE (11.0 rows, 208.4 KiB processed)[0m in 2.89s]
[0m07:50:59.777826 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:50:59.992990 [debug] [Thread-2 (]: Writing runtime sql for node "model.hospital_analytics.patient_journey"
[0m07:50:59.996167 [debug] [Thread-2 (]: On model.hospital_analytics.patient_journey: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_journey"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_journey`
      
    
    

    OPTIONS()
    as (
      

WITH patient_data AS (
  SELECT 
    patient_id,
    full_name,
    gender,
    age
  FROM `dataeng-2025-gar`.`hospital_staging`.`patients`
),

visit_details AS (
  SELECT
    v.visit_id,
    v.visit_date,
    v.patient_id,
    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,
    v.doctor_id,
    v.doctor_name,
    v.specialization,
    v.diagnosis,
    v.total_cost AS visit_cost,
    v.cost_category,
    p.gender,
    p.age
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
  LEFT JOIN patient_data p ON v.patient_id = p.patient_id
),

prescription_details AS (
  SELECT
    p.prescription_id,
    p.patient_id,
    p.doctor_id,
    p.medicine_name,
    p.dosage,
    p.duration,
    p.estimated_total_cost AS prescription_cost,
    -- Using visit_date as proxy since prescription_date doesn't exist
    (SELECT MIN(v.visit_date) 
    FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v
    WHERE v.patient_id = p.patient_id
      AND v.doctor_id = p.doctor_id
    ) AS approximate_prescription_date
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` p
),

billing_details AS (
  SELECT
    b.billing_id,
    b.visit_id,
    b.patient_id,
    b.billing_date,
    b.total_amount,
    b.payment_status,
    b.days_to_bill
  FROM `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b
)

SELECT
  vd.visit_id,
  vd.visit_date,
  vd.patient_id,
  vd.patient_full_name AS patient_name,
  vd.gender,
  vd.age,
  vd.doctor_id,
  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,
  COALESCE(vd.specialization, 'Not Specified') AS specialization,
  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,
  vd.visit_cost,
  vd.cost_category,
  
  pd.prescription_id,
  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,
  pd.dosage,
  pd.duration,
  COALESCE(pd.prescription_cost, 0) AS prescription_cost,
  
  bd.billing_id,
  bd.billing_date,
  bd.total_amount AS billed_amount,
  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,
  bd.days_to_bill,
  
  -- Financial calculations
  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,
  CASE
    WHEN bd.payment_status = 'Paid' THEN 0
    ELSE COALESCE(bd.total_amount, vd.visit_cost)
  END AS outstanding_balance,
  
  -- Enhanced analytics
  CASE
    WHEN pd.prescription_id IS NOT NULL THEN 1
    ELSE 0
  END AS has_prescription,
  
  COUNT(pd.prescription_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_prescriptions_for_patient,
  
  AVG(vd.visit_cost) OVER (
    PARTITION BY vd.patient_id
  ) AS avg_visit_cost_per_patient,
  
  -- Visit analytics
  COUNT(vd.visit_id) OVER (
    PARTITION BY vd.patient_id
  ) AS total_visits_for_patient

FROM visit_details vd
LEFT JOIN prescription_details pd ON 
  vd.patient_id = pd.patient_id AND
  vd.doctor_id = pd.doctor_id
LEFT JOIN billing_details bd ON 
  vd.visit_id = bd.visit_id
ORDER BY 
  vd.patient_full_name,
  vd.visit_date
    );
  
[0m07:51:00.017297 [debug] [Thread-1 (]: Writing runtime sql for node "model.hospital_analytics.patient_spending_analysis"
[0m07:51:00.018589 [debug] [Thread-1 (]: On model.hospital_analytics.patient_spending_analysis: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "node_id": "model.hospital_analytics.patient_spending_analysis"} */

  
    

    create or replace table `dataeng-2025-gar`.`hospital_analytics`.`patient_spending_analysis`
      
    
    

    OPTIONS()
    as (
      

SELECT
  p.patient_id,
  p.full_name,
  p.age_group,
  p.gender,
  p.blood_type,
  COUNT(DISTINCT v.visit_id) AS total_visits,
  SUM(v.total_cost) AS total_medical_spend,
  AVG(v.total_cost) AS avg_visit_cost,
  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,
  SUM(pr.estimated_total_cost) AS total_prescription_spend,
  COUNT(DISTINCT b.billing_id) AS total_bills,
  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,
  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding
FROM `dataeng-2025-gar`.`hospital_staging`.`patients` p
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id
LEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id
GROUP BY 1, 2, 3, 4, 5
ORDER BY total_medical_spend DESC
    );
  
[0m07:51:00.217153 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9cd7e8b1-545e-4da8-b049-03c8a0df06c6&page=queryresults
[0m07:51:00.256931 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:9d033a58-2e8d-4b7c-b0cd-d3dcc272ff81&page=queryresults
[0m07:51:01.420999 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a1f4f12510>]}
[0m07:51:01.421569 [info ] [Thread-3 (]: 11 of 13 OK created sql table model hospital_analytics.doctor_performance ...... [[32mCREATE TABLE (10.0 rows, 263.2 KiB processed)[0m in 4.11s]
[0m07:51:01.424419 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:51:02.308769 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21c8ca850>]}
[0m07:51:02.310445 [info ] [Thread-2 (]: 12 of 13 OK created sql table model hospital_analytics.patient_journey ......... [[32mCREATE TABLE (191.9k rows, 1.0 MiB processed)[0m in 3.09s]
[0m07:51:02.313665 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:51:38.183164 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96e1eca0-2ab9-4e92-8eea-c68a7ace4e1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a21ca7da90>]}
[0m07:51:38.184921 [info ] [Thread-1 (]: 13 of 13 OK created sql table model hospital_analytics.patient_spending_analysis  [[32mCREATE TABLE (100.0 rows, 527.5 KiB processed)[0m in 38.75s]
[0m07:51:38.302719 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:51:40.699653 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:51:41.236409 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:51:41.730484 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:51:41.731921 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:51:42.514884 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:51:42.610286 [debug] [MainThread]: Connection 'model.hospital_analytics.monthly_visit_stats' was properly closed.
[0m07:51:42.823696 [info ] [MainThread]: 
[0m07:51:42.875856 [info ] [MainThread]: Finished running 3 view models, 10 table models in 0 hours 0 minutes and 54.81 seconds (54.81s).
[0m07:51:43.415218 [debug] [MainThread]: Command end result
[0m07:51:46.562621 [info ] [MainThread]: 
[0m07:51:46.575611 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:51:46.594626 [info ] [MainThread]: 
[0m07:51:46.600508 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m07:51:46.621020 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 62.64825, "process_in_blocks": "0", "process_kernel_time": 3.859004, "process_mem_max_rss": "215552", "process_out_blocks": "3736", "process_user_time": 6.506987}
[0m07:51:46.635545 [debug] [MainThread]: Command `dbt run` succeeded at 07:51:46.621438 after 62.67 seconds
[0m07:51:46.636930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a241e14810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a24561cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71a2457a0a10>]}
[0m07:51:46.637176 [debug] [MainThread]: Flushing usage events
[0m07:52:47.770745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88dfb1d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88f386610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88e344e90>]}


============================== 07:52:47.773007 | 5ce8ded3-96eb-495c-bb39-2c3962d99fbc ==============================
[0m07:52:47.773007 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:52:47.773385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:52:48.446031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5ce8ded3-96eb-495c-bb39-2c3962d99fbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e86a3fa590>]}
[0m07:52:48.477500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5ce8ded3-96eb-495c-bb39-2c3962d99fbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88fd3ef90>]}
[0m07:52:48.478003 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m07:52:48.669548 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m07:52:48.849679 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:52:48.852567 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:52:48.952474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ce8ded3-96eb-495c-bb39-2c3962d99fbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e869e68650>]}
[0m07:52:49.022059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ce8ded3-96eb-495c-bb39-2c3962d99fbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e86a0f5150>]}
[0m07:52:49.022879 [info ] [MainThread]: Found 13 models, 11 data tests, 6 sources, 487 macros
[0m07:52:49.023491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ce8ded3-96eb-495c-bb39-2c3962d99fbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e869f79750>]}
[0m07:52:49.027689 [info ] [MainThread]: 
[0m07:52:49.028346 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m07:52:49.055078 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_analytics'
[0m07:52:49.057048 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:49.099995 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_intermediate'
[0m07:52:49.106847 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:49.486996 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_dataeng-2025-gar_hospital_staging'
[0m07:52:49.537831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:50.414173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ce8ded3-96eb-495c-bb39-2c3962d99fbc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88df95710>]}
[0m07:52:50.416560 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:52:50.426475 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m07:52:50.433886 [info ] [MainThread]: 
[0m07:52:50.506979 [debug] [Thread-1 (]: Began running node model.hospital_analytics._hospital_medicines
[0m07:52:50.508166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_staging, now model.hospital_analytics._hospital_medicines)
[0m07:52:50.508586 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics._hospital_medicines
[0m07:52:50.531403 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics._hospital_medicines"
[0m07:52:50.542154 [debug] [Thread-2 (]: Began running node model.hospital_analytics._hospital_patients
[0m07:52:50.543305 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_intermediate, now model.hospital_analytics._hospital_patients)
[0m07:52:50.554047 [debug] [Thread-1 (]: Began executing node model.hospital_analytics._hospital_medicines
[0m07:52:50.556738 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:50.556171 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics._hospital_patients
[0m07:52:50.555018 [debug] [Thread-3 (]: Began running node model.hospital_analytics._hospital_visits
[0m07:52:50.564828 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_dataeng-2025-gar_hospital_analytics, now model.hospital_analytics._hospital_visits)
[0m07:52:50.560077 [debug] [Thread-4 (]: Began running node model.hospital_analytics.doctors
[0m07:52:50.567253 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.hospital_analytics.doctors'
[0m07:52:50.559714 [debug] [Thread-1 (]: Finished running node model.hospital_analytics._hospital_medicines
[0m07:52:50.565782 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics._hospital_visits
[0m07:52:50.567533 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.doctors
[0m07:52:50.563783 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics._hospital_patients"
[0m07:52:50.572892 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics._hospital_visits"
[0m07:52:50.626494 [debug] [Thread-1 (]: Began running node model.hospital_analytics.medicines
[0m07:52:50.627963 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.doctors"
[0m07:52:50.628593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_medicines, now model.hospital_analytics.medicines)
[0m07:52:50.628974 [debug] [Thread-2 (]: Began executing node model.hospital_analytics._hospital_patients
[0m07:52:50.629687 [debug] [Thread-3 (]: Began executing node model.hospital_analytics._hospital_visits
[0m07:52:50.630375 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.medicines
[0m07:52:50.630820 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:52:50.631197 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.doctors
[0m07:52:50.638488 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:52:50.634798 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.medicines"
[0m07:52:50.631578 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:52:50.639319 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.medicines
[0m07:52:50.637264 [debug] [Thread-2 (]: Finished running node model.hospital_analytics._hospital_patients
[0m07:52:50.640174 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:50.641849 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.doctors
[0m07:52:50.647543 [debug] [Thread-3 (]: Finished running node model.hospital_analytics._hospital_visits
[0m07:52:50.651717 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.medicines
[0m07:52:50.695994 [debug] [Thread-1 (]: Began running node model.hospital_analytics.patients
[0m07:52:50.700381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.medicines, now model.hospital_analytics.patients)
[0m07:52:50.722642 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.patients
[0m07:52:50.752501 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.patients"
[0m07:52:50.755949 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.patients
[0m07:52:50.756241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:50.764572 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.patients
[0m07:52:50.767532 [debug] [Thread-1 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:52:50.777150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.patients, now test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9)
[0m07:52:50.781445 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:52:50.787677 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:52:50.788870 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:52:50.792608 [debug] [Thread-2 (]: Began running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:52:50.798102 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.doctors, now test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061)
[0m07:52:50.843740 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:52:50.798994 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_visits, now test.hospital_analytics.not_null_doctors_experience_years.f354663d1a)
[0m07:52:50.825687 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.hospital_analytics._hospital_patients, now test.hospital_analytics.unique_doctors_doctor_id.c207617ce7)
[0m07:52:50.920486 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9"
[0m07:52:50.916148 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061"
[0m07:52:50.921280 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:52:50.921775 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:52:50.928706 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a"
[0m07:52:50.936703 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7"
[0m07:52:50.937666 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:52:50.939912 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:52:50.943522 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:52:50.944302 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:50.945580 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:52:50.947581 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:52:50.957171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:50.982448 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:52:51.042573 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9
[0m07:52:51.004815 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061
[0m07:52:51.019166 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_doctors_experience_years.f354663d1a
[0m07:52:51.048170 [debug] [Thread-1 (]: Began running node model.hospital_analytics.prescriptions_enhanced
[0m07:52:51.065477 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.unique_doctors_doctor_id.c207617ce7
[0m07:52:51.075167 [debug] [Thread-4 (]: Began running node model.hospital_analytics.visits_enhanced
[0m07:52:51.091739 [debug] [Thread-3 (]: Began running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m07:52:51.101178 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061, now model.hospital_analytics.visits_enhanced)
[0m07:52:51.093670 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m07:52:51.092903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9, now model.hospital_analytics.prescriptions_enhanced)
[0m07:52:51.104973 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_doctors_experience_years.f354663d1a, now test.hospital_analytics.not_null_patients_age.8fed007e09)
[0m07:52:51.116357 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.visits_enhanced
[0m07:52:51.129729 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_doctors_doctor_id.c207617ce7, now test.hospital_analytics.not_null_patients_full_name.7bac40f23c)
[0m07:52:51.172902 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m07:52:51.139772 [debug] [Thread-3 (]: Began compiling node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m07:52:51.139095 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.prescriptions_enhanced
[0m07:52:51.199994 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.visits_enhanced"
[0m07:52:51.216085 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_full_name.7bac40f23c"
[0m07:52:51.273175 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m07:52:51.273569 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:52:51.321930 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.prescriptions_enhanced"
[0m07:52:51.358727 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.visits_enhanced
[0m07:52:51.366009 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:51.348044 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.prescriptions_enhanced
[0m07:52:51.383445 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:51.332814 [debug] [Thread-3 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_age.8fed007e09"
[0m07:52:51.387699 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_full_name.7bac40f23c
[0m07:52:51.388281 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.visits_enhanced
[0m07:52:51.388665 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.prescriptions_enhanced
[0m07:52:51.389674 [debug] [Thread-3 (]: Began executing node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m07:52:51.390305 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m07:52:51.391427 [debug] [Thread-4 (]: Began running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m07:52:51.394878 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.visits_enhanced, now test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a)
[0m07:52:51.393653 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:52:51.394257 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_full_name.7bac40f23c, now test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9)
[0m07:52:51.395257 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m07:52:51.392966 [debug] [Thread-1 (]: Began running node model.hospital_analytics.billing_enhanced
[0m07:52:51.397696 [debug] [Thread-3 (]: Finished running node test.hospital_analytics.not_null_patients_age.8fed007e09
[0m07:52:51.398645 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m07:52:51.403537 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.prescriptions_enhanced, now model.hospital_analytics.billing_enhanced)
[0m07:52:51.416108 [debug] [Thread-1 (]: Began compiling node model.hospital_analytics.billing_enhanced
[0m07:52:51.404237 [debug] [Thread-3 (]: Began running node model.hospital_analytics.monthly_visit_stats
[0m07:52:51.414836 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9"
[0m07:52:51.402981 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a"
[0m07:52:51.418957 [debug] [Thread-1 (]: Writing injected SQL for node "model.hospital_analytics.billing_enhanced"
[0m07:52:51.419732 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_age.8fed007e09, now model.hospital_analytics.monthly_visit_stats)
[0m07:52:51.421899 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m07:52:51.422804 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m07:52:51.435125 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:51.424002 [debug] [Thread-1 (]: Began executing node model.hospital_analytics.billing_enhanced
[0m07:52:51.425378 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:52:51.446046 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a
[0m07:52:51.438082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:51.423381 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.monthly_visit_stats
[0m07:52:51.481772 [debug] [Thread-4 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:52:51.465370 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9
[0m07:52:51.519195 [debug] [Thread-1 (]: Finished running node model.hospital_analytics.billing_enhanced
[0m07:52:51.542793 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a, now test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b)
[0m07:52:51.564177 [debug] [Thread-4 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:52:51.554294 [debug] [Thread-2 (]: Began running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:52:51.558673 [debug] [Thread-1 (]: Began running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:52:51.544867 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.monthly_visit_stats"
[0m07:52:51.585614 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9, now test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c)
[0m07:52:51.598964 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.billing_enhanced, now test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297)
[0m07:52:51.600671 [debug] [Thread-4 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b"
[0m07:52:51.602261 [debug] [Thread-2 (]: Began compiling node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:52:51.605740 [debug] [Thread-1 (]: Began compiling node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:52:51.606248 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.monthly_visit_stats
[0m07:52:51.623302 [debug] [Thread-4 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:52:51.676298 [debug] [Thread-1 (]: Writing injected SQL for node "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297"
[0m07:52:51.680030 [debug] [Thread-2 (]: Writing injected SQL for node "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c"
[0m07:52:51.680843 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:52:51.681228 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:51.682099 [debug] [Thread-1 (]: Began executing node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:52:51.694608 [debug] [Thread-2 (]: Began executing node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:52:51.742002 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.monthly_visit_stats
[0m07:52:51.796043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:51.806240 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:52:51.806811 [debug] [Thread-3 (]: Began running node model.hospital_analytics.doctor_performance
[0m07:52:51.822604 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.hospital_analytics.monthly_visit_stats, now model.hospital_analytics.doctor_performance)
[0m07:52:51.877359 [debug] [Thread-4 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b
[0m07:52:51.874501 [debug] [Thread-3 (]: Began compiling node model.hospital_analytics.doctor_performance
[0m07:52:51.933675 [debug] [Thread-2 (]: Finished running node test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c
[0m07:52:51.888054 [debug] [Thread-4 (]: Began running node model.hospital_analytics.patient_journey
[0m07:52:51.954595 [debug] [Thread-3 (]: Writing injected SQL for node "model.hospital_analytics.doctor_performance"
[0m07:52:51.987874 [debug] [Thread-3 (]: Began executing node model.hospital_analytics.doctor_performance
[0m07:52:51.972772 [debug] [Thread-2 (]: Began running node model.hospital_analytics.patient_spending_analysis
[0m07:52:51.983202 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b, now model.hospital_analytics.patient_journey)
[0m07:52:51.999247 [debug] [Thread-4 (]: Began compiling node model.hospital_analytics.patient_journey
[0m07:52:51.998768 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c, now model.hospital_analytics.patient_spending_analysis)
[0m07:52:51.995947 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:52:52.013246 [debug] [Thread-1 (]: Finished running node test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297
[0m07:52:52.032221 [debug] [Thread-3 (]: Finished running node model.hospital_analytics.doctor_performance
[0m07:52:52.035569 [debug] [Thread-2 (]: Began compiling node model.hospital_analytics.patient_spending_analysis
[0m07:52:52.038060 [debug] [Thread-4 (]: Writing injected SQL for node "model.hospital_analytics.patient_journey"
[0m07:52:52.046119 [debug] [Thread-2 (]: Writing injected SQL for node "model.hospital_analytics.patient_spending_analysis"
[0m07:52:52.059196 [debug] [Thread-4 (]: Began executing node model.hospital_analytics.patient_journey
[0m07:52:52.061085 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:52.065979 [debug] [Thread-4 (]: Finished running node model.hospital_analytics.patient_journey
[0m07:52:52.080138 [debug] [Thread-2 (]: Began executing node model.hospital_analytics.patient_spending_analysis
[0m07:52:52.080507 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:52:52.096376 [debug] [Thread-2 (]: Finished running node model.hospital_analytics.patient_spending_analysis
[0m07:52:52.111224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:52:52.111858 [debug] [MainThread]: Connection 'model.hospital_analytics.doctor_performance' was properly closed.
[0m07:52:52.112509 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_spending_analysis' was properly closed.
[0m07:52:52.112846 [debug] [MainThread]: Connection 'test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297' was properly closed.
[0m07:52:52.113164 [debug] [MainThread]: Connection 'model.hospital_analytics.patient_journey' was properly closed.
[0m07:52:52.116233 [debug] [MainThread]: Command end result
[0m07:52:52.388786 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m07:52:52.389219 [info ] [MainThread]: Building catalog
[0m07:52:52.396780 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m07:52:52.403459 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m07:52:52.421767 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('billing_payments')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('prescriptions')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('visits')
                            ) or (
                                upper(table_schema) = upper('hospital')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:52:52.423198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:52.423916 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m07:52:52.424552 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_staging`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('doctors')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_visits')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('_hospital_medicines')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('patients')
                            ) or (
                                upper(table_schema) = upper('hospital_staging')
                            and upper(table_name) = upper('medicines')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_staging`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:52:52.498071 [debug] [ThreadPool]: Acquiring new bigquery connection 'dataeng-2025-gar.information_schema'
[0m07:52:52.505785 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_analytics`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('monthly_visit_stats')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_spending_analysis')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('doctor_performance')
                            ) or (
                                upper(table_schema) = upper('hospital_analytics')
                            and upper(table_name) = upper('patient_journey')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_analytics`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:52:52.516122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:52.523051 [debug] [ThreadPool]: On dataeng-2025-gar.information_schema: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "hospital_analytics", "target_name": "dev", "connection_name": "dataeng-2025-gar.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `dataeng-2025-gar`.`hospital_intermediate`.__TABLES__ tables
    left join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('prescriptions_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('visits_enhanced')
                            ) or (
                                upper(table_schema) = upper('hospital_intermediate')
                            and upper(table_name) = upper('billing_enhanced')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMNS columns
    join `dataeng-2025-gar`.`hospital_intermediate`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m07:52:52.526554 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:52.607094 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:53.212486 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:34df615d-e42a-4417-bce7-0acb7c9e532a&page=queryresults
[0m07:52:53.218391 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:478d0d27-2420-4a9c-b620-3bce47d80064&page=queryresults
[0m07:52:53.272053 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:a1663138-7ade-4848-baae-c80def108038&page=queryresults
[0m07:52:53.276749 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=dataeng-2025-gar&j=bq:asia-southeast2:90f17022-8c1c-4628-bdaa-f7991eaa1d92&page=queryresults
[0m07:52:54.802842 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:52:54.841719 [info ] [MainThread]: Catalog written to /usr/app/dbt/target/catalog.json
[0m07:52:54.842839 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 7.108501, "process_in_blocks": "3016", "process_kernel_time": 2.604987, "process_mem_max_rss": "210052", "process_out_blocks": "5728", "process_user_time": 4.823309}
[0m07:52:54.843232 [debug] [MainThread]: Command `dbt docs generate` succeeded at 07:52:54.843163 after 7.11 seconds
[0m07:52:54.843468 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m07:52:54.843644 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m07:52:54.843774 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m07:52:54.843891 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m07:52:54.844000 [debug] [MainThread]: Connection 'dataeng-2025-gar.information_schema' was properly closed.
[0m07:52:54.844155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e86a8be610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88f386610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e88e659b50>]}
[0m07:52:54.844701 [debug] [MainThread]: Flushing usage events
[0m07:52:57.975147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b5c49e8d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b5c2b45e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b5c2b4fd10>]}


============================== 07:52:57.977630 | edc8ef62-90c6-418f-a42f-f36c26e30ecd ==============================
[0m07:52:57.977630 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:52:57.978395 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080 --host 0.0.0.0', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:52:58.649607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'edc8ef62-90c6-418f-a42f-f36c26e30ecd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b59f47fe10>]}
[0m07:52:58.694645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'edc8ef62-90c6-418f-a42f-f36c26e30ecd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b5c49070d0>]}
